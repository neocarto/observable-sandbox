/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/deck.gl@9.0.4/dist.min.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function t(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}var r=t,n=i;function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===t||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}"function"==typeof e.setTimeout&&(r=setTimeout),"function"==typeof e.clearTimeout&&(n=clearTimeout);var o,a=[],l=!1,u=-1;function h(){l&&o&&(l=!1,o.length?a=o.concat(a):u=-1,a.length&&c())}function c(){if(!l){var e=s(h);l=!0;for(var t=a.length;t;){for(o=a,a=[];++u<t;)o&&o[u].run();u=-1,t=a.length}o=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}d.prototype.run=function(){this.fun.apply(null,this.array)};function f(){}var p=f,g=f,m=f,_=f,v=f,y=f,b=f;var A=e.performance||{},E=A.now||A.mozNow||A.msNow||A.oNow||A.webkitNow||function(){return(new Date).getTime()};var w=new Date;var x={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];a.push(new d(e,t)),1!==a.length||l||s(c)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:p,addListener:g,once:m,off:_,removeListener:v,removeAllListeners:y,emit:b,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*E.call(A),i=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(i-=e[0],(r-=e[1])<0&&(i--,r+=1e9)),[i,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-w)/1e3}},T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function C(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var S,P={exports:{}};globalThis,S=function(){var e=(()=>{var e=Object.create,t=Object.defineProperty,i=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,o=C,a=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),l=(e,i)=>{for(var r in i)t(e,r,{get:i[r],enumerable:!0})},u=(e,n,o,a)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let l of r(n))!s.call(e,l)&&l!==o&&t(e,l,{get:()=>n[l],enumerable:!(a=i(n,l))||a.enumerable});return e},h=(i,r,s)=>(s=null!=i?e(n(i)):{},u(!r&&i&&i.__esModule?s:t(s,"default",{value:i,enumerable:!0}),i)),c=(e,i,r)=>(((e,i,r)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(e,"symbol"!=typeof i?i+"":i,r),r),d=a(((e,t)=>{!function(e,i,r,n){var s,o=["","webkit","Moz","MS","ms","o"],a=i.createElement("div"),l="function",u=Math.round,h=Math.abs,c=Date.now;function d(e,t,i){return setTimeout(y(e,i),t)}function f(e,t,i){return!!Array.isArray(e)&&(p(e,i[t],i),!0)}function p(e,t,i){var r;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==n)for(r=0;r<e.length;)t.call(i,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}function g(t,i,r){var n="DEPRECATED METHOD: "+i+"\n"+r+" AT \n";return function(){var i=new Error("get-stack-trace"),r=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=e.console&&(e.console.warn||e.console.log);return s&&s.call(e.console,n,r),t.apply(this,arguments)}}s="function"!=typeof Object.assign?function(e){if(e===n||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==n&&null!==r)for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])}return t}:Object.assign;var m=g((function(e,t,i){for(var r=Object.keys(t),s=0;s<r.length;)(!i||i&&e[r[s]]===n)&&(e[r[s]]=t[r[s]]),s++;return e}),"extend","Use `assign`."),_=g((function(e,t){return m(e,t,!0)}),"merge","Use `assign`.");function v(e,t,i){var r,n=t.prototype;(r=e.prototype=Object.create(n)).constructor=e,r._super=n,i&&s(r,i)}function y(e,t){return function(){return e.apply(t,arguments)}}function b(e,t){return typeof e==l?e.apply(t&&t[0]||n,t):e}function A(e,t){return e===n?t:e}function E(e,t,i){p(C(t),(function(t){e.addEventListener(t,i,!1)}))}function w(e,t,i){p(C(t),(function(t){e.removeEventListener(t,i,!1)}))}function x(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function T(e,t){return e.indexOf(t)>-1}function C(e){return e.trim().split(/\s+/g)}function S(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var r=0;r<e.length;){if(i&&e[r][i]==t||!i&&e[r]===t)return r;r++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function M(e,t,i){for(var r=[],n=[],s=0;s<e.length;){var o=t?e[s][t]:e[s];S(n,o)<0&&r.push(e[s]),n[s]=o,s++}return i&&(r=t?r.sort((function(e,i){return e[t]>i[t]})):r.sort()),r}function R(e,t){for(var i,r,s=t[0].toUpperCase()+t.slice(1),a=0;a<o.length;){if((r=(i=o[a])?i+s:t)in e)return r;a++}return n}var I=1;function B(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}var L="ontouchstart"in e,O=R(e,"PointerEvent")!==n,F=L&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),N="touch",D="mouse",k=25,U=1,G=4,z=8,V=1,j=2,H=4,W=8,X=16,q=j|H,K=W|X,$=q|K,J=["x","y"],Y=["clientX","clientY"];function Z(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){b(e.options.enable,[e])&&i.handler(t)},this.init()}function Q(e,t,i){var r=i.pointers.length,s=i.changedPointers.length,o=t&U&&r-s==0,a=t&(G|z)&&r-s==0;i.isFirst=!!o,i.isFinal=!!a,o&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,r=t.pointers,s=r.length;i.firstInput||(i.firstInput=ee(t)),s>1&&!i.firstMultiple?i.firstMultiple=ee(t):1===s&&(i.firstMultiple=!1);var o=i.firstInput,a=i.firstMultiple,l=a?a.center:o.center,u=t.center=te(r);t.timeStamp=c(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=se(l,u),t.distance=ne(l,u),function(e,t){var i=t.center,r=e.offsetDelta||{},n=e.prevDelta||{},s=e.prevInput||{};(t.eventType===U||s.eventType===G)&&(n=e.prevDelta={x:s.deltaX||0,y:s.deltaY||0},r=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=n.x+(i.x-r.x),t.deltaY=n.y+(i.y-r.y)}(i,t),t.offsetDirection=re(t.deltaX,t.deltaY);var d=ie(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=h(d.x)>h(d.y)?d.x:d.y,t.scale=a?function(e,t){return ne(t[0],t[1],Y)/ne(e[0],e[1],Y)}(a.pointers,r):1,t.rotation=a?function(e,t){return se(t[1],t[0],Y)+se(e[1],e[0],Y)}(a.pointers,r):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,r,s,o,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=z&&(l>k||a.velocity===n)){var u=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,d=ie(l,u,c);r=d.x,s=d.y,i=h(d.x)>h(d.y)?d.x:d.y,o=re(u,c),e.lastInterval=t}else i=a.velocity,r=a.velocityX,s=a.velocityY,o=a.direction;t.velocity=i,t.velocityX=r,t.velocityY=s,t.direction=o}(i,t);var f=e.element;x(t.srcEvent.target,f)&&(f=t.srcEvent.target),t.target=f}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function ee(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:u(e.pointers[i].clientX),clientY:u(e.pointers[i].clientY)},i++;return{timeStamp:c(),pointers:t,center:te(t),deltaX:e.deltaX,deltaY:e.deltaY}}function te(e){var t=e.length;if(1===t)return{x:u(e[0].clientX),y:u(e[0].clientY)};for(var i=0,r=0,n=0;n<t;)i+=e[n].clientX,r+=e[n].clientY,n++;return{x:u(i/t),y:u(r/t)}}function ie(e,t,i){return{x:t/e||0,y:i/e||0}}function re(e,t){return e===t?V:h(e)>=h(t)?e<0?j:H:t<0?W:X}function ne(e,t,i){i||(i=J);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return Math.sqrt(r*r+n*n)}function se(e,t,i){i||(i=J);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return 180*Math.atan2(n,r)/Math.PI}Z.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(B(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(B(this.element),this.evWin,this.domHandler)}};var oe={mousedown:U,mousemove:2,mouseup:G},ae="mousedown",le="mousemove mouseup";function ue(){this.evEl=ae,this.evWin=le,this.pressed=!1,Z.apply(this,arguments)}v(ue,Z,{handler:function(e){var t=oe[e.type];t&U&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=G),this.pressed&&(t&G&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:D,srcEvent:e}))}});var he={pointerdown:U,pointermove:2,pointerup:G,pointercancel:z,pointerout:z},ce={2:N,3:"pen",4:D,5:"kinect"},de="pointerdown",fe="pointermove pointerup pointercancel";function pe(){this.evEl=de,this.evWin=fe,Z.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(de="MSPointerDown",fe="MSPointerMove MSPointerUp MSPointerCancel"),v(pe,Z,{handler:function(e){var t=this.store,i=!1,r=e.type.toLowerCase().replace("ms",""),n=he[r],s=ce[e.pointerType]||e.pointerType,o=s==N,a=S(t,e.pointerId,"pointerId");n&U&&(0===e.button||o)?a<0&&(t.push(e),a=t.length-1):n&(G|z)&&(i=!0),!(a<0)&&(t[a]=e,this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:s,srcEvent:e}),i&&t.splice(a,1))}});var ge={touchstart:U,touchmove:2,touchend:G,touchcancel:z};function me(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,Z.apply(this,arguments)}function _e(e,t){var i=P(e.touches),r=P(e.changedTouches);return t&(G|z)&&(i=M(i.concat(r),"identifier",!0)),[i,r]}v(me,Z,{handler:function(e){var t=ge[e.type];if(t===U&&(this.started=!0),this.started){var i=_e.call(this,e,t);t&(G|z)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:N,srcEvent:e})}}});var ve={touchstart:U,touchmove:2,touchend:G,touchcancel:z},ye="touchstart touchmove touchend touchcancel";function be(){this.evTarget=ye,this.targetIds={},Z.apply(this,arguments)}function Ae(e,t){var i=P(e.touches),r=this.targetIds;if(t&(2|U)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,s,o=P(e.changedTouches),a=[],l=this.target;if(s=i.filter((function(e){return x(e.target,l)})),t===U)for(n=0;n<s.length;)r[s[n].identifier]=!0,n++;for(n=0;n<o.length;)r[o[n].identifier]&&a.push(o[n]),t&(G|z)&&delete r[o[n].identifier],n++;return a.length?[M(s.concat(a),"identifier",!0),a]:void 0}v(be,Z,{handler:function(e){var t=ve[e.type],i=Ae.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:N,srcEvent:e})}});var Ee=2500;function we(){Z.apply(this,arguments);var e=y(this.handler,this);this.touch=new be(this.manager,e),this.mouse=new ue(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function xe(e,t){e&U?(this.primaryTouch=t.changedPointers[0].identifier,Te.call(this,t)):e&(G|z)&&Te.call(this,t)}function Te(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(i);e>-1&&r.splice(e,1)}),Ee)}}function Ce(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var n=this.lastTouches[r],s=Math.abs(t-n.x),o=Math.abs(i-n.y);if(s<=25&&o<=25)return!0}return!1}v(we,Z,{handler:function(e,t,i){var r=i.pointerType==N,n=i.pointerType==D;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(r)xe.call(this,t,i);else if(n&&Ce.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Se=R(a.style,"touchAction"),Pe=Se!==n,Me="compute",Re="auto",Ie="manipulation",Be="none",Le="pan-x",Oe="pan-y",Fe=function(){if(!Pe)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){t[r]=!i||e.CSS.supports("touch-action",r)})),t}();function Ne(e,t){this.manager=e,this.set(t)}Ne.prototype={set:function(e){e==Me&&(e=this.compute()),Pe&&this.manager.element.style&&Fe[e]&&(this.manager.element.style[Se]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return p(this.manager.recognizers,(function(t){b(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(T(e,Be))return Be;var t=T(e,Le),i=T(e,Oe);return t&&i?Be:t||i?t?Le:Oe:T(e,Ie)?Ie:Re}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(!this.manager.session.prevented){var r=this.actions,n=T(r,Be)&&!Fe[Be],s=T(r,Oe)&&!Fe[Oe],o=T(r,Le)&&!Fe[Le];if(n){var a=1===e.pointers.length,l=e.distance<2,u=e.deltaTime<250;if(a&&l&&u)return}return o&&s||!(n||s&&i&q||o&&i&K)?void 0:this.preventSrc(t)}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var De=1,ke=32;function Ue(e){this.options=s({},this.defaults,e||{}),this.id=I++,this.manager=null,this.options.enable=A(this.options.enable,!0),this.state=De,this.simultaneous={},this.requireFail=[]}function Ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function ze(e){return e==X?"down":e==W?"up":e==j?"left":e==H?"right":""}function Ve(e,t){var i=t.manager;return i?i.get(e):e}function je(){Ue.apply(this,arguments)}function He(){je.apply(this,arguments),this.pX=null,this.pY=null}function We(){je.apply(this,arguments)}function Xe(){Ue.apply(this,arguments),this._timer=null,this._input=null}function qe(){je.apply(this,arguments)}function Ke(){je.apply(this,arguments)}function $e(){Ue.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Je(e,t){return(t=t||{}).recognizers=A(t.recognizers,Je.defaults.preset),new Ye(e,t)}function Ye(e,t){this.options=s({},Je.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(O?pe:F?be:L?we:ue))(e,Q)}(this),this.touchAction=new Ne(this,this.options.touchAction),Ze(this,!0),p(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Ze(e,t){var i,r=e.element;r.style&&(p(e.options.cssProps,(function(n,s){i=R(r.style,s),t?(e.oldCssProps[i]=r.style[i],r.style[i]=n):r.style[i]=e.oldCssProps[i]||""})),t||(e.oldCssProps={}))}Ue.prototype={defaults:{},set:function(e){return s(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(f(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Ve(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return f(e,"dropRecognizeWith",this)||(e=Ve(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(f(e,"requireFailure",this))return this;var t=this.requireFail;return-1===S(t,e=Ve(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(f(e,"dropRequireFailure",this))return this;e=Ve(e,this);var t=S(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function r(i){t.manager.emit(i,e)}i<8&&r(t.options.event+Ge(i)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),i>=8&&r(t.options.event+Ge(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=ke},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ke|De)))return!1;e++}return!0},recognize:function(e){var t=s({},e);if(!b(this.options.enable,[this,t]))return this.reset(),void(this.state=ke);56&this.state&&(this.state=De),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},v(je,Ue,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,r=6&t,n=this.attrTest(e);return r&&(i&z||!n)?16|t:r||n?i&G?8|t:2&t?4|t:2:ke}}),v(He,je,{defaults:{event:"pan",threshold:10,pointers:1,direction:$},getTouchAction:function(){var e=this.options.direction,t=[];return e&q&&t.push(Oe),e&K&&t.push(Le),t},directionTest:function(e){var t=this.options,i=!0,r=e.distance,n=e.direction,s=e.deltaX,o=e.deltaY;return n&t.direction||(t.direction&q?(n=0===s?V:s<0?j:H,i=s!=this.pX,r=Math.abs(e.deltaX)):(n=0===o?V:o<0?W:X,i=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=n,i&&r>t.threshold&&n&t.direction},attrTest:function(e){return je.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ze(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),v(We,je,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Be]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),v(Xe,Ue,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Re]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime>t.time;if(this._input=e,!r||!i||e.eventType&(G|z)&&!n)this.reset();else if(e.eventType&U)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(e.eventType&G)return 8;return ke},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&e.eventType&G?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}}),v(qe,je,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Be]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),v(Ke,je,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:q|K,pointers:1},getTouchAction:function(){return He.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(q|K)?t=e.overallVelocity:i&q?t=e.overallVelocityX:i&K&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&h(t)>this.options.velocity&&e.eventType&G},emit:function(e){var t=ze(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),v($e,Ue,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ie]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&U&&0===this.count)return this.failTimeout();if(r&&n&&i){if(e.eventType!=G)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||ne(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&s?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return ke},failTimeout:function(){return this._timer=d((function(){this.state=ke}),this.options.interval,this),ke},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Je.VERSION="2.0.7",Je.defaults={domEvents:!1,touchAction:Me,enable:!0,inputTarget:null,inputClass:null,preset:[[qe,{enable:!1}],[We,{enable:!1},["rotate"]],[Ke,{direction:q}],[He,{direction:q},["swipe"]],[$e],[$e,{event:"doubletap",taps:2},["tap"]],[Xe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ye.prototype={set:function(e){return s(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var i,r=this.recognizers,n=t.curRecognizer;(!n||n&&8&n.state)&&(n=t.curRecognizer=null);for(var s=0;s<r.length;)i=r[s],2===t.stopped||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(e),!n&&14&i.state&&(n=t.curRecognizer=i),s++}},get:function(e){if(e instanceof Ue)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(f(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(f(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=S(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==n&&t!==n){var i=this.handlers;return p(C(e),(function(e){i[e]=i[e]||[],i[e].push(t)})),this}},off:function(e,t){if(e!==n){var i=this.handlers;return p(C(e),(function(e){t?i[e]&&i[e].splice(S(i[e],t),1):delete i[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var r=i.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<r.length;)r[n](t),n++}},destroy:function(){this.element&&Ze(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},s(Je,{INPUT_START:U,INPUT_MOVE:2,INPUT_END:G,INPUT_CANCEL:z,STATE_POSSIBLE:De,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:ke,DIRECTION_NONE:V,DIRECTION_LEFT:j,DIRECTION_RIGHT:H,DIRECTION_UP:W,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:q,DIRECTION_VERTICAL:K,DIRECTION_ALL:$,Manager:Ye,Input:Z,TouchAction:Ne,TouchInput:be,MouseInput:ue,PointerEventInput:pe,TouchMouseInput:we,SingleTouchInput:me,Recognizer:Ue,AttrRecognizer:je,Tap:$e,Pan:He,Swipe:Ke,Pinch:We,Rotate:qe,Press:Xe,on:E,off:w,each:p,merge:_,extend:m,assign:s,inherit:v,bindFn:y,prefixed:R}),(typeof e<"u"?e:typeof self<"u"?self:{}).Hammer=Je,"function"===n&&(void 0).amd?(void 0)((function(){return Je})):typeof t<"u"&&t.exports?t.exports=Je:e.Hammer=Je}(window,document)})),f=a(((e,t)=>{function i(e,t,i){i=i||2;var n,o,a,l,u,d,f,g=t&&t.length,m=g?t[0]*i:e.length,_=r(e,0,m,i,!0),v=[];if(!_||_.next===_.prev)return v;if(g&&(_=function(e,t,i,n){var s,o,a,l,u,d=[];for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:e.length,(u=r(e,a,l,n,!1))===u.next&&(u.steiner=!0),d.push(p(u));for(d.sort(h),s=0;s<d.length;s++)i=c(d[s],i);return i}(e,t,_,i)),e.length>80*i){n=a=e[0],o=l=e[1];for(var y=i;y<m;y+=i)(u=e[y])<n&&(n=u),(d=e[y+1])<o&&(o=d),u>a&&(a=u),d>l&&(l=d);f=0!==(f=Math.max(a-n,l-o))?32767/f:0}return s(_,v,i,n,o,f,0),v}function r(e,t,i,r,n){var s,o;if(n===S(e,t,i,r)>0)for(s=t;s<i;s+=r)o=x(s,e[s],e[s+1],o);else for(s=i-r;s>=t;s-=r)o=x(s,e[s],e[s+1],o);return o&&v(o,o.next)&&(T(o),o=o.next),o}function n(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{if(T(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function s(e,t,i,r,h,c,d){if(e){!d&&c&&function(e,t,i,r){var n=e;do{0===n.z&&(n.z=f(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,s,o,a,l,u=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,r=i,a=0,t=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,u*=2}while(o>1)}(n)}(e,r,h,c);for(var p,g,m=e;e.prev!==e.next;)if(p=e.prev,g=e.next,c?a(e,r,h,c):o(e))t.push(p.i/i|0),t.push(e.i/i|0),t.push(g.i/i|0),T(e),e=g.next,m=g.next;else if((e=g)===m){d?1===d?s(e=l(n(e),t,i),t,i,r,h,c,2):2===d&&u(e,t,i,r,h,c):s(n(e),t,i,r,h,c,1);break}}}function o(e){var t=e.prev,i=e,r=e.next;if(_(t,i,r)>=0)return!1;for(var n=t.x,s=i.x,o=r.x,a=t.y,l=i.y,u=r.y,h=n<s?n<o?n:o:s<o?s:o,c=a<l?a<u?a:u:l<u?l:u,d=n>s?n>o?n:o:s>o?s:o,f=a>l?a>u?a:u:l>u?l:u,p=r.next;p!==t;){if(p.x>=h&&p.x<=d&&p.y>=c&&p.y<=f&&g(n,a,s,l,o,u,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function a(e,t,i,r){var n=e.prev,s=e,o=e.next;if(_(n,s,o)>=0)return!1;for(var a=n.x,l=s.x,u=o.x,h=n.y,c=s.y,d=o.y,p=a<l?a<u?a:u:l<u?l:u,m=h<c?h<d?h:d:c<d?c:d,v=a>l?a>u?a:u:l>u?l:u,y=h>c?h>d?h:d:c>d?c:d,b=f(p,m,t,i,r),A=f(v,y,t,i,r),E=e.prevZ,w=e.nextZ;E&&E.z>=b&&w&&w.z<=A;){if(E.x>=p&&E.x<=v&&E.y>=m&&E.y<=y&&E!==n&&E!==o&&g(a,h,l,c,u,d,E.x,E.y)&&_(E.prev,E,E.next)>=0||(E=E.prevZ,w.x>=p&&w.x<=v&&w.y>=m&&w.y<=y&&w!==n&&w!==o&&g(a,h,l,c,u,d,w.x,w.y)&&_(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;E&&E.z>=b;){if(E.x>=p&&E.x<=v&&E.y>=m&&E.y<=y&&E!==n&&E!==o&&g(a,h,l,c,u,d,E.x,E.y)&&_(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;w&&w.z<=A;){if(w.x>=p&&w.x<=v&&w.y>=m&&w.y<=y&&w!==n&&w!==o&&g(a,h,l,c,u,d,w.x,w.y)&&_(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function l(e,t,i){var r=e;do{var s=r.prev,o=r.next.next;!v(s,o)&&y(s,r,r.next,o)&&E(s,o)&&E(o,s)&&(t.push(s.i/i|0),t.push(r.i/i|0),t.push(o.i/i|0),T(r),T(r.next),r=e=o),r=r.next}while(r!==e);return n(r)}function u(e,t,i,r,o,a){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&m(l,u)){var h=w(l,u);return l=n(l,l.next),h=n(h,h.next),s(l,t,i,r,o,a,0),void s(h,t,i,r,o,a,0)}u=u.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function c(e,t){var i=function(e,t){var i,r=t,n=e.x,s=e.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o&&(o=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==t);if(!i)return null;var l,u=i,h=i.x,c=i.y,f=1/0;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&g(s<c?n:o,s,h,c,s<c?o:n,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(n-r.x),E(r,e)&&(l<f||l===f&&(r.x>i.x||r.x===i.x&&d(i,r)))&&(i=r,f=l)),r=r.next}while(r!==u);return i}(e,t);if(!i)return t;var r=w(i,e);return n(r,r.next),n(i,i.next)}function d(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function f(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,r,n,s,o,a){return(n-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(r-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(n-o)*(r-a)}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&y(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(E(e,t)&&E(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||v(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,i,r){var n=A(_(e,t,i)),s=A(_(e,t,r)),o=A(_(i,r,e)),a=A(_(i,r,t));return!!(n!==s&&o!==a||0===n&&b(e,i,t)||0===s&&b(e,r,t)||0===o&&b(i,e,r)||0===a&&b(i,t,r))}function b(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function A(e){return e>0?1:e<0?-1:0}function E(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function w(e,t){var i=new C(e.i,e.x,e.y),r=new C(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function x(e,t,i,r){var n=new C(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,i,r){for(var n=0,s=t,o=i-r;s<i;s+=r)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}t.exports=i,t.exports.default=i,i.deviation=function(e,t,i,r){var n=t&&t.length,s=n?t[0]*i:e.length,o=Math.abs(S(e,0,s,i));if(n)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,h=a<l-1?t[a+1]*i:e.length;o-=Math.abs(S(e,u,h,i))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,f=r[a+1]*i,p=r[a+2]*i;c+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},i.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[n][s][o]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}})),p=a((e=>{var t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+i+"$");e.isExist=function(e){return typeof e<"u"},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,i){if(t){let r=Object.keys(t),n=r.length;for(let s=0;s<n;s++)e[r[s]]="strict"===i?[t[r[s]]]:t[r[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){let t=r.exec(e);return!(null===t||typeof t>"u")},e.getAllMatches=function(e,t){let i=[],r=t.exec(e);for(;r;){let n=[];n.startIndex=t.lastIndex-r[0].length;let s=r.length;for(let e=0;e<s;e++)n.push(r[e]);i.push(n),r=t.exec(e)}return i},e.nameRegexp=i})),g=a((e=>{var t=p(),i={allowBooleanAttributes:!1,unpairedTags:[]};function r(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function n(e,t){let i=t;for(;t<e.length;t++)if("?"==e[t]||" "==e[t]){let r=e.substr(i,t-i);if(t>5&&"xml"===r)return d("InvalidXml","XML declaration allowed only at the start of the document.",m(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}continue}return t}function s(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let i=1;for(t+=8;t<e.length;t++)if("<"===e[t])i++;else if(">"===e[t]&&(i--,0===i))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}e.validate=function(e,t){t=Object.assign({},i,t);let o=[],a=!1,u=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let i=0;i<e.length;i++)if("<"===e[i]&&"?"===e[i+1]){if(i+=2,i=n(e,i),i.err)return i}else{if("<"!==e[i]){if(r(e[i]))continue;return d("InvalidChar","char '"+e[i]+"' is not expected.",m(e,i))}{let f=i;if(i++,"!"===e[i]){i=s(e,i);continue}{let p=!1;"/"===e[i]&&(p=!0,i++);let _="";for(;i<e.length&&">"!==e[i]&&" "!==e[i]&&"\t"!==e[i]&&"\n"!==e[i]&&"\r"!==e[i];i++)_+=e[i];if(_=_.trim(),"/"===_[_.length-1]&&(_=_.substring(0,_.length-1),i--),!g(_)){let t;return t=0===_.trim().length?"Invalid space after '<'.":"Tag '"+_+"' is an invalid name.",d("InvalidTag",t,m(e,i))}let v=l(e,i);if(!1===v)return d("InvalidAttr","Attributes for '"+_+"' have open quote.",m(e,i));let y=v.value;if(i=v.index,"/"===y[y.length-1]){let r=i-y.length;y=y.substring(0,y.length-1);let n=h(y,t);if(!0!==n)return d(n.err.code,n.err.msg,m(e,r+n.err.line));a=!0}else if(p){if(!v.tagClosed)return d("InvalidTag","Closing tag '"+_+"' doesn't have proper closing.",m(e,i));if(y.trim().length>0)return d("InvalidTag","Closing tag '"+_+"' can't have attributes or invalid starting.",m(e,f));{let t=o.pop();if(_!==t.tagName){let i=m(e,t.tagStartPos);return d("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+i.line+", col "+i.col+") instead of closing tag '"+_+"'.",m(e,f))}0==o.length&&(u=!0)}}else{let r=h(y,t);if(!0!==r)return d(r.err.code,r.err.msg,m(e,i-y.length+r.err.line));if(!0===u)return d("InvalidXml","Multiple possible root nodes found.",m(e,i));-1!==t.unpairedTags.indexOf(_)||o.push({tagName:_,tagStartPos:f}),a=!0}for(i++;i<e.length;i++)if("<"===e[i]){if("!"===e[i+1]){i++,i=s(e,i);continue}if("?"!==e[i+1])break;if(i=n(e,++i),i.err)return i}else if("&"===e[i]){let t=c(e,i);if(-1==t)return d("InvalidChar","char '&' is not expected.",m(e,i));i=t}else if(!0===u&&!r(e[i]))return d("InvalidXml","Extra text at the end",m(e,i));"<"===e[i]&&i--}}}return a?1==o.length?d("InvalidTag","Unclosed tag '"+o[0].tagName+"'.",m(e,o[0].tagStartPos)):!(o.length>0)||d("InvalidXml","Invalid '"+JSON.stringify(o.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):d("InvalidXml","Start tag expected.",1)};var o='"',a="'";function l(e,t){let i="",r="",n=!1;for(;t<e.length;t++){if(e[t]===o||e[t]===a)""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){n=!0;break}i+=e[t]}return""===r&&{value:i,index:t,tagClosed:n}}var u=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function h(e,i){let r=t.getAllMatches(e,u),n={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return d("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",_(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return d("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",_(r[e]));if(void 0===r[e][3]&&!i.allowBooleanAttributes)return d("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",_(r[e]));let t=r[e][2];if(!f(t))return d("InvalidAttr","Attribute '"+t+"' is an invalid name.",_(r[e]));if(n.hasOwnProperty(t))return d("InvalidAttr","Attribute '"+t+"' is repeated.",_(r[e]));n[t]=1}return!0}function c(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let i=/\d/;for("x"===e[t]&&(t++,i=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(i))break}return-1}(e,++t);let i=0;for(;t<e.length;t++,i++)if(!(e[t].match(/\w/)&&i<20)){if(";"===e[t])break;return-1}return t}function d(e,t,i){return{err:{code:e,msg:t,line:i.line||i,col:i.col}}}function f(e){return t.isName(e)}function g(e){return t.isName(e)}function m(e,t){let i=e.substring(0,t).split(/\r?\n/);return{line:i.length,col:i[i.length-1].length+1}}function _(e){return e.startIndex+e[1].length}})),m=a((e=>{var t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,i){return e}};e.buildOptions=function(e){return Object.assign({},t,e)},e.defaultOptions=t})),_=a(((e,t)=>{t.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}})),v=a(((e,t)=>{var i=p();function r(e,t){let i="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)i+=e[t];if(i=i.trim(),-1!==i.indexOf(" "))throw new Error("External entites are not supported");let r=e[t++],n="";for(;t<e.length&&e[t]!==r;t++)n+=e[t];return[i,n,t]}function n(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function s(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function a(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function l(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function u(e){if(i.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}t.exports=function(e,t){let i={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let h=1,c=!1,d=!1,f="";for(;t<e.length;t++)if("<"!==e[t]||d)if(">"===e[t]){if(d?"-"===e[t-1]&&"-"===e[t-2]&&(d=!1,h--):h--,0===h)break}else"["===e[t]?c=!0:f+=e[t];else{if(c&&s(e,t))t+=7,[entityName,val,t]=r(e,t+1),-1===val.indexOf("&")&&(i[u(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(c&&o(e,t))t+=8;else if(c&&a(e,t))t+=8;else if(c&&l(e,t))t+=9;else{if(!n)throw new Error("Invalid DOCTYPE");d=!0}h++,f=""}if(0!==h)throw new Error("Unclosed DOCTYPE")}return{entities:i,i:t}}})),y=a(((e,t)=>{var i=/^[-+]?0x[a-fA-F0-9]+$/,r=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var n={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};t.exports=function(e,t={}){if(t=Object.assign({},n,t),!e||"string"!=typeof e)return e;let s=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(s))return e;if(t.hex&&i.test(s))return Number.parseInt(s,16);{let i=r.exec(s);if(i){let r=i[1],n=i[2],o=function(e){return e&&-1!==e.indexOf(".")&&("."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1))),e}(i[3]),a=i[4]||i[6];if(!t.leadingZeros&&n.length>0&&r&&"."!==s[2])return e;if(!t.leadingZeros&&n.length>0&&!r&&"."!==s[1])return e;{let i=Number(s),l=""+i;return-1!==l.search(/[eE]/)||a?t.eNotation?i:e:-1!==s.indexOf(".")?"0"===l&&""===o||l===o||r&&l==="-"+o?i:e:n?o===l||r+o===l?i:e:s===l||s===r+l?i:e}}return e}}})),b=a(((e,t)=>{var i=p(),r=_(),n=v(),s=y();function o(e){let t=Object.keys(e);for(let i=0;i<t.length;i++){let r=t[i];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function a(e,t,i,r,n,s,o){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));let r=this.options.tagValueProcessor(t,e,i,n,s);return null==r?e:typeof r!=typeof e||r!==e?r:this.options.trimValues||e.trim()===e?w(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function l(e){if(this.options.removeNSPrefix){let t=e.split(":"),i="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=i+t[1])}return e}var u=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function h(e,t,r){if(!this.options.ignoreAttributes&&"string"==typeof e){let r=i.getAllMatches(e,u),n=r.length,s={};for(let e=0;e<n;e++){let i=this.resolveNameSpace(r[e][1]),n=r[e][4],o=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==n){this.options.trimValues&&(n=n.trim()),n=this.replaceEntitiesValue(n);let e=this.options.attributeValueProcessor(i,n,t);s[o]=null==e?n:typeof e!=typeof n||e!==n?e:w(n,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[o]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){let e={};return e[this.options.attributesGroupName]=s,e}return s}}var c=function(e){e=e.replace(/\r\n?/g,"\n");let t=new r("!xml"),i=t,s="",o="";for(let a=0;a<e.length;a++)if("<"===e[a])if("/"===e[a+1]){let t=b(e,">",a,"Closing Tag is not closed."),r=e.substring(a+2,t).trim();if(this.options.removeNSPrefix){let e=r.indexOf(":");-1!==e&&(r=r.substr(e+1))}this.options.transformTagName&&(r=this.options.transformTagName(r)),i&&(s=this.saveTextToParentTag(s,i,o));let n=o.substring(o.lastIndexOf(".")+1);if(r&&-1!==this.options.unpairedTags.indexOf(r))throw new Error(`Unpaired tag can not be used as closing tag: </${r}>`);let l=0;n&&-1!==this.options.unpairedTags.indexOf(n)?(l=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=o.lastIndexOf("."),o=o.substring(0,l),i=this.tagsNodeStack.pop(),s="",a=t}else if("?"===e[a+1]){let t=A(e,a,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,i,o),!(this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags)){let e=new r(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,o,t.tagName)),this.addChild(i,e,o)}a=t.closeIndex+1}else if("!--"===e.substr(a+1,3)){let t=b(e,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){let r=e.substring(a+4,t-2);s=this.saveTextToParentTag(s,i,o),i.add(this.options.commentPropName,[{[this.options.textNodeName]:r}])}a=t}else if("!D"===e.substr(a+1,2)){let t=n(e,a);this.docTypeEntities=t.entities,a=t.i}else if("!["===e.substr(a+1,2)){let t=b(e,"]]>",a,"CDATA is not closed.")-2,r=e.substring(a+9,t);s=this.saveTextToParentTag(s,i,o);let n=this.parseTextData(r,i.tagname,o,!0,!1,!0,!0);null==n&&(n=""),this.options.cdataPropName?i.add(this.options.cdataPropName,[{[this.options.textNodeName]:r}]):i.add(this.options.textNodeName,n),a=t+2}else{let n=A(e,a,this.options.removeNSPrefix),l=n.tagName,u=n.rawTagName,h=n.tagExp,c=n.attrExpPresent,d=n.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),i&&s&&"!xml"!==i.tagname&&(s=this.saveTextToParentTag(s,i,o,!1));let f=i;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(i=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),l!==t.tagname&&(o+=o?"."+l:l),this.isItStopNode(this.options.stopNodes,o,l)){let t="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)a=n.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(l))a=n.closeIndex;else{let i=this.readStopNodeData(e,u,d+1);if(!i)throw new Error(`Unexpected end of ${u}`);a=i.i,t=i.tagContent}let s=new r(l);l!==h&&c&&(s[":@"]=this.buildAttributesMap(h,o,l)),t&&(t=this.parseTextData(t,l,o,!0,c,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),s.add(this.options.textNodeName,t),this.addChild(i,s,o)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){"/"===l[l.length-1]?(l=l.substr(0,l.length-1),o=o.substr(0,o.length-1),h=l):h=h.substr(0,h.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));let e=new r(l);l!==h&&c&&(e[":@"]=this.buildAttributesMap(h,o,l)),this.addChild(i,e,o),o=o.substr(0,o.lastIndexOf("."))}else{let e=new r(l);this.tagsNodeStack.push(i),l!==h&&c&&(e[":@"]=this.buildAttributesMap(h,o,l)),this.addChild(i,e,o),i=e}s="",a=d}}else s+=e[a];return t.child};function d(e,t,i){let r=this.options.updateTag(t.tagname,i,t[":@"]);!1===r||("string"==typeof r&&(t.tagname=r),e.addChild(t))}var f=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){let i=this.docTypeEntities[t];e=e.replace(i.regx,i.val)}for(let t in this.lastEntities){let i=this.lastEntities[t];e=e.replace(i.regex,i.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){let i=this.htmlEntities[t];e=e.replace(i.regex,i.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function g(e,t,i,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,i,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function m(e,t,i){let r="*."+i;for(let i in e){let n=e[i];if(r===n||t===n)return!0}return!1}function b(e,t,i,r){let n=e.indexOf(t,i);if(-1===n)throw new Error(r);return n+t.length-1}function A(e,t,i,r=">"){let n=function(e,t,i=">"){let r,n="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===i[0]){if(!i[1])return{data:n,index:s};if(e[s+1]===i[1])return{data:n,index:s}}else"\t"===t&&(t=" ");n+=t}}(e,t+1,r);if(!n)return;let s=n.data,o=n.index,a=s.search(/\s/),l=s,u=!0;-1!==a&&(l=s.substring(0,a),s=s.substring(a+1).trimStart());let h=l;if(i){let e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),u=l!==n.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:u,rawTagName:h}}function E(e,t,i){let r=i,n=1;for(;i<e.length;i++)if("<"===e[i])if("/"===e[i+1]){let s=b(e,">",i,`${t} is not closed`);if(e.substring(i+2,s).trim()===t&&(n--,0===n))return{tagContent:e.substring(r,i),i:s};i=s}else if("?"===e[i+1])i=b(e,"?>",i+1,"StopNode is not closed.");else if("!--"===e.substr(i+1,3))i=b(e,"--\x3e",i+3,"StopNode is not closed.");else if("!["===e.substr(i+1,2))i=b(e,"]]>",i,"StopNode is not closed.")-2;else{let r=A(e,i,">");r&&((r&&r.tagName)===t&&"/"!==r.tagExp[r.tagExp.length-1]&&n++,i=r.closeIndex)}}function w(e,t,r){if(t&&"string"==typeof e){let t=e.trim();return"true"===t||"false"!==t&&s(e,r)}return i.isExist(e)?e:""}t.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=o,this.parseXml=c,this.parseTextData=a,this.resolveNameSpace=l,this.buildAttributesMap=h,this.isItStopNode=m,this.replaceEntitiesValue=f,this.readStopNodeData=E,this.saveTextToParentTag=g,this.addChild=d}}})),A=a((e=>{function t(e,s,o){let a,l={};for(let u=0;u<e.length;u++){let h=e[u],c=i(h),d="";if(d=void 0===o?c:o+"."+c,c===s.textNodeName)void 0===a?a=h[c]:a+=""+h[c];else{if(void 0===c)continue;if(h[c]){let e=t(h[c],s,d),i=n(e,s);h[":@"]?r(e,h[":@"],d,s):1!==Object.keys(e).length||void 0===e[s.textNodeName]||s.alwaysCreateTextNode?0===Object.keys(e).length&&(s.alwaysCreateTextNode?e[s.textNodeName]="":e=""):e=e[s.textNodeName],void 0!==l[c]&&l.hasOwnProperty(c)?(Array.isArray(l[c])||(l[c]=[l[c]]),l[c].push(e)):s.isArray(c,d,i)?l[c]=[e]:l[c]=e}}}return"string"==typeof a?a.length>0&&(l[s.textNodeName]=a):void 0!==a&&(l[s.textNodeName]=a),l}function i(e){let t=Object.keys(e);for(let e=0;e<t.length;e++){let i=t[e];if(":@"!==i)return i}}function r(e,t,i,r){if(t){let n=Object.keys(t),s=n.length;for(let o=0;o<s;o++){let s=n[o];r.isArray(s,i+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function n(e,t){let{textNodeName:i}=t,r=Object.keys(e).length;return!(0!==r&&(1!==r||!e[i]&&"boolean"!=typeof e[i]&&0!==e[i]))}e.prettify=function(e,i){return t(e,i)}})),E=a(((e,t)=>{var{buildOptions:i}=m(),r=b(),{prettify:n}=A(),s=g();t.exports=class{constructor(e){this.externalEntities={},this.options=i(e)}parse(e,t){if("string"!=typeof e){if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});let i=s.validate(e,t);if(!0!==i)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}let i=new r(this.options);i.addExternalEntities(this.externalEntities);let o=i.parseXml(e);return this.options.preserveOrder||void 0===o?o:n(o,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}})),w=a(((e,t)=>{function i(e,t,a,l){let u="",h=!1;for(let c=0;c<e.length;c++){let d=e[c],f=r(d);if(void 0===f)continue;let p="";if(p=0===a.length?f:`${a}.${f}`,f===t.textNodeName){let e=d[f];s(p,t)||(e=t.tagValueProcessor(f,e),e=o(e,t)),h&&(u+=l),u+=e,h=!1;continue}if(f===t.cdataPropName){h&&(u+=l),u+=`<![CDATA[${d[f][0][t.textNodeName]}]]>`,h=!1;continue}if(f===t.commentPropName){u+=l+`\x3c!--${d[f][0][t.textNodeName]}--\x3e`,h=!0;continue}if("?"===f[0]){let e=n(d[":@"],t),i="?xml"===f?"":l,r=d[f][0][t.textNodeName];r=0!==r.length?" "+r:"",u+=i+`<${f}${r}${e}?>`,h=!0;continue}let g=l;""!==g&&(g+=t.indentBy);let m=l+`<${f}${n(d[":@"],t)}`,_=i(d[f],t,p,g);-1!==t.unpairedTags.indexOf(f)?t.suppressUnpairedNode?u+=m+">":u+=m+"/>":_&&0!==_.length||!t.suppressEmptyNode?_&&_.endsWith(">")?u+=m+`>${_}${l}</${f}>`:(u+=m+">",_&&""!==l&&(_.includes("/>")||_.includes("</"))?u+=l+t.indentBy+_+l:u+=_,u+=`</${f}>`):u+=m+"/>",h=!0}return u}function r(e){let t=Object.keys(e);for(let i=0;i<t.length;i++){let r=t[i];if(e.hasOwnProperty(r)&&":@"!==r)return r}}function n(e,t){let i="";if(e&&!t.ignoreAttributes)for(let r in e){if(!e.hasOwnProperty(r))continue;let n=t.attributeValueProcessor(r,e[r]);n=o(n,t),!0===n&&t.suppressBooleanAttributes?i+=` ${r.substr(t.attributeNamePrefix.length)}`:i+=` ${r.substr(t.attributeNamePrefix.length)}="${n}"`}return i}function s(e,t){let i=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+i)return!0;return!1}function o(e,t){if(e&&e.length>0&&t.processEntities)for(let i=0;i<t.entities.length;i++){let r=t.entities[i];e=e.replace(r.regex,r.val)}return e}t.exports=function(e,t){let r="";return t.format&&t.indentBy.length>0&&(r="\n"),i(e,t,"",r)}})),S=a(((e,t)=>{var i=w(),r={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function n(e){this.options=Object.assign({},r,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=a),this.processTextOrObjNode=s,this.options.format?(this.indentate=o,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function s(e,t,i){let r=this.j2x(e,i+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,r.attrStr,i):this.buildObjectNode(r.val,t,r.attrStr,i)}function o(e){return this.options.indentBy.repeat(e)}function a(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}n.prototype.build=function(e){return this.options.preserveOrder?i(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},n.prototype.j2x=function(e,t){let i="",r="";for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n))if(typeof e[n]>"u")this.isAttribute(n)&&(r+="");else if(null===e[n])this.isAttribute(n)?r+="":"?"===n[0]?r+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(e[n]instanceof Date)r+=this.buildTextValNode(e[n],n,"",t);else if("object"!=typeof e[n]){let s=this.isAttribute(n);if(s)i+=this.buildAttrPairStr(s,""+e[n]);else if(n===this.options.textNodeName){let t=this.options.tagValueProcessor(n,""+e[n]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextValNode(e[n],n,"",t)}else if(Array.isArray(e[n])){let i=e[n].length,s="";for(let o=0;o<i;o++){let i=e[n][o];typeof i>"u"||(null===i?"?"===n[0]?r+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+n+"/"+this.tagEndChar:"object"==typeof i?this.options.oneListGroup?s+=this.j2x(i,t+1).val:s+=this.processTextOrObjNode(i,n,t):s+=this.buildTextValNode(i,n,"",t))}this.options.oneListGroup&&(s=this.buildObjectNode(s,n,"",t)),r+=s}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){let t=Object.keys(e[n]),r=t.length;for(let s=0;s<r;s++)i+=this.buildAttrPairStr(t[s],""+e[n][t[s]])}else r+=this.processTextOrObjNode(e[n],n,t);return{attrStr:i,val:r}},n.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},n.prototype.buildObjectNode=function(e,t,i,r){if(""===e)return"?"===t[0]?this.indentate(r)+"<"+t+i+"?"+this.tagEndChar:this.indentate(r)+"<"+t+i+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",n=""),!i&&""!==i||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+i+s+this.tagEndChar+e+this.indentate(r)+n:this.indentate(r)+"<"+t+i+s+">"+e+n}},n.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},n.prototype.buildTextValNode=function(e,t,i,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(r)+"<"+t+i+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,e);return n=this.replaceEntitiesValue(n),""===n?this.indentate(r)+"<"+t+i+this.closeTag(t)+this.tagEndChar:this.indentate(r)+"<"+t+i+">"+n+"</"+t+this.tagEndChar}},n.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){let i=this.options.entities[t];e=e.replace(i.regex,i.val)}return e},t.exports=n})),P=a(((e,t)=>{var i=g(),r=E(),n=S();t.exports={XMLParser:r,XMLValidator:i,XMLBuilder:n}})),M=a(((e,t)=>{var i,r;i=e,r=function(){function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var i={},r={};function n(e,t){var n,s,a;return t?(a=0<=(e>>>=0)&&e<256)&&(s=r[e])?s:(n=o(e,(0|e)<0?-1:0,!0),a&&(r[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(s=i[e])?s:(n=o(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function s(e,t){if(isNaN(e)||!isFinite(e))return t?g:p;if(t){if(e<0)return g;if(e>=c)return b}else{if(e<=-d)return A;if(e+1>=d)return y}return e<0?s(-e,t).neg():o(e%h|0,e/h|0,t)}function o(t,i,r){return new e(t,i,r)}e.fromInt=n,e.fromNumber=s,e.fromBits=o;var a=Math.pow;function l(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,i).neg();for(var n=s(a(i,8)),o=p,u=0;u<e.length;u+=8){var h=Math.min(8,e.length-u),c=parseInt(e.substring(u,u+h),i);if(h<8){var d=s(a(i,h));o=o.mul(d).add(s(c))}else o=(o=o.mul(n)).add(s(c))}return o.unsigned=t,o}function u(t){return t instanceof e?t:"number"==typeof t?s(t):"string"==typeof t?l(t):o(t.low,t.high,t.unsigned)}e.fromString=l,e.fromValue=u;var h=4294967296,c=h*h,d=c/2,f=n(1<<24),p=n(0);e.ZERO=p;var g=n(0,!0);e.UZERO=g;var m=n(1);e.ONE=m;var _=n(1,!0);e.UONE=_;var v=n(-1);e.NEG_ONE=v;var y=o(-1,2147483647,!1);e.MAX_VALUE=y;var b=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=b;var A=o(0,-2147483648,!1);e.MIN_VALUE=A;var E=e.prototype;return E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},E.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(A)){var t=s(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=s(a(e,6),this.unsigned),o=this,l="";;){var u=o.div(n),h=(o.sub(u.mul(n)).toInt()>>>0).toString(e);if((o=u).isZero())return h+l;for(;h.length<6;)h="0"+h;l=""+h+l}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},E.isZero=function(){return 0===this.high&&0===this.low},E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(e){return t(e)||(e=u(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},E.eq=E.equals,E.notEquals=function(e){return!this.eq(e)},E.neq=E.notEquals,E.lessThan=function(e){return this.comp(e)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(e){return this.comp(e)<=0},E.lte=E.lessThanOrEqual,E.greaterThan=function(e){return this.comp(e)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(e){return this.comp(e)>=0},E.gte=E.greaterThanOrEqual,E.compare=function(e){if(t(e)||(e=u(e)),this.eq(e))return 0;var i=this.isNegative(),r=e.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(m)},E.neg=E.negate,E.add=function(e){t(e)||(e=u(e));var i=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,a=e.high>>>16,l=65535&e.high,h=e.low>>>16,c=0,d=0,f=0,p=0;return f+=(p+=s+(65535&e.low))>>>16,d+=(f+=n+h)>>>16,c+=(d+=r+l)>>>16,c+=i+a,o((f&=65535)<<16|(p&=65535),(c&=65535)<<16|(d&=65535),this.unsigned)},E.subtract=function(e){return t(e)||(e=u(e)),this.add(e.neg())},E.sub=E.subtract,E.multiply=function(e){if(this.isZero()||(t(e)||(e=u(e)),e.isZero()))return p;if(this.eq(A))return e.isOdd()?A:p;if(e.eq(A))return this.isOdd()?A:p;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(f)&&e.lt(f))return s(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,n=this.low>>>16,a=65535&this.low,l=e.high>>>16,h=65535&e.high,c=e.low>>>16,d=65535&e.low,g=0,m=0,_=0,v=0;return _+=(v+=a*d)>>>16,m+=(_+=n*d)>>>16,_&=65535,m+=(_+=a*c)>>>16,g+=(m+=r*d)>>>16,m&=65535,g+=(m+=n*c)>>>16,m&=65535,g+=(m+=a*h)>>>16,g+=i*d+r*c+n*h+a*l,o((_&=65535)<<16|(v&=65535),(g&=65535)<<16|(m&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(e){if(t(e)||(e=u(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?g:p;var i,r,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return _;n=g}else{if(this.eq(A))return e.eq(m)||e.eq(v)?A:e.eq(A)?m:(i=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?m:v:(r=this.sub(e.mul(i)),n=i.add(r.div(e)));if(e.eq(A))return this.unsigned?g:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=p}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),l=o<=48?1:a(2,o-48),h=s(i),c=h.mul(e);c.isNegative()||c.gt(r);)c=(h=s(i-=l,this.unsigned)).mul(e);h.isZero()&&(h=m),n=n.add(h),r=r.sub(c)}return n},E.div=E.divide,E.modulo=function(e){return t(e)||(e=u(e)),this.sub(this.div(e).mul(e))},E.mod=E.modulo,E.not=function(){return o(~this.low,~this.high,this.unsigned)},E.and=function(e){return t(e)||(e=u(e)),o(this.low&e.low,this.high&e.high,this.unsigned)},E.or=function(e){return t(e)||(e=u(e)),o(this.low|e.low,this.high|e.high,this.unsigned)},E.xor=function(e){return t(e)||(e=u(e)),o(this.low^e.low,this.high^e.high,this.unsigned)},E.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?o(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):o(0,this.low<<e-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?o(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):o(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0==(e&=63))return this;var i=this.high;return e<32?o(this.low>>>e|i<<32-e,i>>>e,this.unsigned):o(32===e?i:i>>>e-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e},"function"==typeof o&&"object"==typeof t&&t&&t.exports?t.exports=r():(i.dcodeIO=i.dcodeIO||{}).Long=r()})),R=a(((e,t)=>{t.exports=globalThis.h3||{}})),I=a((e=>{e.read=function(e,t,i,r,n){var s,o,a=8*n-r-1,l=(1<<a)-1,u=l>>1,h=-7,c=i?n-1:0,d=i?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=a;h>0;s=256*s+e[t+c],c+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=u}return(f?-1:1)*o*Math.pow(2,s-r)},e.write=function(e,t,i,r,n,s){var o,a,l,u=8*s-n-1,h=(1<<u)-1,c=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(o++,l/=2),o+c>=h?(a=0,o=h):o+c>=1?(a=(t*l-1)*Math.pow(2,n),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,n),o=0));n>=8;e[i+f]=255&a,f+=p,a/=256,n-=8);for(o=o<<n|a,u+=n;u>0;e[i+f]=255&o,f+=p,o/=256,u-=8);e[i+f-p]|=128*g}})),B=a(((e,t)=>{t.exports=r;var i=I();function r(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var n=4294967296,s=1/n,o=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function a(e){return e.type===r.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function u(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function h(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function c(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function g(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function _(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function v(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function y(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function b(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,e(n,t,this),this.pos===s&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=v(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=b(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=v(this.buf,this.pos)+v(this.buf,this.pos+4)*n;return this.pos+=8,e},readSFixed64:function(){var e=v(this.buf,this.pos)+b(this.buf,this.pos+4)*n;return this.pos+=8,e},readFloat:function(){var e=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128||(t|=(127&(i=r[this.pos++]))<<7,i<128)||(t|=(127&(i=r[this.pos++]))<<14,i<128)||(t|=(127&(i=r[this.pos++]))<<21,i<128)?t:function(e,t,i){var r,n,s=i.buf;if(n=s[i.pos++],r=(112&n)>>4,n<128||(n=s[i.pos++],r|=(127&n)<<3,n<128)||(n=s[i.pos++],r|=(127&n)<<10,n<128)||(n=s[i.pos++],r|=(127&n)<<17,n<128)||(n=s[i.pos++],r|=(127&n)<<24,n<128)||(n=s[i.pos++],r|=(1&n)<<31,n<128))return function(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&o?function(e,t,i){return o.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var s,o,a,l=e[n],u=null,h=l>239?4:l>223?3:l>191?2:1;if(n+h>i)break;1===h?l<128&&(u=l):2===h?128==(192&(s=e[n+1]))&&(u=(31&l)<<6|63&s)<=127&&(u=null):3===h?(s=e[n+1],o=e[n+2],128==(192&s)&&128==(192&o)&&((u=(15&l)<<12|(63&s)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(s=e[n+1],o=e[n+2],a=e[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((u=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),n+=h}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==r.Bytes)return e.push(this.readVarint(t));var i=a(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==r.Bytes)return e.push(this.readSVarint());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==r.Bytes)return e.push(this.readBoolean());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==r.Bytes)return e.push(this.readFloat());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==r.Bytes)return e.push(this.readDouble());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==r.Bytes)return e.push(this.readFixed32());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==r.Bytes)return e.push(this.readSFixed32());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==r.Bytes)return e.push(this.readFixed64());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==r.Bytes)return e.push(this.readSFixed64());var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===r.Varint)for(;this.buf[this.pos++]>127;);else if(t===r.Bytes)this.pos=this.readVarint()+this.pos;else if(t===r.Fixed32)this.pos+=4;else{if(t!==r.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*s),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*s),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,s=0;s<t.length;s++){if((r=t.charCodeAt(s))>55295&&r<57344){if(!n){r>56319||s+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&l(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),i.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),i.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&l(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,r.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,u,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,c,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,_,t)},writeBytesField:function(e,t){this.writeTag(e,r.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,r.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,r.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,r.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}})),L={};async function O(e,t,i,r){return r._parse(e,t,i,r)}function F(e,t){if(!e)throw new Error(t||"loader assertion failed.")}l(L,{AGGREGATION_OPERATION:()=>xN,AmbientLight:()=>$d,ArcLayer:()=>Qb,Attribute:()=>dy,AttributeManager:()=>Ty,BitmapLayer:()=>oA,BrushingExtension:()=>BO,COORDINATE_SYSTEM:()=>Nc,CPUGridLayer:()=>HD,ClipExtension:()=>pF,CollisionFilterExtension:()=>yF,ColumnLayer:()=>oE,CompassWidget:()=>DG,CompositeLayer:()=>db,ContourLayer:()=>Qk,Controller:()=>Mg,DarkGlassTheme:()=>VG,DarkTheme:()=>GG,DataFilterExtension:()=>WO,Deck:()=>Yv,DeckGL:()=>wN,DeckRenderer:()=>Dg,DirectionalLight:()=>ef,FillStyleExtension:()=>oF,FirstPersonController:()=>Mb,FirstPersonView:()=>Ib,FirstPersonViewport:()=>Cb,FlyToInterpolator:()=>Kb,Fp64Extension:()=>YO,FullscreenWidget:()=>NG,GPUGridLayer:()=>aU,GeoJsonLayer:()=>Bw,GeohashLayer:()=>vN,GoogleMapsOverlay:()=>kU,GreatCircleLayer:()=>gx,GridCellLayer:()=>uE,GridLayer:()=>hU,H3ClusterLayer:()=>MC,H3HexagonLayer:()=>CC,HeatmapLayer:()=>xU,HexagonLayer:()=>QD,IconLayer:()=>yA,Layer:()=>hb,LayerExtension:()=>Wb,LayerManager:()=>ng,LightGlassTheme:()=>zG,LightTheme:()=>UG,LightingEffect:()=>uf,LineLayer:()=>EA,LinearInterpolator:()=>yg,MVTLayer:()=>nN,MapController:()=>Bg,MapView:()=>Og,MapboxOverlay:()=>nG,MaskExtension:()=>PF,OPERATION:()=>Gc,OrbitController:()=>Lb,OrbitView:()=>Fb,OrbitViewport:()=>Eb,OrthographicController:()=>Db,OrthographicView:()=>Ub,OrthographicViewport:()=>Tb,PathLayer:()=>_E,PathStyleExtension:()=>iF,PointCloudLayer:()=>SA,PointLight:()=>Ff,PolygonLayer:()=>jE,PostProcessEffect:()=>Np,QuadkeyLayer:()=>Gx,S2Layer:()=>Fx,ScatterplotLayer:()=>IA,ScenegraphLayer:()=>RR,ScreenGridLayer:()=>FD,SimpleMeshLayer:()=>VC,SolidPolygonLayer:()=>kE,TRANSITION_EVENTS:()=>dg,TerrainLayer:()=>SO,Tesselator:()=>$b,TextLayer:()=>vw,Tile3DLayer:()=>uO,TileLayer:()=>pC,TransitionInterpolator:()=>mg,TripsLayer:()=>_C,UNIT:()=>kc,VERSION:()=>Pi,View:()=>ug,Viewport:()=>wf,WebMercatorViewport:()=>Tf,ZoomWidget:()=>kG,_AggregationLayer:()=>sD,_BinSorter:()=>AD,_CPUAggregator:()=>GD,_CameraLight:()=>Nf,_Component:()=>eb,_ComponentState:()=>ib,_GPUGridAggregator:()=>KN,_GeoCellLayer:()=>vx,_GlobeController:()=>zb,_GlobeView:()=>jb,_GlobeViewport:()=>vb,_LayersPass:()=>rf,_MultiIconLayer:()=>KE,_PickLayersPass:()=>zp,_SunLight:()=>Zf,_TerrainExtension:()=>GF,_TextBackgroundLayer:()=>dw,_Tile2DHeader:()=>zx,_Tileset2D:()=>uC,_WMSLayer:()=>dx,_compareProps:()=>By,_count:()=>ky,_deepEqual:()=>sg,_fillArray:()=>rg,_flatten:()=>tg,_getURLFromTemplate:()=>$T,_memoize:()=>Xc,_mergeShaders:()=>Uy,_registerLoggers:()=>Ti,assert:()=>gg,createIterable:()=>sy,fp64LowPart:()=>gf,getShaderAssembler:()=>Wd,gouraudLighting:()=>Ic,log:()=>wi,phongLighting:()=>Bc,picking:()=>Vd,project:()=>id,project32:()=>rd,project64:()=>KO,shadow:()=>zd});var N=Boolean("object"!=typeof x||"[object process]"!==String(x)||x.browser),D=typeof x<"u"&&x.version&&/v([0-9]*)/.exec(x.version);function k(e,t){return U(e||{},t)}function U(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(i>3)return t;let r={...e};for(let[e,n]of Object.entries(t))n&&"object"==typeof n&&!Array.isArray(n)?r[e]=U(r[e]||{},t[e],i+1):r[e]=t[e];return r}D&&parseFloat(D[1]);var G,z="latest",V=(null!==(G=globalThis._loadersgl_)&&void 0!==G&&G.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.4"),globalThis._loadersgl_.version);function j(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var H="object"!=typeof x||"[object process]"!==String(x)||x.browser,W="function"==typeof importScripts,X=typeof window<"u"&&typeof window.orientation<"u",q=typeof x<"u"&&x.version&&/v([0-9]*)/.exec(x.version);q&&parseFloat(q[1]);var K=class{terminate(){}},$=new Map;function J(e){j(e.source&&!e.url||!e.source&&e.url);let t=$.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;let t=function(e){return`try {\n  importScripts('${e}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`}(e);return Y(t)}(e.url),$.set(e.url,t)),e.source&&(t=Y(e.source),$.set(e.source,t))),j(t),t}function Y(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Z(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=i||new Set;if(e)if(Q(e))r.add(e);else if(Q(e.buffer))r.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&"object"==typeof e)for(let i in e)Z(e[i],t,r);return void 0===i?Array.from(r):[]}function Q(e){return!!e&&(e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)}var ee=()=>{},te=class{static isSupported(){return typeof Worker<"u"&&H||typeof K<"u"&&!H}constructor(e){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";let{name:t,source:i,url:r}=e;j(i||r),this.name=t,this.source=i,this.url=r,this.onMessage=ee,this.onError=e=>console.log(e),this.worker=H?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ee,this.onError=ee,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Z(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=J({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){let t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new K(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new K(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}},ie={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},re=class{static isSupported(){return te.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return re._workerFarm=re._workerFarm||new re({}),re._workerFarm.setProps(e),re._workerFarm}constructor(e){this.props=void 0,this.workerPools=new Map,this.props={...ie},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:i,url:r}=e,n=this.workerPools.get(t);return n||(n=new class{static isSupported(){return te.isSupported()}constructor(e){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,i)=>e.done(i),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e.error(t),r=new Promise((r=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:r}),this)));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let i=new class{constructor(e,t){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){j(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){j(this.isRunning),this.isRunning=!1,this._reject(e)}}(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!H||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new te({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return X?this.maxMobileConcurrency:this.maxConcurrency}}({name:t,source:i,url:r}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};re._workerFarm=void 0;var ne={};async function se(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t&&(e=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!i.useLocalLibraries&&e.startsWith("http"))return e;r=r||e;let n=i.modules||{};return n[r]?n[r]:H?i.CDN?(j(i.CDN.startsWith("http")),`${i.CDN}/${t}@${V}/dist/libs/${r}`):W?`../src/libs/${r}`:`modules/${t}/src/libs/${r}`:`modules/${t}/dist/libs/${r}`}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)),ne[e]=ne[e]||async function(e){if(e.endsWith("wasm"))return await async function(e){return H||!Qe.readFileAsArrayBuffer||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await Qe.readFileAsArrayBuffer(e)}(e);if(!H)try{return Qe&&Qe.requireFromFile&&await Qe.requireFromFile(e)}catch(e){return console.error(e),null}if(W)return importScripts(e);let t=await async function(e){return H||!Qe.readFileAsText||e.startsWith("http")?await(await fetch(e)).text():await Qe.readFileAsText(e)}(e);return function(e,t){if(!H)return Qe.requireFromString&&Qe.requireFromString(e,t);if(W)return eval.call(globalThis,e),null;let i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch{i.text=e}return document.body.appendChild(i),null}(t,e)}(e),await ne[e]}async function oe(e,t,i,r,n){let s=e.id,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t[e.id]||{},r=H?`${e.id}-worker.js`:`${e.id}-worker-node.js`,n=i.workerUrl;if(!n&&"compression"===e.id&&(n=t.workerUrl),"test"===t._workerType&&(n=H?`modules/${e.module}/dist/${r}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!n){let t=e.version;"latest"===t&&(t=z);let i=t?`@${t}`:"";n=`https://unpkg.com/@loaders.gl/${e.module}${i}/dist/${r}`}return j(n),n}(e,i),a=re.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));let l=await a.startJob("process-on-worker",ae.bind(null,n));return l.postMessage("process",{input:t,options:i,context:r}),await(await l.result).result}async function ae(e,t,i,r){switch(i){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":let{id:n,input:s,options:o}=r;try{let i=await e(s,o);t.postMessage("done",{id:n,result:i})}catch(e){let i=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:n,error:i})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function le(e,t,i){if(e.byteLength<=t+i)return"";let r=new DataView(e),n="";for(let e=0;e<i;e++)n+=String.fromCharCode(r.getUint8(t+e));return n}function ue(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?le(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?le(e,0,t):""}(e)}"`)}}function he(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){let t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),i=t.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(i),n=0;for(let e of t)r.set(e,n),n+=e.byteLength;return r.buffer}(t)}function ce(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let r=t,n=r&&r.length>1&&r[0].constructor||null;if(!n)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');let s=new n(r.reduce(((e,t)=>e+t.length),0)),o=0;for(let e of r)s.set(e,o),o+=e.length;return s}function de(e,t,i){let r=void 0!==i?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(r).buffer}function fe(e,t){return F(e>=0),F(t>0),e+(t-1)&~(t-1)}function pe(e,t,i){let r;if(e instanceof ArrayBuffer)r=new Uint8Array(e);else{let t=e.byteOffset,i=e.byteLength;r=new Uint8Array(e.buffer||e.arrayBuffer,t,i)}return t.set(r,i),i+fe(r.byteLength,4)}function ge(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof x<"u"&&x.hrtime){let t=x.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var me=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ge(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ge()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},_e=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let t of Object.values(this.stats))e(t)}getTable(){let e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(e=[]){e.forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){let{name:t,type:i}=e,r=this.stats[t];return r||(r=e instanceof me?e:new me(t,i),this.stats[t]=r),r}},ve={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},ye=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props=void 0,this.stats=void 0,this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.updateTimer=null,this.props={...ve,...e},this.stats=new _e({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let i={handle:e,priority:0,getPriority:t},r=new Promise((e=>(i.resolve=e,i)));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){let{handle:t,resolve:i}=e,r=!1,n=()=>{r||(r=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:n}):Promise.resolve({done:n})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout((()=>this._issueNewRequestsAsync()),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){let e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){let e=this.requestQueue;for(let t=0;t<e.length;++t){let i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort(((e,t)=>e.priority-t.priority))}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0&&(e.resolve(null),1))}},be="",Ae={};function Ee(e){if(function(e){return e&&"object"==typeof e&&e.isBuffer}(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){let t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var we={};function xe(){var e;if(typeof x<"u"&&typeof x.cwd<"u")return x.cwd();let t=null===(e=window.location)||void 0===e?void 0:e.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function Te(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function Ce(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function Se(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(t=t.map(((e,i)=>(i&&(e=e.replace(new RegExp("^/"),"")),i!==t.length-1&&(e=e.replace(new RegExp("/$"),"")),e)))).join("/")}function Pe(){let e=[];for(let t=0;t<arguments.length;t++)e[t]=t<0||arguments.length<=t?void 0:arguments[t];let t,i="",r=!1;for(let n=e.length-1;n>=-1&&!r;n--){let s;n>=0?s=e[n]:(void 0===t&&(t=xe()),s=t),0!==s.length&&(i=`${s}/${i}`,r=s.charCodeAt(0)===Me)}return i=function(e,t){let i,r="",n=-1,s=0,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(i===Me)break;i=Me}if(i===Me){if(n!==a-1&&1!==s)if(n!==a-1&&2===s){if(r.length<2||!o||r.charCodeAt(r.length-1)!==Re||r.charCodeAt(r.length-2)!==Re)if(r.length>2){let e=r.length-1,t=e;for(;t>=0&&r.charCodeAt(t)!==Me;--t);if(t!==e){r=-1===t?"":r.slice(0,t),n=a,s=0,o=!1;continue}}else if(2===r.length||1===r.length){r="",n=a,s=0,o=!1;continue}t&&(r.length>0?r+="/..":r="..",o=!0)}else{let t=e.slice(n+1,a);r.length>0?r+=`/${t}`:r=t,o=!1}n=a,s=0}else i===Re&&-1!==s?++s:s=-1}return r}(i,!r),r?`/${i}`:i.length>0?i:"."}l(we,{dirname:()=>Ce,filename:()=>Te,join:()=>Se,resolve:()=>Pe});var Me=47,Re=46,Ie=class{constructor(e){this.data=void 0,this.fetch=void 0,this.loadOptions=void 0,this._needsRefresh=!0,this.props=void 0,this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=function(e){let t=e?.fetch;if(t&&"function"==typeof t)return(e,i)=>t(e,i);let i=e?.fetch;return i&&"function"!=typeof i?e=>fetch(e,i):e=>fetch(e)}(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._needsRefresh;return e&&(this._needsRefresh=!1),t}},Be=class extends Ie{};Be.type="template",Be.testURL=e=>!1;var Le=e=>"function"==typeof e,Oe=e=>null!==e&&"object"==typeof e,Fe=e=>Oe(e)&&e.constructor==={}.constructor,Ne=e=>Boolean(e)&&"function"==typeof e[Symbol.iterator],De=e=>e&&"function"==typeof e[Symbol.asyncIterator],ke=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Ue=e=>typeof Blob<"u"&&e instanceof Blob,Ge=e=>e&&"object"==typeof e&&e.isBuffer,ze=e=>(e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Oe(e)&&Le(e.tee)&&Le(e.cancel)&&Le(e.getReader))(e)||(e=>Oe(e)&&Le(e.read)&&Le(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Ve=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,je=/^([-\w.]+\/[-\w.+]+)/;function He(e){let t=Ve.exec(e);return t?t[1]:""}var We=/\?.*/;function Xe(e){return e.replace(We,"")}function qe(e){return ke(e)?e.url:Ue(e)?e.name||"":"string"==typeof e?e:""}function Ke(e){if(ke(e)){let t=e,i=t.headers.get("content-type")||"",r=Xe(t.url);return function(e){let t=je.exec(e);return t?t[1]:e}(i)||He(r)}return Ue(e)?e.type||"":"string"==typeof e?He(e):""}async function $e(e){if(ke(e))return e;let t={},i=function(e){return ke(e)?e.headers["content-length"]||-1:Ue(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);i>=0&&(t["content-length"]=String(i));let r=qe(e),n=Ke(e);n&&(t["content-type"]=n);let s=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let t=e.slice(0,5);return await new Promise((e=>{let i=new FileReader;i.onload=t=>{var i;return e(null==t||null===(i=t.target)||void 0===i?void 0:i.result)},i.readAsDataURL(t)}))}return e instanceof ArrayBuffer?`data:base64,${function(e){let t="",i=new Uint8Array(e);for(let e=0;e<i.byteLength;e++)t+=String.fromCharCode(i[e]);return btoa(t)}(e.slice(0,5))}`:null}(e);s&&(t["x-first-bytes"]=s),"string"==typeof e&&(e=(new TextEncoder).encode(e));let o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:r}),o}async function Je(e,t){if("string"==typeof e){let n=function(e){for(let t in Ae)if(e.startsWith(t)){let i=Ae[t];e=e.replace(t,i)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${be}${e}`),e}(e);var i,r;return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(n)&&null!==(i=globalThis.loaders)&&void 0!==i&&i.fetchNode?null===(r=globalThis.loaders)||void 0===r?void 0:r.fetchNode(n,t):await fetch(n,t)}return await $e(e)}var Ye=globalThis,Ze=globalThis.process||{},et=globalThis.navigator||{};function tt(e){if(typeof window<"u"&&"renderer"===window.process?.type||typeof x<"u"&&Boolean(x.versions?.electron))return!0;let t=typeof navigator<"u"&&navigator.userAgent,i=e||t;return Boolean(i&&i.indexOf("Electron")>=0)}function it(){return!("object"==typeof x&&"[object process]"===String(x)&&!x?.browser)||tt()}var rt,nt="4.0.7";!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(rt||(rt={}));var st=10;function ot(e){return"string"!=typeof e?e:(e=e.toUpperCase(),rt[e]||rt.WHITE)}function at(e,t){if(!e)throw new Error(t||"Assertion failed")}function lt(){let e;if(it()&&Ye.performance)e=Ye?.performance?.now?.();else if("hrtime"in Ze){let t=Ze?.hrtime?.();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var ut={debug:it()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ht={enabled:!0,level:0};function ct(){}var dt={},ft={once:!0},pt=class{constructor({id:e}={id:""}){this.VERSION=nt,this._startTs=lt(),this._deltaTs=lt(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new class{constructor(e,t,i="sessionStorage"){this.storage=function(e){try{let t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){let t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}(`__probe-${this.id}__`,ht),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){let i=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(i),n=e;for(let i of r){let r=n[i];"function"==typeof r&&(t.find((e=>i===e))||(n[i]=r.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((lt()-this._startTs).toPrecision(10))}getDelta(){return Number((lt()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ut.warn,arguments,ft)}error(e){return this._getLogFunction(0,e,ut.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,ut.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ut.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ut.debug||ut.info,arguments,ft)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||ct,i&&[i],{tag:_t(t)}):ct}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ct)}group(e,t,i={collapsed:!1}){let r=mt({logLevel:e,message:t,opts:i}),{collapsed:n}=i;return r.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ct)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=gt(e)}_getLogFunction(e,t,i,r,n){if(this._shouldLog(e)){n=mt({logLevel:e,message:t,args:r,opts:n}),at(i=i||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=lt();let s=n.tag||n.message;if(n.once&&s){if(dt[s])return ct;dt[s]=lt()}return t=function(e,t,i){if("string"==typeof t){let r=i.time?function(e,t=8){let i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(i.total)):"";t=function(e,t,i){return!it&&"string"==typeof e&&(t&&(e=`[${ot(t)}m${e}[39m`),i&&(e=`[${ot(i)+st}m${e}[49m`)),e}(t=i.time?`${e}: ${r}  ${t}`:`${e}: ${t}`,i.color,i.background)}return t}(this.id,n.message,n),i.bind(console,t,...n.args)}return ct}};function gt(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return at(Number.isFinite(t)&&t>=0),t}function mt(e){let{logLevel:t,message:i}=e;e.logLevel=gt(t);let r=e.args?Array.from(e.args):[];for(;r.length&&r.shift()!==i;);switch(typeof t){case"string":case"function":void 0!==i&&r.unshift(i),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());let n=typeof e.message;return at("string"===n||"object"===n),Object.assign(e,{args:r},e.opts)}function _t(e){for(let t in e)for(let i in e[t])return i||"untitled";return"empty"}pt.VERSION=nt,globalThis.probe={};var vt=new pt({id:"@probe.gl/log"}),yt=new pt({id:"loaders.gl"}),bt=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},At={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){this.console=void 0,this.console=console}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.error.bind(this.console,...t)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:N,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Et={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function wt(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state=e._state||{},e._state}function xt(){let e=wt();return e.globalOptions=e.globalOptions||{...At},e.globalOptions}function Tt(e,t,i,r){return i=i||[],function(e,t){Ct(e,null,At,Et,t);for(let i of t){let r=e&&e[i.id]||{},n=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Ct(r,i.id,n,s,t)}}(e,i=Array.isArray(i)?i:[i]),function(e,t,i){let r={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(r,i),null===r.log&&(r.log=new bt),Pt(r,xt()),Pt(r,t),r}(t,e,r)}function Ct(e,t,i,r,n){let s=t||"Top level",o=t?`${t}.`:"";for(let a in e){let l=!t&&Oe(e[a]);if(!(a in i)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in r)yt.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){let e=St(a,n);yt.warn(`${s} loader option '${o}${a}' not recognized. ${e}`)()}}}function St(e,t){let i=e.toLowerCase(),r="";for(let n of t)for(let t in n.options){if(e===t)return`Did you mean '${n.id}.${t}'?`;let s=t.toLowerCase();(i.startsWith(s)||s.startsWith(i))&&(r=r||`Did you mean '${n.id}.${t}'?`)}return r}function Pt(e,t){for(let i in t)if(i in t){let r=t[i];Fe(r)&&Fe(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function Mt(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function Rt(e){var t,i;let r;return F(e,"null loader"),F(Mt(e),"invalid loader"),Array.isArray(e)&&(r=e[1],e=e[0],e={...e,options:{...e.options,...r}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(i=e)&&void 0!==i&&i.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var It=()=>{let e=wt();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Bt(e){let t=It();e=Array.isArray(e)?e:[e];for(let i of e){let e=Rt(i);t.find((t=>e===t))||t.unshift(e)}}var Lt=new pt({id:"loaders.gl"}),Ot=/\.([^.]+)$/;function Ft(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Nt(e))return null;if(t&&!Array.isArray(t))return Rt(t);let n=[];t&&(n=n.concat(t)),null!=i&&i.ignoreRegisteredLoaders||n.push(...It()),function(e){for(let t of e)Rt(t)}(n);let s=function(e,t,i,r){let n=qe(e),s=Ke(e),o=Xe(n)||r?.url,a=null,l="";var u;return null!=i&&i.mimeType&&(a=kt(t,i?.mimeType),l=`match forced by supplied MIME type ${i?.mimeType}`),a=a||function(e,t){let i=t&&Ot.exec(t),r=i&&i[1];return r?function(e,t){t=t.toLowerCase();for(let i of e)for(let e of i.extensions)if(e.toLowerCase()===t)return i;return null}(e,r):null}(t,o),l=l||(a?`matched url ${o}`:""),a=a||kt(t,s),l=l||(a?`matched MIME type ${s}`:""),a=a||function(e,t){if(!t)return null;for(let i of e)if("string"==typeof t){if(Ut(t,i))return i}else if(ArrayBuffer.isView(t)){if(Gt(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&Gt(t,0,i))return i;return null}(t,e),l=l||(a?`matched initial data ${zt(e)}`:""),null!=i&&i.fallbackMimeType&&(a=a||kt(t,i?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&Lt.log(1,`selectLoader selected ${null===(u=a)||void 0===u?void 0:u.name}: ${l}.`),a}(e,n,i,r);if(!(s||null!=i&&i.nothrow))throw new Error(Dt(e));return s}function Nt(e){return!(e instanceof Response&&204===e.status)}function Dt(e){let t=qe(e),i=Ke(e),r="No valid loader found (";r+=t?`${we.filename(t)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;let n=e?zt(e):"";return r+=n?` first bytes: "${n}"`:"first bytes: not available",r+=")",r}function kt(e,t){for(let i of e)if(i.mimeTypes&&i.mimeTypes.includes(t)||t===`application/x.${i.id}`)return i;return null}function Ut(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function Gt(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some((i=>function(e,t,i,r){if(r instanceof ArrayBuffer)return function(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;++e)if(r[e]!==n[e])return!1;return!0}(r,e,r.byteLength);switch(typeof r){case"function":return r(e);case"string":return r===Vt(e,t,r.length);default:return!1}}(e,t,0,i)))}function zt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?Vt(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Vt(e,0,t):""}function Vt(e,t,i){if(e.byteLength<t+i)return"";let r=new DataView(e),n="";for(let e=0;e<i;e++)n+=String.fromCharCode(r.getUint8(t+e));return n}function jt(e,t){return N?async function*(e,t){let i,r=e.getReader();try{for(;;){let e=i||r.read();null!=t&&t._streamReadAhead&&(i=r.read());let{done:n,value:s}=await e;if(n)return;yield Ee(s)}}catch{r.releaseLock()}}(e,t):async function*(e,t){for await(let t of e)yield Ee(t)}(e)}function Ht(e,t){if("string"==typeof e)return function*(e,t){let i=t?.chunkSize||262144,r=0,n=new TextEncoder;for(;r<e.length;){let t=Math.min(e.length-r,i),s=e.slice(r,r+t);r+=t,yield n.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){let{chunkSize:i=262144}=t,r=0;for(;r<e.byteLength;){let t=Math.min(e.byteLength-r,i),n=new ArrayBuffer(t),s=new Uint8Array(e,r,t);new Uint8Array(n).set(s),r+=t,yield n}}()}(e,t);if(Ue(e))return async function*(e,t){let i=t?.chunkSize||1048576,r=0;for(;r<e.size;){let t=r+i,n=await e.slice(r,t).arrayBuffer();r=t,yield n}}(e,t);if(ze(e))return jt(e,t);if(ke(e))return jt(e.body,t);throw new Error("makeIterator")}var Wt="Cannot convert supplied data type";async function Xt(e,t,i){let r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||r)return function(e,t,i){if(t.text&&"string"==typeof e)return e;if(Ge(e)&&(e=e.buffer),e instanceof ArrayBuffer){let i=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let i=e.buffer,r=e.byteLength||e.length;return(0!==e.byteOffset||r!==i.byteLength)&&(i=i.slice(e.byteOffset,e.byteOffset+r)),i}throw new Error(Wt)}(e,t);if(Ue(e)&&(e=await $e(e)),ke(e)){let i=e;return await async function(e){if(!e.ok){let t=await async function(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{let i=e.headers.get("Content-Type"),r=e.statusText;null!=i&&i.includes("application/json")&&(r+=` ${await e.text()}`),t+=r,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}(e);throw new Error(t)}}(i),t.binary?await i.arrayBuffer():await i.text()}if(ze(e)&&(e=Ht(e,i)),Ne(e)||De(e))return async function(e){let t=[];for await(let i of e)t.push(i);return he(...t)}(e);throw new Error(Wt)}function qt(e,t){let i=xt(),r=e||i;return"function"==typeof r.fetch?r.fetch:Oe(r.fetch)?e=>Je(e,r.fetch):null!=t&&t.fetch?t?.fetch:Je}function Kt(e,t,i){if(i)return i;let r={fetch:qt(t,e),...e};if(r.url){let e=Xe(r.url);r.baseUrl=e,r.queryString=function(e){let t=e.match(We);return t&&t[0]}(r.url),r.filename=we.filename(e),r.baseUrl=we.dirname(e)}return Array.isArray(r.loaders)||(r.loaders=null),r}async function $t(e,t,i,r){t&&!Array.isArray(t)&&!Mt(t)&&(r=void 0,i=t,t=void 0),i=i||{};let n=qe(e=await e),s=function(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){let e=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...e]:e}return i&&i.length?i:void 0}(t,r),o=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Nt(e))return null;let n=Ft(e,t,{...i,nothrow:!0},r);if(n)return n;if(Ue(e)&&(n=Ft(e=await e.slice(0,10).arrayBuffer(),t,i,r)),!(n||null!=i&&i.nothrow))throw new Error(Dt(e));return n}(e,s,i);return o?(r=Kt({url:n,_parse:$t,loaders:s},i=Tt(i,o,s,n),r||null),await async function(e,t,i,r){if(function(e){j(e,"no worker provided"),e.version}(e),i=k(e.options,i),ke(t)){let e=t,{ok:i,redirected:n,status:s,statusText:o,type:a,url:l}=e,u=Object.fromEntries(e.headers.entries());r.response={headers:u,ok:i,redirected:n,status:s,statusText:o,type:a,url:l}}t=await Xt(t,e,i);let n=e;if(n.parseTextSync&&"string"==typeof t)return n.parseTextSync(t,i,r);if(function(e,t){return!(!re.isSupported()||!(H||null!=t&&t._nodeWorkers))&&e.worker&&t?.worker}(e,i))return await oe(e,t,i,r,$t);if(n.parseText&&"string"==typeof t)return await n.parseText(t,i,r);if(n.parse)return await n.parse(t,i,r);throw j(!n.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,i,r)):null}function Jt(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,o=-1/0,a=e.POSITION?e.POSITION.value:[],l=a&&a.length;for(let e=0;e<l;e+=3){let l=a[e],u=a[e+1],h=a[e+2];t=l<t?l:t,i=u<i?u:i,r=h<r?h:r,n=l>n?l:n,s=u>s?u:s,o=h>o?h:o}return[[t,i,r],[n,s,o]]}function Yt(e,t,i){let r=function(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(t.value),n=i||function(e){let t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:r}]},nullable:!1,metadata:n}}async function Zt(e,t,i,r){let n,s;Array.isArray(t)||Mt(t)?(n=t,s=i):(n=[],s=t);let o=qt(s),a=e;return"string"==typeof e&&(a=await o(e)),Ue(e)&&(a=await o(e)),Array.isArray(n),await $t(a,n,s)}var Qt,ei=null===(Qt=globalThis.loaders)||void 0===Qt?void 0:Qt.parseImageNode,ti=typeof Image<"u",ii=typeof ImageBitmap<"u",ri=Boolean(ei),ni=!!N||ri;function si(e){let t=function(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}function oi(e){switch(si(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}var ai=/^data:image\/svg\+xml/,li=/\.svg((\?|#).*)?$/;function ui(e){return e&&(ai.test(e)||li.test(e))}function hi(e,t){if(ui(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function ci(e,t,i){let r=function(e,t){if(ui(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return hi(e,t)}(e,i),n=self.URL||self.webkitURL,s="string"!=typeof r&&n.createObjectURL(r);try{return await async function(e,t){let i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise(((e,t)=>{try{i.onload=()=>e(i),i.onerror=e=>{let i=e instanceof Error?e.message:"error";t(new Error(i))}}catch(e){t(e)}}))}(s||r,t)}finally{s&&n.revokeObjectURL(s)}}var di={},fi=!0;async function pi(e,t,i){let r;r=ui(i)?await ci(e,t,i):hi(e,i);let n=t&&t.imagebitmap;return await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if((function(e){for(let t in e||di)return!1;return!0}(t)||!fi)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),fi=!1}return await createImageBitmap(e)}(r,n)}function gi(e){return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=function(e){return[...e].map((e=>e.charCodeAt(0)))}(t);for(let t=0;t<r.length;++t)if(r[t]!==e[t+i])return!1;return!0}(e,"ftyp",4)&&96&e[8]?function(e){switch(function(e,t,i){return String.fromCharCode(...e.slice(t,i))}(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(e):null}var mi=!1,_i=!0;function vi(e){let t=yi(e);return function(e){let t=yi(e);return t.byteLength>=24&&2303741511===t.getUint32(0,mi)?{mimeType:"image/png",width:t.getUint32(16,mi),height:t.getUint32(20,mi)}:null}(t)||function(e){let t=yi(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,mi)&&255===t.getUint8(2)))return null;let{tableMarkers:i,sofMarkers:r}=function(){let e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=2;for(;n+9<t.byteLength;){let e=t.getUint16(n,mi);if(r.has(e))return{mimeType:"image/jpeg",height:t.getUint16(n+5,mi),width:t.getUint16(n+7,mi)};if(!i.has(e))return null;n+=2,n+=t.getUint16(n,mi)}return null}(t)||function(e){let t=yi(e);return t.byteLength>=10&&1195984440===t.getUint32(0,mi)?{mimeType:"image/gif",width:t.getUint16(6,_i),height:t.getUint16(8,_i)}:null}(t)||function(e){let t=yi(e);return t.byteLength>=14&&16973===t.getUint16(0,mi)&&t.getUint32(2,_i)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,_i),height:t.getUint32(22,_i)}:null}(t)||function(e){let t=new Uint8Array(e instanceof DataView?e.buffer:e),i=gi(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}(t)}function yi(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}var bi={id:"image",module:"images",name:"Images",version:"4.1.4",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,i){let r,n=((t=t||{}).image||{}).type||"auto",{url:s}=i||{},o=function(e){switch(e){case"auto":case"data":return function(){if(ii)return"imagebitmap";if(ti)return"image";if(ni)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return ii||ti||ni;case"imagebitmap":return ii;case"image":return ti;case"data":return ni;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n);switch(o){case"imagebitmap":r=await pi(e,t,s);break;case"image":r=await ci(e,t,s);break;case"data":r=await async function(e,t){var i;let{mimeType:r}=vi(e)||{},n=null===(i=globalThis.loaders)||void 0===i?void 0:i.parseImageNode;return F(n),await n(e,r)}(e);break;default:F(!1)}return"data"===n&&(r=oi(r)),r},tests:[e=>Boolean(vi(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},Ai={};function Ei(e){if(void 0===Ai[e]){let t=N?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{return 0===document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)}catch{return!1}}(e);default:return!0}}(e):function(e){var t,i;let r=["image/png","image/jpeg","image/gif"],n=(null===(t=globalThis.loaders)||void 0===t?void 0:t.imageFormatsNode)||r,s=null===(i=globalThis.loaders)||void 0===i?void 0:i.parseImageNode;return Boolean(s)&&n.includes(e)}(e);Ai[e]=t}return Ai[e]}var wi=new pt({id:"deck"}),xi={};function Ti(e){xi=e}function Ci(e,t,i,r){wi.level>0&&xi[e]&&xi[e].call(null,t,i,r)}var Si={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){let t=e[0],i=e[e.length-1];return"{"===t&&"}"===i||"["===t&&"]"===i},parseTextSync:JSON.parse},Pi=function(){let e="9.0.4",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(wi.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:wi,_registerLoggers:Ti},Bt([Si,[bi,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();function Mi(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var Ri={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Ii(e){let t=Bi(e);if("object"!==t)return{value:e,...Ri[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Ri[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Bi(e.value),{...e,...Ri[t],type:t}):{type:"object",value:null};throw new Error("props")}function Bi(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var Li={vertex:"#ifdef MODULE_LOGDEPTH\nlogdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\ngl_FragColor = material_filterColor(gl_FragColor);\n#endif\n#ifdef MODULE_LIGHTING\ngl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n#ifdef MODULE_FOG\ngl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n#ifdef MODULE_PICKING\ngl_FragColor = picking_filterHighlightColor(gl_FragColor);\ngl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n#ifdef MODULE_LOGDEPTH\nlogdepth_setFragDepth();\n#endif\n"},Oi=/void\s+main\s*\([^)]*\)\s*\{\n?/,Fi=/}\n?[^{}]*$/,Ni=[],Di="__LUMA_INJECT_DECLARATIONS__";function ki(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Ui(e,t,i,r=!1){let n="vertex"===t;for(let t in i){let r=i[t];r.sort(((e,t)=>e.order-t.order)),Ni.length=r.length;for(let e=0,t=r.length;e<t;++e)Ni[e]=r[e].injection;let s=`${Ni.join("\n")}\n`;switch(t){case"vs:#decl":n&&(e=e.replace(Di,s));break;case"vs:#main-start":n&&(e=e.replace(Oi,(e=>e+s)));break;case"vs:#main-end":n&&(e=e.replace(Fi,(e=>s+e)));break;case"fs:#decl":n||(e=e.replace(Di,s));break;case"fs:#main-start":n||(e=e.replace(Oi,(e=>e+s)));break;case"fs:#main-end":n||(e=e.replace(Fi,(e=>s+e)));break;default:e=e.replace(t,(e=>e+s))}}return e=e.replace(Di,""),r&&(e=e.replace(/\}\s*$/,(e=>e+Li[t]))),e}var Gi=1,zi=class{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(e){return e.map((e=>{if(e instanceof zi)return e;Mi("string"!=typeof e,`Shader module use by name is deprecated. Import shader module '${JSON.stringify(e)}' and use it directly.`),e.name||(console.warn("shader module has no name"),e.name="shader-module-"+Gi++);let t=new zi(e);return t.dependencies=zi.instantiateModules(e.dependencies||[]),t}))}constructor(e){let{name:t,vs:i,fs:r,dependencies:n=[],uniformPropTypes:s={},getUniforms:o,deprecations:a=[],defines:l={},inject:u={}}=e;Mi("string"==typeof t),this.name=t,this.vs=i,this.fs=r,this.getModuleUniforms=o,this.dependencies=zi.instantiateModules(n),this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=function(e){let t={vertex:{},fragment:{}};for(let i in e){let r=e[i];"string"==typeof r&&(r={order:0,injection:r}),t[ki(i)][i]=r}return t}(u),s&&(this.uniforms=function(e){let t={};for(let[i,r]of Object.entries(e))t[i]=Ii(r);return t}(s))}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:Mi(!1)}let i=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------\n\n#define MODULE_${i}\n${t}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):function(e,t,i){let r={};for(let[n,s]of Object.entries(t))e&&n in e&&!s.private?(s.validate&&Mi(s.validate(e[n],s),`${i}: invalid ${n}`),r[n]=e[n]):r[n]=s.value;return r}(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)})),e}_defaultGetUniforms(e={}){let t={},i=this.uniforms;for(let r in i){let n=i[r];r in e&&!n.private?(n.validate&&Mi(n.validate(e[r],n),`${this.name}: invalid ${r}`),t[r]=e[r]):t[r]=n.value}return t}};function Vi(e){if(e.source&&"webgpu"===e.platformInfo.type)return{...e,vs:void 0,fs:void 0};if(!e.vs)throw new Error("no vertex shader");let t,i=ji(e.platformInfo,e.vs);return e.fs&&(t=ji(e.platformInfo,e.fs)),{...e,vs:i,fs:t}}function ji(e,t){if("string"==typeof t)return t;if("webgpu"===e.type){if(t?.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders")}if(t?.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}function Hi(e){return function(e){let t={},i={};return Wi({modules:e,level:0,moduleMap:t,moduleDepth:i}),Object.keys(i).sort(((e,t)=>i[t]-i[e])).map((e=>t[e]))}(zi.instantiateModules(e))}function Wi(e){let{modules:t,level:i,moduleMap:r,moduleDepth:n}=e;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(let e of t)r[e.name]=e,(void 0===n[e.name]||n[e.name]<i)&&(n[e.name]=i);for(let e of t)e.dependencies&&Wi({modules:e.dependencies,level:i+1,moduleMap:r,moduleDepth:n})}var Xi=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qi=[...Xi,[Ji("attribute"),"in $1"],[Ji("varying"),"out $1"]],Ki=[...Xi,[Ji("varying"),"in $1"]];function $i(e,t){for(let[i,r]of t)e=e.replace(i,r);return e}function Ji(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Yi(e,t){let i="";for(let r in e){let n=e[r];if(i+=`void ${n.signature} {\n`,n.header&&(i+=`  ${n.header}`),t[r]){let e=t[r];e.sort(((e,t)=>e.order-t.order));for(let t of e)i+=`  ${t.injection}\n`}n.footer&&(i+=`  ${n.footer}`),i+="}\n"}return i}function Zi(e){let t={vertex:{},fragment:{}};for(let i of e){let e,r;"string"!=typeof i?(e=i,r=e.hook):(e={},r=i),r=r.trim();let[n,s]=r.split(":"),o=r.replace(/\(.+/,""),a=Object.assign(e,{signature:s});switch(n){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(n)}}return t}function Qi(e,t="unnamed"){let i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return i?i[1]:t}function er(e){let t=100,i=e.match(/[^\s]+/g);if(i&&i.length>=2&&"#version"===i[0]){let e=parseInt(i[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}var tr=`\n\n${Di}\n`,ir="precision highp float;\n";function rr(e){let t=Hi(e.modules||[]);return{source:or(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:lr(t)}}function nr(e){let t=Hi(e.modules||[]);return{vs:or(e.platformInfo,{...e,source:e.vs,stage:"vertex",modules:t}),fs:or(e.platformInfo,{...e,source:e.fs,stage:"fragment",modules:t}),getUniforms:lr(t)}}function sr(e){let{vs:t,fs:i}=e,r=Hi(e.modules||[]);return{vs:ar(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:ar(e.platformInfo,{...e,source:i,stage:"fragment",modules:r}),getUniforms:lr(r)}}function or(e,t){let{source:i,stage:r,modules:n,hookFunctions:s=[],inject:o={},log:a}=t;Mi("string"==typeof i,"shader source must be a string");let l=i,u="",h=Zi(s),c={},d={},f={};for(let e in o){let t="string"==typeof o[e]?{injection:o[e],order:0}:o[e],i=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(i){let r=i[2],n=i[3];r?"decl"===n?d[e]=[t]:f[e]=[t]:c[e]=[t]}else f[e]=[t]}let p="webgpu"!==e.type?n:[];for(let e of p){a&&e.checkDeprecations(l,a),u+=e.getModuleSource(r,"wgsl");let t=e.injections[r];for(let e in t){let i=/^(v|f)s:#([\w-]+)$/.exec(e);if(i){let r="decl"===i[2]?d:f;r[e]=r[e]||[],r[e].push(t[e])}else c[e]=c[e]||[],c[e].push(t[e])}}return u+=tr,u=Ui(u,r,d),u+=Yi(h[r],c),u+=l,u=Ui(u,r,f),u}function ar(e,t){let{id:i,source:r,stage:n,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:u={},prologue:h=!0,log:c}=t;Mi("string"==typeof r,"shader source must be a string");let d="glsl"===s?function(e,t){return{name:Qi(e,t),language:"glsl",version:er(e)}}(r).version:-1,f=e.shaderLanguageVersion,p=100===d?"#version 100":"#version 300 es",g=r.split("\n").slice(1).join("\n"),m={};o.forEach((e=>{Object.assign(m,e.getDefines())})),Object.assign(m,a);let _="";switch(s){case"wgsl":break;case"glsl":_=h?`${p}\n\n// ----- PROLOGUE -------------------------\n${function(e){let{id:t,source:i,stage:r}=e;return t&&-1===i.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${t}_${r}\n\n`:""}({id:i,source:r,stage:n})}\n#define SHADER_TYPE_${n.toUpperCase()}\n${function(e){switch(e?.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===n?ir:""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(let i in e){let r=e[i];(r||Number.isFinite(r))&&(t+=`#define ${i.toUpperCase()} ${e[i]}\n`)}return t}(m)}\n\n`:`${p}\n`}let v=Zi(l),y={},b={},A={};for(let e in u){let t="string"==typeof u[e]?{injection:u[e],order:0}:u[e],i=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(i){let r=i[2],n=i[3];r?"decl"===n?b[e]=[t]:A[e]=[t]:y[e]=[t]}else A[e]=[t]}for(let e of o){c&&e.checkDeprecations(g,c),_+=e.getModuleSource(n);let t=e.injections[n];for(let e in t){let i=/^(v|f)s:#([\w-]+)$/.exec(e);if(i){let r="decl"===i[2]?b:A;r[e]=r[e]||[],r[e].push(t[e])}else y[e]=y[e]||[],y[e].push(t[e])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=tr,_=Ui(_,n,b),_+=Yi(v[n],y),_+=g,_=Ui(_,n,A),"glsl"===s&&d!==f&&(_=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return $i(e,qi);case"fragment":return $i(e,Ki);default:throw new Error(t)}}(_,n)),_.trim()}function lr(e){return function(t){let i={};for(let r of e){let e=r.getUniforms(t,i);Object.assign(i,e)}return i}}var ur=class{_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return ur.defaultShaderAssembler=ur.defaultShaderAssembler||new ur,ur.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){let t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){let t=this._getModuleList(e.modules),i=this._hookFunctions,r=Vi(e);return{...rr({platformInfo:e.platformInfo,...r,modules:t,hookFunctions:i}),modules:t}}assembleShaderPair(e){let t=Vi(e),i=this._getModuleList(e.modules),r=this._hookFunctions,{platformInfo:n}=e;return{..."wgsl"===e.platformInfo.shaderLanguage?nr({platformInfo:n,...t,modules:i,hookFunctions:r}):sr({platformInfo:n,...t,modules:i,hookFunctions:r}),modules:i}}_getModuleList(e=[]){let t=new Array(this._defaultModules.length+e.length),i={},r=0;for(let e=0,n=this._defaultModules.length;e<n;++e){let n=this._defaultModules[e],s=n.name;t[r++]=n,i[s]=!0}for(let n=0,s=e.length;n<s;++n){let s=e[n],o=s.name;i[o]||(t[r++]=s,i[o]=!0)}return t.length=r,zi.instantiateModules(t)}},hr=ur;function cr(e){let{input:t,inputChannels:i,output:r}=e||{};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\ntransform_output = vec4(0);\n}";if(!i)throw new Error("inputChannels");let n=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(i),s=function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,i);return`#version 300 es\nin ${n} ${t};\nout vec4 ${r};\nvoid main() {\n  ${r} = ${s};\n}`}c(hr,"defaultShaderAssembler");var dr=new pt({id:"luma.gl"}),fr=new class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new _e({id:e})),this.stats.get(e)}},pr=function(){let e="9.0.9";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(it()&&dr.log(1,`${e} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:dr,stats:fr}),e}();function gr(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]?e:null:function(e){return!ArrayBuffer.isView(e)||e instanceof DataView?null:e}(e)}var mr={};function _r(e="id"){return mr[e]=mr[e]||1,`${e}-${mr[e]++}`}function vr(e){let t=!0;for(let i in e){t=!1;break}return t}var yr=class{id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=function(e,t){let i={...t};for(let t in e)void 0!==e[t]&&(i[t]=e[t]);return i}(t,i);let r="undefined"!==this.props.id?this.props.id:_r(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){let i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};c(yr,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});var br=class extends yr{get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){let i={...t};(t.usage||0)&br.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),super(e,i,br.defaultProps),this.usage=t.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}readSyncWebGL(e,t){throw new Error("not implemented")}debugData=new ArrayBuffer(0);_setDebugData(e,t,i){let r=ArrayBuffer.isView(e)?e.buffer:e,n=Math.min(e?e.byteLength:i,br.DEBUG_DATA_MAX_LENGTH);null===e?this.debugData=new ArrayBuffer(n):0===t&&i===e.byteLength?this.debugData=r.slice(0,n):this.debugData=r.slice(t,t+n)}},Ar=br;function Er(e){let t=function(e){return xr[e]}(wr[e]),i=e.includes("norm"),r=!i&&!e.startsWith("float"),n=e.startsWith("s");return{dataType:wr[e],byteLength:t,integer:r,signed:n,normalized:i}}c(Ar,"defaultProps",{...yr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),c(Ar,"MAP_READ",1),c(Ar,"MAP_WRITE",2),c(Ar,"COPY_SRC",4),c(Ar,"COPY_DST",8),c(Ar,"INDEX",16),c(Ar,"VERTEX",32),c(Ar,"UNIFORM",64),c(Ar,"STORAGE",128),c(Ar,"INDIRECT",256),c(Ar,"QUERY_RESOLVE",512),c(Ar,"DEBUG_DATA_MAX_LENGTH",32);var wr={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},xr={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Tr=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Cr=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function Sr(e){let t=Cr.exec(e);if(t){let[,e,i,r,n,s]=t;if(e){let t=Er(`${r}${i}`);return{format:e,components:e.length,srgb:"-srgb"===n,unsized:"-unsized"===s,webgl:"-webgl"===s,...t}}}return function(e){let t=Pr[e];if(!t)throw new Error(`Unknown format ${e}`);return{format:t.format||"",components:t.components||t.format?.length||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}(e)}var Pr={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}},Mr=class{},Rr=class{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}},Ir=class{get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Ir.defaultProps,...e},this.id=this.props.id||_r(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=fr;_lumaData={};isTextureFormatCompressed(e){return function(e){return Tr.some((t=>e.startsWith(t)))}(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||"string"==typeof e)&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let t={...e};return(e.usage||0)&Ar.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":dr.warn("indices buffer content must be of integer type")()),t}},Br=Ir;function Lr(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}c(Br,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:Boolean(dr.get("debug")),spector:Boolean(dr.get("spector")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>dr.error(e.message)}),c(Br,"VERSION",pr);var Or=new Map,Fr=class{static registerDevices(e){for(let t of e)Lr(t.type&&t.isSupported&&t.create),Or.set(t.type,t)}static getAvailableDevices(){return Array.from(Or).map((e=>e.type))}static getSupportedDevices(){return Array.from(Or).filter((e=>e.isSupported())).map((e=>e.type))}static setDefaultDeviceProps(e){Object.assign(Br.defaultProps,e)}static async attachDevice(e){let t=Nr(e.devices)||Or;if(e.handle instanceof WebGL2RenderingContext){let i=t.get("webgl");if(i)return await i.attach(e.handle)}if(null===e.handle){let e=t.get("unknown");if(e)return await e.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){(e={...Br.defaultProps,...e}).gl&&(e.type="webgl");let t=Nr(e.devices)||Or;switch(e.type){case"webgpu":let i=t.get("webgpu");if(i)return await i.create(e);break;case"webgl":let r=t.get("webgl");if(r)return await r.create(e);break;case"unknown":let n=t.get("unknown");if(n)return await n.create(e);break;case"best-available":if(i=t.get("webgpu"),i?.isSupported?.())return await i.create(e);if(r=t.get("webgl"),r?.isSupported?.())return await r.create(e)}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}};function Nr(e){if(!e||0===e?.length)return null;let t=new Map;for(let i of e)t.set(i.type,i);return t}c(Fr,"defaultProps",{...Br.defaultProps,type:"best-available",devices:void 0}),c(Fr,"stats",fr),c(Fr,"log",dr);var Dr=it()&&typeof document<"u",kr=()=>Dr&&"complete"===document.readyState,Ur={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"},Gr=class{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return kr()}constructor(e){if(this.props={...Ur,...e},e=this.props,!it())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){let t=document.getElementById(e);if(!t&&!kr())throw new Error(`Accessing '${e}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{let t=function(e){let{width:t,height:i}=e,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=t||1,r.height=i||1,r.style.width=Number.isFinite(t)?`${t}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}(e),i=function(e){if("string"==typeof e){let t=document.getElementById(e);if(!t&&!kr())throw new Error(`Accessing '${e}' before page was loaded`);if(!t)throw new Error(`${e} is not an HTML element`);return t}return e||document.body}(e?.container||null);i.insertBefore(t,i.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((e=>{for(let t of e)t.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||!(e=void 0===e?this.props.useDevicePixels:e)||e<=0?1:!0===e?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),{clientWidth:t}=this._canvasSizeInfo;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){let i=this.cssToDeviceRatio(),[r,n]=this.getDrawingBufferSize();return function(e,t,i,r,n){let s,o=e,a=zr(o[0],t,i),l=Vr(o[1],t,r,n),u=zr(o[0]+1,t,i),h=u===i-1?u:u-1;return u=Vr(o[1]+1,t,r,n),n?(u=0===u?u:u+1,s=l,l=u):s=u===r-1?u:u-1,{x:a,y:l,width:Math.max(h-a+1,1),height:Math.max(s-l+1,1)}}(e,i,r,n,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,r="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!r)&&(dr.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);let n=this._canvasSizeInfo;if(n.clientWidth!==i||n.clientHeight!==r||n.devicePixelRatio!==e){let t=e,n=Math.floor(i*t),s=Math.floor(r*t);this.htmlCanvas.width=n,this.htmlCanvas.height=s;let[o,a]=this.getDrawingBufferSize();(o!==n||a!==s)&&(t=Math.min(o/i,a/r),this.htmlCanvas.width=Math.floor(i*t),this.htmlCanvas.height=Math.floor(r*t),dr.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){let e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){"lumagl-auto-created-canvas"===this.htmlCanvas?.id&&(this.htmlCanvas.id=e)}};function zr(e,t,i){return Math.min(Math.round(e*t),i-1)}function Vr(e,t,i,r){return r?Math.max(0,i-1-Math.round(e*t)):Math.min(Math.round(e*t),i-1)}c(Gr,"pageLoaded",kr()||typeof window>"u"?Promise.resolve():new Promise((e=>{window.addEventListener("load",(()=>e()))})));var jr=class extends yr{get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(e,t,i=jr.defaultProps){super(e,t,i),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=e.incrementTimestamp()}},Hr=jr;c(Hr,"defaultProps",{...yr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),c(Hr,"COPY_SRC",1),c(Hr,"COPY_DST",2),c(Hr,"TEXTURE_BINDING",4),c(Hr,"STORAGE_BINDING",8),c(Hr,"RENDER_ATTACHMENT",16);var Wr=class extends yr{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Wr.defaultProps)}},Xr=Wr;function qr(e,t,i,r){if(r?.inlineSource){let r=function(e,t,i){let r="";for(let n=t-2;n<=t;n++){let s=e[n-1];void 0!==s&&(r+=Kr(s,t,i))}return r}(t,i);return`\n${r}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}return r?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Kr(e,t,i){let r=i?.html?function(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(e):e;return`${function(e,t){let i="";for(let r=e.length;r<t;++r)i+=" ";return i+e}(String(t),4)}: ${r}${i?.html?"<br/>":"\n"}`}function $r(e,t){return{name:Jr(e,t),language:"glsl",version:Yr(e)}}function Jr(e,t="unnamed"){let i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return i?i[1]:t}function Yr(e){let t=100,i=e.match(/[^\s]+/g);if(i&&i.length>=2&&"#version"===i[0]){let e=parseInt(i[1],10);Number.isFinite(e)&&(t=e)}return t}c(Xr,"defaultProps",{...yr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});var Zr=class extends yr{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){super(e,{id:en(t),...t},Zr.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e=this.props.debug){switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}let t=await this.getCompilationInfo();"warnings"===this.props.debug&&0===t?.length||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;let t=$r(this.source).name,i=`${this.stage} ${t}`,r=function(e,t,i){let r="",n=t.split(/\r?\n/),s=e.slice().sort(((e,t)=>e.lineNum-t.lineNum));switch(i?.showSourceCode||"no"){case"all":let t=0;for(let e=1;e<=n.length;e++)for(r+=Kr(n[e-1],e,i);s.length>t&&s[t].lineNum===e;){let e=s[t++];r+=qr(e,n,e.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(let t of e)r+=qr(t,n,t.lineNum,{inlineSource:"no"!==i?.showSourceCode});return r}}(e,this.source,{showSourceCode:"all",html:!0}),n=this.getTranslatedSource();n&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${n}</pre></code>`);let s=document.createElement("Button");s.innerHTML=`\n<h1>Shader Compilation Error in ${i}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${r}\n</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s);let o=document.getElementsByClassName("luma-compiler-log-error");o[0]?.scrollIntoView&&o[0].scrollIntoView(),s.onclick=()=>{let e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}},Qr=Zr;function en(e){return $r(e.source).name||e.id||_r(`unnamed ${e.stage}-shader`)}c(Qr,"defaultProps",{...yr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});var tn=class extends yr{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t,tn.defaultProps)}},rn=tn;c(rn,"defaultProps",{...yr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});var nn=class extends yr{get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(e,t={}){super(e,t,nn.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(e){let t=!e;if(e){let[i,r]=Array.isArray(e)?e:[e.width,e.height];t=t||r!==this.height||i!==this.width,this.width=i,this.height=r}t&&(dr.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e=>{if("string"==typeof e){let t=this.createColorTexture(e);return this.attachResource(t),t.view}return e instanceof Hr?e.view:e}));let e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){let t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof Hr?e.view:e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:Hr.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:Hr.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){let r=this.device._createTexture({...this.colorAttachments[i].props,width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){let i=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}},sn=nn;c(sn,"defaultProps",{...yr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});var on=class extends yr{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,on.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}},an=on;c(an,"defaultProps",{...yr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}});var ln=class extends yr{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t,ln.defaultProps)}},un=ln;c(un,"defaultProps",{...yr.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});var hn=class extends yr{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(e,t){super(e,t,hn.defaultProps)}},cn=hn;c(cn,"defaultProps",{...yr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});var dn=class extends yr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,dn.defaultProps)}},fn=dn;c(fn,"defaultProps",{...yr.defaultProps,measureExecutionTime:void 0});var pn=class extends yr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,pn.defaultProps)}},gn=pn;c(gn,"defaultProps",{...yr.defaultProps});var mn={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},_n={f32:4,f16:2,i32:4,u32:4};function vn(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[i,r]=e.split("x"),n=i,s=r?parseInt(r):1,o=Er(n),a={type:n,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function yn(e,t){let i={};for(let r of e.attributes)i[r.name]=bn(e,t,r.name);return i}function bn(e,t,i){let r=function(e,t){let i=e.attributes.find((e=>e.name===t));return i||dr.warn(`shader layout attribute "${t}" not present in shader`),i||null}(e,i),n=function(e,t){!function(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&dr.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let i=function(e,t){for(let i of e)if(i.format&&i.name===t)return{attributeName:i.name,bufferName:t,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}(e,t);return i||(i=function(e,t){for(let i of e){let e=i.byteStride;if("number"!=typeof i.byteStride)for(let t of i.attributes||[])e+=vn(t.format).byteLength;let r=i.attributes?.find((e=>e.attribute===t));if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),i)?i:(dr.warn(`layout for attribute "${t}" not present in buffer layout`),null)}(t,i);if(!r)return null;let s=function(e){let[t,i]=mn[e],r="i32"===t||"u32"===t,n="u32"!==t,s=_n[t]*i,o=function(e,t){let i;switch(e){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?i:`${i}x${t}`}(t,i);return{dataType:t,components:i,defaultVertexFormat:o,byteLength:s,integer:r,signed:n}}(r.type),o=n?.vertexFormat||s.defaultVertexFormat,a=vn(o);return{attributeName:n?.attributeName||r.name,bufferName:n?.bufferName||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:n?.stepMode||r.stepMode,byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}var An=class extends yr{get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,An.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(e,t,i=16){let r=yn(e,t),n=new Array(i).fill(null);for(let e of Object.values(r))n[e.location]=e;return n}(t.renderPipeline.shaderLayout,t.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){throw new Error("constant attributes not supported")}},En=An;c(En,"defaultProps",{...yr.defaultProps,renderPipeline:null});var wn=class extends yr{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,wn.defaultProps)}},xn=wn;c(xn,"defaultProps",{...yr.defaultProps,layout:void 0,buffers:{}});var Tn=class extends yr{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Tn.defaultProps)}},Cn=Tn;c(Cn,"defaultProps",{...yr.defaultProps,type:void 0,count:void 0});var Sn,Pn={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Mn(e){let t=Pn[e];return Lr(e),t}function Rn(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function In(e){return(!Sn||Sn.byteLength<e)&&(Sn=new ArrayBuffer(e)),Sn}var Bn=class{layout={};byteLength;constructor(e){let t=0;for(let[i,r]of Object.entries(e)){let e=Mn(r),{type:n,components:s}=e;t=Rn(t,s);let o=t;t+=s,this.layout[i]={type:n,size:s,offset:o}}t+=(4-t%4)%4;let i=4*t;this.byteLength=Math.max(i,1024)}getData(e){let t=In(Math.max(this.byteLength,1024)),i={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(let[t,r]of Object.entries(e)){let e=this.layout[t];if(!e){dr.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}let{type:n,size:s,offset:o}=e,a=i[n];if(1===s){if("number"!=typeof r&&"boolean"!=typeof r){dr.warn(`Supplied value for single component uniform ${t} is not a number: ${r}`)();continue}a[o]=Number(r)}else{let e=gr(r);if(!e){dr.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${r}`)();continue}a.set(e,o)}}return new Uint8Array(t)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}},Ln=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name,e?.name&&e?.shaderLayout){let t=e?.shaderLayout.bindings?.find((t=>"uniform"===t.type&&t.name===e?.name));if(!t)throw new Error(e?.name);let i=t;for(let e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(let[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t,i=16){if(e!==t)return!1;let r=gr(e);if(!r)return!1;let n=gr(t);if(n&&r.length===n.length)for(let e=0;e<r.length;++e)if(n[e]!==r[e])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){let t=gr(e);return t?t.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}};function On(e){let t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function Fn(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function Nn(e,t,i){if(!t||t>4)throw new Error(`size ${t}`);let r=t,n=On(e);if("uint8"===n||"sint8"===n){if(1===r||3===r)throw new Error(`size: ${t}`);return i&&(n=n.replace("int","norm")),`${n}x${r}`}if("uint16"===n||"sint16"===n){if(1===r||3===r)throw new Error(`size: ${t}`);return i&&(n=n.replace("int","norm")),`${n}x${r}`}return 1===r?n:`${n}x${r}`}function Dn(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach((i=>{let r=e[i];!function(e){return null!==gr(e)||"number"==typeof e||"boolean"==typeof e}(r)?t.bindings[i]=r:t.uniforms[i]=r})),t}async function kn(e,t){return await new Promise(((i,r)=>{try{let n=new Image;n.onload=()=>i(n),n.onerror=()=>r(new Error(`Could not load image ${e}.`)),n.crossOrigin=t?.crossOrigin||"anonymous",n.src=e.startsWith("http")?e:""+e}catch(e){r(e)}}))}async function Un(e,t){let i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");let r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",e),t&&(r.id=t),new Promise(((t,n)=>{r.onload=t,r.onerror=t=>n(new Error(`Unable to load script '${e}': ${t}`)),i.appendChild(r)}))}function Gn(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Gn(e[r],t[r],i-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let n of r)if(!t.hasOwnProperty(n)||!Gn(e[n],t[n],i-1))return!1;return!0}return!1}var zn,Vn=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}},jn=class extends Vn{constructor(){super()}},Hn=class extends jn{constructor(e,t,i,r){super(),this.name=e,this.args=t,this.returnType=i,this.body=r}get astNodeType(){return"function"}},Wn=class extends jn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}},Xn=class extends jn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}},qn=class extends jn{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}},Kn=class extends jn{constructor(e,t,i,r){super(),this.init=e,this.condition=t,this.increment=i,this.body=r}get astNodeType(){return"for"}},$n=class extends jn{constructor(e,t,i,r,n){super(),this.name=e,this.type=t,this.storage=i,this.access=r,this.value=n}get astNodeType(){return"var"}},Jn=class extends jn{constructor(e,t,i){super(),this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}},Yn=class extends jn{constructor(e,t,i,r,n){super(),this.name=e,this.type=t,this.storage=i,this.access=r,this.value=n}get astNodeType(){return"let"}},Zn=class extends jn{constructor(e,t,i,r,n){super(),this.name=e,this.type=t,this.storage=i,this.access=r,this.value=n}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}};!function(e){e.increment="++",e.decrement="--"}(zn||(zn={})),function(e){e.parse=function(t){let i=t;if("parse"==i)throw new Error("Invalid value for IncrementOperator");return e[i]}}(zn||(zn={}));var Qn,es=class extends jn{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}};!function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="}(Qn||(Qn={})),function(e){e.parse=function(t){let i=t;if("parse"==i)throw new Error("Invalid value for AssignOperator");return e[i]}}(Qn||(Qn={}));var ts,is,rs=class extends jn{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}},ns=class extends jn{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}},ss=class extends jn{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}},os=class extends jn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}},as=class extends jn{constructor(e,t,i,r){super(),this.condition=e,this.body=t,this.elseif=i,this.else=r}get astNodeType(){return"if"}},ls=class extends jn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}},us=class extends jn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},hs=class extends jn{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}},cs=class extends jn{constructor(){super()}get astNodeType(){return"discard"}},ds=class extends jn{constructor(){super()}get astNodeType(){return"break"}},fs=class extends jn{constructor(){super()}get astNodeType(){return"continue"}},ps=class extends jn{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}},gs=class extends ps{constructor(e,t){super(e),this.members=t}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}},ms=class extends ps{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}},_s=class extends ps{constructor(e,t,i,r){super(e),this.storage=t,this.type=i,this.access=r}get astNodeType(){return"pointer"}},vs=class extends ps{constructor(e,t,i,r){super(e),this.attributes=t,this.format=i,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}},ys=class extends ps{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}},bs=class extends Vn{constructor(){super()}},As=class extends bs{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}},Es=class extends bs{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}},ws=class extends bs{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return 180*this.args[0].evaluate(e)/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}},xs=class extends bs{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}},Ts=class extends bs{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,i;if(this.initializer instanceof Es){let r=null===(t=this.postfix)||void 0===t?void 0:t.evaluateString(e),n=null===(i=this.initializer.type)||void 0===i?void 0:i.name,s=e.structs.get(n),o=s?.getMemberIndex(r);if(-1!=o)return this.initializer.args[o].evaluate(e);console.log(o)}return this.initializer.evaluate(e)}},Cs=class extends bs{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}},Ss=class extends bs{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}},Ps=class extends bs{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}},Ms=class extends bs{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}},Rs=class extends bs{constructor(){super()}},Is=class extends Rs{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}},Bs=class extends Rs{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}},Ls=class extends Vn{constructor(){super()}},Os=class extends Ls{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}},Fs=class extends Ls{constructor(e){super(),this.body=e}get astNodeType(){return"default"}},Ns=class extends Vn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}},Ds=class extends Vn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}},ks=class extends Vn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}},Us=class extends Vn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}};!function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"}(is||(is={}));var Gs=class{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}},zs=class{};ts=zs,zs.none=new Gs("",is.reserved,""),zs.eof=new Gs("EOF",is.token,""),zs.reserved={asm:new Gs("asm",is.reserved,"asm"),bf16:new Gs("bf16",is.reserved,"bf16"),do:new Gs("do",is.reserved,"do"),enum:new Gs("enum",is.reserved,"enum"),f16:new Gs("f16",is.reserved,"f16"),f64:new Gs("f64",is.reserved,"f64"),handle:new Gs("handle",is.reserved,"handle"),i8:new Gs("i8",is.reserved,"i8"),i16:new Gs("i16",is.reserved,"i16"),i64:new Gs("i64",is.reserved,"i64"),mat:new Gs("mat",is.reserved,"mat"),premerge:new Gs("premerge",is.reserved,"premerge"),regardless:new Gs("regardless",is.reserved,"regardless"),typedef:new Gs("typedef",is.reserved,"typedef"),u8:new Gs("u8",is.reserved,"u8"),u16:new Gs("u16",is.reserved,"u16"),u64:new Gs("u64",is.reserved,"u64"),unless:new Gs("unless",is.reserved,"unless"),using:new Gs("using",is.reserved,"using"),vec:new Gs("vec",is.reserved,"vec"),void:new Gs("void",is.reserved,"void")},zs.keywords={array:new Gs("array",is.keyword,"array"),atomic:new Gs("atomic",is.keyword,"atomic"),bool:new Gs("bool",is.keyword,"bool"),f32:new Gs("f32",is.keyword,"f32"),i32:new Gs("i32",is.keyword,"i32"),mat2x2:new Gs("mat2x2",is.keyword,"mat2x2"),mat2x3:new Gs("mat2x3",is.keyword,"mat2x3"),mat2x4:new Gs("mat2x4",is.keyword,"mat2x4"),mat3x2:new Gs("mat3x2",is.keyword,"mat3x2"),mat3x3:new Gs("mat3x3",is.keyword,"mat3x3"),mat3x4:new Gs("mat3x4",is.keyword,"mat3x4"),mat4x2:new Gs("mat4x2",is.keyword,"mat4x2"),mat4x3:new Gs("mat4x3",is.keyword,"mat4x3"),mat4x4:new Gs("mat4x4",is.keyword,"mat4x4"),ptr:new Gs("ptr",is.keyword,"ptr"),sampler:new Gs("sampler",is.keyword,"sampler"),sampler_comparison:new Gs("sampler_comparison",is.keyword,"sampler_comparison"),struct:new Gs("struct",is.keyword,"struct"),texture_1d:new Gs("texture_1d",is.keyword,"texture_1d"),texture_2d:new Gs("texture_2d",is.keyword,"texture_2d"),texture_2d_array:new Gs("texture_2d_array",is.keyword,"texture_2d_array"),texture_3d:new Gs("texture_3d",is.keyword,"texture_3d"),texture_cube:new Gs("texture_cube",is.keyword,"texture_cube"),texture_cube_array:new Gs("texture_cube_array",is.keyword,"texture_cube_array"),texture_multisampled_2d:new Gs("texture_multisampled_2d",is.keyword,"texture_multisampled_2d"),texture_storage_1d:new Gs("texture_storage_1d",is.keyword,"texture_storage_1d"),texture_storage_2d:new Gs("texture_storage_2d",is.keyword,"texture_storage_2d"),texture_storage_2d_array:new Gs("texture_storage_2d_array",is.keyword,"texture_storage_2d_array"),texture_storage_3d:new Gs("texture_storage_3d",is.keyword,"texture_storage_3d"),texture_depth_2d:new Gs("texture_depth_2d",is.keyword,"texture_depth_2d"),texture_depth_2d_array:new Gs("texture_depth_2d_array",is.keyword,"texture_depth_2d_array"),texture_depth_cube:new Gs("texture_depth_cube",is.keyword,"texture_depth_cube"),texture_depth_cube_array:new Gs("texture_depth_cube_array",is.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Gs("texture_depth_multisampled_2d",is.keyword,"texture_depth_multisampled_2d"),texture_external:new Gs("texture_external",is.keyword,"texture_external"),u32:new Gs("u32",is.keyword,"u32"),vec2:new Gs("vec2",is.keyword,"vec2"),vec3:new Gs("vec3",is.keyword,"vec3"),vec4:new Gs("vec4",is.keyword,"vec4"),bitcast:new Gs("bitcast",is.keyword,"bitcast"),block:new Gs("block",is.keyword,"block"),break:new Gs("break",is.keyword,"break"),case:new Gs("case",is.keyword,"case"),continue:new Gs("continue",is.keyword,"continue"),continuing:new Gs("continuing",is.keyword,"continuing"),default:new Gs("default",is.keyword,"default"),discard:new Gs("discard",is.keyword,"discard"),else:new Gs("else",is.keyword,"else"),enable:new Gs("enable",is.keyword,"enable"),fallthrough:new Gs("fallthrough",is.keyword,"fallthrough"),false:new Gs("false",is.keyword,"false"),fn:new Gs("fn",is.keyword,"fn"),for:new Gs("for",is.keyword,"for"),function:new Gs("function",is.keyword,"function"),if:new Gs("if",is.keyword,"if"),let:new Gs("let",is.keyword,"let"),const:new Gs("const",is.keyword,"const"),loop:new Gs("loop",is.keyword,"loop"),while:new Gs("while",is.keyword,"while"),private:new Gs("private",is.keyword,"private"),read:new Gs("read",is.keyword,"read"),read_write:new Gs("read_write",is.keyword,"read_write"),return:new Gs("return",is.keyword,"return"),storage:new Gs("storage",is.keyword,"storage"),switch:new Gs("switch",is.keyword,"switch"),true:new Gs("true",is.keyword,"true"),alias:new Gs("alias",is.keyword,"alias"),type:new Gs("type",is.keyword,"type"),uniform:new Gs("uniform",is.keyword,"uniform"),var:new Gs("var",is.keyword,"var"),override:new Gs("override",is.keyword,"override"),workgroup:new Gs("workgroup",is.keyword,"workgroup"),write:new Gs("write",is.keyword,"write"),r8unorm:new Gs("r8unorm",is.keyword,"r8unorm"),r8snorm:new Gs("r8snorm",is.keyword,"r8snorm"),r8uint:new Gs("r8uint",is.keyword,"r8uint"),r8sint:new Gs("r8sint",is.keyword,"r8sint"),r16uint:new Gs("r16uint",is.keyword,"r16uint"),r16sint:new Gs("r16sint",is.keyword,"r16sint"),r16float:new Gs("r16float",is.keyword,"r16float"),rg8unorm:new Gs("rg8unorm",is.keyword,"rg8unorm"),rg8snorm:new Gs("rg8snorm",is.keyword,"rg8snorm"),rg8uint:new Gs("rg8uint",is.keyword,"rg8uint"),rg8sint:new Gs("rg8sint",is.keyword,"rg8sint"),r32uint:new Gs("r32uint",is.keyword,"r32uint"),r32sint:new Gs("r32sint",is.keyword,"r32sint"),r32float:new Gs("r32float",is.keyword,"r32float"),rg16uint:new Gs("rg16uint",is.keyword,"rg16uint"),rg16sint:new Gs("rg16sint",is.keyword,"rg16sint"),rg16float:new Gs("rg16float",is.keyword,"rg16float"),rgba8unorm:new Gs("rgba8unorm",is.keyword,"rgba8unorm"),rgba8unorm_srgb:new Gs("rgba8unorm_srgb",is.keyword,"rgba8unorm_srgb"),rgba8snorm:new Gs("rgba8snorm",is.keyword,"rgba8snorm"),rgba8uint:new Gs("rgba8uint",is.keyword,"rgba8uint"),rgba8sint:new Gs("rgba8sint",is.keyword,"rgba8sint"),bgra8unorm:new Gs("bgra8unorm",is.keyword,"bgra8unorm"),bgra8unorm_srgb:new Gs("bgra8unorm_srgb",is.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Gs("rgb10a2unorm",is.keyword,"rgb10a2unorm"),rg11b10float:new Gs("rg11b10float",is.keyword,"rg11b10float"),rg32uint:new Gs("rg32uint",is.keyword,"rg32uint"),rg32sint:new Gs("rg32sint",is.keyword,"rg32sint"),rg32float:new Gs("rg32float",is.keyword,"rg32float"),rgba16uint:new Gs("rgba16uint",is.keyword,"rgba16uint"),rgba16sint:new Gs("rgba16sint",is.keyword,"rgba16sint"),rgba16float:new Gs("rgba16float",is.keyword,"rgba16float"),rgba32uint:new Gs("rgba32uint",is.keyword,"rgba32uint"),rgba32sint:new Gs("rgba32sint",is.keyword,"rgba32sint"),rgba32float:new Gs("rgba32float",is.keyword,"rgba32float"),static_assert:new Gs("static_assert",is.keyword,"static_assert")},zs.tokens={decimal_float_literal:new Gs("decimal_float_literal",is.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Gs("hex_float_literal",is.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Gs("int_literal",is.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Gs("uint_literal",is.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Gs("ident",is.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new Gs("and",is.token,"&"),and_and:new Gs("and_and",is.token,"&&"),arrow:new Gs("arrow ",is.token,"->"),attr:new Gs("attr",is.token,"@"),attr_left:new Gs("attr_left",is.token,"[["),attr_right:new Gs("attr_right",is.token,"]]"),forward_slash:new Gs("forward_slash",is.token,"/"),bang:new Gs("bang",is.token,"!"),bracket_left:new Gs("bracket_left",is.token,"["),bracket_right:new Gs("bracket_right",is.token,"]"),brace_left:new Gs("brace_left",is.token,"{"),brace_right:new Gs("brace_right",is.token,"}"),colon:new Gs("colon",is.token,":"),comma:new Gs("comma",is.token,","),equal:new Gs("equal",is.token,"="),equal_equal:new Gs("equal_equal",is.token,"=="),not_equal:new Gs("not_equal",is.token,"!="),greater_than:new Gs("greater_than",is.token,">"),greater_than_equal:new Gs("greater_than_equal",is.token,">="),shift_right:new Gs("shift_right",is.token,">>"),less_than:new Gs("less_than",is.token,"<"),less_than_equal:new Gs("less_than_equal",is.token,"<="),shift_left:new Gs("shift_left",is.token,"<<"),modulo:new Gs("modulo",is.token,"%"),minus:new Gs("minus",is.token,"-"),minus_minus:new Gs("minus_minus",is.token,"--"),period:new Gs("period",is.token,"."),plus:new Gs("plus",is.token,"+"),plus_plus:new Gs("plus_plus",is.token,"++"),or:new Gs("or",is.token,"|"),or_or:new Gs("or_or",is.token,"||"),paren_left:new Gs("paren_left",is.token,"("),paren_right:new Gs("paren_right",is.token,")"),semicolon:new Gs("semicolon",is.token,";"),star:new Gs("star",is.token,"*"),tilde:new Gs("tilde",is.token,"~"),underscore:new Gs("underscore",is.token,"_"),xor:new Gs("xor",is.token,"^"),plus_equal:new Gs("plus_equal",is.token,"+="),minus_equal:new Gs("minus_equal",is.token,"-="),times_equal:new Gs("times_equal",is.token,"*="),division_equal:new Gs("division_equal",is.token,"/="),modulo_equal:new Gs("modulo_equal",is.token,"%="),and_equal:new Gs("and_equal",is.token,"&="),or_equal:new Gs("or_equal",is.token,"|="),xor_equal:new Gs("xor_equal",is.token,"^="),shift_right_equal:new Gs("shift_right_equal",is.token,">>="),shift_left_equal:new Gs("shift_left_equal",is.token,"<<=")},zs.storage_class=[ts.keywords.function,ts.keywords.private,ts.keywords.workgroup,ts.keywords.uniform,ts.keywords.storage],zs.access_mode=[ts.keywords.read,ts.keywords.write,ts.keywords.read_write],zs.sampler_type=[ts.keywords.sampler,ts.keywords.sampler_comparison],zs.sampled_texture_type=[ts.keywords.texture_1d,ts.keywords.texture_2d,ts.keywords.texture_2d_array,ts.keywords.texture_3d,ts.keywords.texture_cube,ts.keywords.texture_cube_array],zs.multisampled_texture_type=[ts.keywords.texture_multisampled_2d],zs.storage_texture_type=[ts.keywords.texture_storage_1d,ts.keywords.texture_storage_2d,ts.keywords.texture_storage_2d_array,ts.keywords.texture_storage_3d],zs.depth_texture_type=[ts.keywords.texture_depth_2d,ts.keywords.texture_depth_2d_array,ts.keywords.texture_depth_cube,ts.keywords.texture_depth_cube_array,ts.keywords.texture_depth_multisampled_2d],zs.texture_external_type=[ts.keywords.texture_external],zs.any_texture_type=[...ts.sampled_texture_type,...ts.multisampled_texture_type,...ts.storage_texture_type,...ts.depth_texture_type,...ts.texture_external_type],zs.texel_format=[ts.keywords.r8unorm,ts.keywords.r8snorm,ts.keywords.r8uint,ts.keywords.r8sint,ts.keywords.r16uint,ts.keywords.r16sint,ts.keywords.r16float,ts.keywords.rg8unorm,ts.keywords.rg8snorm,ts.keywords.rg8uint,ts.keywords.rg8sint,ts.keywords.r32uint,ts.keywords.r32sint,ts.keywords.r32float,ts.keywords.rg16uint,ts.keywords.rg16sint,ts.keywords.rg16float,ts.keywords.rgba8unorm,ts.keywords.rgba8unorm_srgb,ts.keywords.rgba8snorm,ts.keywords.rgba8uint,ts.keywords.rgba8sint,ts.keywords.bgra8unorm,ts.keywords.bgra8unorm_srgb,ts.keywords.rgb10a2unorm,ts.keywords.rg11b10float,ts.keywords.rg32uint,ts.keywords.rg32sint,ts.keywords.rg32float,ts.keywords.rgba16uint,ts.keywords.rgba16sint,ts.keywords.rgba16float,ts.keywords.rgba32uint,ts.keywords.rgba32sint,ts.keywords.rgba32float],zs.const_literal=[ts.tokens.int_literal,ts.tokens.uint_literal,ts.tokens.decimal_float_literal,ts.tokens.hex_float_literal,ts.keywords.true,ts.keywords.false],zs.literal_or_ident=[ts.tokens.ident,ts.tokens.int_literal,ts.tokens.uint_literal,ts.tokens.decimal_float_literal,ts.tokens.hex_float_literal],zs.element_count_expression=[ts.tokens.int_literal,ts.tokens.uint_literal,ts.tokens.ident],zs.template_types=[ts.keywords.vec2,ts.keywords.vec3,ts.keywords.vec4,ts.keywords.mat2x2,ts.keywords.mat2x3,ts.keywords.mat2x4,ts.keywords.mat3x2,ts.keywords.mat3x3,ts.keywords.mat3x4,ts.keywords.mat4x2,ts.keywords.mat4x3,ts.keywords.mat4x4,ts.keywords.atomic,ts.keywords.bitcast,...ts.any_texture_type],zs.attribute_name=[ts.tokens.ident,ts.keywords.block],zs.assignment_operators=[ts.tokens.equal,ts.tokens.plus_equal,ts.tokens.minus_equal,ts.tokens.times_equal,ts.tokens.division_equal,ts.tokens.modulo_equal,ts.tokens.and_equal,ts.tokens.or_equal,ts.tokens.xor_equal,ts.tokens.shift_right_equal,ts.tokens.shift_left_equal],zs.increment_operators=[ts.tokens.plus_plus,ts.tokens.minus_minus];var Vs,js=class{constructor(e,t,i){this.type=e,this.lexeme=t,this.line=i}toString(){return this.lexeme}isTemplateType(){return-1!=zs.template_types.indexOf(this.type)}isArrayType(){return this.type==zs.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},Hs=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}},Ws=class{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Xs=class extends Hs{constructor(e,t){super(e,t),this.members=[],this.align=0}get isStruct(){return!0}},qs=class extends Hs{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}},Ks=class extends Hs{constructor(e,t,i,r){super(e,i),this.format=t,this.access=r}get isTemplate(){return!0}};!function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"}(Vs||(Vs={}));var $s=class{constructor(e,t,i,r,n,s,o){this.name=e,this.type=t,this.group=i,this.binding=r,this.attributes=n,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Js=class{constructor(e,t){this.align=e,this.size=t}},Ys=class{constructor(e,t,i,r){this.name=e,this.type=t,this.locationType=i,this.location=r}},Zs=class{constructor(e,t=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=t}},Qs=class{constructor(e,t,i,r){this.name=e,this.type=t,this.attributes=i,this.id=r}},eo=class{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}update(e){let t=(new class{constructor(){this._tokens=[],this._current=0,this._context=new class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}}parse(e){this._initialize(e);let t=[];for(;!this._isAtEnd();){let e=this._global_decl_or_directive();if(!e)break;t.push(e)}return t}_initialize(e){if(e)if("string"==typeof e){let t=new class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new js(zs.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}let t=zs.none;for(;;){let i=this._findType(e),r=this._peekAhead();if(">"==e&&(">"==r||"="==r)){let e=!1,t=this._tokens.length-1;for(let i=0;i<5&&t>=0;++i,--t)if(this._tokens[t].type===zs.tokens.less_than){t>0&&this._tokens[t-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(i),!0}if(i===zs.none){let r=e,n=0,s=2;for(let e=0;e<s;++e)if(r+=this._peekAhead(e),i=this._findType(r),i!==zs.none){n=e;break}if(i===zs.none)return t!==zs.none&&(this._current--,this._addToken(t),!0);e=r,this._current+=n+1}if(t=i,this._isAtEnd())break;e+=this._advance()}return t!==zs.none&&(this._addToken(t),!0)}_findType(e){for(let t in zs.keywords){let i=zs.keywords[t];if(this._match(e,i.rule))return i}for(let t in zs.tokens){let i=zs.tokens[t];if(this._match(e,i.rule))return i}return zs.none}_match(e,t){if("string"==typeof t){if(t==e)return!0}else{let i=t.exec(e);if(i&&0==i.index&&i[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let t=this._source.substring(this._start,this._current);this._tokens.push(new js(e,t,this._line))}}(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return console.error(e,t),{token:e,message:t,toString:function(){return`${t}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==zs.eof}_match(e){if(e instanceof Gs)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){let i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;let t=this._peek();if(e instanceof Array){let i=t.type;return-1!=e.indexOf(i)}return t.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(zs.tokens.semicolon)&&!this._isAtEnd(););if(this._match(zs.keywords.alias)){let e=this._type_alias();return this._consume(zs.tokens.semicolon,"Expected ';'"),e}if(this._match(zs.keywords.enable)){let e=this._enable_directive();return this._consume(zs.tokens.semicolon,"Expected ';'"),e}let e=this._attribute();if(this._check(zs.keywords.var)){let t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(zs.tokens.semicolon,"Expected ';'."),t}if(this._check(zs.keywords.override)){let t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(zs.tokens.semicolon,"Expected ';'."),t}if(this._check(zs.keywords.let)){let t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(zs.tokens.semicolon,"Expected ';'."),t}if(this._check(zs.keywords.const)){let t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(zs.tokens.semicolon,"Expected ';'."),t}if(this._check(zs.keywords.struct)){let t=this._struct_decl();return null!=t&&(t.attributes=e),t}if(this._check(zs.keywords.fn)){let t=this._function_decl();return null!=t&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(zs.keywords.fn))return null;let e=this._consume(zs.tokens.ident,"Expected function name.").toString();this._consume(zs.tokens.paren_left,"Expected '(' for function arguments.");let t=[];if(!this._check(zs.tokens.paren_right))do{if(this._check(zs.tokens.paren_right))break;let e=this._attribute(),i=this._consume(zs.tokens.ident,"Expected argument name.").toString();this._consume(zs.tokens.colon,"Expected ':' for argument type.");let r=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=r,t.push(new Ns(i,n,e)))}while(this._match(zs.tokens.comma));this._consume(zs.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(zs.tokens.arrow)){let e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}let r=this._compound_statement();return new Hn(e,t,i,r)}_compound_statement(){let e=[];for(this._consume(zs.tokens.brace_left,"Expected '{' for block.");!this._check(zs.tokens.brace_right);){let t=this._statement();null!==t&&e.push(t)}return this._consume(zs.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(zs.tokens.semicolon)&&!this._isAtEnd(););if(this._check(zs.keywords.if))return this._if_statement();if(this._check(zs.keywords.switch))return this._switch_statement();if(this._check(zs.keywords.loop))return this._loop_statement();if(this._check(zs.keywords.for))return this._for_statement();if(this._check(zs.keywords.while))return this._while_statement();if(this._check(zs.keywords.continuing))return this._continuing_statement();if(this._check(zs.keywords.static_assert))return this._static_assert_statement();if(this._check(zs.tokens.brace_left))return this._compound_statement();let e=null;return e=this._check(zs.keywords.return)?this._return_statement():this._check([zs.keywords.var,zs.keywords.let,zs.keywords.const])?this._variable_statement():this._match(zs.keywords.discard)?new cs:this._match(zs.keywords.break)?new ds:this._match(zs.keywords.continue)?new fs:this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),null!=e&&this._consume(zs.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(zs.keywords.static_assert))return null;let e=this._optional_paren_expression();return new Wn(e)}_while_statement(){if(!this._match(zs.keywords.while))return null;let e=this._optional_paren_expression(),t=this._compound_statement();return new Xn(e,t)}_continuing_statement(){if(!this._match(zs.keywords.continuing))return null;let e=this._compound_statement();return new qn(e)}_for_statement(){if(!this._match(zs.keywords.for))return null;this._consume(zs.tokens.paren_left,"Expected '('.");let e=this._check(zs.tokens.semicolon)?null:this._for_init();this._consume(zs.tokens.semicolon,"Expected ';'.");let t=this._check(zs.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(zs.tokens.semicolon,"Expected ';'.");let i=this._check(zs.tokens.paren_right)?null:this._for_increment();this._consume(zs.tokens.paren_right,"Expected ')'.");let r=this._compound_statement();return new Kn(e,t,i,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(zs.keywords.var)){let e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(zs.tokens.equal)&&(t=this._short_circuit_or_expression()),new $n(e.name,e.type,e.storage,e.access,t)}if(this._match(zs.keywords.let)){let e=this._consume(zs.tokens.ident,"Expected name for let.").toString(),t=null;if(this._match(zs.tokens.colon)){let e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(zs.tokens.equal,"Expected '=' for let.");let i=this._short_circuit_or_expression();return new Yn(e,t,null,null,i)}if(this._match(zs.keywords.const)){let e=this._consume(zs.tokens.ident,"Expected name for const.").toString(),t=null;if(this._match(zs.tokens.colon)){let e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(zs.tokens.equal,"Expected '=' for const.");let i=this._short_circuit_or_expression();return new Zn(e,t,null,null,i)}return null}_increment_decrement_statement(){let e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(zs.increment_operators))return this._current=e,null;let i=this._consume(zs.increment_operators,"Expected increment operator");return new es(i.type===zs.tokens.plus_plus?zn.increment:zn.decrement,t)}_assignment_statement(){let e=null;if(this._check(zs.tokens.brace_right))return null;let t=this._match(zs.tokens.underscore);if(t||(e=this._unary_expression()),!t&&null==e)return null;let i=this._consume(zs.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new rs(Qn.parse(i.lexeme),e,r)}_func_call_statement(){if(!this._check(zs.tokens.ident))return null;let e=this._current,t=this._consume(zs.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=e,null):new ns(t.lexeme,i)}_loop_statement(){if(!this._match(zs.keywords.loop))return null;this._consume(zs.tokens.brace_left,"Expected '{' for loop.");let e=[],t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let i of t)e.push(i);else e.push(t);t=this._statement()}let i=null;return this._match(zs.keywords.continuing)&&(i=this._compound_statement()),this._consume(zs.tokens.brace_right,"Expected '}' for loop."),new ss(e,i)}_switch_statement(){if(!this._match(zs.keywords.switch))return null;let e=this._optional_paren_expression();this._consume(zs.tokens.brace_left,"Expected '{' for switch.");let t=this._switch_body();if(null==t||0==t.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(zs.tokens.brace_right,"Expected '}' for switch."),new os(e,t)}_switch_body(){let e=[];if(this._match(zs.keywords.case)){let t=this._case_selectors();this._match(zs.tokens.colon),this._consume(zs.tokens.brace_left,"Exected '{' for switch case.");let i=this._case_body();this._consume(zs.tokens.brace_right,"Exected '}' for switch case."),e.push(new Os(t,i))}if(this._match(zs.keywords.default)){this._match(zs.tokens.colon),this._consume(zs.tokens.brace_left,"Exected '{' for switch default.");let t=this._case_body();this._consume(zs.tokens.brace_right,"Exected '}' for switch default."),e.push(new Fs(t))}if(this._check([zs.keywords.default,zs.keywords.case])){let t=this._switch_body();e.push(t[0])}return e}_case_selectors(){var e,t,i,r;let n=[null!==(t=null===(e=this._shift_expression())||void 0===e?void 0:e.evaluate(this._context).toString())&&void 0!==t?t:""];for(;this._match(zs.tokens.comma);)n.push(null!==(r=null===(i=this._shift_expression())||void 0===i?void 0:i.evaluate(this._context).toString())&&void 0!==r?r:"");return n}_case_body(){if(this._match(zs.keywords.fallthrough))return this._consume(zs.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);let t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(zs.keywords.if))return null;let e=this._optional_paren_expression(),t=this._compound_statement(),i=[];this._match_elseif()&&(i=this._elseif_statement(i));let r=null;return this._match(zs.keywords.else)&&(r=this._compound_statement()),new as(e,t,i,r)}_match_elseif(){return this._tokens[this._current].type===zs.keywords.else&&this._tokens[this._current+1].type===zs.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let t=this._optional_paren_expression(),i=this._compound_statement();return e.push(new Ds(t,i)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(zs.keywords.return))return null;let e=this._short_circuit_or_expression();return new ls(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(zs.tokens.or_or);)e=new Bs(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(zs.tokens.and_and);)e=new Bs(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(zs.tokens.or);)e=new Bs(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(zs.tokens.xor);)e=new Bs(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(zs.tokens.and);)e=new Bs(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){let e=this._relational_expression();return this._match([zs.tokens.equal_equal,zs.tokens.not_equal])?new Bs(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([zs.tokens.less_than,zs.tokens.greater_than,zs.tokens.less_than_equal,zs.tokens.greater_than_equal]);)e=new Bs(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([zs.tokens.shift_left,zs.tokens.shift_right]);)e=new Bs(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([zs.tokens.plus,zs.tokens.minus]);)e=new Bs(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([zs.tokens.star,zs.tokens.forward_slash,zs.tokens.modulo]);)e=new Bs(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([zs.tokens.minus,zs.tokens.bang,zs.tokens.tilde,zs.tokens.star,zs.tokens.and])?new Is(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(zs.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(zs.tokens.bracket_right,"Expected ']'.");let t=this._postfix_expression();return t&&(e.postfix=t),e}if(this._match(zs.tokens.period)){let e=this._consume(zs.tokens.ident,"Expected member name."),t=this._postfix_expression(),i=new As(e.lexeme);return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(zs.tokens.ident)){let e=this._previous().toString();if(this._check(zs.tokens.paren_left)){let t=this._argument_expression_list(),i=this._getStruct(e);return null!=i?new Es(i,t):new ws(e,t)}if(this._context.constants.has(e)){let t=this._context.constants.get(e);return new Ts(e,t.value)}return new xs(e)}if(this._match(zs.const_literal))return new Cs(parseFloat(this._previous().toString()));if(this._check(zs.tokens.paren_left))return this._paren_expression();if(this._match(zs.keywords.bitcast)){this._consume(zs.tokens.less_than,"Expected '<'.");let e=this._type_decl();this._consume(zs.tokens.greater_than,"Expected '>'.");let t=this._paren_expression();return new Ss(e,t)}let e=this._type_decl(),t=this._argument_expression_list();return new Ps(e,t)}_argument_expression_list(){if(!this._match(zs.tokens.paren_left))return null;let e=[];do{if(this._check(zs.tokens.paren_right))break;let t=this._short_circuit_or_expression();e.push(t)}while(this._match(zs.tokens.comma));return this._consume(zs.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(zs.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(zs.tokens.paren_right),new Ms([e])}_paren_expression(){this._consume(zs.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(zs.tokens.paren_right,"Expected ')'."),new Ms([e])}_struct_decl(){if(!this._match(zs.keywords.struct))return null;let e=this._consume(zs.tokens.ident,"Expected name for struct.").toString();this._consume(zs.tokens.brace_left,"Expected '{' for struct body.");let t=[];for(;!this._check(zs.tokens.brace_right);){let e=this._attribute(),i=this._consume(zs.tokens.ident,"Expected variable name.").toString();this._consume(zs.tokens.colon,"Expected ':' for struct member type.");let r=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=r),this._check(zs.tokens.brace_right)?this._match(zs.tokens.comma):this._consume(zs.tokens.comma,"Expected ',' for struct member."),t.push(new ks(i,n,e))}this._consume(zs.tokens.brace_right,"Expected '}' after struct body.");let i=new gs(e,t);return this._context.structs.set(e,i),i}_global_variable_decl(){let e=this._variable_decl();return e&&this._match(zs.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(zs.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(zs.keywords.const))return null;let e=this._consume(zs.tokens.ident,"Expected variable name"),t=null;if(this._match(zs.tokens.colon)){let e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let i=null;if(this._match(zs.tokens.equal)){let e=this._short_circuit_or_expression();if(e instanceof Es)i=e;else if(e instanceof Ts&&e.initializer instanceof Es)i=e.initializer;else try{let t=e.evaluate(this._context);i=new Cs(t)}catch{i=e}}let r=new Zn(e.toString(),t,"","",i);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(zs.keywords.let))return null;let e=this._consume(zs.tokens.ident,"Expected variable name"),t=null;if(this._match(zs.tokens.colon)){let e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let i=null;return this._match(zs.tokens.equal)&&(i=this._const_expression()),new Yn(e.toString(),t,"","",i)}_const_expression(){if(this._match(zs.const_literal))return new As(this._previous().toString());let e=this._type_decl();this._consume(zs.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(zs.tokens.paren_right)&&(t.push(this._const_expression()),this._check(zs.tokens.comma));)this._advance();return this._consume(zs.tokens.paren_right,"Expected ')'."),new Es(e,t)}_variable_decl(){if(!this._match(zs.keywords.var))return null;let e="",t="";this._match(zs.tokens.less_than)&&(e=this._consume(zs.storage_class,"Expected storage_class.").toString(),this._match(zs.tokens.comma)&&(t=this._consume(zs.access_mode,"Expected access_mode.").toString()),this._consume(zs.tokens.greater_than,"Expected '>'."));let i=this._consume(zs.tokens.ident,"Expected variable name"),r=null;if(this._match(zs.tokens.colon)){let e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return new $n(i.toString(),r,e,t,null)}_override_decl(){if(!this._match(zs.keywords.override))return null;let e=this._consume(zs.tokens.ident,"Expected variable name"),t=null;if(this._match(zs.tokens.colon)){let e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return new Jn(e.toString(),t,null)}_enable_directive(){let e=this._consume(zs.tokens.ident,"identity expected.");return new us(e.toString())}_type_alias(){let e=this._consume(zs.tokens.ident,"identity expected.");this._consume(zs.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let i=new hs(e.toString(),t);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([zs.tokens.ident,...zs.texel_format,zs.keywords.bool,zs.keywords.f32,zs.keywords.i32,zs.keywords.u32])){let e=this._advance(),t=e.toString();return this._context.structs.has(t)?this._context.structs.get(t):this._context.aliases.has(t)?this._context.aliases.get(t).type:new ps(e.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(zs.template_types)){let e=this._advance().toString(),t=null,i=null;return this._match(zs.tokens.less_than)&&(t=this._type_decl(),i=null,this._match(zs.tokens.comma)&&(i=this._consume(zs.access_mode,"Expected access_mode for pointer").toString()),this._consume(zs.tokens.greater_than,"Expected '>' for type.")),new ms(e,t,i)}if(this._match(zs.keywords.ptr)){let e=this._previous().toString();this._consume(zs.tokens.less_than,"Expected '<' for pointer.");let t=this._consume(zs.storage_class,"Expected storage_class for pointer");this._consume(zs.tokens.comma,"Expected ',' for pointer.");let i=this._type_decl(),r=null;return this._match(zs.tokens.comma)&&(r=this._consume(zs.access_mode,"Expected access_mode for pointer").toString()),this._consume(zs.tokens.greater_than,"Expected '>' for pointer."),new _s(e,t.toString(),i,r)}let t=this._attribute();if(this._match(zs.keywords.array)){let e=null,i=-1,r=this._previous();if(this._match(zs.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";this._match(zs.tokens.comma)&&(t=this._shift_expression().evaluate(this._context).toString()),this._consume(zs.tokens.greater_than,"Expected '>' for array."),i=t?parseInt(t):0}return new vs(r.toString(),t,e,i)}return null}_texture_sampler_types(){if(this._match(zs.sampler_type))return new ys(this._previous().toString(),null,null);if(this._match(zs.depth_texture_type))return new ys(this._previous().toString(),null,null);if(this._match(zs.sampled_texture_type)||this._match(zs.multisampled_texture_type)){let e=this._previous();this._consume(zs.tokens.less_than,"Expected '<' for sampler type.");let t=this._type_decl();return this._consume(zs.tokens.greater_than,"Expected '>' for sampler type."),new ys(e.toString(),t,null)}if(this._match(zs.storage_texture_type)){let e=this._previous();this._consume(zs.tokens.less_than,"Expected '<' for sampler type.");let t=this._consume(zs.texel_format,"Invalid texel format.").toString();this._consume(zs.tokens.comma,"Expected ',' after texel format.");let i=this._consume(zs.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(zs.tokens.greater_than,"Expected '>' for sampler type."),new ys(e.toString(),t,i)}return null}_attribute(){let e=[];for(;this._match(zs.tokens.attr);){let t=this._consume(zs.attribute_name,"Expected attribute name"),i=new Us(t.toString(),null);if(this._match(zs.tokens.paren_left)){if(i.value=this._consume(zs.literal_or_ident,"Expected attribute value").toString(),this._check(zs.tokens.comma)){this._advance();do{let e=this._consume(zs.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(e)}while(this._match(zs.tokens.comma))}this._consume(zs.tokens.paren_right,"Expected ')'")}e.push(i)}for(;this._match(zs.tokens.attr_left);){if(!this._check(zs.tokens.attr_right))do{let t=this._consume(zs.attribute_name,"Expected attribute name"),i=new Us(t.toString(),null);if(this._match(zs.tokens.paren_left)){if(i.value=[this._consume(zs.literal_or_ident,"Expected attribute value").toString()],this._check(zs.tokens.comma)){this._advance();do{let e=this._consume(zs.literal_or_ident,"Expected attribute value").toString();i.value.push(e)}while(this._match(zs.tokens.comma))}this._consume(zs.tokens.paren_right,"Expected ')'")}e.push(i)}while(this._match(zs.tokens.comma));this._consume(zs.tokens.attr_right,"Expected ']]' after attribute declarations")}return 0==e.length?null:e}}).parse(e);for(let e of t)if(e instanceof gs){let t=this._getTypeInfo(e,null);t instanceof Xs&&this.structs.push(t)}else if(e instanceof hs)this.aliases.push(this._getAliasInfo(e));else if(e instanceof Jn){let t=e,i=this._getAttributeNum(t.attributes,"id",0),r=null!=t.type?this._getTypeInfo(t.type,t.attributes):null;this.overrides.push(new Qs(t.name,r,t.attributes,i))}else if(this._isUniformVar(e)){let t=e,i=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),n=this._getTypeInfo(t.type,t.attributes),s=new $s(t.name,n,i,r,t.attributes,Vs.Uniform,t.access);this.uniforms.push(s)}else if(this._isStorageVar(e)){let t=e,i=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),n=this._getTypeInfo(t.type,t.attributes),s=this._isStorageTexture(n),o=new $s(t.name,n,i,r,t.attributes,s?Vs.StorageTexture:Vs.Storage,t.access);this.storage.push(o)}else if(this._isTextureVar(e)){let t=e,i=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),n=this._getTypeInfo(t.type,t.attributes),s=this._isStorageTexture(n),o=new $s(t.name,n,i,r,t.attributes,s?Vs.StorageTexture:Vs.Texture,t.access);s?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(e)){let t=e,i=this._getAttributeNum(t.attributes,"group",0),r=this._getAttributeNum(t.attributes,"binding",0),n=this._getTypeInfo(t.type,t.attributes),s=new $s(t.name,n,i,r,t.attributes,Vs.Sampler,t.access);this.samplers.push(s)}else if(e instanceof Hn){let t=this._getAttribute(e,"vertex"),i=this._getAttribute(e,"fragment"),r=this._getAttribute(e,"compute"),n=t||i||r;if(n){let t=new Zs(e.name,n.name);t.inputs=this._getInputs(e.args),t.outputs=this._getOutputs(e.returnType),this.entry[n.name].push(t)}}}getBindGroups(){let e=[];function t(t,i){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),i>=e[t].length&&(e[t].length=i+1)}for(let i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof gs)this._getStructOutputs(e,t);else{let i=this._getOutputInfo(e);null!==i&&t.push(i)}return t}_getStructOutputs(e,t){for(let i of e.members)if(i.type instanceof gs)this._getStructOutputs(i.type,t);else{let e=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(null!==e){let r=this._getTypeInfo(i.type,i.type.attributes),n=this._parseInt(e.value),s=new Ys(i.name,r,e.name,n);t.push(s)}}}_getOutputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let i=this._getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new Ys("",i,t.name,r)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(let i of e)if(i.type instanceof gs)this._getStructInputs(i.type,t);else{let e=this._getInputInfo(i);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(let i of e.members)if(i.type instanceof gs)this._getStructInputs(i.type,t);else{let e=this._getInputInfo(i);null!==e&&t.push(e)}}_getInputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let i=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),n=this._parseInt(t.value),s=new class{constructor(e,t,i,r){this.name=e,this.type=t,this.locationType=i,this.location=r,this.interpolation=null}}(e.name,r,t.name,n);return null!==i&&(s.interpolation=this._parseString(i.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(let t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new class{constructor(e,t){this.name=e,this.type=t}}(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof vs){let i=e,r=this._getTypeInfo(i.format,i.attributes),n=new qs(i.name,t);return n.format=r,n.count=i.count,this._types.set(e,n),this._updateTypeInfo(n),n}if(e instanceof gs){let i=e,r=new Xs(i.name,t);for(let e of i.members){let t=this._getTypeInfo(e.type,e.attributes);r.members.push(new Ws(e.name,t,e.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof ys){let i=e,r=i.format instanceof ps,n=i.format?r?this._getTypeInfo(i.format,null):new Hs(i.format,null):null,s=new Ks(i.name,n,t,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ms){let i=e,r=i.format?this._getTypeInfo(i.format,null):null,n=new Ks(i.name,r,t,i.access);return this._types.set(e,n),this._updateTypeInfo(n),n}let i=new Hs(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i;let r=this._getTypeSize(e);if(e.size=null!==(t=r?.size)&&void 0!==t?t:0,e instanceof qs){let t=this._getTypeSize(e.format);e.stride=null!==(i=t?.size)&&void 0!==i?i:0,this._updateTypeInfo(e.format)}e instanceof Xs&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,r=0,n=0,s=0;for(let o=0,a=e.members.length;o<a;++o){let a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;let u=l.align,h=l.size;i=this._roundUp(u,i+r),r=h,n=i,s=Math.max(s,u),a.offset=i,a.size=h,this._updateTypeInfo(a.type)}e.size=this._roundUp(s,n+r),e.align=s}_getTypeSize(e){var t;if(null==e)return null;let i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ws&&(e=e.type),e instanceof Hs){let t=this._getAlias(e.name);null!==t&&(e=t)}{let t=eo._typeInfo[e.name];if(void 0!==t){let n="f16"===e.format?2:1;return new Js(Math.max(r,t.align/n),Math.max(i,t.size/n))}}{let t=eo._typeInfo[e.name.substring(0,e.name.length-1)];if(t){let n="h"===e.name[e.name.length-1]?2:1;return new Js(Math.max(r,t.align/n),Math.max(i,t.size/n))}}if(e instanceof qs){let n=e,s=8,o=8,a=this._getTypeSize(n.format);return null!==a&&(o=a.size,s=a.align),o=n.count*this._getAttributeNum(null!==(t=e?.attributes)&&void 0!==t?t:null,"stride",this._roundUp(s,o)),i&&(o=i),new Js(Math.max(r,s),Math.max(i,o))}if(e instanceof Xs){let t=0,n=0,s=0,o=0,a=0;for(let i of e.members){let e=this._getTypeSize(i.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+o),o=e.size,a=s)}return n=this._roundUp(t,a+o),new Js(Math.max(r,t),Math.max(i,n))}return null}_isUniformVar(e){return e instanceof $n&&"uniform"==e.storage}_isStorageVar(e){return e instanceof $n&&"storage"==e.storage}_isTextureVar(e){return e instanceof $n&&null!==e.type&&-1!=eo._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof $n&&null!==e.type&&-1!=eo._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){let i=e;if(!i||!i.attributes)return null;let r=i.attributes;for(let e of r)if(e.name==t)return e;return null}_getAttributeNum(e,t,i){if(null===e)return i;for(let r of e)if(r.name==t){let e=null!==r&&null!==r.value?r.value:i;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}};function to(e){let t,i={attributes:[],bindings:[]};try{t=function(e){try{return new eo(e)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw"object"==typeof e&&e?.message&&(t+=`: ${e.message} `),"object"==typeof e&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}(e)}catch(e){return dr.error(e.message)(),i}for(let e of t.uniforms){let t=[];for(let i of e.type.members)t.push({name:i.name,type:io(i.type)});i.bindings.push({type:"uniform",name:e.name,location:e.binding,group:e.group,members:t})}let r=t.entry.vertex[0],n=r?.inputs.length||0;for(let e=0;e<n;e++){let t=r.inputs[e];if("location"===t.locationType){let e=io(t.type);i.attributes.push({name:t.name,location:t.location,type:e})}}return i}function io(e){return e.format?`${e.name}<${e.format.name}>`:e.name}eo._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},eo._textureTypes=zs.any_texture_type.map((e=>e.name)),eo._samplerTypes=zs.sampler_type.map((e=>e.name));var ro={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\nfloat sin_taylor_fp32(float a) {\nfloat r, s, t, x;\nif (a == 0.0) {\nreturn 0.0;\n}\nx = -a * a;\ns = a;\nr = a;\nr = r * x;\nt = r * INVERSE_FACTORIAL_3;\ns = s + t;\nr = r * x;\nt = r * INVERSE_FACTORIAL_5;\ns = s + t;\nr = r * x;\nt = r * INVERSE_FACTORIAL_7;\ns = s + t;\nr = r * x;\nt = r * INVERSE_FACTORIAL_9;\ns = s + t;\nreturn s;\n}\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\nif (a == 0.0) {\nsin_t = 0.0;\ncos_t = 1.0;\n}\nsin_t = sin_taylor_fp32(a);\ncos_t = sqrt(1.0 - sin_t * sin_t);\n}\nfloat tan_taylor_fp32(float a) {\nfloat sin_a;\nfloat cos_a;\nif (a == 0.0) {\nreturn 0.0;\n}\nfloat z = floor(a / TWO_PI);\nfloat r = a - TWO_PI * z;\nfloat t;\nfloat q = floor(r / PI_2 + 0.5);\nint j = int(q);\nif (j < -2 || j > 2) {\nreturn 1.0 / 0.0;\n}\nt = r - PI_2 * q;\nq = floor(t / PI_16 + 0.5);\nint k = int(q);\nint abs_k = int(abs(float(k)));\nif (abs_k > 4) {\nreturn 1.0 / 0.0;\n} else {\nt = t - PI_16 * q;\n}\nfloat u = 0.0;\nfloat v = 0.0;\nfloat sin_t, cos_t;\nfloat s, c;\nsincos_taylor_fp32(t, sin_t, cos_t);\nif (k == 0) {\ns = sin_t;\nc = cos_t;\n} else {\nif (abs(float(abs_k) - 1.0) < 0.5) {\nu = COS_TABLE_0;\nv = SIN_TABLE_0;\n} else if (abs(float(abs_k) - 2.0) < 0.5) {\nu = COS_TABLE_1;\nv = SIN_TABLE_1;\n} else if (abs(float(abs_k) - 3.0) < 0.5) {\nu = COS_TABLE_2;\nv = SIN_TABLE_2;\n} else if (abs(float(abs_k) - 4.0) < 0.5) {\nu = COS_TABLE_3;\nv = SIN_TABLE_3;\n}\nif (k > 0) {\ns = u * sin_t + v * cos_t;\nc = u * cos_t - v * sin_t;\n} else {\ns = u * sin_t - v * cos_t;\nc = u * cos_t + v * sin_t;\n}\n}\nif (j == 0) {\nsin_a = s;\ncos_a = c;\n} else if (j == 1) {\nsin_a = c;\ncos_a = -s;\n} else if (j == -1) {\nsin_a = -c;\ncos_a = s;\n} else {\nsin_a = -s;\ncos_a = -c;\n}\nreturn sin_a / cos_a;\n}\n#endif\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nreturn tan_taylor_fp32(a);\n#else\nreturn tan(a);\n#endif\n}\n"},no=new Float32Array([0,1,1,1]),so={name:"picking",vs:"uniform pickingUniforms {\nfloat isActive;\nfloat isAttribute;\nfloat isHighlightActive;\nfloat useFloatColors;\nvec3 highlightedObjectColor;\nvec4 highlightColor;\n} picking;\nout vec4 picking_vRGBcolor_Avalid;\nvec3 picking_normalizeColor(vec3 color) {\nreturn picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\nvec4 picking_normalizeColor(vec4 color) {\nreturn picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\nbool picking_isColorZero(vec3 color) {\nreturn dot(color, vec3(1.0)) < 0.00001;\n}\nbool picking_isColorValid(vec3 color) {\nreturn dot(color, vec3(1.0)) > 0.00001;\n}\nbool isVertexHighlighted(vec3 vertexColor) {\nvec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\nreturn\nbool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\nvoid picking_setPickingColor(vec3 pickingColor) {\npickingColor = picking_normalizeColor(pickingColor);\nif (bool(picking.isActive)) {\npicking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\nif (!bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.rgb = pickingColor;\n}\n} else {\npicking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n}\n}\nvoid picking_setPickingAttribute(float value) {\nif (bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.r = value;\n}\n}\nvoid picking_setPickingAttribute(vec2 value) {\nif (bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.rg = value;\n}\n}\nvoid picking_setPickingAttribute(vec3 value) {\nif (bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.rgb = value;\n}\n}\n",fs:"uniform pickingUniforms {\nfloat isActive;\nfloat isAttribute;\nfloat isHighlightActive;\nfloat useFloatColors;\nvec3 highlightedObjectColor;\nvec4 highlightColor;\n} picking;\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\nif (picking.isActive > 0.5) {\nreturn color;\n}\nbool selected = bool(picking_vRGBcolor_Avalid.a);\nif (selected) {\nfloat highLightAlpha = picking.highlightColor.a;\nfloat blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\nfloat highLightRatio = highLightAlpha / blendedAlpha;\nvec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\nreturn vec4(blendedRGB, blendedAlpha);\n} else {\nreturn color;\n}\n}\nvec4 picking_filterPickingColor(vec4 color) {\nif (bool(picking.isActive)) {\nif (picking_vRGBcolor_Avalid.a == 0.0) {\ndiscard;\n}\nreturn picking_vRGBcolor_Avalid;\n}\nreturn color;\n}\nvec4 picking_filterColor(vec4 color) {\nvec4 highlightColor = picking_filterHighlightColor(color);\nreturn picking_filterPickingColor(highlightColor);\n}\n",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:no},getUniforms:function(e={},t){let i={};if(void 0!==e.highlightedObjectColor)if(null===e.highlightedObjectColor)i.isHighlightActive=!1;else{i.isHighlightActive=!0;let t=e.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=t}if(e.highlightColor){let t=Array.from(e.highlightColor,(e=>e/255));Number.isFinite(t[3])||(t[3]=1),i.highlightColor=t}return void 0!==e.isActive&&(i.isActive=Boolean(e.isActive),i.isAttribute=Boolean(e.isAttribute)),void 0!==e.useFloatColors&&(i.useFloatColors=Boolean(e.useFloatColors)),i}};function oo(e,t=[],i=0){let r=Math.fround(e),n=e-r;return t[i]=r,t[i+1]=n,t}function ao(e){return e-Math.fround(e)}function lo(e){let t=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){let n=4*i+r;oo(e[4*r+i],t,2*n)}return t}var uo={ONE:1},ho={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\nconst float SPLIT = 4097.0;\nfloat t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat a_hi = t * ONE - (t - a);\nfloat a_lo = a * ONE - a_hi;\n#else\nfloat a_hi = t - (t - a);\nfloat a_lo = a - a_hi;\n#endif\nreturn vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\nvec2 b = split(a.x);\nb.y += a.y;\nreturn b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat sum = (a + b) * ONE;\nfloat err = b - (sum - a) * ONE;\n#else\nfloat sum = a + b;\nfloat err = b - (sum - a);\n#endif\nreturn vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\nfloat s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat v = (s * ONE - a) * ONE;\nfloat err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\nfloat v = s - a;\nfloat err = (a - (s - v)) + (b - v);\n#endif\nreturn vec2(s, err);\n}\nvec2 twoSub(float a, float b) {\nfloat s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat v = (s * ONE - a) * ONE;\nfloat err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\nfloat v = s - a;\nfloat err = (a - (s - v)) - (b + v);\n#endif\nreturn vec2(s, err);\n}\nvec2 twoSqr(float a) {\nfloat prod = a * a;\nvec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\na_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\nfloat err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\nreturn vec2(prod, err);\n}\nvec2 twoProd(float a, float b) {\nfloat prod = a * b;\nvec2 a_fp64 = split(a);\nvec2 b_fp64 = split(b);\nfloat err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\na_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\nreturn vec2(prod, err);\n}\nvec2 sum_fp64(vec2 a, vec2 b) {\nvec2 s, t;\ns = twoSum(a.x, b.x);\nt = twoSum(a.y, b.y);\ns.y += t.x;\ns = quickTwoSum(s.x, s.y);\ns.y += t.y;\ns = quickTwoSum(s.x, s.y);\nreturn s;\n}\nvec2 sub_fp64(vec2 a, vec2 b) {\nvec2 s, t;\ns = twoSub(a.x, b.x);\nt = twoSub(a.y, b.y);\ns.y += t.x;\ns = quickTwoSum(s.x, s.y);\ns.y += t.y;\ns = quickTwoSum(s.x, s.y);\nreturn s;\n}\nvec2 mul_fp64(vec2 a, vec2 b) {\nvec2 prod = twoProd(a.x, b.x);\nprod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nprod = split2(prod);\n#endif\nprod = quickTwoSum(prod.x, prod.y);\nprod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nprod = split2(prod);\n#endif\nprod = quickTwoSum(prod.x, prod.y);\nreturn prod;\n}\nvec2 div_fp64(vec2 a, vec2 b) {\nfloat xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nvec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\nvec2 yn = a * xn;\n#endif\nfloat diff = (sub_fp64(a, mul_fp64(b, yn))).x;\nvec2 prod = twoProd(xn, diff);\nreturn sum_fp64(yn, prod);\n}\nvec2 sqrt_fp64(vec2 a) {\nif (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\nif (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\nfloat x = 1.0 / sqrt(a.x);\nfloat yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nvec2 yn_sqr = twoSqr(yn) * ONE;\n#else\nvec2 yn_sqr = twoSqr(yn);\n#endif\nfloat diff = sub_fp64(a, yn_sqr).x;\nvec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nreturn sum_fp64(split(yn), prod);\n#else\nreturn sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",getUniforms:function(){return uo},fp64ify:oo,fp64LowPart:ao,fp64ifyMatrix4:lo},co={name:"fp64",vs:"const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);\nfloat nint(float d) {\nif (d == floor(d)) return d;\nreturn floor(d + 0.5);\n}\nvec2 nint_fp64(vec2 a) {\nfloat hi = nint(a.x);\nfloat lo;\nvec2 tmp;\nif (hi == a.x) {\nlo = nint(a.y);\ntmp = quickTwoSum(hi, lo);\n} else {\nlo = 0.0;\nif (abs(hi - a.x) == 0.5 && a.y < 0.0) {\nhi -= 1.0;\n}\ntmp = vec2(hi, lo);\n}\nreturn tmp;\n}\nvec2 exp_fp64(vec2 a) {\nconst int k_power = 4;\nconst float k = 16.0;\nconst float inv_k = 1.0 / k;\nif (a.x <= -88.0) return vec2(0.0, 0.0);\nif (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\nif (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\nif (a.x == 1.0 && a.y == 0.0) return E_FP64;\nfloat m = floor(a.x / LOG2_FP64.x + 0.5);\nvec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\nvec2 s, t, p;\np = mul_fp64(r, r);\ns = sum_fp64(r, p * 0.5);\np = mul_fp64(p, r);\nt = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\ns = sum_fp64(s, t);\np = mul_fp64(p, r);\nt = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\ns = sum_fp64(s, t);\np = mul_fp64(p, r);\nt = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\ns = sum_fp64(s, t);\nfor (int i = 0; i < k_power; i++) {\ns = sum_fp64(s * 2.0, mul_fp64(s, s));\n}\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\ns = sum_fp64(s, vec2(ONE, 0.0));\n#else\ns = sum_fp64(s, vec2(1.0, 0.0));\n#endif\nreturn s * pow(2.0, m);\n}\nvec2 log_fp64(vec2 a)\n{\nif (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\nif (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\nvec2 x = vec2(log(a.x), 0.0);\nvec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\ns = vec2(ONE, 0.0);\n#else\ns = vec2(1.0, 0.0);\n#endif\nx = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\nreturn x;\n}\nvec2 sin_taylor_fp64(vec2 a) {\nvec2 r, s, t, x;\nif (a.x == 0.0 && a.y == 0.0) {\nreturn vec2(0.0, 0.0);\n}\nx = -mul_fp64(a, a);\ns = a;\nr = a;\nr = mul_fp64(r, x);\nt = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\ns = sum_fp64(s, t);\nr = mul_fp64(r, x);\nt = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\ns = sum_fp64(s, t);\nreturn s;\n}\nvec2 cos_taylor_fp64(vec2 a) {\nvec2 r, s, t, x;\nif (a.x == 0.0 && a.y == 0.0) {\nreturn vec2(1.0, 0.0);\n}\nx = -mul_fp64(a, a);\nr = x;\ns = sum_fp64(vec2(1.0, 0.0), r * 0.5);\nr = mul_fp64(r, x);\nt = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\ns = sum_fp64(s, t);\nr = mul_fp64(r, x);\nt = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\ns = sum_fp64(s, t);\nreturn s;\n}\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\nif (a.x == 0.0 && a.y == 0.0) {\nsin_t = vec2(0.0, 0.0);\ncos_t = vec2(1.0, 0.0);\n}\nsin_t = sin_taylor_fp64(a);\ncos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\nvec2 sin_fp64(vec2 a) {\nif (a.x == 0.0 && a.y == 0.0) {\nreturn vec2(0.0, 0.0);\n}\nvec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\nvec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\nvec2 t;\nfloat q = floor(r.x / PI_2_FP64.x + 0.5);\nint j = int(q);\nif (j < -2 || j > 2) {\nreturn vec2(0.0 / 0.0, 0.0 / 0.0);\n}\nt = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\nq = floor(t.x / PI_16_FP64.x + 0.5);\nint k = int(q);\nif (k == 0) {\nif (j == 0) {\nreturn sin_taylor_fp64(t);\n} else if (j == 1) {\nreturn cos_taylor_fp64(t);\n} else if (j == -1) {\nreturn -cos_taylor_fp64(t);\n} else {\nreturn -sin_taylor_fp64(t);\n}\n}\nint abs_k = int(abs(float(k)));\nif (abs_k > 4) {\nreturn vec2(0.0 / 0.0, 0.0 / 0.0);\n} else {\nt = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n}\nvec2 u = vec2(0.0, 0.0);\nvec2 v = vec2(0.0, 0.0);\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\nif (abs(float(abs_k) - 1.0) < 0.5) {\nu = COS_TABLE_0_FP64;\nv = SIN_TABLE_0_FP64;\n} else if (abs(float(abs_k) - 2.0) < 0.5) {\nu = COS_TABLE_1_FP64;\nv = SIN_TABLE_1_FP64;\n} else if (abs(float(abs_k) - 3.0) < 0.5) {\nu = COS_TABLE_2_FP64;\nv = SIN_TABLE_2_FP64;\n} else if (abs(float(abs_k) - 4.0) < 0.5) {\nu = COS_TABLE_3_FP64;\nv = SIN_TABLE_3_FP64;\n}\n#else\nif (abs_k == 1) {\nu = COS_TABLE_0_FP64;\nv = SIN_TABLE_0_FP64;\n} else if (abs_k == 2) {\nu = COS_TABLE_1_FP64;\nv = SIN_TABLE_1_FP64;\n} else if (abs_k == 3) {\nu = COS_TABLE_2_FP64;\nv = SIN_TABLE_2_FP64;\n} else if (abs_k == 4) {\nu = COS_TABLE_3_FP64;\nv = SIN_TABLE_3_FP64;\n}\n#endif\nvec2 sin_t, cos_t;\nsincos_taylor_fp64(t, sin_t, cos_t);\nvec2 result = vec2(0.0, 0.0);\nif (j == 0) {\nif (k > 0) {\nresult = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n} else {\nresult = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n}\n} else if (j == 1) {\nif (k > 0) {\nresult = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n} else {\nresult = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n}\n} else if (j == -1) {\nif (k > 0) {\nresult = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n} else {\nresult = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n}\n} else {\nif (k > 0) {\nresult = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n} else {\nresult = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n}\n}\nreturn result;\n}\nvec2 cos_fp64(vec2 a) {\nif (a.x == 0.0 && a.y == 0.0) {\nreturn vec2(1.0, 0.0);\n}\nvec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\nvec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\nvec2 t;\nfloat q = floor(r.x / PI_2_FP64.x + 0.5);\nint j = int(q);\nif (j < -2 || j > 2) {\nreturn vec2(0.0 / 0.0, 0.0 / 0.0);\n}\nt = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\nq = floor(t.x / PI_16_FP64.x + 0.5);\nint k = int(q);\nif (k == 0) {\nif (j == 0) {\nreturn cos_taylor_fp64(t);\n} else if (j == 1) {\nreturn -sin_taylor_fp64(t);\n} else if (j == -1) {\nreturn sin_taylor_fp64(t);\n} else {\nreturn -cos_taylor_fp64(t);\n}\n}\nint abs_k = int(abs(float(k)));\nif (abs_k > 4) {\nreturn vec2(0.0 / 0.0, 0.0 / 0.0);\n} else {\nt = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n}\nvec2 u = vec2(0.0, 0.0);\nvec2 v = vec2(0.0, 0.0);\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\nif (abs(float(abs_k) - 1.0) < 0.5) {\nu = COS_TABLE_0_FP64;\nv = SIN_TABLE_0_FP64;\n} else if (abs(float(abs_k) - 2.0) < 0.5) {\nu = COS_TABLE_1_FP64;\nv = SIN_TABLE_1_FP64;\n} else if (abs(float(abs_k) - 3.0) < 0.5) {\nu = COS_TABLE_2_FP64;\nv = SIN_TABLE_2_FP64;\n} else if (abs(float(abs_k) - 4.0) < 0.5) {\nu = COS_TABLE_3_FP64;\nv = SIN_TABLE_3_FP64;\n}\n#else\nif (abs_k == 1) {\nu = COS_TABLE_0_FP64;\nv = SIN_TABLE_0_FP64;\n} else if (abs_k == 2) {\nu = COS_TABLE_1_FP64;\nv = SIN_TABLE_1_FP64;\n} else if (abs_k == 3) {\nu = COS_TABLE_2_FP64;\nv = SIN_TABLE_2_FP64;\n} else if (abs_k == 4) {\nu = COS_TABLE_3_FP64;\nv = SIN_TABLE_3_FP64;\n}\n#endif\nvec2 sin_t, cos_t;\nsincos_taylor_fp64(t, sin_t, cos_t);\nvec2 result = vec2(0.0, 0.0);\nif (j == 0) {\nif (k > 0) {\nresult = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n} else {\nresult = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n}\n} else if (j == 1) {\nif (k > 0) {\nresult = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n} else {\nresult = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n}\n} else if (j == -1) {\nif (k > 0) {\nresult = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n} else {\nresult = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n}\n} else {\nif (k > 0) {\nresult = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n} else {\nresult = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n}\n}\nreturn result;\n}\nvec2 tan_fp64(vec2 a) {\nvec2 sin_a;\nvec2 cos_a;\nif (a.x == 0.0 && a.y == 0.0) {\nreturn vec2(0.0, 0.0);\n}\nvec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\nvec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\nvec2 t;\nfloat q = floor(r.x / PI_2_FP64.x + 0.5);\nint j = int(q);\nif (j < -2 || j > 2) {\nreturn vec2(0.0 / 0.0, 0.0 / 0.0);\n}\nt = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\nq = floor(t.x / PI_16_FP64.x + 0.5);\nint k = int(q);\nint abs_k = int(abs(float(k)));\nif (abs_k > 4) {\nreturn vec2(0.0 / 0.0, 0.0 / 0.0);\n} else {\nt = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n}\nvec2 u = vec2(0.0, 0.0);\nvec2 v = vec2(0.0, 0.0);\nvec2 sin_t, cos_t;\nvec2 s, c;\nsincos_taylor_fp64(t, sin_t, cos_t);\nif (k == 0) {\ns = sin_t;\nc = cos_t;\n} else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\nif (abs(float(abs_k) - 1.0) < 0.5) {\nu = COS_TABLE_0_FP64;\nv = SIN_TABLE_0_FP64;\n} else if (abs(float(abs_k) - 2.0) < 0.5) {\nu = COS_TABLE_1_FP64;\nv = SIN_TABLE_1_FP64;\n} else if (abs(float(abs_k) - 3.0) < 0.5) {\nu = COS_TABLE_2_FP64;\nv = SIN_TABLE_2_FP64;\n} else if (abs(float(abs_k) - 4.0) < 0.5) {\nu = COS_TABLE_3_FP64;\nv = SIN_TABLE_3_FP64;\n}\n#else\nif (abs_k == 1) {\nu = COS_TABLE_0_FP64;\nv = SIN_TABLE_0_FP64;\n} else if (abs_k == 2) {\nu = COS_TABLE_1_FP64;\nv = SIN_TABLE_1_FP64;\n} else if (abs_k == 3) {\nu = COS_TABLE_2_FP64;\nv = SIN_TABLE_2_FP64;\n} else if (abs_k == 4) {\nu = COS_TABLE_3_FP64;\nv = SIN_TABLE_3_FP64;\n}\n#endif\nif (k > 0) {\ns = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\nc = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n} else {\ns = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\nc = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n}\n}\nif (j == 0) {\nsin_a = s;\ncos_a = c;\n} else if (j == 1) {\nsin_a = c;\ncos_a = -s;\n} else if (j == -1) {\nsin_a = -c;\ncos_a = s;\n} else {\nsin_a = -s;\ncos_a = -c;\n}\nreturn div_fp64(sin_a, cos_a);\n}\nvec2 radians_fp64(vec2 degree) {\nreturn mul_fp64(degree, PI_180_FP64);\n}\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\nvec2 range = sub_fp64(b, a);\nreturn sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\nout_val[0] = sum_fp64(a[0], b[0]);\nout_val[1] = sum_fp64(a[1], b[1]);\n}\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\nout_val[0] = sub_fp64(a[0], b[0]);\nout_val[1] = sub_fp64(a[1], b[1]);\n}\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\nout_val[0] = mul_fp64(a[0], b[0]);\nout_val[1] = mul_fp64(a[1], b[1]);\n}\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\nout_val[0] = div_fp64(a[0], b[0]);\nout_val[1] = div_fp64(a[1], b[1]);\n}\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\nvec2 range[2];\nvec2_sub_fp64(y, x, range);\nvec2 portion[2];\nportion[0] = range[0] * a;\nportion[1] = range[1] * a;\nvec2_sum_fp64(x, portion, out_val);\n}\nvec2 vec2_length_fp64(vec2 x[2]) {\nreturn sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\nvec2 length = vec2_length_fp64(x);\nvec2 length_vec2[2];\nlength_vec2[0] = length;\nlength_vec2[1] = length;\nvec2_div_fp64(x, length_vec2, out_val);\n}\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\nvec2 diff[2];\nvec2_sub_fp64(x, y, diff);\nreturn vec2_length_fp64(diff);\n}\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\nvec2 v[2];\nv[0] = mul_fp64(a[0], b[0]);\nv[1] = mul_fp64(a[1], b[1]);\nreturn sum_fp64(v[0], v[1]);\n}\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\nfor (int i = 0; i < 3; i++) {\nout_val[i] = sum_fp64(a[i], b[i]);\n}\n}\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\nfor (int i = 0; i < 3; i++) {\nout_val[i] = sum_fp64(a[i], b[i]);\n}\n}\nvec2 vec3_length_fp64(vec2 x[3]) {\nreturn sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\nmul_fp64(x[2], x[2])));\n}\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\nvec2 diff[3];\nvec3_sub_fp64(x, y, diff);\nreturn vec3_length_fp64(diff);\n}\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\nout_val[0].x = a[0];\nout_val[0].y = 0.0;\nout_val[1].x = a[1];\nout_val[1].y = 0.0;\nout_val[2].x = a[2];\nout_val[2].y = 0.0;\nout_val[3].x = a[3];\nout_val[3].y = 0.0;\n}\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\nout_val[0] = mul_fp64(a[0], b);\nout_val[1] = mul_fp64(a[1], b);\nout_val[2] = mul_fp64(a[2], b);\nout_val[3] = mul_fp64(a[3], b);\n}\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\nfor (int i = 0; i < 4; i++) {\nout_val[i] = sum_fp64(a[i], b[i]);\n}\n}\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\nvec2 v[4];\nv[0] = mul_fp64(a[0], b[0]);\nv[1] = mul_fp64(a[1], b[1]);\nv[2] = mul_fp64(a[2], b[2]);\nv[3] = mul_fp64(a[3], b[3]);\nout_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\nvec2 tmp[4];\nfor (int i = 0; i < 4; i++)\n{\nfor (int j = 0; j < 4; j++)\n{\ntmp[j] = b[j + i * 4];\n}\nvec4_dot_fp64(a, tmp, out_val[i]);\n}\n}\n",dependencies:[ho],fp64ify:oo,fp64LowPart:ao,fp64ifyMatrix4:lo},fo=1/Math.PI*180,po=1/180*Math.PI;globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};var go=globalThis.mathgl.config;function mo(e,{precision:t=go.precision}={}){return e=function(e){return Math.round(e/go.EPSILON)*go.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function _o(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function vo(e){return bo(e)}function yo(e){return Ao(e)}function bo(e,t){return To(e,(e=>e*po),t)}function Ao(e,t){return To(e,(e=>e*fo),t)}function Eo(e,t,i){return To(e,(e=>Math.max(t,Math.min(i,e))))}function wo(e,t,i){return _o(e)?e.map(((e,r)=>wo(e,t[r],i))):i*t+(1-i)*e}function xo(e,t,i){let r=go.EPSILON;i&&(go.EPSILON=i);try{if(e===t)return!0;if(_o(e)&&_o(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!xo(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=go.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{go.EPSILON=r}}function To(e,t,i){if(_o(e)){let r=e;i=i||function(e){return e.clone?e.clone():new Array(e.length)}(r);for(let n=0;n<i.length&&n<r.length;++n){let r="number"==typeof e?e:e[n];i[n]=t(r,n,i)}return i}return t(e)}var Co=class extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:_o(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(go)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+mo(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!xo(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(void 0===i)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){let n=e[r],s="number"==typeof t?t:t[r];this[r]=n+i*(s-n)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(go.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}};function So(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Po(e,t,i=""){if(go.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function Mo(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Ro=class extends Co{get x(){return this[0]}set x(e){this[0]=So(e)}get y(){return this[1]}set y(e){this[1]=So(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){let r=this[i]-e[i];t+=r*r}return So(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return So(t)}normalize(){let e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Mo(e>=0&&e<this.ELEMENTS,"index is out of range"),So(this[e])}setComponent(e,t){return Mo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}},Io={};l(Io,{add:()=>Go,angle:()=>fa,ceil:()=>Ho,clone:()=>No,copy:()=>ko,create:()=>Fo,cross:()=>sa,dist:()=>Ea,distance:()=>Yo,div:()=>Aa,divide:()=>jo,dot:()=>na,equals:()=>_a,exactEquals:()=>ma,floor:()=>Wo,forEach:()=>Ta,fromValues:()=>Do,inverse:()=>ia,len:()=>va,length:()=>Qo,lerp:()=>oa,max:()=>qo,min:()=>Xo,mul:()=>ba,multiply:()=>Vo,negate:()=>ta,normalize:()=>ra,random:()=>aa,rotate:()=>da,round:()=>Ko,scale:()=>$o,scaleAndAdd:()=>Jo,set:()=>Uo,sqrDist:()=>wa,sqrLen:()=>xa,squaredDistance:()=>Zo,squaredLength:()=>ea,str:()=>ga,sub:()=>ya,subtract:()=>zo,transformMat2:()=>la,transformMat2d:()=>ua,transformMat3:()=>ha,transformMat4:()=>ca,zero:()=>pa});var Bo=typeof Float32Array<"u"?Float32Array:Array,Lo=Math.random;function Oo(e){return e>=0?Math.round(e):e%.5==0?Math.floor(e):Math.round(e)}function Fo(){let e=new Bo(2);return Bo!=Float32Array&&(e[0]=0,e[1]=0),e}function No(e){let t=new Bo(2);return t[0]=e[0],t[1]=e[1],t}function Do(e,t){let i=new Bo(2);return i[0]=e,i[1]=t,i}function ko(e,t){return e[0]=t[0],e[1]=t[1],e}function Uo(e,t,i){return e[0]=t,e[1]=i,e}function Go(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function zo(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function Vo(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function jo(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function Ho(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Wo(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Xo(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function qo(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function Ko(e,t){return e[0]=Oo(t[0]),e[1]=Oo(t[1]),e}function $o(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function Jo(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function Yo(e,t){let i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function Zo(e,t){let i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function Qo(e){let t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function ea(e){let t=e[0],i=e[1];return t*t+i*i}function ta(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ia(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function ra(e,t){let i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function na(e,t){return e[0]*t[0]+e[1]*t[1]}function sa(e,t,i){let r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function oa(e,t,i,r){let n=t[0],s=t[1];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e}function aa(e,t){t=void 0===t?1:t;let i=2*Lo()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function la(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e}function ua(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e}function ha(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e}function ca(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e}function da(e,t,i,r){let n=t[0]-i[0],s=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=n*a-s*o+i[0],e[1]=n*o+s*a+i[1],e}function fa(e,t){let i=e[0],r=e[1],n=t[0],s=t[1],o=Math.sqrt((i*i+r*r)*(n*n+s*s)),a=o&&(i*n+r*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function pa(e){return e[0]=0,e[1]=0,e}function ga(e){return`vec2(${e[0]}, ${e[1]})`}function ma(e,t){return e[0]===t[0]&&e[1]===t[1]}function _a(e,t){let i=e[0],r=e[1],n=t[0],s=t[1];return Math.abs(i-n)<=1e-6*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))}var va=Qo,ya=zo,ba=Vo,Aa=jo,Ea=Yo,wa=Zo,xa=ea,Ta=function(){let e=Fo();return function(t,i,r,n,s,o){let a,l;for(i||(i=2),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,a=r;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],s(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function Ca(e,t,i){let r=t[0],n=t[1],s=i[3]*r+i[7]*n||1;return e[0]=(i[0]*r+i[4]*n)/s,e[1]=(i[1]*r+i[5]*n)/s,e}function Sa(e,t,i){let r=t[0],n=t[1],s=t[2],o=i[3]*r+i[7]*n+i[11]*s||1;return e[0]=(i[0]*r+i[4]*n+i[8]*s)/o,e[1]=(i[1]*r+i[5]*n+i[9]*s)/o,e[2]=(i[2]*r+i[6]*n+i[10]*s)/o,e}function Pa(e,t,i){let r=t[0],n=t[1],s=t[2];return e[0]=i[0]*r+i[3]*n+i[6]*s,e[1]=i[1]*r+i[4]*n+i[7]*s,e[2]=i[2]*r+i[5]*n+i[8]*s,e[3]=t[3],e}var Ma=class extends Ro{constructor(e=0,t=0){super(2),_o(e)&&1===arguments.length?this.copy(e):(go.debug&&(So(e),So(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return go.debug&&(So(e.x),So(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ca(this,this,e),this.check()}transformAsVector(e){return Ca(this,this,e),this.check()}transformByMatrix3(e){return ha(this,this,e),this.check()}transformByMatrix2x3(e){return ua(this,this,e),this.check()}transformByMatrix2(e){return la(this,this,e),this.check()}},Ra={};function Ia(){let e=new Bo(3);return Bo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ba(e){let t=new Bo(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function La(e){let t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function Oa(e,t,i){let r=new Bo(3);return r[0]=e,r[1]=t,r[2]=i,r}function Fa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Na(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function Da(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function ka(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Ua(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Ga(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function za(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Va(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ja(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function Ha(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function Wa(e,t){return e[0]=Oo(t[0]),e[1]=Oo(t[1]),e[2]=Oo(t[2]),e}function Xa(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function qa(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Ka(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}function $a(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function Ja(e){let t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function Ya(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Za(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Qa(e,t){let i=t[0],r=t[1],n=t[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function el(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function tl(e,t,i){let r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],l=i[2];return e[0]=n*l-s*a,e[1]=s*o-r*l,e[2]=r*a-n*o,e}function il(e,t,i,r){let n=t[0],s=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e}function rl(e,t,i,r){let n=Math.acos(Math.min(Math.max(el(t,i),-1),1)),s=Math.sin(n),o=Math.sin((1-r)*n)/s,a=Math.sin(r*n)/s;return e[0]=o*t[0]+a*i[0],e[1]=o*t[1]+a*i[1],e[2]=o*t[2]+a*i[2],e}function nl(e,t,i,r,n,s){let o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,u=o*(s-1),h=o*(3-2*s);return e[0]=t[0]*a+i[0]*l+r[0]*u+n[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*u+n[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*u+n[2]*h,e}function sl(e,t,i,r,n,s){let o=1-s,a=o*o,l=s*s,u=a*o,h=3*s*a,c=3*l*o,d=l*s;return e[0]=t[0]*u+i[0]*h+r[0]*c+n[0]*d,e[1]=t[1]*u+i[1]*h+r[1]*c+n[1]*d,e[2]=t[2]*u+i[2]*h+r[2]*c+n[2]*d,e}function ol(e,t){t=void 0===t?1:t;let i=2*Lo()*Math.PI,r=2*Lo()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e}function al(e,t,i){let r=t[0],n=t[1],s=t[2],o=i[3]*r+i[7]*n+i[11]*s+i[15];return o=o||1,e[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/o,e[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/o,e[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/o,e}function ll(e,t,i){let r=t[0],n=t[1],s=t[2];return e[0]=r*i[0]+n*i[3]+s*i[6],e[1]=r*i[1]+n*i[4]+s*i[7],e[2]=r*i[2]+n*i[5]+s*i[8],e}function ul(e,t,i){let r=i[0],n=i[1],s=i[2],o=i[3],a=t[0],l=t[1],u=t[2],h=n*u-s*l,c=s*a-r*u,d=r*l-n*a,f=n*d-s*c,p=s*h-r*d,g=r*c-n*h,m=2*o;return h*=m,c*=m,d*=m,f*=2,p*=2,g*=2,e[0]=a+h+f,e[1]=l+c+p,e[2]=u+d+g,e}function hl(e,t,i,r){let n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function cl(e,t,i,r){let n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function dl(e,t,i,r){let n=[],s=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function fl(e,t){let i=e[0],r=e[1],n=e[2],s=t[0],o=t[1],a=t[2],l=Math.sqrt((i*i+r*r+n*n)*(s*s+o*o+a*a)),u=l&&el(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))}function pl(e){return e[0]=0,e[1]=0,e[2]=0,e}function gl(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function ml(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function _l(e,t){let i=e[0],r=e[1],n=e[2],s=t[0],o=t[1],a=t[2];return Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))}l(Ra,{add:()=>Da,angle:()=>fl,bezier:()=>sl,ceil:()=>za,clone:()=>Ba,copy:()=>Fa,create:()=>Ia,cross:()=>tl,dist:()=>xl,distance:()=>Ka,div:()=>wl,divide:()=>Ga,dot:()=>el,equals:()=>_l,exactEquals:()=>ml,floor:()=>Va,forEach:()=>Pl,fromValues:()=>Oa,hermite:()=>nl,inverse:()=>Za,len:()=>Cl,length:()=>La,lerp:()=>il,max:()=>Ha,min:()=>ja,mul:()=>El,multiply:()=>Ua,negate:()=>Ya,normalize:()=>Qa,random:()=>ol,rotateX:()=>hl,rotateY:()=>cl,rotateZ:()=>dl,round:()=>Wa,scale:()=>Xa,scaleAndAdd:()=>qa,set:()=>Na,slerp:()=>rl,sqrDist:()=>Tl,sqrLen:()=>Sl,squaredDistance:()=>$a,squaredLength:()=>Ja,str:()=>gl,sub:()=>Al,subtract:()=>ka,transformMat3:()=>ll,transformMat4:()=>al,transformQuat:()=>ul,zero:()=>pl});var vl,yl,bl,Al=ka,El=Ua,wl=Ga,xl=Ka,Tl=$a,Cl=La,Sl=Ja,Pl=function(){let e=Ia();return function(t,i,r,n,s,o){let a,l;for(i||(i=3),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,a=r;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}(),Ml=[0,0,0],Rl=class extends Ro{static get ZERO(){return vl||(vl=new Rl(0,0,0),Object.freeze(vl)),vl}constructor(e=0,t=0,i=0){super(-0,-0,-0),1===arguments.length&&_o(e)?this.copy(e):(go.debug&&(So(e),So(t),So(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return go.debug&&(So(e.x),So(e.y),So(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=So(e)}angle(e){return fl(this,e)}cross(e){return tl(this,this,e),this.check()}rotateX({radians:e,origin:t=Ml}){return hl(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Ml}){return cl(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Ml}){return dl(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return al(this,this,e),this.check()}transformAsVector(e){return Sa(this,this,e),this.check()}transformByMatrix3(e){return ll(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,i){let r=t[0],n=t[1];e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return ul(this,this,e),this.check()}},Il=class extends Ro{static get ZERO(){return yl||(yl=new Il(0,0,0,0),Object.freeze(yl)),yl}constructor(e=0,t=0,i=0,r=0){super(-0,-0,-0,-0),_o(e)&&1===arguments.length?this.copy(e):(go.debug&&(So(e),So(t),So(i),So(r)),this[0]=e,this[1]=t,this[2]=i,this[3]=r)}set(e,t,i,r){return this[0]=e,this[1]=t,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return go.debug&&(So(e.x),So(e.y),So(e.z),So(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=So(e)}get w(){return this[3]}set w(e){this[3]=So(e)}transform(e){return al(this,this,e),this.check()}transformByMatrix3(e){return Pa(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,i){let r=t[0],n=t[1];e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e[2]=t[2],e[3]=t[3]}(this,this,e),this.check()}transformByQuaternion(e){return ul(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}},Bl=class extends Co{toString(){let e="[";if(go.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=So(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[i+e];return t}setColumn(e,t){let i=e*this.RANK;for(let e=0;e<this.RANK;++e)this[i+e]=t[e];return this}};function Ll(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=i[0],f=i[1],p=i[2],g=i[3],m=i[4],_=i[5],v=i[6],y=i[7],b=i[8];return e[0]=d*r+f*o+p*u,e[1]=d*n+f*a+p*h,e[2]=d*s+f*l+p*c,e[3]=g*r+m*o+_*u,e[4]=g*n+m*a+_*h,e[5]=g*s+m*l+_*c,e[6]=v*r+y*o+b*u,e[7]=v*n+y*a+b*h,e[8]=v*s+y*l+b*c,e}function Ol(e,t,i){let r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(bl||(bl={}));var Fl,Nl=Object.freeze([1,0,0,0,1,0,0,0,1]),Dl=class extends Bl{static get IDENTITY(){return kl||(kl=new Dl,Object.freeze(kl)),kl}static get ZERO(){return Fl||(Fl=new Dl([0,0,0,0,0,0,0,0,0]),Object.freeze(Fl)),Fl}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return bl}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Nl)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,l=n+n,u=i*o,h=r*o,c=r*a,d=n*o,f=n*a,p=n*l,g=s*o,m=s*a,_=s*l;e[0]=1-c-p,e[3]=h-_,e[6]=d+m,e[1]=h+_,e[4]=1-u-p,e[7]=f-g,e[2]=d-m,e[5]=f+g,e[8]=1-u-c}(this,e),this.check()}set(e,t,i,r,n,s,o,a,l){return this[0]=e,this[1]=t,this[2]=i,this[3]=r,this[4]=n,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this.check()}setRowMajor(e,t,i,r,n,s,o,a,l){return this[0]=e,this[1]=r,this[2]=o,this[3]=t,this[4]=n,this[5]=a,this[6]=i,this[7]=s,this[8]=l,this.check()}determinant(){return function(e){let t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],u=e[8];return t*(u*s-o*l)+i*(-u*n+o*a)+r*(l*n-s*a)}(this)}transpose(){return function(e,t){if(e===t){let i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return function(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],c=h*o-a*u,d=-h*s+a*l,f=u*s-o*l,p=i*c+r*d+n*f;p&&(p=1/p,e[0]=c*p,e[1]=(-h*r+n*u)*p,e[2]=(a*r-n*o)*p,e[3]=d*p,e[4]=(h*i-n*l)*p,e[5]=(-a*i+n*s)*p,e[6]=f*p,e[7]=(-u*i+r*l)*p,e[8]=(o*i-r*s)*p)}(this,this),this.check()}multiplyLeft(e){return Ll(this,e,this),this.check()}multiplyRight(e){return Ll(this,this,e),this.check()}rotate(e){return function(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=Math.sin(i),f=Math.cos(i);e[0]=f*r+d*o,e[1]=f*n+d*a,e[2]=f*s+d*l,e[3]=f*o-d*r,e[4]=f*a-d*n,e[5]=f*l-d*s,e[6]=u,e[7]=h,e[8]=c}(this,this,e),this.check()}scale(e){return Array.isArray(e)?Ol(this,this,e):Ol(this,this,[e,e]),this.check()}translate(e){return function(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=i[0],f=i[1];e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*r+f*o+u,e[7]=d*n+f*a+h,e[8]=d*s+f*l+c}(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=ha(t||[-0,-0],e,this);break;case 3:i=ll(t||[-0,-0,-0],e,this);break;case 4:i=Pa(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Po(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}},kl=null,Ul={};function Gl(){let e=new Bo(16);return Bo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function zl(e){let t=new Bo(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Vl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function jl(e,t,i,r,n,s,o,a,l,u,h,c,d,f,p,g){let m=new Bo(16);return m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=s,m[6]=o,m[7]=a,m[8]=l,m[9]=u,m[10]=h,m[11]=c,m[12]=d,m[13]=f,m[14]=p,m[15]=g,m}function Hl(e,t,i,r,n,s,o,a,l,u,h,c,d,f,p,g,m){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=u,e[9]=h,e[10]=c,e[11]=d,e[12]=f,e[13]=p,e[14]=g,e[15]=m,e}function Wl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xl(e,t){if(e===t){let i=t[1],r=t[2],n=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ql(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],c=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15],v=i*a-r*o,y=i*l-n*o,b=i*u-s*o,A=r*l-n*a,E=r*u-s*a,w=n*u-s*l,x=h*g-c*p,T=h*m-d*p,C=h*_-f*p,S=c*m-d*g,P=c*_-f*g,M=d*_-f*m,R=v*M-y*P+b*S+A*C-E*T+w*x;return R?(R=1/R,e[0]=(a*M-l*P+u*S)*R,e[1]=(n*P-r*M-s*S)*R,e[2]=(g*w-m*E+_*A)*R,e[3]=(d*E-c*w-f*A)*R,e[4]=(l*C-o*M-u*T)*R,e[5]=(i*M-n*C+s*T)*R,e[6]=(m*b-p*w-_*y)*R,e[7]=(h*w-d*b+f*y)*R,e[8]=(o*P-a*C+u*x)*R,e[9]=(r*C-i*P-s*x)*R,e[10]=(p*E-g*b+_*v)*R,e[11]=(c*b-h*E-f*v)*R,e[12]=(a*T-o*S-l*x)*R,e[13]=(i*S-r*T+n*x)*R,e[14]=(g*y-p*A-m*v)*R,e[15]=(h*A-c*y+d*v)*R,e):null}function Kl(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],c=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15],v=i*a-r*o,y=i*l-n*o,b=i*u-s*o,A=r*l-n*a,E=r*u-s*a,w=n*u-s*l,x=h*g-c*p,T=h*m-d*p,C=h*_-f*p,S=c*m-d*g,P=c*_-f*g,M=d*_-f*m;return e[0]=a*M-l*P+u*S,e[1]=n*P-r*M-s*S,e[2]=g*w-m*E+_*A,e[3]=d*E-c*w-f*A,e[4]=l*C-o*M-u*T,e[5]=i*M-n*C+s*T,e[6]=m*b-p*w-_*y,e[7]=h*w-d*b+f*y,e[8]=o*P-a*C+u*x,e[9]=r*C-i*P-s*x,e[10]=p*E-g*b+_*v,e[11]=c*b-h*E-f*v,e[12]=a*T-o*S-l*x,e[13]=i*S-r*T+n*x,e[14]=g*y-p*A-m*v,e[15]=h*A-c*y+d*v,e}function $l(e){let t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],u=e[8],h=e[9],c=e[10],d=e[11],f=e[12],p=e[13],g=e[14],m=t*o-i*s,_=t*a-r*s,v=i*a-r*o,y=u*p-h*f,b=u*g-c*f,A=h*g-c*p;return l*(t*A-i*b+r*y)-n*(s*A-o*b+a*y)+e[15]*(u*v-h*_+c*m)-d*(f*v-p*_+g*m)}function Jl(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],v=t[15],y=i[0],b=i[1],A=i[2],E=i[3];return e[0]=y*r+b*a+A*c+E*g,e[1]=y*n+b*l+A*d+E*m,e[2]=y*s+b*u+A*f+E*_,e[3]=y*o+b*h+A*p+E*v,y=i[4],b=i[5],A=i[6],E=i[7],e[4]=y*r+b*a+A*c+E*g,e[5]=y*n+b*l+A*d+E*m,e[6]=y*s+b*u+A*f+E*_,e[7]=y*o+b*h+A*p+E*v,y=i[8],b=i[9],A=i[10],E=i[11],e[8]=y*r+b*a+A*c+E*g,e[9]=y*n+b*l+A*d+E*m,e[10]=y*s+b*u+A*f+E*_,e[11]=y*o+b*h+A*p+E*v,y=i[12],b=i[13],A=i[14],E=i[15],e[12]=y*r+b*a+A*c+E*g,e[13]=y*n+b*l+A*d+E*m,e[14]=y*s+b*u+A*f+E*_,e[15]=y*o+b*h+A*p+E*v,e}function Yl(e,t,i){let r,n,s,o,a,l,u,h,c,d,f,p,g=i[0],m=i[1],_=i[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*_+t[12],e[13]=t[1]*g+t[5]*m+t[9]*_+t[13],e[14]=t[2]*g+t[6]*m+t[10]*_+t[14],e[15]=t[3]*g+t[7]*m+t[11]*_+t[15]):(r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],f=t[10],p=t[11],e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=u,e[7]=h,e[8]=c,e[9]=d,e[10]=f,e[11]=p,e[12]=r*g+a*m+c*_+t[12],e[13]=n*g+l*m+d*_+t[13],e[14]=s*g+u*m+f*_+t[14],e[15]=o*g+h*m+p*_+t[15]),e}function Zl(e,t,i){let r=i[0],n=i[1],s=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ql(e,t,i,r){let n,s,o,a,l,u,h,c,d,f,p,g,m,_,v,y,b,A,E,w,x,T,C,S,P=r[0],M=r[1],R=r[2],I=Math.sqrt(P*P+M*M+R*R);return I<1e-6?null:(I=1/I,P*=I,M*=I,R*=I,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],u=t[2],h=t[3],c=t[4],d=t[5],f=t[6],p=t[7],g=t[8],m=t[9],_=t[10],v=t[11],y=P*P*o+n,b=M*P*o+R*s,A=R*P*o-M*s,E=P*M*o-R*s,w=M*M*o+n,x=R*M*o+P*s,T=P*R*o+M*s,C=M*R*o-P*s,S=R*R*o+n,e[0]=a*y+c*b+g*A,e[1]=l*y+d*b+m*A,e[2]=u*y+f*b+_*A,e[3]=h*y+p*b+v*A,e[4]=a*E+c*w+g*x,e[5]=l*E+d*w+m*x,e[6]=u*E+f*w+_*x,e[7]=h*E+p*w+v*x,e[8]=a*T+c*C+g*S,e[9]=l*T+d*C+m*S,e[10]=u*T+f*C+_*S,e[11]=h*T+p*C+v*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function eu(e,t,i){let r=Math.sin(i),n=Math.cos(i),s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=t[9],c=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+u*r,e[5]=o*n+h*r,e[6]=a*n+c*r,e[7]=l*n+d*r,e[8]=u*n-s*r,e[9]=h*n-o*r,e[10]=c*n-a*r,e[11]=d*n-l*r,e}function tu(e,t,i){let r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],a=t[2],l=t[3],u=t[8],h=t[9],c=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-u*r,e[1]=o*n-h*r,e[2]=a*n-c*r,e[3]=l*n-d*r,e[8]=s*r+u*n,e[9]=o*r+h*n,e[10]=a*r+c*n,e[11]=l*r+d*n,e}function iu(e,t,i){let r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],a=t[2],l=t[3],u=t[4],h=t[5],c=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+u*r,e[1]=o*n+h*r,e[2]=a*n+c*r,e[3]=l*n+d*r,e[4]=u*n-s*r,e[5]=h*n-o*r,e[6]=c*n-a*r,e[7]=d*n-l*r,e}function ru(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function nu(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function su(e,t,i){let r,n,s,o=i[0],a=i[1],l=i[2],u=Math.sqrt(o*o+a*a+l*l);return u<1e-6?null:(u=1/u,o*=u,a*=u,l*=u,n=Math.sin(t),r=Math.cos(t),s=1-r,e[0]=o*o*s+r,e[1]=a*o*s+l*n,e[2]=l*o*s-a*n,e[3]=0,e[4]=o*a*s-l*n,e[5]=a*a*s+r,e[6]=l*a*s+o*n,e[7]=0,e[8]=o*l*s+a*n,e[9]=a*l*s-o*n,e[10]=l*l*s+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ou(e,t){let i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function au(e,t){let i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lu(e,t){let i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function uu(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3],a=r+r,l=n+n,u=s+s,h=r*a,c=r*l,d=r*u,f=n*l,p=n*u,g=s*u,m=o*a,_=o*l,v=o*u;return e[0]=1-(f+g),e[1]=c+v,e[2]=d-_,e[3]=0,e[4]=c-v,e[5]=1-(h+g),e[6]=p+m,e[7]=0,e[8]=d+_,e[9]=p-m,e[10]=1-(h+f),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function hu(e,t){let i=new Bo(3),r=-t[0],n=-t[1],s=-t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=r*r+n*n+s*s+o*o;return c>0?(i[0]=2*(a*o+h*r+l*s-u*n)/c,i[1]=2*(l*o+h*n+u*r-a*s)/c,i[2]=2*(u*o+h*s+a*n-l*r)/c):(i[0]=2*(a*o+h*r+l*s-u*n),i[1]=2*(l*o+h*n+u*r-a*s),i[2]=2*(u*o+h*s+a*n-l*r)),uu(e,t,i),e}function cu(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function du(e,t){let i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],u=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+n*n),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+u*u+h*h),e}function fu(e,t){let i=new Bo(3);du(i,t);let r=1/i[0],n=1/i[1],s=1/i[2],o=t[0]*r,a=t[1]*n,l=t[2]*s,u=t[4]*r,h=t[5]*n,c=t[6]*s,d=t[8]*r,f=t[9]*n,p=t[10]*s,g=o+h+p,m=0;return g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(c-f)/m,e[1]=(d-l)/m,e[2]=(a-u)/m):o>h&&o>p?(m=2*Math.sqrt(1+o-h-p),e[3]=(c-f)/m,e[0]=.25*m,e[1]=(a+u)/m,e[2]=(d+l)/m):h>p?(m=2*Math.sqrt(1+h-o-p),e[3]=(d-l)/m,e[0]=(a+u)/m,e[1]=.25*m,e[2]=(c+f)/m):(m=2*Math.sqrt(1+p-o-h),e[3]=(a-u)/m,e[0]=(d+l)/m,e[1]=(c+f)/m,e[2]=.25*m),e}function pu(e,t,i,r){t[0]=r[12],t[1]=r[13],t[2]=r[14];let n=r[0],s=r[1],o=r[2],a=r[4],l=r[5],u=r[6],h=r[8],c=r[9],d=r[10];i[0]=Math.sqrt(n*n+s*s+o*o),i[1]=Math.sqrt(a*a+l*l+u*u),i[2]=Math.sqrt(h*h+c*c+d*d);let f=1/i[0],p=1/i[1],g=1/i[2],m=n*f,_=s*p,v=o*g,y=a*f,b=l*p,A=u*g,E=h*f,w=c*p,x=d*g,T=m+b+x,C=0;return T>0?(C=2*Math.sqrt(T+1),e[3]=.25*C,e[0]=(A-w)/C,e[1]=(E-v)/C,e[2]=(_-y)/C):m>b&&m>x?(C=2*Math.sqrt(1+m-b-x),e[3]=(A-w)/C,e[0]=.25*C,e[1]=(_+y)/C,e[2]=(E+v)/C):b>x?(C=2*Math.sqrt(1+b-m-x),e[3]=(E-v)/C,e[0]=(_+y)/C,e[1]=.25*C,e[2]=(A+w)/C):(C=2*Math.sqrt(1+x-m-b),e[3]=(_-y)/C,e[0]=(E+v)/C,e[1]=(A+w)/C,e[2]=.25*C),e}function gu(e,t,i,r){let n=t[0],s=t[1],o=t[2],a=t[3],l=n+n,u=s+s,h=o+o,c=n*l,d=n*u,f=n*h,p=s*u,g=s*h,m=o*h,_=a*l,v=a*u,y=a*h,b=r[0],A=r[1],E=r[2];return e[0]=(1-(p+m))*b,e[1]=(d+y)*b,e[2]=(f-v)*b,e[3]=0,e[4]=(d-y)*A,e[5]=(1-(c+m))*A,e[6]=(g+_)*A,e[7]=0,e[8]=(f+v)*E,e[9]=(g-_)*E,e[10]=(1-(c+p))*E,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function mu(e,t,i,r,n){let s=t[0],o=t[1],a=t[2],l=t[3],u=s+s,h=o+o,c=a+a,d=s*u,f=s*h,p=s*c,g=o*h,m=o*c,_=a*c,v=l*u,y=l*h,b=l*c,A=r[0],E=r[1],w=r[2],x=n[0],T=n[1],C=n[2],S=(1-(g+_))*A,P=(f+b)*A,M=(p-y)*A,R=(f-b)*E,I=(1-(d+_))*E,B=(m+v)*E,L=(p+y)*w,O=(m-v)*w,F=(1-(d+g))*w;return e[0]=S,e[1]=P,e[2]=M,e[3]=0,e[4]=R,e[5]=I,e[6]=B,e[7]=0,e[8]=L,e[9]=O,e[10]=F,e[11]=0,e[12]=i[0]+x-(S*x+R*T+L*C),e[13]=i[1]+T-(P*x+I*T+O*C),e[14]=i[2]+C-(M*x+B*T+F*C),e[15]=1,e}function _u(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,l=n+n,u=i*o,h=r*o,c=r*a,d=n*o,f=n*a,p=n*l,g=s*o,m=s*a,_=s*l;return e[0]=1-c-p,e[1]=h+_,e[2]=d-m,e[3]=0,e[4]=h-_,e[5]=1-u-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-u-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vu(e,t,i,r,n,s,o){let a=1/(i-t),l=1/(n-r),u=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(n+r)*l,e[10]=(o+s)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*u,e[15]=0,e}function yu(e,t,i,r,n){let s=1/Math.tan(t/2);if(e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(r-n);e[10]=(n+r)*t,e[14]=2*n*r*t}else e[10]=-1,e[14]=-2*r;return e}l(Ul,{add:()=>Ru,adjoint:()=>Kl,clone:()=>zl,copy:()=>Vl,create:()=>Gl,decompose:()=>pu,determinant:()=>$l,equals:()=>Fu,exactEquals:()=>Ou,frob:()=>Mu,fromQuat:()=>_u,fromQuat2:()=>hu,fromRotation:()=>su,fromRotationTranslation:()=>uu,fromRotationTranslationScale:()=>gu,fromRotationTranslationScaleOrigin:()=>mu,fromScaling:()=>nu,fromTranslation:()=>ru,fromValues:()=>jl,fromXRotation:()=>ou,fromYRotation:()=>au,fromZRotation:()=>lu,frustum:()=>vu,getRotation:()=>fu,getScaling:()=>du,getTranslation:()=>cu,identity:()=>Wl,invert:()=>ql,lookAt:()=>Cu,mul:()=>Nu,multiply:()=>Jl,multiplyScalar:()=>Bu,multiplyScalarAndAdd:()=>Lu,ortho:()=>xu,orthoNO:()=>wu,orthoZO:()=>Tu,perspective:()=>bu,perspectiveFromFieldOfView:()=>Eu,perspectiveNO:()=>yu,perspectiveZO:()=>Au,rotate:()=>Ql,rotateX:()=>eu,rotateY:()=>tu,rotateZ:()=>iu,scale:()=>Zl,set:()=>Hl,str:()=>Pu,sub:()=>Du,subtract:()=>Iu,targetTo:()=>Su,translate:()=>Yl,transpose:()=>Xl});var bu=yu;function Au(e,t,i,r,n){let s=1/Math.tan(t/2);if(e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(r-n);e[10]=n*t,e[14]=n*r*t}else e[10]=-1,e[14]=-r;return e}function Eu(e,t,i,r){let n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),u=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(n-s)*u*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function wu(e,t,i,r,n,s,o){let a=1/(t-i),l=1/(r-n),u=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=(o+s)*u,e[15]=1,e}var xu=wu;function Tu(e,t,i,r,n,s,o){let a=1/(t-i),l=1/(r-n),u=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=s*u,e[15]=1,e}function Cu(e,t,i,r){let n,s,o,a,l,u,h,c,d,f,p=t[0],g=t[1],m=t[2],_=r[0],v=r[1],y=r[2],b=i[0],A=i[1],E=i[2];return Math.abs(p-b)<1e-6&&Math.abs(g-A)<1e-6&&Math.abs(m-E)<1e-6?Wl(e):(c=p-b,d=g-A,f=m-E,n=1/Math.sqrt(c*c+d*d+f*f),c*=n,d*=n,f*=n,s=v*f-y*d,o=y*c-_*f,a=_*d-v*c,n=Math.sqrt(s*s+o*o+a*a),n?(n=1/n,s*=n,o*=n,a*=n):(s=0,o=0,a=0),l=d*a-f*o,u=f*s-c*a,h=c*o-d*s,n=Math.sqrt(l*l+u*u+h*h),n?(n=1/n,l*=n,u*=n,h*=n):(l=0,u=0,h=0),e[0]=s,e[1]=l,e[2]=c,e[3]=0,e[4]=o,e[5]=u,e[6]=d,e[7]=0,e[8]=a,e[9]=h,e[10]=f,e[11]=0,e[12]=-(s*p+o*g+a*m),e[13]=-(l*p+u*g+h*m),e[14]=-(c*p+d*g+f*m),e[15]=1,e)}function Su(e,t,i,r){let n=t[0],s=t[1],o=t[2],a=r[0],l=r[1],u=r[2],h=n-i[0],c=s-i[1],d=o-i[2],f=h*h+c*c+d*d;f>0&&(f=1/Math.sqrt(f),h*=f,c*=f,d*=f);let p=l*d-u*c,g=u*h-a*d,m=a*c-l*h;return f=p*p+g*g+m*m,f>0&&(f=1/Math.sqrt(f),p*=f,g*=f,m*=f),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=c*m-d*g,e[5]=d*p-h*m,e[6]=h*g-c*p,e[7]=0,e[8]=h,e[9]=c,e[10]=d,e[11]=0,e[12]=n,e[13]=s,e[14]=o,e[15]=1,e}function Pu(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function Mu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function Ru(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function Iu(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function Bu(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function Lu(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function Ou(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Fu(e,t){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],h=e[8],c=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],_=e[15],v=t[0],y=t[1],b=t[2],A=t[3],E=t[4],w=t[5],x=t[6],T=t[7],C=t[8],S=t[9],P=t[10],M=t[11],R=t[12],I=t[13],B=t[14],L=t[15];return Math.abs(i-v)<=1e-6*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(s-A)<=1e-6*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-w)<=1e-6*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-x)<=1e-6*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-T)<=1e-6*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-C)<=1e-6*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(c-S)<=1e-6*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(d-P)<=1e-6*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-M)<=1e-6*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(p-R)<=1e-6*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(g-I)<=1e-6*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(m-B)<=1e-6*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(_-L)<=1e-6*Math.max(1,Math.abs(_),Math.abs(L))}var Nu=Jl,Du=Iu,ku={};function Uu(){let e=new Bo(4);return Bo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Gu(e){let t=new Bo(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function zu(e,t,i,r){let n=new Bo(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function Vu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ju(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e}function Hu(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Wu(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function Xu(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function qu(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function Ku(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function $u(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Ju(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function Yu(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function Zu(e,t){return e[0]=Oo(t[0]),e[1]=Oo(t[1]),e[2]=Oo(t[2]),e[3]=Oo(t[3]),e}function Qu(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function eh(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function th(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function ih(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return i*i+r*r+n*n+s*s}function rh(e){let t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)}function nh(e){let t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}function sh(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function oh(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ah(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=s*o,e}function lh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function uh(e,t,i,r){let n=i[0]*r[1]-i[1]*r[0],s=i[0]*r[2]-i[2]*r[0],o=i[0]*r[3]-i[3]*r[0],a=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],u=i[2]*r[3]-i[3]*r[2],h=t[0],c=t[1],d=t[2],f=t[3];return e[0]=c*u-d*l+f*a,e[1]=-h*u+d*o-f*s,e[2]=h*l-c*o+f*n,e[3]=-h*a+c*s-d*n,e}function hh(e,t,i,r){let n=t[0],s=t[1],o=t[2],a=t[3];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function ch(e,t){let i,r,n,s,o,a;t=void 0===t?1:t;do{i=2*Lo()-1,r=2*Lo()-1,o=i*i+r*r}while(o>=1);do{n=2*Lo()-1,s=2*Lo()-1,a=n*n+s*s}while(a>=1);let l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*n*l,e[3]=t*s*l,e}function dh(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,e}function fh(e,t,i){let r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],l=i[2],u=i[3],h=u*r+a*s-l*n,c=u*n+l*r-o*s,d=u*s+o*n-a*r,f=-o*r-a*n-l*s;return e[0]=h*u+f*-o+c*-l-d*-a,e[1]=c*u+f*-a+d*-o-h*-l,e[2]=d*u+f*-l+h*-a-c*-o,e[3]=t[3],e}function ph(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function gh(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function mh(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _h(e,t){let i=e[0],r=e[1],n=e[2],s=e[3],o=t[0],a=t[1],l=t[2],u=t[3];return Math.abs(i-o)<=1e-6*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=1e-6*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=1e-6*Math.max(1,Math.abs(s),Math.abs(u))}l(ku,{add:()=>Hu,ceil:()=>Ku,clone:()=>Gu,copy:()=>Vu,create:()=>Uu,cross:()=>uh,dist:()=>Eh,distance:()=>th,div:()=>Ah,divide:()=>qu,dot:()=>lh,equals:()=>_h,exactEquals:()=>mh,floor:()=>$u,forEach:()=>Ch,fromValues:()=>zu,inverse:()=>oh,len:()=>xh,length:()=>rh,lerp:()=>hh,max:()=>Yu,min:()=>Ju,mul:()=>bh,multiply:()=>Xu,negate:()=>sh,normalize:()=>ah,random:()=>ch,round:()=>Zu,scale:()=>Qu,scaleAndAdd:()=>eh,set:()=>ju,sqrDist:()=>wh,sqrLen:()=>Th,squaredDistance:()=>ih,squaredLength:()=>nh,str:()=>gh,sub:()=>yh,subtract:()=>Wu,transformMat4:()=>dh,transformQuat:()=>fh,zero:()=>ph});var vh,yh=Wu,bh=Xu,Ah=qu,Eh=th,wh=ih,xh=rh,Th=nh,Ch=function(){let e=Uu();return function(t,i,r,n,s,o){let a,l;for(i||(i=4),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,a=r;a<l;a+=i)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],s(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(vh||(vh={}));var Sh,Ph,Mh=45*Math.PI/180,Rh=1,Ih=.1,Bh=500,Lh=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Oh=class extends Bl{static get IDENTITY(){return Ph||(Ph=new Oh,Object.freeze(Ph)),Ph}static get ZERO(){return Sh||(Sh=new Oh([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sh)),Sh}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return vh}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,r,n,s,o,a,l,u,h,c,d,f,p,g){return this[0]=e,this[1]=t,this[2]=i,this[3]=r,this[4]=n,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this[9]=u,this[10]=h,this[11]=c,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,i,r,n,s,o,a,l,u,h,c,d,f,p,g){return this[0]=e,this[1]=n,this[2]=l,this[3]=d,this[4]=t,this[5]=s,this[6]=u,this[7]=f,this[8]=i,this[9]=o,this[10]=h,this[11]=p,this[12]=r,this[13]=a,this[14]=c,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Lh)}fromObject(e){return this.check()}fromQuaternion(e){return _u(this,e),this.check()}frustum(e){let{left:t,right:i,bottom:r,top:n,near:s=Ih,far:o=Bh}=e;return o===1/0?function(e,t,i,r,n,s){let o=2*s/(i-t),a=2*s/(n-r),l=(i+t)/(i-t),u=(n+r)/(n-r),h=-1,c=-1,d=-2*s;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=u,e[10]=h,e[11]=c,e[12]=0,e[13]=0,e[14]=d,e[15]=0}(this,t,i,r,n,s):vu(this,t,i,r,n,s,o),this.check()}lookAt(e){let{eye:t,center:i=[0,0,0],up:r=[0,1,0]}=e;return Cu(this,t,i,r),this.check()}ortho(e){let{left:t,right:i,bottom:r,top:n,near:s=Ih,far:o=Bh}=e;return xu(this,t,i,r,n,s,o),this.check()}orthographic(e){let{fovy:t=Mh,aspect:i=Rh,focalDistance:r=1,near:n=Ih,far:s=Bh}=e;Fh(t);let o=t/2,a=r*Math.tan(o),l=a*i;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:n,far:s})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:i=1,near:r=.1,far:n=500}=e;return Fh(t),bu(this,t,i,r,n),this.check()}determinant(){return $l(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),r=1/i[0],n=1/i[1],s=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*n,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*n,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*n,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),r=1/i[0],n=1/i[1],s=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*n,e[2]=this[2]*s,e[3]=this[4]*r,e[4]=this[5]*n,e[5]=this[6]*s,e[6]=this[8]*r,e[7]=this[9]*n,e[8]=this[10]*s,e}transpose(){return Xl(this,this),this.check()}invert(){return ql(this,this),this.check()}multiplyLeft(e){return Jl(this,e,this),this.check()}multiplyRight(e){return Jl(this,this,e),this.check()}rotateX(e){return eu(this,this,e),this.check()}rotateY(e){return tu(this,this,e),this.check()}rotateZ(e){return iu(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return Ql(this,this,e,t),this.check()}scale(e){return Zl(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Yl(this,this,e),this.check()}transform(e,t){return 4===e.length?(Po(t=dh(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let i,{length:r}=e;switch(r){case 2:i=ca(t||[-0,-0],e,this);break;case 3:i=al(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Po(i,e.length),i}transformAsVector(e,t){let i;switch(e.length){case 2:i=Ca(t||[-0,-0],e,this);break;case 3:i=Sa(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Po(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}};function Fh(e){if(e>2*Math.PI)throw Error("expected radians")}function Nh(){let e=new Bo(4);return Bo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Dh(e,t,i){i*=.5;let r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function kh(e,t,i){let r=t[0],n=t[1],s=t[2],o=t[3],a=i[0],l=i[1],u=i[2],h=i[3];return e[0]=r*h+o*a+n*u-s*l,e[1]=n*h+o*l+s*a-r*u,e[2]=s*h+o*u+r*l-n*a,e[3]=o*h-r*a-n*l-s*u,e}function Uh(e,t,i,r){let n,s,o,a,l,u=t[0],h=t[1],c=t[2],d=t[3],f=i[0],p=i[1],g=i[2],m=i[3];return n=u*f+h*p+c*g+d*m,n<0&&(n=-n,f=-f,p=-p,g=-g,m=-m),1-n>1e-6?(s=Math.acos(n),l=Math.sin(s),o=Math.sin((1-r)*s)/l,a=Math.sin(r*s)/l):(o=1-r,a=r),e[0]=o*u+a*f,e[1]=o*h+a*p,e[2]=o*c+a*g,e[3]=o*d+a*m,e}function Gh(e,t){let i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let n=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*n+s]-t[3*s+n])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}var zh=Hu,Vh=Qu,jh=lh,Hh=hh,Wh=rh,Xh=nh,qh=ah,Kh=function(){let e=Ia(),t=Oa(1,0,0),i=Oa(0,1,0);return function(r,n,s){let o=el(n,s);return o<-.999999?(tl(e,t,n),Cl(e)<1e-6&&tl(e,i,n),Qa(e,e),Dh(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(tl(e,n,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,qh(r,r))}}();Nh(),Nh(),function(){let e=new Bo(9);Bo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1}();var $h=[0,0,0,1],Jh=class extends Co{constructor(e=0,t=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&1===arguments.length?this.copy(e):this.set(e,t,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,r){return this[0]=e,this[1]=t,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Gh(this,e),this.check()}fromAxisRotation(e,t){return Dh(this,e,t),this.check()}identity(){return function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=So(e)}get y(){return this[1]}set y(e){this[1]=So(e)}get z(){return this[2]}set z(e){this[2]=So(e)}get w(){return this[3]}set w(e){this[3]=So(e)}len(){return Wh(this)}lengthSquared(){return Xh(this)}dot(e){return jh(this,e)}rotationTo(e,t){return Kh(this,e,t),this.check()}add(e){return zh(this,this,e),this.check()}calculateW(){return function(e,t){let i=t[0],r=t[1],n=t[2];e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n))}(this,this),this.check()}conjugate(){return function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3]}(this,this),this.check()}invert(){return function(e,t){let i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;e[0]=-i*a,e[1]=-r*a,e[2]=-n*a,e[3]=s*a}(this,this),this.check()}lerp(e,t,i){return void 0===i?this.lerp(this,e,t):(Hh(this,e,t,i),this.check())}multiplyRight(e){return kh(this,this,e),this.check()}multiplyLeft(e){return kh(this,e,this),this.check()}normalize(){let e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,i){i*=.5;let r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);e[0]=r*l+o*a,e[1]=n*l+s*a,e[2]=s*l-n*a,e[3]=o*l-r*a}(this,this,e),this.check()}rotateY(e){return function(e,t,i){i*=.5;let r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);e[0]=r*l-s*a,e[1]=n*l+o*a,e[2]=s*l+r*a,e[3]=o*l-n*a}(this,this,e),this.check()}rotateZ(e){return function(e,t,i){i*=.5;let r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);e[0]=r*l+n*a,e[1]=n*l-r*a,e[2]=s*l+o*a,e[3]=o*l-s*a}(this,this,e),this.check()}scale(e){return Vh(this,this,e),this.check()}slerp(e,t,i){let r,n,s;switch(arguments.length){case 1:({start:r=$h,target:n,ratio:s}=e);break;case 2:r=this,n=e,s=t;break;default:r=e,n=t,s=i}return Uh(this,r,n,s),this.check()}transformVector4(e,t=new Il){return fh(t,e,this),Po(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}},Yh=1e-6,Zh=class{constructor({phi:e=0,theta:t=0,radius:i=1,bearing:r,pitch:n,altitude:s,radiusScale:o=6371e3}={}){this.phi=e,this.theta=t,this.radius=i||s||1,this.radiusScale=o||1,void 0!==r&&(this.bearing=r),void 0!==n&&(this.pitch=n),this.check()}toString(){return this.formatString(go)}formatString({printTypes:e=!1}){let t=mo;return`${e?"Spherical":""}[rho:${t(this.radius)},theta:${t(this.theta)},phi:${t(this.phi)}]`}equals(e){return xo(this.radius,e.radius)&&xo(this.theta,e.theta)&&xo(this.phi,e.phi)}exactEquals(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}get bearing(){return 180-Ao(this.phi)}set bearing(e){this.phi=Math.PI-bo(e)}get pitch(){return Ao(this.theta)}set pitch(e){this.theta=bo(e)}get longitude(){return Ao(this.phi)}get latitude(){return Ao(this.theta)}get lng(){return Ao(this.phi)}get lat(){return Ao(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this.check()}clone(){return(new Zh).copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}fromLngLatZ([e,t,i]){return this.radius=1+i/this.radiusScale,this.phi=bo(t),this.theta=bo(e),this.check()}fromVector3(e){return this.radius=La(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Eo(e[2]/this.radius,-1,1))),this.check()}toVector3(){return new Rl(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Yh,Math.min(Math.PI-Yh,this.phi)),this}check(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},Qh={};l(Qh,{EPSILON1:()=>ec,EPSILON10:()=>uc,EPSILON11:()=>hc,EPSILON12:()=>cc,EPSILON13:()=>dc,EPSILON14:()=>fc,EPSILON15:()=>pc,EPSILON16:()=>gc,EPSILON17:()=>mc,EPSILON18:()=>_c,EPSILON19:()=>vc,EPSILON2:()=>tc,EPSILON20:()=>yc,EPSILON3:()=>ic,EPSILON4:()=>rc,EPSILON5:()=>nc,EPSILON6:()=>sc,EPSILON7:()=>oc,EPSILON8:()=>ac,EPSILON9:()=>lc,PI_OVER_FOUR:()=>Ac,PI_OVER_SIX:()=>Ec,PI_OVER_TWO:()=>bc,TWO_PI:()=>wc});var ec=.1,tc=.01,ic=.001,rc=1e-4,nc=1e-5,sc=1e-6,oc=1e-7,ac=1e-8,lc=1e-9,uc=1e-10,hc=1e-11,cc=1e-12,dc=1e-13,fc=1e-14,pc=1e-15,gc=1e-16,mc=1e-17,_c=1e-18,vc=1e-19,yc=1e-20,bc=Math.PI/2,Ac=Math.PI/4,Ec=Math.PI/6,wc=2*Math.PI,xc="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\nvec3 color;\n};\nstruct PointLight {\nvec3 color;\nvec3 position;\nvec3 attenuation;\n};\nstruct DirectionalLight {\nvec3 color;\nvec3 direction;\n};\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\nuniform bool lighting_uEnabled;\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\nreturn pointLight.attenuation.x\n+ pointLight.attenuation.y * distance\n+ pointLight.attenuation.z * distance * distance;\n}\n#endif\n",Tc={lightSources:{}};function Cc(e={}){let{color:t=[0,0,0],intensity:i=1}=e;return t.map((e=>e*i/255))}var Sc={name:"lights",vs:xc,fs:xc,getUniforms:function e(t=Tc){if("lightSources"in t){let{ambientLight:e,pointLights:i,directionalLights:r}=t.lightSources||{};return e||i&&i.length>0||r&&r.length>0?Object.assign({},function({ambientLight:e,pointLights:t=[],directionalLights:i=[]}){let r={};return r["lighting_uAmbientLight.color"]=e?Cc(e):[0,0,0],t.forEach(((e,t)=>{r[`lighting_uPointLight[${t}].color`]=Cc(e),r[`lighting_uPointLight[${t}].position`]=e.position,r[`lighting_uPointLight[${t}].attenuation`]=e.attenuation||[1,0,0]})),r.lighting_uPointLightCount=t.length,i.forEach(((e,t)=>{r[`lighting_uDirectionalLight[${t}].color`]=Cc(e),r[`lighting_uDirectionalLight[${t}].direction`]=e.direction})),r.lighting_uDirectionalLightCount=i.length,r}({ambientLight:e,pointLights:i,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){let i={pointLights:[],directionalLights:[]};for(let e of t.lights||[])switch(e.type){case"ambient":i.ambientLight=e;break;case"directional":i.directionalLights?.push(e);break;case"point":i.pointLights?.push(e)}return e({lightSources:i})}return{}},defines:{MAX_LIGHTS:3}},Pc="uniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\nvec3 halfway_direction = normalize(light_direction + view_direction);\nfloat lambertian = dot(light_direction, normal_worldspace);\nfloat specular = 0.0;\nif (lambertian > 0.0) {\nfloat specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\nspecular = pow(specular_angle, lighting_uShininess);\n}\nlambertian = max(lambertian, 0.0);\nreturn (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\nvec3 lightColor = surfaceColor;\nif (lighting_uEnabled) {\nvec3 view_direction = normalize(cameraPosition - position_worldspace);\nlightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uPointLightCount) {\nbreak;\n}\nPointLight pointLight = lighting_uPointLight[i];\nvec3 light_position_worldspace = pointLight.position;\nvec3 light_direction = normalize(light_position_worldspace - position_worldspace);\nlightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n}\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uDirectionalLightCount) {\nbreak;\n}\nDirectionalLight directionalLight = lighting_uDirectionalLight[i];\nlightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n}\n}\nreturn lightColor;\n}\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\nvec3 lightColor = vec3(0, 0, 0);\nvec3 surfaceColor = vec3(0, 0, 0);\nif (lighting_uEnabled) {\nvec3 view_direction = normalize(cameraPosition - position_worldspace);\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uPointLightCount) {\nbreak;\n}\nPointLight pointLight = lighting_uPointLight[i];\nvec3 light_position_worldspace = pointLight.position;\nvec3 light_direction = normalize(light_position_worldspace - position_worldspace);\nlightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n}\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uDirectionalLightCount) {\nbreak;\n}\nDirectionalLight directionalLight = lighting_uDirectionalLight[i];\nlightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n}\n}\nreturn lightColor;\n}\n",Mc={};function Rc(e=Mc){if(!("material"in e))return{};let{material:t}=e;return t?function(e){let{ambient:t=.35,diffuse:i=.6,shininess:r=32,specularColor:n=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:n.map((e=>e/255))}}(t):{lighting_uEnabled:!1}}var Ic={name:"gouraud-lighting",dependencies:[Sc],vs:Pc,defines:{LIGHTING_VERTEX:1},getUniforms:Rc},Bc={name:"phong-lighting",dependencies:[Sc],fs:Pc,defines:{LIGHTING_FRAGMENT:1},getUniforms:Rc},Lc={name:"pbr",vs:"uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\nout vec3 pbr_vPosition;\nout vec2 pbr_vUV;\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nout mat3 pbr_vTBN;\n# else\nout vec3 pbr_vNormal;\n# endif\n#endif\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\nvec4 pos = u_ModelMatrix * position;\npbr_vPosition = vec3(pos.xyz) / pos.w;\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\nvec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\nvec3 bitangentW = cross(normalW, tangentW) * tangent.w;\npbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\npbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n#ifdef HAS_UV\npbr_vUV = uv;\n#else\npbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"precision highp float;\nuniform bool pbr_uUnlit;\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\nuniform vec3 u_Camera;\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\nin vec3 pbr_vPosition;\nin vec2 pbr_vUV;\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nin mat3 pbr_vTBN;\n#else\nin vec3 pbr_vNormal;\n#endif\n#endif\nstruct PBRInfo\n{\nfloat NdotL;\nfloat NdotV;\nfloat NdotH;\nfloat LdotH;\nfloat VdotH;\nfloat perceptualRoughness;\nfloat metalness;\nvec3 reflectance0;\nvec3 reflectance90;\nfloat alphaRoughness;\nvec3 diffuseColor;\nvec3 specularColor;\nvec3 n;\nvec3 v;\n};\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\nvec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else\nvec3 bLess = step(vec3(0.04045),srgbIn.xyz);\nvec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif\nreturn vec4(linOut,srgbIn.w);;\n#else\nreturn srgbIn;\n#endif\n}\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\nvec3 pos_dx = dFdx(pbr_vPosition);\nvec3 pos_dy = dFdy(pbr_vPosition);\nvec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\nvec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\nvec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n#ifdef HAS_NORMALS\nvec3 ng = normalize(pbr_vNormal);\n#else\nvec3 ng = cross(pos_dx, pos_dy);\n#endif\nt = normalize(t - ng * dot(ng, t));\nvec3 b = normalize(cross(ng, t));\nmat3 tbn = mat3(t, b, ng);\n#else\nmat3 tbn = pbr_vTBN;\n#endif\n#ifdef HAS_NORMALMAP\nvec3 n = texture(u_NormalSampler, pbr_vUV).rgb;\nn = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\nvec3 n = normalize(tbn[2].xyz);\n#endif\nreturn n;\n}\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\nfloat mipCount = 9.0;\nfloat lod = (pbrInputs.perceptualRoughness * mipCount);\nvec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,\nvec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\nvec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n#ifdef USE_TEX_LOD\nvec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\nvec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\nvec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\nvec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\ndiffuse *= u_ScaleIBLAmbient.x;\nspecular *= u_ScaleIBLAmbient.y;\nreturn diffuse + specular;\n}\n#endif\nvec3 diffuse(PBRInfo pbrInputs)\n{\nreturn pbrInputs.diffuseColor / M_PI;\n}\nvec3 specularReflection(PBRInfo pbrInputs)\n{\nreturn pbrInputs.reflectance0 +\n(pbrInputs.reflectance90 - pbrInputs.reflectance0) *\npow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\nfloat NdotL = pbrInputs.NdotL;\nfloat NdotV = pbrInputs.NdotV;\nfloat r = pbrInputs.alphaRoughness;\nfloat attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\nfloat attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\nreturn attenuationL * attenuationV;\n}\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\nfloat roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\nfloat f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\nreturn roughnessSq / (M_PI * f * f);\n}\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\npbrInputs.NdotL = 1.0;\npbrInputs.NdotH = 0.0;\npbrInputs.LdotH = 0.0;\npbrInputs.VdotH = 1.0;\n}\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\nvec3 n = pbrInputs.n;\nvec3 v = pbrInputs.v;\nvec3 l = normalize(lightDirection);\nvec3 h = normalize(l+v);\npbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\npbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\npbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\npbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\nvec3 light_direction = normalize(pointLight.position - pbr_vPosition);\nPBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\nvec3 F = specularReflection(pbrInputs);\nfloat G = geometricOcclusion(pbrInputs);\nfloat D = microfacetDistribution(pbrInputs);\nvec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\nvec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\nreturn pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n#ifdef HAS_BASECOLORMAP\nvec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\nvec4 baseColor = u_BaseColorFactor;\n#endif\n#ifdef ALPHA_CUTOFF\nif (baseColor.a < u_AlphaCutoff) {\ndiscard;\n}\n#endif\nvec3 color = vec3(0, 0, 0);\nif(pbr_uUnlit){\ncolor.rgb = baseColor.rgb;\n}\nelse{\nfloat perceptualRoughness = u_MetallicRoughnessValues.y;\nfloat metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\nvec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);\nperceptualRoughness = mrSample.g * perceptualRoughness;\nmetallic = mrSample.b * metallic;\n#endif\nperceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\nmetallic = clamp(metallic, 0.0, 1.0);\nfloat alphaRoughness = perceptualRoughness * perceptualRoughness;\nvec3 f0 = vec3(0.04);\nvec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\ndiffuseColor *= 1.0 - metallic;\nvec3 specularColor = mix(f0, baseColor.rgb, metallic);\nfloat reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\nfloat reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\nvec3 specularEnvironmentR0 = specularColor.rgb;\nvec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\nvec3 n = getNormal();\nvec3 v = normalize(u_Camera - pbr_vPosition);\nfloat NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\nvec3 reflection = -normalize(reflect(v, n));\nPBRInfo pbrInputs = PBRInfo(\n0.0,\nNdotV,\n0.0,\n0.0,\n0.0,\nperceptualRoughness,\nmetallic,\nspecularEnvironmentR0,\nspecularEnvironmentR90,\nalphaRoughness,\ndiffuseColor,\nspecularColor,\nn,\nv\n);\n#ifdef USE_LIGHTS\nPBRInfo_setAmbientLight(pbrInputs);\ncolor += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\nfor(int i = 0; i < lighting_uDirectionalLightCount; i++) {\nif (i < lighting_uDirectionalLightCount) {\nPBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\ncolor += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n}\n}\nfor(int i = 0; i < lighting_uPointLightCount; i++) {\nif (i < lighting_uPointLightCount) {\nPBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\nfloat attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\ncolor += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n}\n}\n#endif\n#ifdef USE_IBL\ncolor += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\nfloat ao = texture(u_OcclusionSampler, pbr_vUV).r;\ncolor = mix(color, color * ao, u_OcclusionStrength);\n#endif\n#ifdef HAS_EMISSIVEMAP\nvec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\ncolor += emissive;\n#endif\n#ifdef PBR_DEBUG\ncolor = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\ncolor = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\ncolor = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n}\nreturn vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:1},dependencies:[Sc]},Oc="#define SMOOTH_EDGE_RADIUS 0.5",Fc={name:"geometry",vs:`\n${Oc}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`\n${Oc}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`},Nc={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Nc,"IDENTITY",{get:()=>(wi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var Dc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},kc={common:0,meters:1,pixels:2},Uc={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Gc={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"},zc=Object.keys(Nc).map((e=>`const int COORDINATE_SYSTEM_${e} = ${Nc[e]};`)).join(""),Vc=Object.keys(Dc).map((e=>`const int PROJECTION_MODE_${e} = ${Dc[e]};`)).join(""),jc=Object.keys(kc).map((e=>`const int UNIT_${e.toUpperCase()} = ${kc[e]};`)).join(""),Hc=`${zc}\n${Vc}\n${jc}\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject_uPseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project_uCommonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project_uCommonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project_uWrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project_uModelMatrix * position;\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project_uCoordinateOrigin;\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project_uCommonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project_uCoordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\nreturn offset * project_uFocalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project_uScale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project_uScale;\n}\n`;function Wc(e,t){if(e===t)return!0;if(Array.isArray(e)){let i=e.length;if(!t||t.length!==i)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}return!1}function Xc(e){let t,i={};return r=>{for(let n in r)if(!Wc(r[n],i[n])){t=e(r),i=r;break}return t}}var qc=[0,0,0,0],Kc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Jc=[0,0,0],Yc=[0,0,0],Zc=Xc((function({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r}){let{projectionCenter:n,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:u}=function(e,t,i){let{viewMatrixUncentered:r,projectionMatrix:n}=e,{viewMatrix:s,viewProjectionMatrix:o}=e,a=qc,l=qc,u=e.cameraPosition,{geospatialOrigin:h,shaderCoordinateOrigin:c,offsetMode:d}=Qc(e,t,i);return d&&(l=e.projectPosition(h||c),u=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],l[3]=1,a=ku.transformMat4([],l,o),s=r||s,o=Ul.multiply([],n,s),o=Ul.multiply([],o,Kc)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:c,geospatialOrigin:h}}(e,i,r),h=e.getDistanceScales(),c=[e.width*t,e.height*t],d=ku.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={project_uCoordinateSystem:i,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:n,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:c,project_uDevicePixelRatio:t,project_uFocalDistance:d,project_uCommonUnitsPerMeter:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Jc,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:$c,project_uCameraPosition:a};if(u){let t=e.getDistanceScales(u);switch(i){case Nc.METER_OFFSETS:f.project_uCommonUnitsPerWorldUnit=t.unitsPerMeter,f.project_uCommonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case Nc.LNGLAT:case Nc.LNGLAT_OFFSETS:e._pseudoMeters||(f.project_uCommonUnitsPerMeter=t.unitsPerMeter),f.project_uCommonUnitsPerWorldUnit=t.unitsPerDegree,f.project_uCommonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case Nc.CARTESIAN:f.project_uCommonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.project_uCommonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f}));function Qc(e,t,i=Yc){i.length<3&&(i=[i[0],i[1],0]);let r,n=i,s=!0;switch(r=t===Nc.LNGLAT_OFFSETS||t===Nc.METER_OFFSETS?i:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Dc.WEB_MERCATOR:(t===Nc.LNGLAT||t===Nc.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Dc.WEB_MERCATOR_AUTO_OFFSET:t===Nc.LNGLAT?n=r:t===Nc.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],r=e.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case Dc.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case Dc.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:s}}function ed({viewport:e,devicePixelRatio:t=1,modelMatrix:i=null,coordinateSystem:r=Nc.DEFAULT,coordinateOrigin:n=Yc,autoWrapLongitude:s=!1}){r===Nc.DEFAULT&&(r=e.isGeospatial?Nc.LNGLAT:Nc.CARTESIAN);let o=Zc({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n});return o.project_uWrapLongitude=s,o.project_uModelMatrix=i||$c,o}var td={},id={name:"project",dependencies:[ro,Fc],vs:Hc,getUniforms:function(e=td){return"viewport"in e?ed(e):{}}},rd={name:"project32",dependencies:[id],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"};function nd(e,t){let i=ku.transformMat4([],t,e);return ku.scale(i,i,1/i[3]),i}function sd(e,t){let i=e%t;return i<0?t+i:i}function od(e,t,i){return i*t+(1-i)*e}function ad(e,t,i){return e<t?t:e>i?i:e}var ld=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function ud(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var hd=Math.PI,cd=hd/4,dd=hd/180,fd=180/hd,pd=512,gd=4003e4,md=85.051129,_d=1.5;function vd(e){return Math.pow(2,e)}function yd(e){return ld(e)}function bd(e){let[t,i]=e;ud(Number.isFinite(t)),ud(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");let r=i*dd;return[pd*(t*dd+hd)/(2*hd),pd*(hd+Math.log(Math.tan(cd+.5*r)))/(2*hd)]}function Ad(e){let[t,i]=e,r=t/pd*(2*hd)-hd,n=2*(Math.atan(Math.exp(i/pd*(2*hd)-hd))-cd);return[r*fd,n*fd]}function Ed(e){let{latitude:t}=e;ud(Number.isFinite(t));let i=Math.cos(t*dd);return yd(gd*i)-9}function wd(e){let t=Math.cos(e*dd);return pd/gd/t}function xd(e){let{latitude:t,longitude:i,highPrecision:r=!1}=e;ud(Number.isFinite(t)&&Number.isFinite(i));let n=pd,s=Math.cos(t*dd),o=n/360,a=o/s,l=n/gd/s,u={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){let e=dd*Math.tan(t*dd)/s,i=o*e/2,r=n/gd*e,h=r/a*l;u.unitsPerDegree2=[0,i,r],u.unitsPerMeter2=[h,0,h]}return u}function Td(e,t){let[i,r,n]=e,[s,o,a]=t,{unitsPerMeter:l,unitsPerMeter2:u}=xd({longitude:i,latitude:r,highPrecision:!0}),h=bd(e);h[0]+=s*(l[0]+u[0]*o),h[1]+=o*(l[1]+u[1]*o);let c=Ad(h),d=(n||0)+(a||0);return Number.isFinite(n)||Number.isFinite(a)?[c[0],c[1],d]:c}function Cd(e){return 2*Math.atan(.5/e)*fd}function Sd(e){return.5/Math.tan(.5*e*dd)}function Pd(e,t){let[i,r,n=0]=e;return ud(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(n)),nd(t,[i,r,n,1])}function Md(e,t,i=0){let[r,n,s]=e;if(ud(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return nd(t,[r,n,s,1]);let o=nd(t,[r,n,0,1]),a=nd(t,[r,n,1,1]),l=o[2],u=a[2],h=l===u?0:((i||0)-l)/(u-l);return Io.lerp([],o,a,h)}function Rd(e){let{width:t,height:i,bounds:r,minExtent:n=0,maxZoom:s=24,offset:o=[0,0]}=e,[[a,l],[u,h]]=r,c=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(ud(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=bd([a,ad(h,-md,md)]),f=bd([u,ad(l,-md,md)]),p=[Math.max(Math.abs(f[0]-d[0]),n),Math.max(Math.abs(f[1]-d[1]),n)],g=[t-c.left-c.right-2*Math.abs(o[0]),i-c.top-c.bottom-2*Math.abs(o[1])];ud(g[0]>0&&g[1]>0);let m=g[0]/p[0],_=g[1]/p[1],v=(c.right-c.left)/2/m,y=(c.top-c.bottom)/2/_,b=Ad([(f[0]+d[0])/2+v,(f[1]+d[1])/2+y]),A=Math.min(s,ld(Math.abs(Math.min(m,_))));return ud(Number.isFinite(A)),{longitude:b[0],latitude:b[1],zoom:A}}var Id=Math.PI/180;function Bd(e,t,i){let{pixelUnprojectionMatrix:r}=e,n=nd(r,[t,0,1,1]),s=nd(r,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),a=Ad(Io.lerp([],n,s,o));return a.push(i),a}var Ld=.01,Od=["longitude","latitude","zoom"],Fd={curve:1.414,speed:1.2};function Nd(e,t,i){let r=(i=Object.assign({},Fd,i)).curve,n=e.zoom,s=[e.longitude,e.latitude],o=vd(n),a=t.zoom,l=[t.longitude,t.latitude],u=vd(a-n),h=bd(s),c=bd(l),d=Io.sub([],c,h),f=Math.max(e.width,e.height),p=f/u,g=Io.length(d)*o,m=Math.max(g,Ld),_=r*r,v=(p*p-f*f+_*_*m*m)/(2*f*_*m),y=(p*p-f*f-_*_*m*m)/(2*p*_*m),b=Math.log(Math.sqrt(v*v+1)-v),A=Math.log(Math.sqrt(y*y+1)-y);return{startZoom:n,startCenterXY:h,uDelta:d,w0:f,u1:g,S:(A-b)/r,rho:r,rho2:_,r0:b,r1:A}}var Dd=Xc((function({viewport:e,center:t}){return new Oh(e.viewProjectionMatrix).invert().transform(t)})),kd=Xc((function({viewport:e,shadowMatrices:t}){let i=[],r=e.pixelUnprojectionMatrix,n=e.isGeospatial?void 0:1,s=[[0,0,n],[e.width,0,n],[0,e.height,n],[e.width,e.height,n],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((e=>function(e,t){let[i,r,n]=e,s=Md([i,r,n],t);return Number.isFinite(n)?s:[s[0],s[1],0]}(e,r)));for(let r of t){let t=r.clone().translate(new Rl(e.center).negate()),n=s.map((e=>t.transform(e))),o=(new Oh).ortho({left:Math.min(...n.map((e=>e[0]))),right:Math.max(...n.map((e=>e[0]))),bottom:Math.min(...n.map((e=>e[1]))),top:Math.max(...n.map((e=>e[1]))),near:Math.min(...n.map((e=>-e[2]))),far:Math.max(...n.map((e=>-e[2])))});i.push(o.multiplyRight(r))}return i})),Ud=[0,0,0,1],Gd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],zd={name:"shadow",dependencies:[id],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?function(e,t){let{shadowEnabled:i=!0}=e;if(!i||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let r={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,shadow_uColor:e.shadowColor||Ud,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},n=Dd({viewport:e.viewport,center:t.project_uCenter}),s=[],o=kd({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let i=0;i<e.shadowMatrices.length;i++){let r=o[i],a=r.clone().translate(new Rl(e.viewport.center).negate());t.project_uCoordinateSystem===Nc.LNGLAT&&t.project_uProjectionMode===Dc.WEB_MERCATOR?(o[i]=a,s[i]=n):(o[i]=r.clone().multiplyRight(Gd),s[i]=a.transform(n))}for(let e=0;e<o.length;e++)r[`shadow_uViewProjectionMatrices[${e}]`]=o[e],r[`shadow_uProjectCenters[${e}]`]=s[e];for(let t=0;t<2;t++)r[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return r}(e,t):{}},Vd={...so,defaultUniforms:{...so.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},jd=[id],Hd=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Wd(){let e=hr.getDefaultShaderAssembler();for(let t of jd)e.addDefaultModule(t);for(let t of Hd)e.addShaderHook(t);return e}var Xd=[255,255,255],qd=1,Kd=0,$d=class{constructor(e={}){this.type="ambient";let{color:t=Xd}=e,{intensity:i=qd}=e;this.id=e.id||"ambient-"+Kd++,this.color=t,this.intensity=i}},Jd=[255,255,255],Yd=1,Zd=[0,0,-1],Qd=0,ef=class{constructor(e={}){this.type="directional";let{color:t=Jd}=e,{intensity:i=Yd}=e,{direction:r=Zd}=e,{_shadow:n=!1}=e;this.id=e.id||"directional-"+Qd++,this.color=t,this.intensity=i,this.type="directional",this.direction=new Rl(r).normalize().toArray(),this.shadow=n}getProjectedLight(e){return this}},tf=class{constructor(e,t={id:"pass"}){let{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}},rf=class extends tf{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[t,i]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,n=e.clearColor??(!!r&&[0,0,0,0]),s=!!r&&1,o=e.colorMask??15,a={viewport:[0,0,t,i]};e.colorMask&&(a.colorMask=o),e.scissorRect&&(a.scissorRect=e.scissorRect);let l=this.device.beginRenderPass({framebuffer:e.target,parameters:a,clearColor:n,clearDepth:s});try{return this._drawLayers(l,e)}finally{l.end()}}_drawLayers(e,t){let{target:i,moduleParameters:r,viewports:n,views:s,onViewportActive:o,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);let l=[];for(let a of n){let n=s&&s[a.id];o?.(a);let u=this._getDrawLayerParams(a,t),h=a.subViewports||[a];for(let s of h){let o=this._drawLayersInViewport(e,{target:i,moduleParameters:r,viewport:s,view:n,pass:t.pass,layers:t.layers},u);l.push(o)}}return l}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:r=!1,layerFilter:n,cullRect:s,effects:o,moduleParameters:a},l=!1){let u=[],h=nf(this._lastRenderIndex+1),c={layer:t[0],viewport:e,isPicking:r,renderPass:i,cullRect:s},d={};for(let r=0;r<t.length;r++){let s=t[r],f=this._shouldDrawLayer(s,c,n,d),p={shouldDrawLayer:f};f&&!l&&(p.layerRenderIndex=h(s,f),p.moduleParameters=this._getModuleParameters(s,o,i,a),p.layerParameters={...s.context.deck?.props.parameters,...this.getLayerParameters(s,r,e)}),u[r]=p}return u}_drawLayersInViewport(e,{layers:t,moduleParameters:i,pass:r,target:n,viewport:s,view:o},a){let l=function(e,{moduleParameters:t,target:i,viewport:r}){let n=t&&t.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,s]=e.canvasContext.getDrawingBufferSize(),o=i?i.height:s,a=r;return[a.x*n,o-(a.y+a.height)*n,a.width*n,a.height*n]}(this.device,{moduleParameters:i,target:n,viewport:s});if(o&&o.props.clear){let e=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:l},(()=>this.device.clearWebGL(e)))}let u={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let i=0;i<t.length;i++){let n=t[i],{shouldDrawLayer:o,layerRenderIndex:l,moduleParameters:h,layerParameters:c}=a[i];if(o&&n.props.pickable&&u.pickableCount++,n.isComposite)u.compositeCount++;else if(o){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,l),h.viewport=s,n.context.renderPass=e;try{n._drawLayer({renderPass:e,moduleParameters:h,uniforms:{layerIndex:l},parameters:c})}catch(e){n.raiseError(e,`drawing ${n} to ${r}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,r){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;let n=e.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(t))return!1;t.layer=n,n=n.parent}if(i){let e=t.layer.id;if(e in r||(r[e]=i(t)),!r[e])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,i,r){let n=this.device.canvasContext.cssToDeviceRatio(),s=Object.assign(Object.create(e.internalState?.propsInTransition||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:n});if(t)for(let i of t)Object.assign(s,i.getModuleParameters?.(e));return Object.assign(s,this.getModuleParameters(e,t),r)}};function nf(e=0,t={}){let i={},r=(n,s)=>{let o,a=n.props._offset,l=n.id,u=n.parent&&n.parent.id;if(u&&!(u in t)&&r(n.parent,!1),u in i){let e=i[u]=i[u]||nf(t[u],t);o=e(n,s),i[l]=e}else Number.isFinite(a)?(o=a+(t[u]||0),i[l]=null):o=e;return s&&o>=e&&(e=o+1),t[l]=o,o};return r}var sf=class extends rf{constructor(e,t){super(e,t),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){let t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],n=r.width*i,s=r.height*i;(n!==t.width||s!==t.height)&&t.resize({width:n,height:s}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}},of={color:[255,255,255],intensity:1},af=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],lf=[0,0,0,200/255],uf=class{constructor(e={}){this.id="lighting-effect",this.shadowColor=lf,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(zd),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(let t in e){let i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((e=>e.shadow)),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:r,views:n}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:i,onViewportActive:r,views:n,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){let t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((t=>t.getProjectedLight({layer:e}))),pointLights:this.pointLights.map((t=>t.getProjectedLight({layer:e})))},t}cleanup(e){for(let e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(zd))}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let i=(new Oh).lookAt({eye:new Rl(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let i=new sf(e);this.shadowPasses[t]=i,this.shadowMaps[t]=i.shadowMap}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&0===t.length&&0===i.length&&(this.ambientLight=new $d(of),this.directionalLights.push(new ef(af[0]),new ef(af[1])))}},hf=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:r,padding:n=0,copy:s=!1,initialize:o=!1,maxCount:a}){let l=r||e&&e.constructor||Float32Array,u=t*i+n;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;a&&(h=a*i+n);let c=this._allocate(l,u,o,h);return e&&s?c.set(e):o||c.fill(0,0,4),this._release(e),c}release(e){this._release(e)}_allocate(e,t,i,r){let n=Math.max(Math.ceil(t*this.opts.overAlloc),1);n>r&&(n=r);let s=this._pool,o=e.BYTES_PER_ELEMENT*n,a=s.findIndex((e=>e.byteLength>=o));if(a>=0){let t=new e(s.splice(a,1)[0],0,n);return i&&t.fill(0),t}return new e(n)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:i}=e,{byteLength:r}=i,n=t.findIndex((e=>e.byteLength>=r));n<0?t.push(i):(n>0||t.length<this.opts.poolSize)&&t.splice(n,0,i),t.length>this.opts.poolSize&&t.shift()}};function cf(e,t){let i=e%t;return i<0?t+i:i}var df,ff=new Rl;function pf(e,t,i,r){ff.set(e,t,i);let n=ff.len();return{distance:r/n,normal:new Rl(-e/n,-t/n,-i/n)}}function gf(e){return e-Math.fround(e)}function mf(e,t){let{size:i=1,startIndex:r=0}=t,n=void 0!==t.endIndex?t.endIndex:e.length,s=(n-r)/i;df=hf.allocate(df,s,{type:Float32Array,size:2*i});let o=r,a=0;for(;o<n;){for(let t=0;t<i;t++){let r=e[o++];df[a+t]=r,df[a+t+i]=gf(r)}a+=2*i}return df.subarray(0,s*i*2)}function _f(e){let t=null,i=!1;for(let r of e)r&&(t?(i||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],i=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}var vf=Math.PI/180,yf=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bf=[0,0,0],Af={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]},Ef=class{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Af,this.focalDistance=e.focalDistance||1,this.position=e.position||bf,this.modelMatrix=e.modelMatrix||null;let{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Dc.WEB_MERCATOR:Dc.WEB_MERCATOR_AUTO_OFFSET:Dc.IDENTITY}equals(e){return e instanceof Ef&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&xo(e.projectionMatrix,this.projectionMatrix)&&xo(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){let i=Pd(this.projectPosition(e),this.pixelProjectionMatrix),[r,n]=i,s=t?n:this.height-n;return 2===e.length?[r,s]:[r,s,i[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let[r,n,s]=e,o=t?n:this.height-n,a=i&&i*this.distanceScales.unitsPerMeter[2],l=Md([r,o,s],this.pixelUnprojectionMatrix,a),[u,h,c]=this.unprojectPosition(l);return Number.isFinite(s)?[u,h,c]:Number.isFinite(i)?[u,h,i]:[u,h]}projectPosition(e){let[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){let[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){let t=bd(e);return t[1]=Eo(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Ad(e):e}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,0],t),r=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(i[0],r[0],n[0],s[0]),Math.min(i[1],r[1],n[1],s[1]),Math.max(i[0],r[0],n[0],s[0]),Math.max(i[1],r[1],n[1],s[1])]}getDistanceScales(e){return e?xd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,function(e){return{left:pf(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:pf(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:pf(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:pf(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:pf(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:pf(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Ed({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||xd({latitude:i,longitude:t}));let r=Math.pow(2,this.zoom);this.scale=r;let{position:n,modelMatrix:s}=e,o=bf;if(n&&(o=s?new Oh(s).transformAsVector(n,[]):n),this.isGeospatial){let e=this.projectPosition([t,i,0]);this.center=new Rl(o).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(o)}_initMatrices(e){let{viewMatrix:t=yf,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:n,fovy:s=75,near:o=.1,far:a=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Oh).multiplyRight(t).translate(new Rl(this.center).negate()),this.projectionMatrix=i||function({width:e,height:t,orthographic:i,fovyRadians:r,focalDistance:n,padding:s,near:o,far:a}){let l=e/t,u=i?(new Oh).orthographic({fovy:r,aspect:l,focalDistance:n,near:o,far:a}):(new Oh).perspective({fovy:r,aspect:l,near:o,far:a});if(s){let{left:i=0,right:r=0,top:n=0,bottom:o=0}=s,a=Eo((i+e-r)/2,0,e)-e/2,l=Eo((n+t-o)/2,0,t)-t/2;u[8]-=2*a/e,u[9]+=2*l/t}return u}({width:this.width,height:this.height,orthographic:r,fovyRadians:n||s*vf,focalDistance:u,padding:l,near:o,far:a});let h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ul.multiply(h,h,this.projectionMatrix),Ul.multiply(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Ul.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=function(e){return[e[12],e[13],e[14]]}(this.viewMatrixInverse);let c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ul.scale(c,c,[this.width/2,-this.height/2,1]),Ul.translate(c,c,[1,-1,0]),Ul.multiply(d,c,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Ul.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||wi.warn("Pixel project matrix not invertible")()}},wf=Ef;Ef.displayName="Viewport";var xf=class extends wf{constructor(e={}){let{latitude:t=0,longitude:i=0,zoom:r=0,pitch:n=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:c,repeat:d=!1,worldOffset:f=0,position:p,padding:g,legacyMeterSizes:m=!1}=e,{width:_,height:v,altitude:y=1.5}=e,b=Math.pow(2,r);_=_||1,v=v||1;let A,E=null;if(c)y=c[5]/2,A=Cd(y);else{let i;if(e.fovy?(A=e.fovy,y=Sd(A)):A=Cd(y),g){let{top:e=0,bottom:t=0}=g;i=[0,Eo((e+v-t)/2,0,v)-v/2]}E=function(e){let{width:t,height:i,altitude:r,pitch:n=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:u=1}=e,{fovy:h=Cd(_d)}=e;void 0!==r&&(h=Cd(r));let c=h*dd,d=n*dd,f=Sd(h),p=f;o&&(p+=o[2]*a/Math.cos(d)/i);let g=c*(.5+(s?s[1]:0)/i),m=Math.sin(g)*p/Math.sin(ad(Math.PI/2-d-g,.01,Math.PI-.01)),_=Math.sin(d)*m+p,v=10*p;return{fov:c,aspect:t/i,focalDistance:f,near:l,far:Math.min(_*u,v)}}({width:_,height:v,scale:b,center:p&&[0,0,p[2]*wd(t)],offset:i,pitch:n,fovy:A,nearZMultiplier:o,farZMultiplier:a}),Number.isFinite(l)&&(E.near=l),Number.isFinite(u)&&(E.far=u)}let w=function(e){let{height:t,pitch:i,bearing:r,altitude:n,scale:s,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ul.translate(a,a,[0,0,-n]),Ul.rotateX(a,a,-i*dd),Ul.rotateZ(a,a,r*dd);let l=s/t;return Ul.scale(a,a,[l,l,l]),o&&Ul.translate(a,a,Ra.negate([],o)),a}({height:v,pitch:n,bearing:s,scale:b,altitude:y});f&&(w=(new Oh).translate([512*f,0,0]).multiplyLeft(w)),super({...e,width:_,height:v,viewMatrix:w,longitude:i,latitude:t,zoom:r,...E,fovy:A,focalDistance:y}),this.latitude=t,this.longitude=i,this.zoom=r,this.pitch=n,this.bearing=s,this.altitude=y,this.fovy=A,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let e=t;e<=i;e++){let t=e?new xf({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*wd(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)/wd(i)]}addMetersToLngLat(e,t){return Td(e,t)}panByPosition(e,t){let i=Md(t,this.pixelUnprojectionMatrix),r=this.projectFlat(e),n=Io.add([],r,Io.negate([],i)),s=Io.add([],this.center,n),[o,a]=this.unprojectFlat(s);return{longitude:o,latitude:a}}getBounds(e={}){let t=function(e,t=0){let i,r,{width:n,height:s,unproject:o}=e,a={targetZ:t},l=o([0,s],a),u=o([n,s],a);return(e.fovy?.5*e.fovy*Id:Math.atan(.5/e.altitude))>(90-e.pitch)*Id-.01?(i=Bd(e,0,t),r=Bd(e,n,t)):(i=o([0,0],a),r=o([n,0],a)),[l,u,r,i]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:i,height:r}=this,{longitude:n,latitude:s,zoom:o}=Rd({width:i,height:r,bounds:e,...t});return new xf({width:i,height:r,longitude:n,latitude:s,zoom:o})}},Tf=xf;xf.displayName="WebMercatorViewport";var Cf=[0,0,0];function Sf(e,t,i=!1){let r=t.projectPosition(e);if(i&&t instanceof Tf){let[i,n,s=0]=e,o=t.getDistanceScales([i,n]);r[2]=s*o.unitsPerMeter[2]}return r}function Pf(e,{viewport:t,modelMatrix:i,coordinateSystem:r,coordinateOrigin:n,offsetMode:s}){let[o,a,l=0]=e;switch(i&&([o,a,l]=ku.transformMat4([],[o,a,l,1],i)),r){case Nc.LNGLAT:return Sf([o,a,l],t,s);case Nc.LNGLAT_OFFSETS:return Sf([o+n[0],a+n[1],l+(n[2]||0)],t,s);case Nc.METER_OFFSETS:return Sf(Td(n,[o,a,l]),t,s);case Nc.CARTESIAN:default:return t.isGeospatial?[o+n[0],a+n[1],l+n[2]]:t.projectPosition([o,a,l])}}function Mf(e,t){let{viewport:i,coordinateSystem:r,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){let{viewport:t,modelMatrix:i,coordinateOrigin:r}=e,{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return n===Nc.DEFAULT&&(n=t.isGeospatial?Nc.LNGLAT:Nc.CARTESIAN),void 0===s&&(s=n),void 0===o&&(o=r),{viewport:t,coordinateSystem:n,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:u=Cf,shaderCoordinateOrigin:h=Cf,offsetMode:c=!1}=l?Qc(i,r,n):{},d=Pf(e,{viewport:i,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:c});if(c){let e=i.projectPosition(u||h);Ra.sub(d,d,e)}return d}var Rf=[255,255,255],If=1,Bf=[0,0,1],Lf=[0,0,1],Of=0,Ff=class{constructor(e={}){this.type="point";let{color:t=Rf}=e,{intensity:i=If}=e,{position:r=Lf}=e;this.id=e.id||"point-"+Of++,this.color=t,this.intensity=i,this.type="point",this.position=r,this.attenuation=function(e){return e.attenuation?e.attenuation:"intensity"in e?[0,0,e.intensity||0]:Bf}(e),this.projectedLight={...this}}getProjectedLight({layer:e}){let{projectedLight:t}=this,i=e.context.viewport,{coordinateSystem:r,coordinateOrigin:n}=e.props,s=Mf(this.position,{viewport:i,coordinateSystem:r,coordinateOrigin:n,fromCoordinateSystem:i.isGeospatial?Nc.LNGLAT:Nc.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=s,t}},Nf=class extends Ff{getProjectedLight({layer:e}){let{projectedLight:t}=this,i=e.context.viewport,{coordinateSystem:r,coordinateOrigin:n,modelMatrix:s}=e.props,{project_uCameraPosition:o}=ed({viewport:i,modelMatrix:s,coordinateSystem:r,coordinateOrigin:n});return t.color=this.color,t.intensity=this.intensity,t.position=o,t}},Df=Math.PI/180,kf=864e5,Uf=2440588,Gf=2451545,zf=23.4397*Df,Vf=357.5291,jf=.98560028,Hf=280.147,Wf=360.9856235;function Xf(e,t,i){let r=Df*-i,n=Df*t,s=function(e){return function(e){return("number"==typeof e?e:e.getTime())/kf-.5+Uf}(e)-Gf}(e),o=function(e){let t=function(e){return Df*(Vf+jf*e)}(e),i=function(e){let t=e,i=Df*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t)),r=102.9372*Df;return t+i+r+Math.PI}(t);return{declination:$f(i,0),rightAscension:Kf(i,0)}}(s),a=function(e,t){return Df*(Hf+Wf*e)-t}(s,r)-o.rightAscension;return{azimuth:Jf(a,n,o.declination),altitude:Yf(a,n,o.declination)}}function qf(e,t,i){let{azimuth:r,altitude:n}=Xf(e,t,i);return[Math.sin(r)*Math.cos(n),Math.cos(r)*Math.cos(n),-Math.sin(n)]}function Kf(e,t){let i=e;return Math.atan2(Math.sin(i)*Math.cos(zf)-Math.tan(t)*Math.sin(zf),Math.cos(i))}function $f(e,t){let i=e;return Math.asin(Math.sin(t)*Math.cos(zf)+Math.cos(t)*Math.sin(zf)*Math.sin(i))}function Jf(e,t,i){let r=e,n=t,s=i;return Math.atan2(Math.sin(r),Math.cos(r)*Math.sin(n)-Math.tan(s)*Math.cos(n))}function Yf(e,t,i){let r=e,n=t,s=i;return Math.asin(Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos(r))}var Zf=class extends ef{constructor(e){super(e),this.timestamp=e.timestamp}getProjectedLight({layer:e}){let{viewport:t}=e.context;if(t.resolution&&t.resolution>0){let[e,t,i]=qf(this.timestamp,0,0);this.direction=[e,-i,t]}else{let{latitude:e,longitude:i}=t;this.direction=qf(this.timestamp,e,i)}return this}},Qf=1,ep=1,tp=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:n=1}=e,s=Qf++,o={time:0,delay:t,duration:i,rate:r,repeat:n};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(let[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;let t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);let t=this.channels.values();for(let e of t)this._setChannelTime(e,this.time);let i=this.animations.values();for(let e of i){let{animation:t,channel:i}=e;t.setTime(this.getTime(i))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let i=ep++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let i=t-e.delay;i>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}},ip=0,rp={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Fr.stats.get("animation-loop-"+ip++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},np=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){this.id=e.id||_r("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&Lr(this.indices.usage===Ar.INDEX)}destroy(){this.indices?.destroy();for(let e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}};function sp(e,t){if(t instanceof np)return t;let i=function(e,t){if(!t.indices)return;let i=t.indices.value;return e.createBuffer({usage:Ar.INDEX,data:i})}(e,t),{attributes:r,bufferLayout:n}=function(e,t){let i=[],r={};for(let[n,s]of Object.entries(t.attributes)){let t=n;switch(n){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}r[t]=e.createBuffer({data:s.value,id:`${n}-buffer`});let{value:o,size:a,normalized:l}=s;i.push({name:t,format:Nn(o,a,l)})}let n=t._calculateVertexCount(t.attributes,t.indices);return{attributes:r,bufferLayout:i,vertexCount:n}}(e,t);return new np({topology:t.topology||"triangle-list",bufferLayout:n,vertexCount:t.vertexCount,indices:i,attributes:r})}var op=class{device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new op(e),e._lumaData.defaultPipelineFactory}constructor(e){this.device=e}createRenderPipeline(e){let t={...an.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){let e=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=i,this._renderPipelineCache[i]={pipeline:e,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){let t={...cn.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){let e=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=i,this._computePipelineCache[i]={pipeline:e,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){let t=e.hash,i=e instanceof cn?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,0===i[t].useCount&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){let t=this._getHash(e.vs.source),i=e.fs?this._getHash(e.fs.source):0,r=this._getHash(JSON.stringify(e.bufferLayout));if("webgl"===this.device.type)return`${t}/${i}V-BL${r}`;{let n=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V-T${e.topology}P${n}BL${r}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}},ap=op;c(ap,"defaultProps",{...an.defaultProps});var lp=class{device;_cache={};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new lp(e),e._lumaData.defaultShaderFactory}constructor(e){this.device=e}createShader(e){let t=this._hashShader(e),i=this._cache[t];if(!i){let r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:r,useCount:0}}return i.useCount++,i.shader}release(e){let t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,0===i.useCount&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}},up=lp;c(up,"defaultProps",{...Qr.defaultProps});var hp=null,cp=null,dp=class{device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;vertexCount;instanceCount=0;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(e,t){this.props={...dp.defaultProps,...t},t=this.props,this.id=t.id||_r("model"),this.device=e,Object.assign(this.userData,t.userData);let i=Object.fromEntries(this.props.modules?.map((e=>[e.name,e]))||[]);this.setShaderInputs(t.shaderInputs||new class{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(e){let t=Hi(Object.values(e));dr.log(1,"Creating ShaderInputs with modules",t.map((e=>e.name)))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(let[t,i]of Object.entries(e)){let e=t;this.moduleUniforms[e]=i.defaultUniforms||{},this.moduleBindings[e]={}}}destroy(){}setProps(e){for(let t of Object.keys(e)){let i=t,r=e[i],n=this.modules[i];if(!n){dr.warn(`Module ${t} not found`)();continue}let s=this.moduleUniforms[i],o=n.getUniforms?.(r,this.moduleUniforms[i])||r;this.moduleUniforms[i]={...s,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){let e={};for(let t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){let e={};for(let[t,i]of Object.entries(this.moduleUniforms))for(let[r,n]of Object.entries(i))e[`${t}.${r}`]={type:this.modules[t].uniformTypes?.[r],value:String(n)};return e}}(i));let r=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),n=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){this.props.shaderLayout||=to(this.props.source);let{source:e,getUniforms:t}=this.props.shaderAssembler.assembleShader({platformInfo:r,...this.props,modules:n});this.source=e,this._getModuleUniforms=t}else{let{vs:e,fs:t,getUniforms:i}=this.props.shaderAssembler.assembleShaderPair({platformInfo:r,...this.props,modules:n});this.vs=e,this.fs=t,this._getModuleUniforms=i}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||ap.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||up.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),t.vertexCount&&this.setVertexCount(t.vertexCount),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&this.updateModuleSettings(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t;this.predraw();try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),vr(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:i}=this.vertexArray,r=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){this._gpuGeometry?.destroy();let t=e&&sp(this.device,e);t&&(this.setTopology(t.topology||"triangle-list"),this.bufferLayout=pp(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)),this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?pp(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Gn(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setInstanceCount(e){this.instanceCount=e,this.setNeedsRedraw("instanceCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[t,i]of Object.entries(e)){let e=t,r=new Bn(i.uniformTypes||{});this.uniformBufferLayouts.set(e,r);let n=new Ln({name:t});n.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(e,n)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,i]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){let t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);let r=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:Ar.UNIFORM|Ar.COPY_DST,byteLength:r}),s=this.getUniformBufferData(t);return n.write(s),n}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Ar.UNIFORM|Ar.COPY_DST,byteLength:i});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let i=this.updateUniformBuffer(t);e||=i}return e&&dr.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),i=!1;if(this.uniformBuffers.get(e)&&t.needsRedraw){i||=t.needsRedraw;let r=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(r);let n=this.uniformBlocks.get(e).getAllUniforms();dr.log(4,`Writing to uniform buffer ${String(e)}`,r,n)()}return i}}(this.shaderInputs.modules);for(let e of Object.keys(this.shaderInputs.modules)){let t=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=t}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){e.indices&&dr.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(let[i,r]of Object.entries(e)){let e=this.bufferLayout.find((e=>gp(e).includes(i)));if(!e){dr.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}let n=gp(e),s=!1;for(let e of n){let t=this._attributeInfos[e];t&&(this.vertexArray.setBuffer(t.location,r),s=!0)}!s&&!(t?.disableWarnings??this.props.disableWarnings)&&dr.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(let[i,r]of Object.entries(e)){let e=this._attributeInfos[i];e?this.vertexArray.setConstantWebGL(e.location,r):(t?.disableWarnings??this.props.disableWarnings)||dr.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){vr(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){let{bindings:t,uniforms:i}=Dn(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(let t of Object.values(this.bindings))t instanceof Xr?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ar||t instanceof Hr?e=Math.max(e,t.updateTimestamp):t instanceof rn||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let t={...e.attributes};for(let[e]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find((t=>t.name===e))&&"positions"!==e&&delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(dr.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders}),r=null;this.source?r=i:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:i,fs:r}),this._attributeInfos=yn(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=dr.level>3?0:1e4;dr.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,dr.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:dr.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=function(e,t){let i={},r="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[r]:"N/A"}};for(let t of e.attributes)t&&(i[`in ${t.location} ${t.name}: ${t.type}`]={[r]:t.stepMode||"vertex"});for(let t of e.varyings||[])i[`out ${t.location} ${t.name}`]={[r]:JSON.stringify(t.accessor)};return i}(this.pipeline.shaderLayout,this.id);dr.table(2,e)();let t=this.shaderInputs.getDebugTable();for(let[e,i]of Object.entries(this.uniforms))t[e]={value:i};dr.table(2,t)();let i=this._getAttributeDebugTable();dr.table(2,this._attributeInfos)(),dr.table(2,i)(),dr.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let t=dr.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;let i=e.props.framebuffer;i&&function(e,{id:t,minimap:i,opaque:r,top:n="0",left:s="0",rgbaScale:o=1}){hp||((hp=document.createElement("canvas")).id=t,hp.title=t,hp.style.zIndex="100",hp.style.position="absolute",hp.style.top=n,hp.style.left=s,hp.style.border="blue 1px solid",hp.style.transform="scaleY(-1)",document.body.appendChild(hp),cp=hp.getContext("2d")),(hp.width!==e.width||hp.height!==e.height)&&(hp.width=e.width/2,hp.height=e.height/2,hp.style.width="400px",hp.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),l=cp.createImageData(e.width,e.height);for(let e=0;e<a.length;e+=4)l.data[0+e+0]=a[e+0]*o,l.data[0+e+1]=a[e+1]*o,l.data[0+e+2]=a[e+2]*o,l.data[0+e+3]=r?255:a[e+3]*o;cp.putImageData(l,0,0)}(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[t,i]of Object.entries(this._attributeInfos))e[i.location]={name:t,type:i.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[i.location],i.bufferDataType)};if(this.vertexArray.indexBuffer){let{indexBuffer:t}=this.vertexArray,i="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){let i=Fn(t);return(e instanceof Ar?new i(e.debugData):e).toString()}},fp=dp;function pp(e,t){let i=[...e];for(let e of t){let t=i.findIndex((t=>t.name===e.name));t<0?i.push(e):i[t]=e}return i}function gp(e){return e.attributes?e.attributes?.map((e=>e.attribute)):[e.name]}c(fp,"defaultProps",{...an.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:hr.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});var mp=class{device;model;transformFeedback;static isSupported(e){return"webgl"===e?.info?.type}constructor(e,t=fp.defaultProps){Lr(mp.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new fp(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||cr(),topology:t.topology||"point-list",...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){let t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let t=this.getBuffer(e);if(t instanceof Ar)return t.readAsync();let{buffer:i,byteOffset:r=0,byteLength:n=i.byteLength}=t;return i.readAsync(r,n)}},_p=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new fp(this.device,{id:t.id||"texture-transform-model",fs:t.fs||cr({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:"transform_output"}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){}delete(){this.destroy()}run(e){let{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getData({packed:e=!1}={}){throw new Error("getData() not implemented")}getTargetTexture(){let{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:r}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),r){e.targetTexture=r;let{width:t,height:i}=r;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:t,height:i,colorAttachments:[r]}),e.framebuffer.resize({width:t,height:i})}return e}_setSourceTextureParameters(){let e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(let e in t)t[e].sampler=this.sampler}},vp=class{id;topology;vertexCount;indices;attributes;userData={};constructor(e){let{attributes:t={},indices:i=null,vertexCount:r=null}=e;this.id=e.id||_r("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(let[e,i]of Object.entries(t)){let t=ArrayBuffer.isView(i)?{value:i}:i;Lr(ArrayBuffer.isView(t.value),`${this._print(e)}: must be typed array or object with value as typed array`),("POSITION"===e||"positions"===e)&&!t.size&&(t.size=3),"indices"===e?(Lr(!this.indices),this.indices=t):this.attributes[e]=t}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(let t of Object.values(e)){let{value:e,size:r,constant:n}=t;!n&&e&&r>=1&&(i=Math.min(i,e.length/r))}return Lr(Number.isFinite(i)),i}},yp=[-1,-1,1,-1,-1,1,1,1],bp=class extends fp{constructor(e,t){let i=yp.map((e=>-1===e?0:e));super(e,{...t,vs:"#version 300 es\nin vec2 aClipSpacePosition;\nin vec2 aTexCoord;\nin vec2 aCoordinate;\nout vec2 position;\nout vec2 coordinate;\nout vec2 uv;\nvoid main(void) {\ngl_Position = vec4(aClipSpacePosition, 0., 1.);\nposition = aClipSpacePosition;\ncoordinate = aCoordinate;\nuv = aTexCoord;\n}\n",vertexCount:4,geometry:new vp({topology:"triangle-strip",vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(yp)},aTexCoord:{size:2,value:new Float32Array(i)},aCoordinate:{size:2,value:new Float32Array(i)}}})})}},Ap=class{id;matrix=new Oh;display=!0;position=new Rl;rotation=new Rl;scale=new Rl(1,1,1);userData={};props={};constructor(e={}){let{id:t}=e;this.id=t||_r(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return Lr(3===e.length,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Lr(3===e.length,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Lr(3===e.length,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:i,scale:r,update:n=!0}=e;return t&&this.setPosition(t),i&&this.setRotation(i),r&&this.setScale(r),n&&this.updateMatrix(),this}updateMatrix(){let e=this.position,t=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(i),this}update(e={}){let{position:t,rotation:i,scale:r}=e;return t&&this.setPosition(t),i&&this.setRotation(i),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,t){Lr(e),t=t||this.matrix;let i=new Oh(e).multiplyRight(t),r=i.invert(),n=r.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:i,worldInverseMatrix:r,worldInverseTransposeMatrix:n}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}},Ep=class extends Ap{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;let{children:t=[]}=e;dr.assert(t.every((e=>e instanceof Ap)),"every child must an instance of ScenegraphNode"),super(e),this.children=t}getBounds(){let e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse(((t,{worldMatrix:i})=>{let r=t.getBounds();if(!r)return;let[n,s]=r,o=new Rl(n).add(s).divide([2,2,2]);i.transformAsPoint(o,o);let a=new Rl(s).subtract(n).divide([2,2,2]);i.transformAsVector(a,a);for(let t=0;t<8;t++){let i=new Rl(1&t?-1:1,2&t?-1:1,4&t?-1:1).multiply(a).add(o);for(let t=0;t<3;t++)e[0][t]=Math.min(e[0][t],i[t]),e[1][t]=Math.max(e[1][t],i[t])}})),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach((e=>e.destroy())),this.removeAll(),super.destroy()}add(...e){for(let t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(e){let t=this.children,i=t.indexOf(e);return i>-1&&t.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:t=new Oh}={}){let i=new Oh(t).multiplyRight(this.matrix);for(let t of this.children)t instanceof Ep?t.traverse(e,{worldMatrix:i}):e(t,{worldMatrix:i})}},wp=class extends Ap{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach((e=>e.destroy())),this.managedResources=[]}draw(e){return this.model.draw(e)}},xp=class extends vp{constructor(e={}){let{id:t=_r("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:t,topology:"triangle-list",indices:{size:1,value:Tp},attributes:{...Bp,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...Lp,...e.attributes}})}},Tp=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Cp=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Sp=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Pp=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Mp=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Rp=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),Ip=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),Bp={POSITION:{size:3,value:Cp},NORMAL:{size:3,value:Sp},TEXCOORD_0:{size:2,value:Pp}},Lp={POSITION:{size:3,value:Mp},TEXCOORD_0:{size:2,value:Rp},COLOR_0:{size:3,value:Ip}},Op=class extends vp{constructor(e={}){let{id:t=_r("sphere-geometry")}=e,{indices:i,attributes:r}=function(e){let{nlat:t=10,nlong:i=10}=e,r=Math.PI-0,n=0,s=2*Math.PI-n,o=(t+1)*(i+1),a=(t,i,r,n,s)=>e.radius||1,l=new Float32Array(3*o),u=new Float32Array(3*o),h=new Float32Array(2*o),c=new(o>65535?Uint32Array:Uint16Array)(t*i*6);for(let e=0;e<=t;e++)for(let n=0;n<=i;n++){let o=n/i,c=e/t,d=n+e*(i+1),f=2*d,p=3*d,g=s*o,m=r*c,_=Math.sin(g),v=Math.cos(g),y=Math.sin(m),b=v*y,A=Math.cos(m),E=_*y,w=a();l[p+0]=w*b,l[p+1]=w*A,l[p+2]=w*E,u[p+0]=b,u[p+1]=A,u[p+2]=E,h[f+0]=o,h[f+1]=1-c}let d=i+1;for(let e=0;e<i;e++)for(let i=0;i<t;i++){let r=6*(e*t+i);c[r+0]=i*d+e,c[r+1]=i*d+e+1,c[r+2]=(i+1)*d+e,c[r+3]=(i+1)*d+e,c[r+4]=i*d+e+1,c[r+5]=(i+1)*d+e+1}return{indices:{size:1,value:c},attributes:{POSITION:{size:3,value:l},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:h}}}}(e);super({...e,id:t,topology:"triangle-list",indices:i,attributes:{...r,...e.attributes}})}},Fp=class extends tf{constructor(e,t){super(e,t);let{module:i,fs:r,id:n}=t;this.model=new bp(e,{id:n,fs:r,modules:[i],parameters:{depthWriteEnabled:!1,depthCompare:"always"}})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,t){let{clearCanvas:i,inputBuffer:r,outputBuffer:n}=t,s=[r.width,r.height];this.model.shaderInputs.setProps(t.moduleSettings),this.model.setBindings({texSrc:r.colorAttachments[0]}),this.model.setUniforms({texSize:s});let o=this.device.beginRenderPass({framebuffer:n,parameters:{viewport:[0,0,...s]},clearColor:!!i&&[0,0,0,0],clearDepth:1});this.model.draw(o),o.end()}},Np=class{constructor(e,t){this.id=`${e.name}-pass`,this.props=t,function(e){if(!e.normalized&&(e.normalized=!0,e.uniformPropTypes&&!e.getUniforms)){let t=new zi(e);e.getUniforms=t.getUniforms.bind(t)}}(e),this.module=e}setup({device:e}){this.passes=function(e,t,i){return t.passes.map(((r,n)=>{let s=function(e,t){if(t.filter){let i="string"==typeof t.filter?t.filter:`${e.name}_filterColor`;return kp(i)}if(t.sampler){let i="string"==typeof t.sampler?t.sampler:`${e.name}_sampleColor`;return Up(i)}return""}(t,r);return new Fp(e,{id:`${i}-${n}`,module:t,fs:s})}))}(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){let t=this.passes,{target:i}=e,r=e.inputBuffer,n=e.swapBuffer;for(let s=0;s<t.length;s++){let o=s===t.length-1,a=void 0!==i&&o;a&&(n=i);let l=!a||Boolean(e.clearCanvas),u={};u[this.module.name]=this.props,t[s].render({clearCanvas:l,inputBuffer:r,outputBuffer:n,moduleSettings:u});let h=n;n=r,r=h}return r}cleanup(){if(this.passes){for(let e of this.passes)e.delete();this.passes=void 0}}},Dp="#version 300 es\nuniform sampler2D texSrc;\nuniform vec2 texSize;\n\nin vec2 position;\nin vec2 coordinate;\nin vec2 uv;\n\nout vec4 fragColor;\n",kp=e=>`${Dp}\nvoid main() {\n  fragColor = texture(texSrc, coordinate);\n  fragColor = ${e}(fragColor, texSize, coordinate);\n}\n`,Up=e=>`${Dp}\nvoid main() {\n  fragColor = ${e}(texSrc, texSize, coordinate);\n}\n`,Gp={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},zp=class extends rf{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:r,onViewportActive:n,pickingFBO:s,deviceRect:{x:o,y:a,width:l,height:u},cullRect:h,effects:c,pass:d="picking",pickZ:f,moduleParameters:p}){this.pickZ=f;let g=this._resetColorEncoder(f),m=[o,a,l,u],_=super.render({target:s,layers:e,layerFilter:t,views:i,viewports:r,onViewportActive:n,cullRect:h,effects:c?.filter((e=>e.useInPicking)),pass:d,isPicking:!0,moduleParameters:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:g&&Vp.bind(null,g),stats:_}}shouldDrawLayer(e){let{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,t,i){let r={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:n,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?r.blend=!1:n&&s.includes("draw")&&(Object.assign(r,Gp),r.blend=!0,r.blendColor=function(e,t,i){let r,{byLayer:n,byAlpha:s}=e,o=n.get(t);return o?(o.viewports.push(i),r=o.a):(r=n.size+1,r<=255?(o={a:r,layer:t,viewports:[i]},n.set(t,o),s[r]=o):(wi.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}(this._colorEncoderState,e,i)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function Vp(e,t){let i=e.byAlpha[t[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(t)}}var jp="Awaiting state",Hp="Matched. State transferred from previous layer",Wp="Initialized",Xp="Discarded. Awaiting garbage collection",qp="No longer matched. Awaiting garbage collection",Kp="Finalized! Awaiting garbage collection",$p=Symbol.for("component"),Jp=Symbol.for("propTypes"),Yp=Symbol.for("deprecatedProps"),Zp=Symbol.for("asyncPropDefaults"),Qp=Symbol.for("asyncPropOriginal"),eg=Symbol.for("asyncPropResolved");function tg(e,t=(()=>!0)){return Array.isArray(e)?ig(e,t,[]):t(e)?[e]:[]}function ig(e,t,i){let r=-1;for(;++r<e.length;){let n=e[r];Array.isArray(n)?ig(n,t,i):t(n)&&i.push(n)}return i}function rg({target:e,source:t,start:i=0,count:r=1}){let n=t.length,s=r*n,o=0;for(let r=i;o<n;o++)e[r++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(i+o,i,i+o),o*=2):(e.copyWithin(i+o,i,i+s-o),o=s);return e}var ng=class{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{Ci("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};let{deck:i,stats:r,viewport:n,timeline:s}=t||{};this.layers=[],this.resourceManager=new class{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:r=!0}){let n=this._resources[e];n?n.setData(t,i):(n=new class{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(e,t){if(e===this._data&&!t)return;this._data=e;let i=++this._loadCount,r=e;"string"==typeof e&&(r=Zt(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then((e=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=e)})).catch((e=>{this._loadCount===i&&(this.isLoaded=!0,this._error=e||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=e);for(let e of this._subscribers)e.onChange(this.getData())}}(e,t,this._context),this._resources[e]=n),n.persistent=r}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let e in t){let i=t[e],r=this._resources[i.resourceId];r&&r.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:r="default"}){let{_resources:n,protocol:s}=this;e.startsWith(s)&&(n[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));let o=n[e];if(this._track(i,r,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,i,r){let n=this._consumers,s=n[e]=n[e]||{},o=s[t],a=o&&o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),i&&(o?(o.onChange=r,o.resourceId=i.id):o={onChange:r,resourceId:i.id},s[t]=o,i.subscribe(o))}_prune(){this._pruneRequest=null;for(let e of Object.keys(this._resources)){let t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:Wd(),defaultShaderModules:[],renderPass:void 0,stats:r||new _e({id:"deck.gl"}),viewport:n||new wf({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new tp,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(let i of this.layers){let r=i.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter((t=>e.find((e=>0===t.id.indexOf(e))))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Ci("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;let i=tg(e,Boolean);for(let e of i)e.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:t}=this.context;t.find((t=>t.name===e.name))||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:t}=this.context,i=t.findIndex((t=>t.name===e.name));i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){let i={};for(let t of e)i[t.id]?wi.warn(`Multiple old layers with same id ${t.id}`)():i[t.id]=t;if(this._defaultShaderModulesChanged){for(let t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let r=[];this._updateSublayersRecursively(t,i,r),this._finalizeOldLayers(i);let n=!1;for(let e of r)if(e.hasUniformTransition()){n=`Uniform transition in ${e}`;break}this._needsUpdate=n,this.layers=r}_updateSublayersRecursively(e,t,i){for(let r of e){r.context=this.context;let e=t[r.id];null===e&&wi.warn(`Multiple new layers with same id ${r.id}`)(),t[r.id]=null;let n=null;try{this._debug&&e!==r&&r.validateProps(),e?(this._transferLayerState(e,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),n=r.isComposite?r.getSubLayers():null}catch(e){this._handleError("matching",e,r)}n&&this._updateSublayersRecursively(n,t,i)}}_finalizeOldLayers(e){for(let t in e){let i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Wp}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Hp,t!==e&&(e.lifecycle=Xp)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=qp;try{e._finalize(),e.lifecycle=Kp}catch(t){this._handleError("finalization",t,e)}}};function sg(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!sg(e[r],t[r],i-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let n of r)if(!t.hasOwnProperty(n)||!sg(e[n],t[n],i-1))return!1;return!0}return!1}var og=/([0-9]+\.?[0-9]*)(%|px)/;function ag(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=og.exec(e);if(t&&t.length>=3){let e="%"===t[2],i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function lg(e,t){return e.relative?Math.round(e.position*t):e.position}var ug=class{constructor(e={}){let{id:t,x:i=0,y:r=0,width:n="100%",height:s="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ag(i),this._y=ag(r),this._width=ag(n),this._height=ag(s),this._padding=o&&{left:ag(o.left||0),right:ag(o.right||0),top:ag(o.top||0),bottom:ag(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.ViewportType===e.ViewportType&&sg(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);let r=this.getDimensions({width:e,height:t});return r.height&&r.width?new this.ViewportType({...i,...this.props,...r}):null}getViewStateId(){let{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){let i={x:lg(this._x,e),y:lg(this._y,t),width:lg(this._width,e),height:lg(this._height,t)};return this._padding&&(i.padding={left:lg(this._padding.left,e),top:lg(this._padding.top,t),right:lg(this._padding.right,e),bottom:lg(this._padding.bottom,t)}),i}get controller(){let e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}},hg=class{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){let{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}},cg=()=>{},dg={BREAK:1,SNAP_TO_END:2,IGNORE:3},fg=e=>e,pg=dg.BREAK;function gg(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var mg=class{constructor(e){let{compare:t,extract:i,required:r}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=r}arePropsEqual(e,t){for(let i of this._propsToCompare)if(!(i in e)||!(i in t)||!xo(e[i],t[i]))return!1;return!0}initializeProps(e,t){let i={},r={};for(let n of this._propsToExtract)(n in e||n in t)&&(i[n]=e[n],r[n]=t[n]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach((t=>{let i=e[t];gg(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)}))}},_g=["longitude","latitude","zoom","bearing","pitch"],vg=["longitude","latitude","zoom"],yg=class extends mg{constructor(e={}){let t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:_g,required:vg},super(i.transitionProps),this.opts=i}initializeProps(e,t){let i=super.initializeProps(e,t),{makeViewport:r,around:n}=this.opts;if(r&&n){let s=r(e),o=r(t),a=s.unproject(n);i.start.around=n,Object.assign(i.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){let r={};for(let n of this._propsToExtract)r[n]=wo(e[n]||0,t[n]||0,i);if(t.aroundPosition&&this.opts.makeViewport){let n=this.opts.makeViewport({...t,...r});Object.assign(r,n.panByPosition(t.aroundPosition,wo(e.around,t.around,i)))}return r}},bg={transitionDuration:0},Ag=e=>1-(1-e)*(1-e),Eg=["wheel"],wg=["panstart","panmove","panend"],xg=["pinchstart","pinchmove","pinchend"],Tg=["tripanstart","tripanmove","tripanend"],Cg=["doubletap"],Sg=["keydown"],Pg={},Mg=class{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new class{constructor(e){this._onTransitionUpdate=e=>{let{time:t,settings:{interpolator:i,startProps:r,endProps:n,duration:s,easing:o}}=e,a=o(t/s),l=i.interpolateProps(r,n,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new hg(e.timeline),this.onViewStateChange=e.onViewStateChange||cg,this.onStateChange=e.onStateChange||cg}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){let{interruption:e,endProps:t}=this.transition.settings;r={...i,...e===dg.SNAP_TO_END?t:this.propsInTransition||i}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||"auto"===t)&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===dg.IGNORE||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){let i=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(i),n=t.transitionInterpolator,s=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(0===s)return;let o=n.initializeProps(e,r);this.propsInTransition={};let a={duration:s,easing:t.transitionEasing||fg,interpolator:n,interruption:t.transitionInterruption||pg,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!t&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:i}=this.props,{offsetCenter:r}=e;return[r.x-t,r.y-i]}isPointInBounds(e,t){let{width:i,height:r}=this.props;if(t&&t.handled)return!1;let n=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return n&&t&&t.stopPropagation(),n}isFunctionKeyPressed(e){let{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout((()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)}),e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;let{scrollZoom:i=!0,dragPan:r=!0,dragRotate:n=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=e,u=Boolean(this.onViewStateChange);this.toggleEvents(Eg,u&&i),this.toggleEvents(wg,u),this.toggleEvents(xg,u&&(o||a)),this.toggleEvents(Tg,u&&a),this.toggleEvents(Cg,u&&s),this.toggleEvents(Sg,u&&l),this.scrollZoom=i,this.dragPan=r,this.dragRotate=n,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach((e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))}))}updateViewport(e,t=null,i={}){let r={...e.getViewportProps(),...t},n=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),n){let e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:e})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(i=!i);let r=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(r,bg,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,bg,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let i=this.getCenter(e),r=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],n=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ag},{isDragging:!1,isPanning:!0})}else{let e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,bg,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let i=this.getCenter(e),r=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],n=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ag},{isDragging:!1,isRotating:!0})}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();let{speed:i=.01,smooth:r=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:n}=e,s=2/(1+Math.exp(-Math.abs(n*i)));n<0&&0!==s&&(s=1/s);let o=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(o,{...this._getTransitionProps({around:t}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,bg,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let i=this.controllerState.rotate({pos:t});return this.updateViewport(i,bg,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*t/2],n=this.controllerState.rotate({pos:r});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ag},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Pg._startPinchRotation=e.rotation,Pg._lastPinchEvent=e,this.updateViewport(i,bg,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:i}=e,r=this.getCenter(e);t=t.zoom({pos:r,scale:i})}if(this.touchRotate){let{rotation:i}=e;t=t.rotate({deltaAngleX:Pg._startPinchRotation-i})}return this.updateViewport(t,bg,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pg._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:i}=Pg;if(this.touchZoom&&t&&i&&e.scale!==i.scale){let r=this.getCenter(e),n=this.controllerState.rotateEnd(),s=Math.log2(e.scale),o=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),a=Math.pow(2,s+o*t/2);n=n.zoom({pos:r,scale:a}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:r}),transitionDuration:t,transitionEasing:Ag},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pg._startPinchRotation=null,Pg._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;let t,i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:o}=!0===this.keyboard?{}:this.keyboard,{controllerState:a}=this,l={};switch(e.srcEvent.code){case"Minus":t=i?a.zoomOut(r).zoomOut(r):a.zoomOut(r),l.isZooming=!0;break;case"Equal":t=i?a.zoomIn(r).zoomIn(r):a.zoomIn(r),l.isZooming=!0;break;case"ArrowLeft":i?(t=a.rotateLeft(s),l.isRotating=!0):(t=a.moveLeft(n),l.isPanning=!0);break;case"ArrowRight":i?(t=a.rotateRight(s),l.isRotating=!0):(t=a.moveRight(n),l.isPanning=!0);break;case"ArrowUp":i?(t=a.rotateUp(o),l.isRotating=!0):(t=a.moveUp(n),l.isPanning=!0);break;case"ArrowDown":i?(t=a.rotateDown(o),l.isRotating=!0):(t=a.moveDown(n),l.isPanning=!0);break;default:return!1}return this.updateViewport(t,this._getTransitionProps(),l),!0}_getTransitionProps(e){let{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new yg({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:bg}},Rg=class{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}},Ig=class extends Rg{constructor(e){let{width:t,height:i,latitude:r,longitude:n,zoom:s,bearing:o=0,pitch:a=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:c=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:v,startZoom:y,normalize:b=!0}=e;gg(Number.isFinite(n)),gg(Number.isFinite(r)),gg(Number.isFinite(s)),super({width:t,height:i,latitude:r,longitude:n,zoom:s,bearing:o,pitch:a,altitude:l,maxZoom:h,minZoom:c,maxPitch:d,minPitch:f,normalize:b,position:u},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:v,startZoom:y}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;let r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let r,{startRotatePos:n,startBearing:s,startPitch:o}=this.getState();return n&&void 0!==s&&void 0!==o?(r=e?this._getNewRotation(e,n,o,s):{bearing:s+t,pitch:o+i},this._getUpdatedState(r)):this}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:r,startZoomLngLat:n}=this.getState();if(n||(r=this.getViewportProps().zoom,n=this._unproject(t)||this._unproject(e)),!n)return this;let{maxZoom:s,minZoom:o}=this.getViewportProps(),a=r+Math.log2(i);a=Eo(a,o,s);let l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:n}=i;return Math.abs(r-t.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(n-t.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:r}=e;e.zoom=Eo(r,i,t);let{maxPitch:n,minPitch:s,pitch:o}=e;e.pitch=Eo(o,s,n);let{normalize:a=!0}=e;return a&&Object.assign(e,function(e){let{width:t,height:i,pitch:r=0}=e,{longitude:n,latitude:s,zoom:o,bearing:a=0}=e;(n<-180||n>180)&&(n=sd(n+180,360)-180),(a<-180||a>180)&&(a=sd(a+180,360)-180);let l=ld(i/512);if(o<=l)o=l,s=0;else{let e=i/2/Math.pow(2,o),t=Ad([0,e])[1];if(s<t)s=t;else{let t=Ad([0,512-e])[1];s>t&&(s=t)}}return{width:t,height:i,longitude:n,latitude:s,zoom:o,pitch:r,bearing:a}}(e)),e}_zoomFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,r){let n=e[0]-t[0],s=e[1]-t[1],o=e[1],a=t[1],{width:l,height:u}=this.getViewportProps(),h=n/l,c=0;s>0?Math.abs(u-a)>5&&(c=s/(a-u)*1.2):s<0&&a>5&&(c=1-o/a),c=Eo(c,-1,1);let{minPitch:d,maxPitch:f}=this.getViewportProps(),p=i;return c>0?p=i+c*(f-i):c<0&&(p=i-c*(d-i)),{pitch:p,bearing:r+180*h}}},Bg=class extends Mg{constructor(){super(...arguments),this.ControllerState=Ig,this.transition={transitionDuration:300,transitionInterpolator:new yg({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}},Lg=class extends ug{get ViewportType(){return Tf}get ControllerType(){return Bg}},Og=Lg;Lg.displayName="MapView";var Fg=new uf,Ng=class extends rf{shouldDrawLayer(e){let{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}},Dg=class{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Ng(e),this.pickLayersPass=new zp(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);let r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);let n=t.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ci("deckRenderer.renderLayers",this,n,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(let i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();0===e.length&&[0,1].map((t=>{let i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[i]}))}));for(let i of e)i.resize(t)}_postRender(e,t){let{renderBuffers:i}=this,r={...t,inputBuffer:i[0],swapBuffer:i[1]};for(let n of e)if(n.postRender){r.target=n.id===this.lastPostProcessEffect?t.target:void 0;let e=n.postRender(r);r.inputBuffer=e,r.swapBuffer=e===i[0]?i[1]:i[0]}}},kg={pickedColor:null,pickedObjectIndex:-1};function Ug({pickedColors:e,decodePickingColor:t,deviceX:i,deviceY:r,deviceRadius:n,deviceRect:s}){let{x:o,y:a,width:l,height:u}=s,h=n*n,c=-1,d=0;for(let t=0;t<u;t++){let n=t+a-r,s=n*n;if(s>h)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){let e=t+o-i,r=e*e+s;r<=h&&(h=r,c=d)}d+=4}}if(c>=0){let i=e.slice(c,c+4),r=t(i);if(r){let e=Math.floor(c/4/l),t=c/4-e*l;return{...r,pickedColor:i,pickedX:o+t,pickedY:a+e}}wi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return kg}function Gg({pickInfo:e,viewports:t,pixelRatio:i,x:r,y:n,z:s}){let o,a=t[0];if(t.length>1&&(a=function(e,t){for(let i=e.length-1;i>=0;i--){let r=e[i];if(r.containsPixel(t))return r}return e[0]}(e?.pickedViewports||t,{x:r,y:n})),a){let e=[r-a.x,n-a.y];void 0!==s&&(e[2]=s),o=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:r,y:n,pixel:[r,n],coordinate:o,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:i}}function zg(e){let{pickInfo:t,lastPickedInfo:i,mode:r,layers:n}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=t,l=o?[o]:[];if("hover"===r){let e=i.index,t=i.layerId,r=o?o.props.id:null;if(r!==t||a!==e){if(r!==t){let e=n.find((e=>e.props.id===t));e&&l.unshift(e)}i.layerId=r,i.index=a,i.info=null}}let u=Gg(e),h=new Map;return h.set(null,u),l.forEach((e=>{let t={...u};e===o&&(t.color=s,t.index=a,t.picked=!0),t=Vg({layer:e,info:t,mode:r});let n=t.layer;e===o&&"hover"===r&&(i.info=t),h.set(n.id,t),"hover"===r&&n.updateAutoHighlight(t)})),h}function Vg({layer:e,info:t,mode:i}){for(;e&&t;){let r=t.layer||null;t.sourceLayer=r,t.layer=e,t=e.getPickingInfo({info:t,mode:i,sourceLayer:r}),e=e.parent}return t}var jg,Hg={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Wg="top-left",Xg="__root",qg={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(jg||(jg={}));var Kg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},$g=(e,t,i)=>t?e.enable(i):e.disable(i),Jg=(e,t,i)=>e.hint(i,t),Yg=(e,t,i)=>e.pixelStorei(i,t),Zg=(e,t,i)=>{let r=36006===i?36009:36008;return e.bindFramebuffer(r,t)},Qg=(e,t,i)=>{let r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];e.bindBuffer(r,t)};function em(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}var tm={3042:$g,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:$g,2885:(e,t)=>e.cullFace(t),2929:$g,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:$g,35723:Jg,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:Zg,36010:Zg,34964:Qg,36662:Qg,36663:Qg,35053:Qg,35055:Qg,2886:(e,t)=>e.frontFace(t),33170:Jg,2849:(e,t)=>e.lineWidth(t),32823:$g,32824:"polygonOffset",10752:"polygonOffset",35977:$g,32926:$g,32928:$g,32938:"sampleCoverage",32939:"sampleCoverage",3089:$g,3088:(e,t)=>e.scissor(...t),2960:$g,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:$g,10754:$g,12288:$g,12289:$g,12290:$g,12291:$g,12292:$g,12293:$g,12294:$g,12295:$g,3333:Yg,3317:Yg,37440:Yg,37441:Yg,37443:Yg,3330:Yg,3332:Yg,3331:Yg,3314:Yg,32878:Yg,3316:Yg,3315:Yg,32877:Yg,framebuffer:(e,t)=>{let i=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,i)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{let i="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...i)},blendFunc:(e,t)=>{let i=2===t?.length?[...t,...t]:t;e.blendFuncSeparate(...i)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=em(t)?t:[t,t];let[i,r]=t;e.stencilMaskSeparate(1028,i),e.stencilMaskSeparate(1029,r)},stencilFunc:(e,t)=>{t=em(t)&&3===t.length?[...t,...t]:t;let[i,r,n,s,o,a]=t;e.stencilFuncSeparate(1028,i,r,n),e.stencilFuncSeparate(1029,s,o,a)},stencilOp:(e,t)=>{t=em(t)&&3===t.length?[...t,...t]:t;let[i,r,n,s,o,a]=t;e.stencilOpSeparate(1028,i,r,n),e.stencilOpSeparate(1029,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function im(e,t,i){return void 0!==t[e]?t[e]:i[e]}var rm={blendEquation:(e,t,i)=>e.blendEquationSeparate(im(32777,t,i),im(34877,t,i)),blendFunc:(e,t,i)=>e.blendFuncSeparate(im(32969,t,i),im(32968,t,i),im(32971,t,i),im(32970,t,i)),polygonOffset:(e,t,i)=>e.polygonOffset(im(32824,t,i),im(10752,t,i)),sampleCoverage:(e,t,i)=>e.sampleCoverage(im(32938,t,i),im(32939,t,i)),stencilFuncFront:(e,t,i)=>e.stencilFuncSeparate(1028,im(2962,t,i),im(2967,t,i),im(2963,t,i)),stencilFuncBack:(e,t,i)=>e.stencilFuncSeparate(1029,im(34816,t,i),im(36003,t,i),im(36004,t,i)),stencilOpFront:(e,t,i)=>e.stencilOpSeparate(1028,im(2964,t,i),im(2965,t,i),im(2966,t,i)),stencilOpBack:(e,t,i)=>e.stencilOpSeparate(1029,im(34817,t,i),im(34818,t,i),im(34819,t,i))},nm={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,i)=>e({[t]:i}),hint:(e,t,i)=>e({[t]:i}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,i)=>e({36007:i}),bindTransformFeedback:(e,t,i)=>e({36389:i}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,i)=>{switch(t){case 36160:return e({36006:i,36010:i});case 36009:return e({36006:i});case 36008:return e({36010:i});default:return null}},bindBuffer:(e,t,i)=>{let r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return r?e({[r]:i}):{valueChanged:!0}},blendColor:(e,t,i,r,n)=>e({32773:new Float32Array([t,i,r,n])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,i)=>e({32777:t,34877:i}),blendFunc:(e,t,i)=>e({32969:t,32968:i,32971:t,32970:i}),blendFuncSeparate:(e,t,i,r,n)=>e({32969:t,32968:i,32971:r,32970:n}),clearColor:(e,t,i,r,n)=>e({3106:new Float32Array([t,i,r,n])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,i,r,n)=>e({3107:[t,i,r,n]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,i)=>e({2928:new Float32Array([t,i])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,i)=>e({32824:t,10752:i}),sampleCoverage:(e,t,i)=>e({32938:t,32939:i}),scissor:(e,t,i,r,n)=>e({3088:new Int32Array([t,i,r,n])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,i)=>e({[1028===t?2968:36005]:i}),stencilFunc:(e,t,i,r)=>e({2962:t,2967:i,2963:r,34816:t,36003:i,36004:r}),stencilFuncSeparate:(e,t,i,r,n)=>e({[1028===t?2962:34816]:i,[1028===t?2967:36003]:r,[1028===t?2963:36004]:n}),stencilOp:(e,t,i,r)=>e({2964:t,2965:i,2966:r,34817:t,34818:i,34819:r}),stencilOpSeparate:(e,t,i,r,n)=>e({[1028===t?2964:34817]:i,[1028===t?2965:34818]:r,[1028===t?2966:34819]:n}),viewport:(e,t,i,r,n)=>e({2978:[t,i,r,n]})},sm=(e,t)=>e.isEnabled(t),om={3042:sm,2884:sm,2929:sm,3024:sm,32823:sm,32926:sm,32928:sm,3089:sm,2960:sm,35977:sm},am=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function lm(e,t){if(function(e){for(let t in e)return!1;return!0}(t))return;let i={};for(let r in t){let n=Number(r),s=tm[r];s&&("string"==typeof s?i[s]=!0:s(e,t[r],n))}let r=e.state&&e.state.cache;if(r)for(let n in i)(0,rm[n])(e,t,r)}function um(e,t=Kg){if("number"==typeof t){let i=t,r=om[i];return r?r(e,i):e.getParameter(i)}let i=Array.isArray(t)?t:Object.keys(t),r={};for(let t of i){let i=om[t];r[t]=i?i(e,Number(t)):e.getParameter(Number(t))}return r}function hm(e,t){if(e===t)return!0;let i=Array.isArray(e)||ArrayBuffer.isView(e),r=Array.isArray(t)||ArrayBuffer.isView(t);if(i&&r&&e.length===t.length){for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}return!1}var cm=class{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(e,{copyState:t=!1,log:i=(()=>{})}={}){this.gl=e,this.cache=t?um(e):Object.assign({},Kg),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Lr(this.stateStack.length>0);let e=this.stateStack[this.stateStack.length-1];lm(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,i=!1,r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let n in e){Lr(void 0!==n);let s=e[n],o=this.cache[n];hm(s,o)||(i=!0,t=o,r&&!(n in r)&&(r[n]=o),this.cache[n]=s)}return{valueChanged:i,oldValue:t}}};function dm(e){return e.state}function fm(e,t){let{enable:i=!0,copyState:r}=t;if(Lr(void 0!==r),!e.state){e.state=new cm(e,{copyState:r}),function(e){let t=e.useProgram.bind(e);e.useProgram=function(i){let r=dm(e);r.program!==i&&(t(i),r.program=i)}}(e);for(let t in nm)_m(e,t,nm[t]);mm(e,"getParameter"),mm(e,"isEnabled")}return dm(e).enable=i,e}function pm(e){let t=dm(e);t||(fm(e,{copyState:!1}),t=dm(e)),t.push()}function gm(e){let t=dm(e);Lr(t),t.pop()}function mm(e,t){let i=e[t].bind(e);e[t]=function(t){if(void 0===t||am.has(t))return i(t);let r=dm(e);return t in r.cache||(r.cache[t]=i(t)),r.enable?r.cache[t]:i(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function _m(e,t,i){if(!e[t])return;let r=e[t].bind(e);e[t]=function(...t){let n=dm(e),{valueChanged:s,oldValue:o}=i(n._updateCache,...t);return s&&r(...t),o},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}var vm={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function ym(e,t,i){return void 0===i[t]&&(i[t]=e.getExtension(t)||null),i[t]}function bm(e,t){let i=e.getParameter(7936),r=e.getParameter(7937);ym(e,"WEBGL_debug_renderer_info",t);let n=t.WEBGL_debug_renderer_info,s=e.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936)||i,o=e.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937)||r,a=e.getParameter(7938),l=Am(s,o),u=function(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}(s,o),h=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(Am(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(s,o);return{type:"webgl",gpu:l,gpuType:h,gpuBackend:u,vendor:s,renderer:o,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Am(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Em(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}var wm="texture-compression-bc",xm="texture-compression-astc",Tm="texture-compression-etc2",Cm="texture-compression-pvrtc-webgl",Sm="texture-compression-atc-webgl",Pm="float32-renderable-webgl",Mm="float16-renderable-webgl",Rm="snorm8-renderable-webgl",Im="norm16-renderable-webgl",Bm="snorm16-renderable-webgl",Lm="float32-filterable",Om="float16-filterable-webgl",Fm="WEBGL_compressed_texture_s3tc",Nm="WEBGL_compressed_texture_s3tc_srgb",Dm="EXT_texture_compression_rgtc",km="EXT_texture_compression_bptc",Um="EXT_texture_norm16",Gm="EXT_render_snorm",zm={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Gm],"norm16-renderable-webgl":[Um],"snorm16-renderable-webgl":[Um,Gm],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Fm,Nm,Dm,km],"texture-compression-bc5-webgl":[Dm],"texture-compression-bc7-webgl":[km],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]},Vm={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Rm},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Rm},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Mm,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Im,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Bm},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Rm},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Mm,filter:Om,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Im},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Bm},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Pm,filter:Lm},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:"rgb9e5ufloat_renderable-webgl"},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Pm,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Im},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Im},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Pm,filter:Lm,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Mm,filter:Om},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Im,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Bm},"rgb32float-webgl":{gl:34837,render:Pm,filter:Lm,gl2ext:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Pm,filter:Lm,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Fm,f:wm},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Nm,f:wm},"bc1-rgba-unorm":{gl:33777,x:Fm,f:wm},"bc1-rgba-unorm-srgb":{gl:35916,x:Nm,f:wm},"bc2-rgba-unorm":{gl:33778,x:Fm,f:wm},"bc2-rgba-unorm-srgb":{gl:35918,x:Nm,f:wm},"bc3-rgba-unorm":{gl:33779,x:Fm,f:wm},"bc3-rgba-unorm-srgb":{gl:35919,x:Nm,f:wm},"bc4-r-unorm":{gl:36283,x:Dm,f:wm},"bc4-r-snorm":{gl:36284,x:Dm,f:wm},"bc5-rg-unorm":{gl:36285,x:Dm,f:wm},"bc5-rg-snorm":{gl:36286,x:Dm,f:wm},"bc6h-rgb-ufloat":{gl:36495,x:km,f:wm},"bc6h-rgb-float":{gl:36494,x:km,f:wm},"bc7-rgba-unorm":{gl:36492,x:km,f:wm},"bc7-rgba-unorm-srgb":{gl:36493,x:km,f:wm},"etc2-rgb8unorm":{gl:37492,f:Tm},"etc2-rgb8unorm-srgb":{gl:37494,f:Tm},"etc2-rgb8a1unorm":{gl:37496,f:Tm},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Tm},"etc2-rgba8unorm":{gl:37493,f:Tm},"etc2-rgba8unorm-srgb":{gl:37495,f:Tm},"eac-r11unorm":{gl:37488,f:Tm},"eac-r11snorm":{gl:37489,f:Tm},"eac-rg11unorm":{gl:37490,f:Tm},"eac-rg11snorm":{gl:37491,f:Tm},"astc-4x4-unorm":{gl:37808,f:xm},"astc-4x4-unorm-srgb":{gl:37840,f:xm},"astc-5x4-unorm":{gl:37809,f:xm},"astc-5x4-unorm-srgb":{gl:37841,f:xm},"astc-5x5-unorm":{gl:37810,f:xm},"astc-5x5-unorm-srgb":{gl:37842,f:xm},"astc-6x5-unorm":{gl:37811,f:xm},"astc-6x5-unorm-srgb":{gl:37843,f:xm},"astc-6x6-unorm":{gl:37812,f:xm},"astc-6x6-unorm-srgb":{gl:37844,f:xm},"astc-8x5-unorm":{gl:37813,f:xm},"astc-8x5-unorm-srgb":{gl:37845,f:xm},"astc-8x6-unorm":{gl:37814,f:xm},"astc-8x6-unorm-srgb":{gl:37846,f:xm},"astc-8x8-unorm":{gl:37815,f:xm},"astc-8x8-unorm-srgb":{gl:37847,f:xm},"astc-10x5-unorm":{gl:37819,f:xm},"astc-10x5-unorm-srgb":{gl:37851,f:xm},"astc-10x6-unorm":{gl:37817,f:xm},"astc-10x6-unorm-srgb":{gl:37849,f:xm},"astc-10x8-unorm":{gl:37818,f:xm},"astc-10x8-unorm-srgb":{gl:37850,f:xm},"astc-10x10-unorm":{gl:37819,f:xm},"astc-10x10-unorm-srgb":{gl:37851,f:xm},"astc-12x10-unorm":{gl:37820,f:xm},"astc-12x10-unorm-srgb":{gl:37852,f:xm},"astc-12x12-unorm":{gl:37821,f:xm},"astc-12x12-unorm-srgb":{gl:37853,f:xm},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Cm},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Cm},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Cm},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Cm},"etc1-rbg-unorm-webgl":{gl:36196,f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{gl:35986,f:Sm},"atc-rgba-unorm-webgl":{gl:35986,f:Sm},"atc-rgbai-unorm-webgl":{gl:34798,f:Sm}},jm={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Hm={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Wm(e,t,i){let r=Vm[t];if(!r||void 0===r.gl)return!1;let n=r.x||r.gl2ext;return!n||Boolean(ym(e,n,i))}function Xm(e){let t=Vm[e]?.gl;if(void 0===t)throw new Error(`Unsupported texture format ${e}`);return t}function qm(e){let t=Vm[e],i=Xm(e),r=Sr(e);return{format:i,dataFormat:t?.dataFormat||$m(r.format,r.integer,r.normalized,i),type:r.dataType?Em(r.dataType):t?.types?.[0]||5121,compressed:r.compressed}}function Km(e){let t=qm(e);return(jm[t.dataFormat]||4)*(Hm[t.type]||1)}function $m(e,t,i,r){if(6408===r||6407===r)return r;switch(e){case"r":return t&&!i?36244:6403;case"rg":return t&&!i?33320:33319;case"rgb":return t&&!i?36248:6407;case"rgba":return t&&!i?36249:6408;default:return 6408}}var Jm={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Ym=class extends Rr{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,ym(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){let e=this.getFeatures();for(let t of e)this.has(t)&&(yield t);return[]}has(e){return!this.disabledFeatures[e]&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in zm}(e)&&function(e,t,i){return(zm[t]||[]).every((t=>ym(e,t,i)))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){let e=this.getFeatures().filter((e=>"polygon-mode-webgl"!==e));for(let t of e)this.has(t)}getFeatures(){return[...Object.keys(Jm),...Object.keys(zm)]}getWebGLFeature(e){let t=Jm[e];return Boolean("string"==typeof t?ym(this.gl,t,this.extensions):t)}},Zm=class extends Mr{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}};function Qm(e,t,i){if(function(e){for(let t in e)return!1;return!0}(t))return i(e);let r,{nocatch:n=!0}=t;if(pm(e),lm(e,t),n)r=i(e),gm(e);else try{r=i(e)}finally{gm(e)}return r}function e_(e,t,i,r){if(vr(t))return r(e);let n=e;pm(n.gl);try{return function(e,t){let i=e,{gl:r}=i;if(t.cullMode)switch(t.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029)}if(t.frontFace&&r.frontFace(s_("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&r.enable(34383),void 0!==t.depthBias&&(r.enable(32823),r.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let e=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,r=s_("provokingVertex",t.provokingVertex,{first:36429,last:36430});e?.provokingVertexWEBGL(r)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let e=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,r=s_("polygonMode",t.polygonMode,{fill:6914,line:6913});e?.polygonModeWEBGL(1028,r),e?.polygonModeWEBGL(1029,r)}t.polygonOffsetLine&&r.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&r.enable(12288),t.clipDistance1&&r.enable(12289),t.clipDistance2&&r.enable(12290),t.clipDistance3&&r.enable(12291),t.clipDistance4&&r.enable(12292),t.clipDistance5&&r.enable(12293),t.clipDistance6&&r.enable(12294),t.clipDistance7&&r.enable(12295)),void 0!==t.depthWriteEnabled&&r.depthMask(function(e,t){return t}(0,t.depthWriteEnabled)),t.depthCompare&&("always"!==t.depthCompare?r.enable(2929):r.disable(2929),r.depthFunc(t_("depthCompare",t.depthCompare))),t.stencilWriteMask){let e=t.stencilWriteMask;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&dr.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let e=t.stencilReadMask||4294967295,i=t_("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,i,0,e),r.stencilFuncSeparate(1029,i,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let e=i_("stencilPassOperation",t.stencilPassOperation),i=i_("stencilFailOperation",t.stencilFailOperation),n=i_("stencilDepthFailOperation",t.stencilDepthFailOperation);r.stencilOpSeparate(1028,i,n,e),r.stencilOpSeparate(1029,i,n,e)}if(t.blendColorOperation||t.blendAlphaOperation){r.enable(3042);let e=r_("blendColorOperation",t.blendColorOperation||"add"),i=r_("blendAlphaOperation",t.blendAlphaOperation||"add");r.blendEquationSeparate(e,i);let n=n_("blendColorSrcFactor",t.blendColorSrcFactor||"one"),s=n_("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=n_("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=n_("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");r.blendFuncSeparate(n,s,o,a)}}(e,t),lm(n.gl,i),r(e)}finally{gm(n.gl)}}function t_(e,t){return s_(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function i_(e,t){return s_(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function r_(e,t){return s_(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function n_(e,t){return s_(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function s_(e,t,i){if(!(t in i))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return i[t]}function o_(e){let t={};return e.addressModeU&&(t[10242]=a_(e.addressModeU)),e.addressModeV&&(t[10243]=a_(e.addressModeV)),e.addressModeW&&(t[32882]=a_(e.addressModeW)),e.magFilter&&(t[10240]=l_(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t){if(!t)return l_(e);switch(e){case"nearest":return"nearest"===t?9984:9986;case"linear":return"nearest"===t?9985:9987}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=t_("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function a_(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function l_(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}var u_=class extends Ar{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;let i="object"==typeof t?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=function(e){return e&Ar.INDEX?34963:e&Ar.VERTEX?34962:e&Ar.UNIFORM?35345:34962}(this.props.usage),this.glUsage=function(e){return e&Ar.INDEX||e&Ar.VERTEX?35044:e&Ar.UNIFORM?35048:35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,i=e.byteLength+t){let r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bufferSubData(r,t,e),this.gl.bindBuffer(r,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){Lr(e>=0);let t=e;0===e&&(t=new Float32Array(0));let i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;let i=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}},h_=class extends rn{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=o_(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(let[t,i]of Object.entries(e)){let e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,i);break;default:this.device.gl.samplerParameteri(this.handle,e,i)}}}},c_=class extends Xr{device;gl;handle;texture;constructor(e,t){super(e,{...Hr.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}},d_={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},f_=class extends Hr{MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(e,t){super(e,{...d_,format:"rgba8unorm",...t}),this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=function(e){switch(e.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;default:throw new Error(e.dimension)}}(this.props),this.loaded=!1,"string"==typeof this.props?.data&&Object.assign(this.props,{data:kn(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(e){return new c_(this.device,{...e,texture:this})}initialize(e={}){if("cube"===this.props.dimension)return this.initializeCube(e);let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;let i=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(i&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;let{parameters:r={}}=e,{pixels:n=null,pixelStore:s={},textureUnit:o,mipmaps:a=!0}=e;t||(t=n);let{width:l,height:u,dataFormat:h,type:c,compressed:d=!1}=e,{depth:f=0}=e,p=Xm(e.format);return({width:l,height:u,compressed:d,dataFormat:h,type:c}=this._deduceParameters({format:e.format,type:c,dataFormat:h,compressed:d,data:t,width:l,height:u})),this.width=l,this.height=u,this.glFormat=p,this.type=c,this.dataFormat=h,this.textureUnit=o,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=a,this.setImageData({data:t,width:l,height:u,depth:f,format:p,type:c,dataFormat:h,parameters:s,compressed:d}),this.setSampler(e.sampler),this._setSamplerParameters(r),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),a&&this.device.isTextureFormatFilterable(e.format)&&this.generateMipmap(),i&&(this._video={video:t,parameters:r,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}initializeCube(e){let{mipmaps:t=!0,parameters:i={}}=e;return this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(i)})),this}setSampler(e={}){let t;e instanceof h_?(this.sampler=e,t=e.props):(this.sampler=new h_(this.device,e),t=e);let i=o_(t);return this._setSamplerParameters(i),this}resize(e){let{height:t,width:i,mipmaps:r=!1}=e;return i!==this.width||t!==this.height?this.initialize({width:i,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:r}):this}update(){if(this._video){let{video:e,parameters:t,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Qm(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this}setImageData(e){if("3d"===this.props.dimension||"2d-array"===this.props.dimension)return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");let{target:t=this.target,pixels:i=null,level:r=0,glFormat:n=this.glFormat,offset:s=0,parameters:o={}}=e,{data:a=null,type:l=this.type,width:u=this.width,height:h=this.height,dataFormat:c=this.dataFormat,compressed:d=!1}=e;a||(a=i),({type:l,dataFormat:c,compressed:d,width:u,height:h}=this._deduceParameters({format:this.props.format,type:l,dataFormat:c,compressed:d,data:a,width:u,height:h}));let{gl:f}=this;f.bindTexture(this.target,this.handle);let p=null;if(({data:a,dataType:p}=this._getDataType({data:a,compressed:d})),Qm(this.gl,o,(()=>{switch(p){case"null":case"browser-object":f.texImage2D(t,r,n,u,h,0,c,l,a);break;case"typed-array":f.texImage2D(t,r,n,u,h,0,c,l,a,s);break;case"buffer":this.device.gl.bindBuffer(35052,a.handle||a),this.device.gl.texImage2D(t,r,n,u,h,0,c,l,s),this.device.gl.bindBuffer(35052,null);break;case"compressed":for(let[e,i]of a.entries())f.compressedTexImage2D(t,e,i.format,i.width,i.height,0,i.data);break;default:Lr(!1,"Unknown image data type")}})),a&&a.byteLength)this.trackAllocatedMemory(a.byteLength,"Texture");else{let e=Km(this.props.format);this.trackAllocatedMemory(this.width*this.height*e,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:i=null,x:r=0,y:n=0,width:s=this.width,height:o=this.height,level:a=0,glFormat:l=this.glFormat,type:u=this.type,dataFormat:h=this.dataFormat,compressed:c=!1,offset:d=0,parameters:f={}}){if(({type:u,dataFormat:h,compressed:c,width:s,height:o}=this._deduceParameters({format:this.props.format,type:u,dataFormat:h,compressed:c,data:i,width:s,height:o})),Lr(1===this.depth,"texSubImage not supported for 3D textures"),i||(i=t),i&&i.data){let e=i;i=e.data,s=e.shape[0],o=e.shape[1]}i instanceof u_&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Qm(this.gl,f,(()=>{c?this.gl.compressedTexSubImage2D(e,a,r,n,s,o,l,i):null===i?this.gl.texSubImage2D(e,a,r,n,s,o,h,u,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(e,a,r,n,s,o,h,u,i,d):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(e,a,r,n,s,o,h,u,d),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(e,a,r,n,s,o,h,u,i)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return dr.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){let{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){let{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof u_?{data:e.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){let{format:t,data:i}=e,{width:r,height:n,dataFormat:s,type:o,compressed:a}=e,l=qm(t);return s=s||l.dataFormat,o=o||l.type,a=a||l.compressed,({width:r,height:n}=this._deduceImageSize(i,r,n)),{dataFormat:s,type:o,compressed:a,width:r,height:n,format:t,data:i}}_deduceImageSize(e,t,i){let r;return r=typeof ImageData<"u"&&e instanceof ImageData?{width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?{width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:i}:{width:t>=0?t:1,height:i>=0?i:1},Lr(r,"Could not deduced texture size"),Lr(void 0===t||r.width===t,"Deduced texture width does not match supplied width"),Lr(void 0===i||r.height===i,"Deduced texture height does not match supplied height"),r}async setCubeMapImageData(e){let{gl:t}=this,{width:i,height:r,pixels:n,data:s,format:o=6408,type:a=5121}=e,l=n||s,u=await Promise.all(f_.FACES.map((e=>{let t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),f_.FACES.forEach(((e,n)=>{u[n].length>1&&!1!==this.props.mipmaps&&dr.warn(`${this.id} has mipmap and multiple LODs.`)(),u[n].forEach(((n,s)=>{i&&r?t.texImage2D(e,s,o,i,r,0,o,a,n):t.texImage2D(e,s,o,o,a,n)}))})),this.unbind()}setImageDataForFace(e){let{face:t,width:i,height:r,pixels:n,data:s,format:o=6408,type:a=5121}=e,{gl:l}=this,u=n||s;return this.bind(),u instanceof Promise?u.then((i=>this.setImageDataForFace(Object.assign({},e,{face:t,data:i,pixels:i})))):this.width||this.height?l.texImage2D(t,0,o,i,r,0,o,a,u):l.texImage2D(t,0,o,o,a,u),this}setImageData3D(e){let{level:t=0,dataFormat:i,format:r,type:n,width:s,height:o,depth:a=1,offset:l=0,data:u,parameters:h={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);let c=qm(r);if(Qm(this.gl,h,(()=>{ArrayBuffer.isView(u)&&this.gl.texImage3D(this.target,t,c.format,s,o,a,0,c.dataFormat,c.type,u),u instanceof u_&&(this.gl.bindBuffer(35052,u.handle),this.gl.texImage3D(this.target,t,i,s,o,a,0,r,n,l))})),u&&u.byteLength)this.trackAllocatedMemory(u.byteLength,"Texture");else{let e=Km(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*e,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!vr(e)){(function(e){dr.log(1,"texture sampler parameters",e)()})(e),this.gl.bindTexture(this.target,this.handle);for(let[t,i]of Object.entries(e)){let e=Number(t),r=i;switch(e){case 33082:case 33083:this.gl.texParameterf(this.target,e,r);break;default:this.gl.texParameteri(this.target,e,r)}}this.gl.bindTexture(this.target,null)}}},p_=f_;c(p_,"FACES",[34069,34070,34071,34072,34073,34074]);var g_=class extends sn{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(e,t){super(e,t);let i=null===t.handle;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();let i=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){let t=this.colorAttachments[e],i=36064+e;t&&this._attachOne(i,t)}if(this.depthStencilAttachment&&this._attachOne(function(e){let t=Vm[e];if(!t?.attachment)throw new Error(`${e} is not a depth stencil format`);return t.attachment}(this.depthStencilAttachment.props.format),this.depthStencilAttachment),!1!==t.check){let e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,i)}}destroy(){super.destroy(),!this.destroyed&&null!==this.handle&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new p_(this.device,{id:`${this.id}-depth-stencil`,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){if(null===this.handle)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight);for(let i of this.colorAttachments)i.texture.resize({width:e,height:t});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:t}),this}_attachOne(e,t){if(Array.isArray(t)){let[i,r=0,n=0]=t;return this._attachTexture(e,i,r,n),i}if(t instanceof p_)return this._attachTexture(e,t,0,0),t;if(t instanceof c_){let i=t;return this._attachTexture(e,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),t.texture}throw new Error("attach")}_attachTexture(e,t,i,r){let{gl:n}=this.device;switch(n.bindTexture(t.target,t.handle),t.target){case 35866:case 32879:n.framebufferTextureLayer(36160,e,t.target,r,i);break;case 34067:let s=function(e){return e<34069?e+34069:e}(i);n.framebufferTexture2D(36160,e,s,t.handle,r);break;case 3553:n.framebufferTexture2D(36160,e,3553,t.handle,r);break;default:Lr(!1,"Illegal texture type")}n.bindTexture(t.target,null)}},m_=class extends Gr{device;presentationSize;_framebuffer=null;constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new g_(this.device,{handle:null}),this._framebuffer}update(){let e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){let t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e)}}commit(){}},__={spector:dr.get("spector")||dr.get("inspect")},v_=null,y_=!1;function b_(e){return e.luma=e.luma||{},e.luma}function A_(e,t={}){return e?t.debug?function(e,t){if(!globalThis.WebGLDebugUtils)return dr.warn("webgl-debug not loaded")(),e;let i=b_(e);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...jg,...e});let r=globalThis.WebGLDebugUtils.makeDebugContext(e,w_.bind(null,t),x_.bind(null,t));for(let e in jg)!(e in r)&&"number"==typeof jg[e]&&(r[e]=jg[e]);class n{}Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.setPrototypeOf(n,r);let s=Object.create(n);return i.realContext=e,i.debugContext=s,s.debug=!0,s}(e,t):function(e){let t=b_(e);return t.realContext?t.realContext:e}(e):null}function E_(e,t){t=Array.from(t).map((e=>void 0===e?"undefined":e));let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${e}(${i})`}function w_(e,t,i,r){r=Array.from(r).map((e=>void 0===e?"undefined":e));let n=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${i}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r)})`;if(dr.error(n)(),e.throwOnError)throw new Error(n)}function x_(e,t,i){let r="";dr.level>=1&&(r=E_(t,i),dr.log(1,r)()),e.break&&e.break.length>0&&(r=r||E_(t,i),e.break.every((e=>-1!==r.indexOf(e))));for(let n of i)if(void 0===n){if(r=r||E_(t,i),e.throwOnError)throw new Error(`Undefined argument: ${r}`);dr.error(`Undefined argument: ${r}`)()}}function T_(e){let t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}var C_=class extends Qr{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){return function(e){let t=e.split(/\r?\n/),i=[];for(let e of t){if(e.length<=1)continue;let t=e.split(":");if(2===t.length){let[e,r]=t;i.push({message:r.trim(),type:T_(e),lineNum:0,linePos:0});continue}let[r,n,s,...o]=t,a=parseInt(s,10);isNaN(a)&&(a=0);let l=parseInt(n,10);isNaN(l)&&(l=0),i.push({message:o.join(":").trim(),type:T_(r),lineNum:a,linePos:l})}return i}(this.device.gl.getShaderInfoLog(this.handle))}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)}async _compile(e){var t;e=(t=e).startsWith("#version ")?t:`#version 100\n${t}`;let{gl:i}=this.device;if(i.shaderSource(this.handle,e),i.compileShader(this.handle),0!==dr.level){if(this.device.features.has("compilation-status-async-webgl"))dr.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),dr.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){let e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);let{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}},S_=6144,P_=[1,2,4,8],M_=class extends un{device;glParameters;constructor(e,t){super(e,t),this.device=e,pm(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){gm(this.device.gl)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){let t={...this.glParameters};this.props.framebuffer&&(t.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=P_.map((t=>Boolean(t&e.colorMask)))),this.glParameters=t,lm(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let e={...this.glParameters},t=0;!1!==this.props.clearColor&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&Qm(this.device.gl,e,(()=>{this.device.gl.clear(t)}))}clearColorBuffer(e=0,t=[0,0,0,0]){Qm(this.device.gl,{framebuffer:this.props.framebuffer},(()=>{switch(t.constructor){case Int32Array:this.device.gl.clearBufferiv(S_,e,t);break;case Uint32Array:this.device.gl.clearBufferuiv(S_,e,t);break;case Float32Array:default:this.device.gl.clearBufferfv(S_,e,t)}}))}},R_="Failed to deduce GL constant from typed array";function I_(e,t){let{clamped:i=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}var B_={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},L_={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},O_=class{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(e){return I_(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Lr(e.size),I_(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new O_(B_,...e)}constructor(...e){e.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return O_.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return O_.getBytesPerVertex(this)}_assign(e={}){return e=function(e,t,i){let{removedProps:r={},deprecatedProps:n={},replacedProps:s={}}=i;for(let i in r)if(i in t){let t=r[i]?`${e}.${r[i]}`:"N/A";dr.removed(`${e}.${i}`,t)()}for(let i in n)if(i in t){let t=n[i];dr.deprecated(`${e}.${i}`,`${e}.${t}`)()}let o=null;for(let[i,r]of Object.entries(s))i in t&&(dr.deprecated(`${e}.${i}`,`${e}.${r}`)(),o=o||Object.assign({},t),o[r]=t[i],delete o[i]);return o||t}("Accessor",e,L_),void 0!==e.type&&(this.type=e.type,(5124===e.type||5125===e.type)&&(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalize&&(this.normalized=e.normalize),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),void 0===this.offset&&delete this.offset,void 0===this.stride&&delete this.stride,void 0===this.type&&delete this.type,void 0===this.size&&delete this.size,void 0===this.divisor&&delete this.divisor,void 0===this.normalized&&delete this.normalized,void 0===this.integer&&delete this.integer,void 0===this.buffer&&delete this.buffer,void 0===this.index&&delete this.index,this}};function F_(e){return N_.includes(e)}var N_=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],D_={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function k_(e){let t=D_[e];if(!t)throw new Error("uniform");let[i,r,,n]=t;return{format:n,components:r,glType:i}}function U_(e){let t=D_[e];if(!t)throw new Error("attribute");let[,i,,r,n]=t;return{attributeType:r,vertexFormat:n,components:i}}function G_(e,t){let i={attributes:[],bindings:[]};i.attributes=function(e,t){let i=[],r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let r=e.getActiveAttrib(t,n);if(!r)throw new Error("activeInfo");let{name:s,type:o}=r,a=e.getAttribLocation(t,s);if(a>=0){let{attributeType:e}=U_(o),t=/instance/i.test(s)?"instance":"vertex";i.push({name:s,location:a,stepMode:t,type:e})}}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);let r=function(e,t){let i=(i,r)=>e.getActiveUniformBlockParameter(t,i,r),r=[],n=e.getProgramParameter(t,35382);for(let s=0;s<n;s++){let n={name:e.getActiveUniformBlockName(t,s)||"",location:i(s,35391),byteLength:i(s,35392),vertex:i(s,35396),fragment:i(s,35398),uniformCount:i(s,35394),uniforms:[]},o=i(s,35395)||[],a=e.getActiveUniforms(t,o,35383),l=e.getActiveUniforms(t,o,35384),u=e.getActiveUniforms(t,o,35387),h=e.getActiveUniforms(t,o,35388);for(let i=0;i<n.uniformCount;++i){let r=e.getActiveUniform(t,o[i]);if(!r)throw new Error("activeInfo");n.uniforms.push({name:r.name,format:k_(a[i]).format,type:a[i],arrayLength:l[i],byteOffset:u[i],byteStride:h[i]})}r.push(n)}return r.sort(((e,t)=>e.location-t.location)),r}(e,t);for(let e of r){let t=e.uniforms.map((e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength})));i.bindings.push({type:"uniform",name:e.name,location:e.location,visibility:(e.vertex?1:0)&(e.fragment?2:0),minBindingSize:e.byteLength,uniforms:t})}let n=function(e,t){let i=[],r=e.getProgramParameter(t,35718);for(let n=0;n<r;n++){let r=e.getActiveUniform(t,n);if(!r)throw new Error("activeInfo");let{name:s,size:o,type:a}=r,{name:l,isArray:u}=j_(s),h=e.getUniformLocation(t,l),c={location:h,name:l,size:o,type:a,isArray:u};if(i.push(c),c.size>1)for(let r=0;r<c.size;r++){let n=`${l}[${r}]`;h=e.getUniformLocation(t,n);let s={...c,name:n,location:h};i.push(s)}}return i}(e,t),s=0;for(let e of n)if(F_(e.type)){let{viewDimension:t,sampleType:r}=V_(e.type);i.bindings.push({type:"texture",name:e.name,location:s,viewDimension:t,sampleType:r}),e.textureUnit=s,s+=1}n.length&&(i.uniforms=n);let o=function(e,t){let i=[],r=e.getProgramParameter(t,35971);for(let n=0;n<r;n++){let r=e.getTransformFeedbackVarying(t,n);if(!r)throw new Error("activeInfo");let{name:s,type:o,size:a}=r,{glType:l,components:u}=k_(o),h={location:n,name:s,accessor:new O_({type:l,size:a*u})};i.push(h)}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);return o?.length&&(i.varyings=o),i}var z_={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function V_(e){let t=z_[e];if(!t)throw new Error("sampler");let[i,r]=t;return{viewDimension:i,sampleType:r}}function j_(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};let t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function H_(e,t,i,r){let n=e,s=r;!0===s&&(s=1),!1===s&&(s=0);let o="number"==typeof s?[s]:s;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof r)throw new Error("samplers must be set to integers");return e.uniform1i(t,r);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:case 35670:return e.uniform1iv(t,o);case 35667:case 35671:return e.uniform2iv(t,o);case 35668:case 35672:return e.uniform3iv(t,o);case 35669:case 35673:return e.uniform4iv(t,o);case 5125:return n.uniform1uiv(t,o,1);case 36294:return n.uniform2uiv(t,o,2);case 36295:return n.uniform3uiv(t,o,3);case 36296:return n.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return n.uniformMatrix2x3fv(t,!1,o);case 35686:return n.uniformMatrix2x4fv(t,!1,o);case 35687:return n.uniformMatrix3x2fv(t,!1,o);case 35688:return n.uniformMatrix3x4fv(t,!1,o);case 35689:return n.uniformMatrix4x2fv(t,!1,o);case 35690:return n.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}var W_=class extends an{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;let{varyings:i,bufferMode:r=35981}=t;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,r)),this._linkShaders(),dr.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=G_(this.device.gl,this.handle),dr.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=function(e,t){let i={...e,attributes:e.attributes.map((e=>({...e})))};for(let e of t?.attributes||[]){let t=i.attributes.find((t=>t.name===e.name));t?(t.type=e.type||t.type,t.stepMode=e.stepMode||t.stepMode):dr.warn(`shader layout attribute ${e.name} not present in shader`)}return i}(this.introspectedLayout,t.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":dr.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`)}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(let[i,r]of Object.entries(e)){let e=this.shaderLayout.bindings.find((e=>e.name===i))||this.shaderLayout.bindings.find((e=>e.name===`${i}Uniforms`));if(e){switch(r||dr.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(r instanceof u_||r.buffer instanceof u_))throw new Error("buffer value");break;case"texture":if(!(r instanceof c_||r instanceof p_||r instanceof g_))throw new Error("texture value");break;case"sampler":dr.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(e.type)}this.bindings[i]=r}else{let e=this.shaderLayout.bindings.map((e=>`"${e.name}"`)).join(", ");t?.disableWarnings||dr.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${e}`)()}}}draw(e){let{renderPass:t,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:n,vertexCount:s,instanceCount:o,firstVertex:a=0,transformFeedback:l}=e,u=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(e)}}(r),h=Boolean(n.indexBuffer),c=n.indexBuffer?.glIndexType,d=Number(o)>0;if("success"!==this.linkStatus)return dr.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||0===s)return dr.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(0===s)return dr.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),n.bindBeforeRender(t),l&&l.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let f=t;return e_(this.device,i,f.glParameters,(()=>{h&&d?this.device.gl.drawElementsInstanced(u,s||0,c,a,o||0):h?this.device.gl.drawElements(u,s||0,c,a):d?this.device.gl.drawArraysInstanced(u,a,s||0,o||0):this.device.gl.drawArrays(u,a,s||0),l&&l.end()})),n.unbindAfterRender(t),!0}setUniformsWebGL(e){let{bindings:t}=Dn(e);Object.keys(t).forEach((e=>{dr.warn(`Unsupported value "${JSON.stringify(t[e])}" used in setUniforms() for key ${e}. Use setBindings() instead?`)()})),Object.assign(this.uniforms,e)}async _linkShaders(){let{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),dr.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),dr.timeEnd(4,`linkProgram for ${this.id}`)(),dr.level,!this.device.features.has("compilation-status-async-webgl")){let e=this._getLinkStatus();return void this._reportLinkStatus(e)}dr.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),dr.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let t=this._getLinkStatus();this._reportLinkStatus(t)}_reportLinkStatus(e){if("success"!==e)throw"error"===this.vs.compilationStatus?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):"error"===this.fs?.compilationStatus?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${e}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}_getLinkStatus(){let{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);let{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(let[,t]of Object.entries(this.bindings))t instanceof p_&&(t.update(),e=e&&t.loaded);return e}_applyBindings(){if("success"!==this.linkStatus)return;let{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(let r of this.shaderLayout.bindings){let n=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!n)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":let{name:s}=r,o=e.getUniformBlockIndex(this.handle,s);if(4294967295===o)throw new Error(`Invalid uniform block name ${s}`);e.uniformBlockBinding(this.handle,i,o),n instanceof u_?e.bindBufferBase(35345,i,n.handle):e.bindBufferRange(35345,i,n.buffer.handle,n.offset||0,n.size||n.buffer.byteLength-n.offset),i+=1;break;case"texture":if(!(n instanceof c_||n instanceof p_||n instanceof g_))throw new Error("texture");let a;if(n instanceof c_)a=n.texture;else if(n instanceof p_)a=n;else{if(!(n instanceof g_&&n.colorAttachments[0]instanceof c_))throw new Error("No texture");dr.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=n.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.target,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(let e of this.shaderLayout.uniforms||[]){let{name:t,location:i,type:r,textureUnit:n}=e,s=this.uniforms[t]??n;void 0!==s&&H_(this.device.gl,i,r,s)}}},X_=class extends gn{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(let t of e)switch(t.name){case"copy-buffer-to-buffer":q_(this.device,t.options);break;case"copy-buffer-to-texture":K_(this.device,t.options);break;case"copy-texture-to-buffer":$_(this.device,t.options);break;case"copy-texture-to-texture":J_(this.device,t.options)}}};function q_(e,t){let i=t.source,r=t.destination;e.gl.bindBuffer(36662,i.handle),e.gl.bindBuffer(36663,r.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function K_(e,t){throw new Error("Not implemented")}function $_(e,t){let{source:i,mipLevel:r=0,aspect:n="all",width:s=t.source.width,height:o=t.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:u,byteOffset:h=0,bytesPerRow:c,rowsPerImage:d}=t;if("all"!==n)throw new Error("not supported");if(0!==r||0!==a||c||d)throw new Error("not implemented");let f,{framebuffer:p,destroyFramebuffer:g}=Y_(i);try{let t=u,i=s||p.width,r=o||p.height,n=qm(p.texture.props.format),a=n.dataFormat,c=n.type;e.gl.bindBuffer(35051,t.handle),f=e.gl.bindFramebuffer(36160,p.handle),e.gl.readPixels(l[0],l[1],i,r,a,c,h)}finally{e.gl.bindBuffer(35051,null),void 0!==f&&e.gl.bindFramebuffer(36160,f),g&&p.destroy()}}function J_(e,t){let i,{source:r,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:o=[0,0],destination:a}=t,{width:l=t.destination.width,height:u=t.destination.height}=t,{framebuffer:h,destroyFramebuffer:c}=Y_(r),[d,f]=s,[p,g,m]=o,_=e.gl.bindFramebuffer(36160,h.handle),v=null;if(!(a instanceof p_))throw new Error("invalid destination");switch(v=a,l=Number.isFinite(l)?l:v.width,u=Number.isFinite(u)?u:v.height,v.bind(0),i=v.target,i){case 3553:case 34067:e.gl.copyTexSubImage2D(i,n,p,g,d,f,l,u);break;case 35866:case 32879:e.gl.copyTexSubImage3D(i,n,p,g,m,d,f,l,u)}v&&v.unbind(),e.gl.bindFramebuffer(36160,_),c&&h.destroy()}function Y_(e){if(e instanceof Hr){let{width:t,height:i,id:r}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${r}`,width:t,height:i,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var Z_=class extends fn{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new X_(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}},Q_=class extends En{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return"Chrome"===function(e){return e||it()?tt(e)?"Electron":(e||et.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}()}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){let t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){let i=t;if(34963===i.glTarget)throw new Error("Use .setIndexBuffer()");let{size:r,type:n,stride:s,offset:o,normalized:a,integer:l,divisor:u}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),l?this.device.gl.vertexAttribIPointer(e,r,n,s,o):this.device.gl.vertexAttribPointer(e,r,n,a,s,o),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,u||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){let t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){let t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);let i=Em(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){let i=Q_.isConstantAttributeZeroSupported(this.device)||0!==e;(t||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){let i=function(e){return Array.isArray(e)?new Float32Array(e):e}(t),r=i.byteLength*e,n=i.length*e;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),s=s||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(i,this.bufferValue),s){let e=function(e,t){return new e(In(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,n);(function(e){let{target:t,source:i,start:r=0,count:n=1}=e,s=i.length,o=n*s,a=0;for(let e=r;a<s;a++)t[e++]=i[a];for(;a<o;)a<o-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+o-a),a=o);e.target})({target:e,source:i,start:0,count:n}),this.buffer.write(e),this.bufferValue=t}return this.buffer}},ev=class extends xn{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":case"line-loop-webgl":return 1;case"triangle-list":case"triangle-strip":case"triangle-fan-webgl":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind((()=>{for(let t in e)this.setBuffer(t,e[t])}))}setBuffer(e,t){let i=this._getVaryingIndex(e),{buffer:r,byteLength:n,byteOffset:s}=this._getBufferRange(t);if(i<0)return this.unusedBuffers[e]=r,void dr.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[i]={buffer:r,byteLength:n,byteOffset:s},this.bindOnUse||this._bindBuffer(i,r,s,n)}getBuffer(e){if(tv(e))return this.buffers[e]||null;let t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof u_)return{buffer:e,byteOffset:0,byteLength:e.byteLength};let{buffer:t,byteOffset:i=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:r}}_getVaryingIndex(e){if(tv(e))return Number(e);for(let t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(let e in this.buffers){let{buffer:t,byteLength:i,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,r,i)}}_unbindBuffers(){for(let e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,r){let n=t&&t.handle;n&&void 0!==r?this.gl.bindBufferRange(35982,e,n,i,r):this.gl.bindBufferBase(35982,e,n)}};function tv(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}var iv=class extends Cn{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise(((i,r)=>{let n=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)})),this._pollingPromise}};function rv(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Lr(!1),0}}function nv(e,t){let{sourceX:i=0,sourceY:r=0,sourceFormat:n=6408,sourceAttachment:s=36064}=t||{},{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:u}=t||{},{framebuffer:h,deleteFramebuffer:c}=ov(e);Lr(h);let{gl:d,handle:f}=h;a=a||h.width,l=l||h.height;let p=s-36064;u=u||h.colorAttachments[p]?.texture?.type||5121,o=function(e,t,i,r,n){if(e)return e;let s=I_(t=t||5121,{clamped:!1}),o=rv(i);return new s(r*n*o)}(o,u,n,a,l),u=u||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(R_)}}(o);let g=d.bindFramebuffer(36160,f);return d.readPixels(i,r,a,l,n,u,o),d.bindFramebuffer(36160,g||null),c&&h.destroy(),o}function sv(e,t){let{target:i,sourceX:r=0,sourceY:n=0,sourceFormat:s=6408,targetByteOffset:o=0}=t||{},{sourceWidth:a,sourceHeight:l,sourceType:u}=t||{},{framebuffer:h,deleteFramebuffer:c}=ov(e);Lr(h),a=a||h.width,l=l||h.height;let d=h;u=u||5121;let f=i;if(!f){let e=rv(s),t=function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Lr(!1),0}}(u),i=o+a*l*e*t;f=d.device.createBuffer({byteLength:i})}let p=e.device.createCommandEncoder();return p.copyTextureToBuffer({source:e,width:a,height:l,origin:[r,n],destination:f,byteOffset:o}),p.destroy(),c&&h.destroy(),f}function ov(e){return e instanceof sn?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:av(e),deleteFramebuffer:!0}}function av(e,t){let{device:i,width:r,height:n,id:s}=e;return i.createFramebuffer({...t,id:`framebuffer-for-${s}`,width:r,height:n,colorAttachments:[e]})}var lv=class extends Br{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(e){if(e instanceof lv)return e;if(e?.device instanceof Br)return e.device;if(!function(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new lv({gl:e})}static async create(e={}){dr.groupCollapsed(1,"WebGLDevice created")();let t=[];e.debug&&t.push(async function(){it()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Un("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.spector&&t.push(async function(e){if(!globalThis.SPECTOR)try{await Un("https://spectorcdn.babylonjs.com/spector.bundle.js")}catch(e){dr.warn(String(e))}}()),"string"==typeof e.canvas&&t.push(Gr.pageLoaded);let i=await Promise.allSettled(t);for(let e of i)"rejected"===e.status&&dr.error(`Failed to initialize debug libraries ${e.reason}`)();if(dr.probe(2,"DOM is loaded")(),e.gl?.device)return dr.warn("reattaching existing device")(),lv.attach(e.gl);let r=new lv(e),n=`Created ${r.type}${r.debug?" debug":""} context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return dr.probe(1,n)(),dr.table(1,r.info)(),dr.groupEnd(1)(),r}constructor(e){super({...e,id:e.id||_r("webgl-device")});let t=e.gl?.device;if(t)throw new Error(`WebGL context already attached to device ${t.id}`);let i=e.gl?.canvas||e.canvas;this.canvasContext=new m_(this,{...e,canvas:i}),this.lost=new Promise((e=>{this._resolveContextLost=e}));let r=e.gl||null;if(r||=function(e,t){t={...vm,...t};let i=null,r=e=>i=e.statusMessage||i;e.addEventListener("webglcontextcreationerror",r,!1);let n=null;if(n||=e.getContext("webgl2",t),e.removeEventListener("webglcontextcreationerror",r,!1),!n)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(t.onContextLost){let{onContextLost:i}=t;e.addEventListener("webglcontextlost",(e=>i(e)),!1)}if(t.onContextRestored){let{onContextRestored:i}=t;e.addEventListener("webglcontextrestored",(e=>i(e)),!1)}return n}(this.canvasContext.canvas,{...e,onContextLost:e=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!r)throw new Error("WebGL context creation failed");this.handle=r,this.gl=r,this.gl.device=this,this.gl._version=2,this.info=bm(this.gl,this._extensions),this.limits=new Zm(this.gl),this.features=new Ym(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();let{enable:n=!0,copyState:s=!1}=e;fm(this.gl,{enable:n,copyState:s,log:(...e)=>dr.log(1,...e)()}),e.debug&&(this.gl=A_(this.gl,{...e,throwOnError:!0}),this.debug=!0,dr.level=Math.max(dr.level,1),dr.warn("WebGL debug mode activated. Performance reduced.")()),e.spector&&(this.spectorJS=function(e){if(e={...__,...e},!e?.spector||(!v_&&globalThis.SPECTOR&&(dr.probe(1,"SPECTOR found and initialized")(),v_=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=v_)),!v_))return null;if(y_||(y_=!0,v_.spyCanvases(),v_?.onCaptureStarted.add((e=>dr.info("Spector capture started:",e)())),v_?.onCapture.add((e=>{dr.info("Spector capture complete:",e)(),v_?.getResultUI(),v_?.resultView.display(),v_?.resultView.addCapture(e)}))),e?.canvas){if("string"==typeof e.spector&&e.spector!==e.canvas.id)return v_;v_?.startCapture(e?.canvas,500),new Promise((e=>setTimeout(e,2e3))).then((e=>{dr.info("Spector capture stopped after 2 seconds")(),v_?.stopCapture()}))}return v_}({...this.props,canvas:this.handle.canvas}))}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return Wm(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return function(e,t,i){if(!Wm(e,t,i)||t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(Sr(t).signed)return!1}catch{return!1}return t.endsWith("32float")?Boolean(ym(e,"OES_texture_float_linear, extensions",i)):!t.endsWith("16float")||Boolean(ym(e,"OES_texture_half_float_linear, extensions",i))}(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return function(e,t,i){return!(!Wm(e,t,i)||"number"==typeof t)}(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){let t=this._getBufferProps(e);return new u_(this,t)}_createTexture(e){return new p_(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new h_(this,e)}createShader(e){return new C_(this,e)}createFramebuffer(e){return new g_(this,e)}createVertexArray(e){return new Q_(this,e)}createTransformFeedback(e){return new ev(this,e)}createQuerySet(e){return new iv(this,e)}createRenderPipeline(e){return new W_(this,e)}beginRenderPass(e){return new M_(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e){return new Z_(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return nv(e,t)}readPixelsToBufferWebGL(e,t){return sv(e,t)}setParametersWebGL(e){lm(this.gl,e)}getParametersWebGL(e){return um(this.gl,e)}withParametersWebGL(e,t){return Qm(this.gl,e,t)}clearWebGL(e){!function(e,t){let{framebuffer:i=null,color:r=null,depth:n=null,stencil:s=null}=t||{},o={};i&&(o.framebuffer=i);let a=0;r&&(a|=16384,!0!==r&&(o.clearColor=r)),n&&(a|=256,!0!==n&&(o.clearDepth=n)),s&&(a|=1024,!0!==n&&(o.clearStencil=n)),Lr(0!==a,"clear: bad arguments");let l=e.gl;Qm(l,o,(()=>{l.clear(a)}))}(this,e)}resetWebGL(){dr.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),function(e){lm(e,Kg)}(this.gl)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let e=!1,t=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return t&&(e=!0,t.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){pm(this.gl)}popState(){gm(this.gl)}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){t=t||this.gl2||this.gl;let i=Number(e);for(let e in t)if(t[e]===i)return`GL.${e}`;return String(e)}_constants;setConstantAttributeWebGL(e,t){let i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);let r=this._constants[e];switch(r&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(r,t)&&dr.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,i){switch(i.length){case 1:e.gl.vertexAttrib1fv(t,i);break;case 2:e.gl.vertexAttrib2fv(t,i);break;case 3:e.gl.vertexAttrib3fv(t,i);break;case 4:e.gl.vertexAttrib4fv(t,i);break;default:Lr(!1)}}(this,e,t);break;case Int32Array:!function(e,t,i){e.gl.vertexAttribI4iv(t,i)}(this,e,t);break;case Uint32Array:!function(e,t,i){e.gl.vertexAttribI4uiv(t,i)}(this,e,t);break;default:Lr(!1)}}getExtension(e){return ym(this.gl,e,this._extensions),this._extensions}},uv=lv;c(uv,"type","webgl");var hv=h(d()),cv={mousedown:1,mousemove:2,mouseup:4};!function(e){let t=e.prototype.handler;e.prototype.handler=function(e){let i=this.store;e.button>0&&"pointerdown"===e.type&&(function(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return!0;return!1}(i,(t=>t.pointerId===e.pointerId))||i.push(e)),t.call(this,e)}}(hv.PointerEventInput),function(e){e.prototype.handler=function(e){let t=cv[e.type];1&t&&e.button>=0&&(this.pressed=!0),2&t&&0===e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}(hv.MouseInput);var dv=hv.Manager,fv=hv,pv=class{constructor(e,t,i){this.element=e,this.callback=t,this.options={enable:!0,...i}}},gv=fv?[[fv.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[fv.Rotate,{enable:!1}],[fv.Pinch,{enable:!1}],[fv.Swipe,{enable:!1}],[fv.Pan,{threshold:0,enable:!1}],[fv.Press,{enable:!1}],[fv.Tap,{event:"doubletap",taps:2,enable:!1}],[fv.Tap,{event:"anytap",enable:!1}],[fv.Tap,{enable:!1}]]:null,mv={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},_v={doubletap:["tap"]},vv={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},yv={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},bv={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Av={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Ev=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",wv=typeof window<"u"?window:T,xv=!1;try{let e={get passive(){return xv=!0,!0}};wv.addEventListener("test",null,e),wv.removeEventListener("test",null)}catch{xv=!1}var Tv=-1!==Ev.indexOf("firefox"),{WHEEL_EVENTS:Cv}=yv,Sv="wheel",Pv=4.000244140625,Mv=class extends pv{constructor(e,t,i){super(e,t,i),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;wv.WheelEvent&&(Tv&&e.deltaMode===wv.WheelEvent.DOM_DELTA_PIXEL&&(t/=wv.devicePixelRatio),e.deltaMode===wv.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%Pv==0&&(t=Math.floor(t/Pv)),e.shiftKey&&t&&(t*=.25),this.callback({type:Sv,center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},this.events=(this.options.events||[]).concat(Cv),this.events.forEach((t=>e.addEventListener(t,this.handleEvent,!!xv&&{passive:!1})))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===Sv&&(this.options.enable=t)}},{MOUSE_EVENTS:Rv}=yv,Iv="pointermove",Bv="pointerover",Lv="pointerout",Ov="pointerenter",Fv="pointerleave",Nv=class extends pv{constructor(e,t,i){super(e,t,i),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;let{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(Rv),this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===Iv&&(this.enableMoveEvent=t),e===Bv&&(this.enableOverEvent=t),e===Lv&&(this.enableOutEvent=t),e===Ov&&(this.enableEnterEvent=t),e===Fv&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit(Bv,e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit(Lv,e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit(Ov,e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit(Fv,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this._emit(Iv,e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}},{KEY_EVENTS:Dv}=yv,kv="keydown",Uv="keyup",Gv=class extends pv{constructor(e,t,i){super(e,t,i),this.handleEvent=e=>{let t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:kv,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:Uv,srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Dv),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===kv&&(this.enableDownEvent=t),e===Uv&&(this.enableUpEvent=t)}},zv="contextmenu",Vv=class extends pv{constructor(e,t,i){super(e,t,i),this.handleEvent=e=>{this.options.enable&&this.callback({type:zv,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===zv&&(this.options.enable=t)}},jv={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function Hv(e){let t=jv[e.srcEvent.type];if(!t)return null;let{buttons:i,button:r,which:n}=e.srcEvent,s=!1,o=!1,a=!1;return 4===t||2===t&&!Number.isFinite(i)?(s=1===n,o=2===n,a=3===n):2===t?(s=Boolean(1&i),o=Boolean(4&i),a=Boolean(2&i)):1===t&&(s=0===r,o=1===r,a=2===r),{leftButton:s,middleButton:o,rightButton:a}}function Wv(e,t){let i=e.center;if(!i)return null;let r=t.getBoundingClientRect(),n=r.width/t.offsetWidth||1,s=r.height/t.offsetHeight||1;return{center:i,offsetCenter:{x:(i.x-r.left-t.clientLeft)/n,y:(i.y-r.top-t.clientTop)/s}}}var Xv={srcElement:"root",priority:0},qv={events:null,recognizers:null,recognizerOptions:{},Manager:dv,touchAction:"none",tabIndex:0};function Kv(){}var $v={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Kv,onWebGLInitialized:Kv,onResize:Kv,onViewStateChange:Kv,onInteractionStateChange:Kv,onBeforeRender:Kv,onAfterRender:Kv,onLoad:Kv,onError:e=>wi.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1},Jv=class{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new _e({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{let{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{let i=e.offsetCenter;if(!i)return;t.x=i.x,t.y=i.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{let t=Uc[e.type],i=e.offsetCenter;if(!t||!i||!this.layerManager)return;let r=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:r,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:s}=n,o=s&&(s[t.handler]||s.props[t.handler]),a=this.props[t.handler],l=!1;o&&(l=o.call(s,n,e)),l||(a?.(n,e),this.widgetManager.onEvent(n,e))},this._onPointerDown=e=>{let t=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...$v,...e},(e=this.props).viewState&&e.initialViewState&&wi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&wi.error("WebGL1 context not supported.")(),this.device=uv.attach(e.gl));let t=this.device;t||(Fr.registerDevices([uv]),t=Fr.createDevice({...e.deviceProps,canvas:this._createCanvas(e)}),t.then((e=>{this.device=e}))),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&hf.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&wi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&wi.removed("onLayerClick","onClick")(),e.initialViewState&&!sg(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),n=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||i||r||n||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return gg(this.viewManager),this.viewManager.views}getViewports(e){return gg(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){gg(this.deckPicker);let{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(t).timeStart();let n=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(t).timeEnd(),n}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),gg(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:i}=e;if(t||0===t){let e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(i||0===i){let t=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){let{gl:i,onError:r,useDevicePixels:n}=t;return new class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(e){if(this.props={...rp,...e},!(e=this.props).device)throw new Error("No device provided");let{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new _e({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){let t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=function(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}(this._animationFrame.bind(this)))}_cancelAnimationFrame(){null!==this._animationFrameId&&(function(e){typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);let i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1],i=1,r=this.device?.canvasContext?.canvas;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}({device:e,useDevicePixels:n,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState||{}}_getViews(){let{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Og({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){let{_pickRequest:e}=this;if(e.event){let{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let r=i,n=!1;for(let i of t)r=i,n=i.layer?.onHover(i,e.event)||n;n||(this.props.onHover?.(r,e.event),this.widgetManager.onHover(r,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof uv&&this.props.onWebGLInitialized(this.device.gl);let t=new tp;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new class{constructor(e=null,t){this._onBasicInput=e=>{let{srcEvent:t}=e,i=vv[t.type];i&&this.manager.emit(i,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={...qv,...t},this.events=new Map,this.setElement(e);let{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;let{options:t}=this,i=t.Manager;this.manager=new i(e,{touchAction:t.touchAction,recognizers:t.recognizers||gv}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(mv).forEach((e=>{let t=this.manager.get(e);t&&mv[e].forEach((e=>{t.recognizeWith(e)}))}));for(let e in t.recognizerOptions){let i=this.manager.get(e);if(i){let r=t.recognizerOptions[e];delete r.enable,i.set(r)}}this.wheelInput=new Mv(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Nv(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Gv(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Vv(e,this._onOtherEvent,{enable:!1});for(let[e,t]of this.events)t.isEmpty()||(this._toggleRecognizer(t.recognizerName,!0),this.manager.on(e,t.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:i}=this;if(!i)return;let r=i.get(e);if(r&&r.options.enable!==t){r.set({enable:t});let n=_v[e];n&&!this.options.recognizers&&n.forEach((n=>{let s=i.get(n);t?(s.requireFailure(e),r.dropRequireFailure(n)):s.dropRequireFailure(e)}))}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,i,r,n){if("string"!=typeof e){i=t;for(let t in e)this._addEventHandler(t,e[t],i,r,n);return}let{manager:s,events:o}=this,a=Av[e]||e,l=o.get(a);l||(l=new class{constructor(e){this.handleEvent=e=>{if(this.isEmpty())return;let t=this._normalizeEvent(e),i=e.srcEvent.target;for(;i&&i!==t.rootElement;){if(this._emit(t,i),t.handled)return;i=i.parentNode}this._emit(t,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,r=!1,n=!1){let{handlers:s,handlersByElement:o}=this,a=Xv;"string"==typeof i||i&&i.addEventListener?a={...Xv,srcElement:i}:i&&(a={...Xv,...i});let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));let u={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};r&&(u.once=!0),n&&(u.passive=!0),s.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,t){let{handlers:i,handlersByElement:r}=this;for(let n=i.length-1;n>=0;n--){let s=i[n];if(s.type===e&&s.handler===t){i.splice(n,1);let e=r.get(s.srcElement);e.splice(e.indexOf(s),1),0===e.length&&r.delete(s.srcElement)}}this._active=i.some((e=>!e.passive))}_emit(e,t){let i=this.handlersByElement.get(t);if(i){let t=!1,r=()=>{e.handled=!0},n=()=>{e.handled=!0,t=!0},s=[];for(let o=0;o<i.length;o++){let{type:a,handler:l,once:u}=i[o];if(l({...e,type:a,stopPropagation:r,stopImmediatePropagation:n}),u&&s.push(i[o]),t)break}for(let e=0;e<s.length;e++){let{type:t,handler:i}=s[e];this.remove(t,i)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...Hv(e),...Wv(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}(this),o.set(a,l),l.recognizerName=bv[a]||a,s&&s.on(a,l.handleEvent)),l.add(e,t,i,r,n),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(let t in e)this._removeEventHandler(t,e[t]);return}let{events:i}=this,r=Av[e]||e,n=i.get(r);if(n&&(n.remove(e,t),n.isEmpty())){let{recognizerName:e}=n,t=!1;for(let r of i.values())if(r.recognizerName===e&&!r.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}}(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let e in Uc)this.eventManager.on(e,this._onEvent);this.viewManager=new class{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter((t=>t.containsPixel(e))):this._viewports}getViews(){let e={};return this.views.forEach((t=>{e[t.id]=t})),e}getView(e){return this.views.find((t=>t.id===e))}getViewState(e){let t="string"==typeof e?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){let i=this.getViewports(),r={x:e[0],y:e[1]};for(let n=i.length-1;n>=0;--n){let s=i[n];if(s.containsPixel(r)){let i=e.slice();return i[0]-=s.x,i[1]-=s.y,s.unproject(i,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=tg(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!sg(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):wi.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,i,r){let n=e.controller;if(n&&i){let s={...t,...n,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==n.type)&&(r=this._createController(e,s)),r&&r.setProps(s),r}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){let n=e[r],s=this.getViewState(n),o=n.makeViewport({viewState:s,width:this.width,height:this.height}),a=t[n.id],l=Boolean(n.controller);l&&!a&&(i=!0),(i||!l)&&a&&(a.finalize(),a=null),this.controllers[n.id]=this._updateController(n,s,o,a),o&&this._viewports.unshift(o)}for(let e in t){let i=t[e];i&&!this.controllers[e]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)}))}_diffViews(e,t){return e.length!==t.length||e.some(((i,r)=>!e[r].equals(t[r])))}}({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new ng(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new class{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let t=this._defaultEffects;if(!t.find((t=>t.id===e.id))){let i=t.findIndex((t=>function(e,t){return(e.order??1/0)-(t.order??1/0)}(t,e)>0));i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(sg(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){let t={};for(let e of this.effects)t[e.id]=e;let i=[];for(let r of e){let e=t[r.id],n=r;e&&e!==r?e.setProps?(e.setProps(r.props),n=e):e.cleanup(this._context):e||r.setup(this._context),i.push(n),delete t[r.id]}for(let e in t)t[e].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some((e=>e instanceof uf))||this._resolvedEffects.push(Fg),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}({deck:this,device:this.device}),this.deckRenderer=new Dg(this.device),this.deckPicker=new class{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new zp(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:r},n=this.lastPickedInfo.info){let s=n&&n.layer&&n.layer.id,o=n&&n.viewport&&n.viewport.id,a=s?i.find((e=>e.id===s)):null,l=o&&r.find((e=>e.id===o))||r[0],u=l&&l.unproject([e-l.x,t-l.y]);return{...n,x:e,y:t,viewport:l,coordinate:u,layer:a}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}let e=this.device.gl;this.pickingFBO?.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO?.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(!1===this._pickable)return null;let t=e.filter((e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite));return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:r,y:n,radius:s=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:u,effects:h}){let c=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===i.length)return{result:[],emptyInfo:Gg({viewports:i,x:r,y:n,pixelRatio:c})};this._resizeBuffer();let f,p=this.device.canvasContext.cssToDevicePixels([r,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(s*c),{width:_,height:v}=this.pickingFBO,y=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:_,deviceHeight:v}),b={x:r-s,y:n-s,width:2*s+1,height:2*s+1},A=[],E=new Set;for(let e=0;e<o;e++){let s,p;if(s=y?Ug({...this._drawAndSample({layers:d,views:t,viewports:i,onViewportActive:u,deviceRect:y,cullRect:b,effects:h,pass:`picking:${a}`}),deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},s.pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[s.pickedLayer],views:t,viewports:i,onViewportActive:u,deviceRect:{x:s.pickedX,y:s.pickedY,width:1,height:1},cullRect:b,effects:h,pass:`picking:${a}:z`},!0);e[3]&&(p=e[0])}s.pickedLayer&&e+1<o&&(E.add(s.pickedLayer),s.pickedLayer.disablePickingIndex(s.pickedObjectIndex)),f=zg({pickInfo:s,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:i,x:r,y:n,z:p,pixelRatio:c});for(let e of f.values())e.layer&&A.push(e);if(!s.pickedColor)break}for(let e of E)e.restorePickingColors();return{result:A,emptyInfo:f.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:r,y:n,width:s=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:u,effects:h}){let c=this._getPickable(e);if(!c||0===i.length)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([r,n],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([r+s,n+o],!0),_=m.x+m.width,v=m.y,y={x:p,y:v,width:_-p,height:g-v},b=function({pickedColors:e,decodePickingColor:t}){let i=new Map;if(e)for(let r=0;r<e.length;r+=4)if(e[r+3]-1>=0){let n=e.slice(r,r+4),s=n.join(",");if(!i.has(s)){let e=t(n);e?i.set(s,{...e,color:n}):wi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(i.values())}(this._drawAndSample({layers:c,views:t,viewports:i,onViewportActive:u,deviceRect:y,cullRect:{x:r,y:n,width:s,height:o},effects:h,pass:`picking:${a}`})),A=new Map,E=[],w=Number.isFinite(l);for(let e=0;e<b.length&&!(w&&E.length>=l);e++){let t=b[e],i={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:r,y:n,pixelRatio:d};i=Vg({layer:t.pickedLayer,info:i,mode:a});let s=i.layer.id;A.has(s)||A.set(s,new Set);let o=A.get(s),l=i.object??i.index;o.has(l)||(o.add(l),E.push(i))}return E}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:r,deviceRect:n,cullRect:s,effects:o,pass:a},l=!1){let u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:n,cullRect:s,effects:o,pass:a,pickZ:l,preRenderStats:{}};for(let e of o)e.useInPicking&&(h.preRenderStats[e.id]=e.preRender(h));let{decodePickingColor:c}=this.pickLayersPass.render(h),{x:d,y:f,width:p,height:g}=n,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:c}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:r,deviceHeight:n}){let s=Math.max(0,e-i),o=Math.max(0,t-i),a=Math.min(r,e+i+1)-s,l=Math.min(n,t+i+1)-o;return a<=0||l<=0?null:{x:s,y:o,width:a,height:l}}}(this.device),this.widgetManager=new class{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!sg(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(let e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find((t=>t.id===e.id))||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){let t={};for(let e of this.resolvedWidgets)t[e.id]=e;this.resolvedWidgets.length=0;for(let e of this.defaultWidgets)t[e.id]=null,this.resolvedWidgets.push(e);for(let i of e){let e=t[i.id];e?e.viewId!==i.viewId||e.placement!==i.placement?(this._remove(e),this._add(i)):i!==e&&(e.setProps(i.props),i=e):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(let e in t){let i=t[e];i&&this._remove(i)}this.widgets=e}_add(e){let{viewId:t=null,placement:i=Wg}=e,r=e.onAdd({deck:this.deck,viewId:t});r&&this._getContainer(t,i).append(r),e._element=r}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){let i=e||Xg,r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[i]=r);let n=r.querySelector(`.${t}`);return n||(n=document.createElement("div"),n.className=t,n.style.position="absolute",Object.assign(n.style,Hg[t]),r.append(n)),n}_updateContainers(){let e=this.deck.width,t=this.deck.height;for(let i in this.containers){let r=this.lastViewports[i]||null,n=i===Xg||r,s=this.containers[i];n?(s.style.display="block",s.style.left=`${r?r.x:0}px`,s.style.top=`${r?r.y:0}px`,s.style.width=`${r?r.width:e}px`,s.style.height=`${r?r.height:t}px`):s.style.display="none"}}onRedraw({viewports:e,layers:t}){let i=e.reduce(((e,t)=>(e[t.id]=t,e)),{}),{lastViewports:r}=this;for(let n of this.getWidgets()){let{viewId:s}=n;if(s){let e=i[s];e&&(n.onViewportChange&&!e.equals(r[s])&&n.onViewportChange(e),n.onRedraw?.({viewports:[e],layers:t}))}else{if(n.onViewportChange)for(let t of e)t.equals(r[t.id])||n.onViewportChange(t);n.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(let i of this.getWidgets()){let{viewId:r}=i;(!r||r===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){let i=Uc[t.type];if(i)for(let r of this.getWidgets()){let{viewId:n}=r;(!n||n===e.viewport?.id)&&r[i.handler]?.(e,t)}}}({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){let t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,qg),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;let r=i(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,t,i){let r=this.element;if(r){if("string"==typeof e)r.innerText=e;else{if(!e)return this.isVisible=!1,void(r.style.display="none");e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className)}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${t}px, ${i}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(r.style,e.style)}}}),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});let n={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(n),"screen"===n.pass&&this.widgetManager.onRedraw({viewports:n.viewports,layers:n.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),wi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let i=Fr.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}},Yv=Jv;Jv.defaultProps=$v,Jv.VERSION=Pi;var Zv=On;function Qv(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function ey(e){return e.stride||e.size*e.bytesPerElement}function ty(e,t){t.offset&&wi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let i=ey(e),r=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*i+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:r,stride:i}}var iy=class{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;let r,n=t.logicalType||t.type,s="float64"===n,{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),r=s?"float32":!n&&t.isIndexed?"uint32":n||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Fn(e)}}(n||r);this.doublePrecision=s,s&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:o,logicalType:n,type:r,normalized:r.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*ey(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),hf.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){let i={};if(this.state.constant){let r=this.value;if(t){let n=ty(this.getAccessor(),t),s=n.offset/r.BYTES_PER_ELEMENT,o=n.size||this.size;i[e]=r.subarray(s,s+o)}else i[e]=r}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}getBufferLayout(e=this.id,t=null){let i=this.getAccessor(),r=[],n={name:this.id,byteStride:ey(i),attributes:r};if(this.doublePrecision){let n=function(e,t){let i=ty(e,t);return{high:i,low:{...i,offset:i.offset+4*e.size}}}(i,t||{});r.push(Qv(e,{...i,...n.high}),Qv(`${e}64Low`,{...i,...n.low}))}else if(t){let n=ty(i,t);r.push(Qv(e,{...i,...n}))}else r.push(Qv(e,i));return n}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:i,size:r}=this,n=i*r;if(t&&n&&t.length>=n){let i=new Array(r).fill(1/0),s=new Array(r).fill(-1/0);for(let e=0;e<n;)for(let n=0;n<r;n++){let r=t[e++];r<i[n]&&(i[n]=r),r>s[n]&&(s[n]=r)}e=[i,s]}}return this.state.bounds=e,e}setData(e){let t,{state:i}=this;t=ArrayBuffer.isView(e)?{value:e}:e instanceof Ar?{buffer:e}:e;let r={...this.settings,...t};if(ArrayBuffer.isView(t.value)){if(!t.type)if(this.doublePrecision&&t.value instanceof Float64Array)r.type="float32";else{let e=Zv(t.value);r.type=r.normalized?e.replace("int","norm"):e}r.bytesPerElement=t.value.BYTES_PER_ELEMENT,r.stride=ey(r)}if(i.bounds=null,t.constant){let e=t.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),i.constant&&this._areValuesEqual(e,this.value))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(t.buffer){let e=t.buffer;i.externalBuffer=e,i.constant=!1,this.value=t.value||null}else if(t.value){this._checkExternalBuffer(t);let e=t.value;i.externalBuffer=null,i.constant=!1,this.value=e;let{buffer:n}=this,s=ey(r),o=(r.vertexOffset||0)*s;if(this.doublePrecision&&e instanceof Float64Array&&(e=mf(e,r)),this.settings.isIndexed){let t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}let a=e.byteLength+o+2*s;(!n||n.byteLength<a)&&(n=this._createBuffer(a)),n.write(e,o)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?mf(t,{size:this.size,startIndex:i,endIndex:r}):t.subarray(i,r),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){let{state:i}=this,r=i.allocatedValue,n=hf.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=n;let{byteOffset:s}=this,{buffer:o}=this;return(!o||o.byteLength<n.byteLength+s)&&(o=this._createBuffer(n.byteLength+s),t&&r&&o.write(r instanceof Float64Array?mf(r,this):r,s)),i.allocatedValue=n,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);let i=this.settings.defaultType,r=!1;if(this.doublePrecision&&(r=t.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&wi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map((e=>(e+128)/255*2-1));case"snorm16":return new Float32Array(e).map((e=>(e+32768)/65535*2-1));case"unorm8":return new Float32Array(e).map((e=>e/255));case"unorm16":return new Float32Array(e).map((e=>e/65535));default:return e}}_normalizeValue(e,t,i){let{defaultValue:r,size:n}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let e=n;for(;--e>=0;)t[i+e]=r[e];return t}switch(n){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let s=n;for(;--s>=0;)t[i+s]=Number.isFinite(e[s])?e[s]:r[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:t?Ar.INDEX:Ar.VERTEX,indexType:t?i:void 0,byteLength:e}),this._buffer}},ry=[],ny=[];function sy(e,t=0,i=1/0){let r=ry,n={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?r=e:e.length>0&&(ny.length=e.length,r=ny):r=ry,(t>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,i),n.index=t-1),{iterable:r,objectInfo:n}}function oy(e){return e&&e[Symbol.asyncIterator]}function ay(e,t){let{size:i,stride:r,offset:n,startIndices:s,nested:o}=t,a=e.BYTES_PER_ELEMENT,l=r?r/a:i,u=n?n/a:0,h=Math.floor((e.length-u)/l);return(t,{index:r,target:n})=>{if(!s){let t=r*l+u;for(let r=0;r<i;r++)n[r]=e[t+r];return n}let a,c=s[r],d=s[r+1]||h;if(o){a=new Array(d-c);for(let t=c;t<d;t++){let r=t*l+u;n=new Array(i);for(let t=0;t<i;t++)n[t]=e[r+t];a[t-c]=n}}else if(l===i)a=e.subarray(c*i+u,d*i+u);else{a=new e.constructor((d-c)*i);let t=0;for(let r=c;r<d;r++){let n=r*l+u;for(let r=0;r<i;r++)a[t++]=e[n+r]}}return a}}var ly=[],uy=[[0,1/0]],hy={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function cy(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let i=e.type||"interpolation";return{...hy[i],...t,...e,type:i}}var dy=class extends iy{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:uy}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){this.state.layoutChanged||=!function(e,t){return e.type===t.type&&e.size===t.size&&ey(e)===ey(t)&&(e.offset||0)===(t.offset||0)}(e,this.getAccessor()),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,i=this.settings.transition;return cy(Array.isArray(t)?e[t.find((t=>e[t]))]:e[t],i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:e=0,endRow:i=1/0}=t;this.state.updateRanges=function(e,t){if(e===uy||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let i=[],r=e.length,n=0;for(let s=0;s<r;s++){let r=e[s];r[1]<t[0]?(i.push(r),n=s+1):r[0]>t[1]?i.push(r):t=[Math.min(r[0],t[0]),Math.max(r[1],t[1])]}return i.splice(n,0,t),i}(this.state.updateRanges,[e,i])}else this.state.updateRanges=uy}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=ly}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:i}=this;return!i.noAlloc&&!!i.update&&(super.allocate(e,t.updateRanges!==uy),!0)}updateBuffer({numInstances:e,data:t,props:i,context:r}){if(!this.needsUpdate())return!1;let{state:{updateRanges:n},settings:{update:s,noAlloc:o}}=this,a=!0;if(s){for(let[o,a]of n)s.call(r,this,{data:t,startRow:o,endRow:a,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[t,i]of n){let r=Number.isFinite(t)?this.getVertexOffset(t):0,n=Number.isFinite(i)?this.getVertexOffset(i):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:r,endOffset:n})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){return void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let n=e;gg(ArrayBuffer.isView(n.value),`invalid ${r.accessor}`);let s=Boolean(n.size)&&n.size!==this.size;return i.binaryAccessor=ay(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(let i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(){this.state.layoutChanged=!1;let e=this.settings.shaderAttributes,t=super.getBufferLayout();if(!e)return t;for(let i in e){let r=super.getBufferLayout(i,e[i]);t.attributes.push(...r.attributes)}return t}_autoUpdater(e,{data:t,startRow:i,endRow:r,props:n,numInstances:s}){if(e.constant)return;let{settings:o,state:a,value:l,size:u,startIndices:h}=e,{accessor:c,transform:d}=o,f=a.binaryAccessor||("function"==typeof c?c:n[c]);gg("function"==typeof f,`accessor "${c}" is not a function`);let p=e.getVertexOffset(i),{iterable:g,objectInfo:m}=sy(t,i,r);for(let t of g){m.index++;let i=f(t,m);if(d&&(i=d.call(this,i)),h){let t=(m.index<h.length-1?h[m.index+1]:s)-h[m.index];if(i&&Array.isArray(i[0])){let t=p;for(let r of i)e._normalizeValue(r,l,t),t+=u}else i&&i.length>u?l.set(i,p):(e._normalizeValue(i,m.target,0),rg({target:l,source:m.target,start:p,count:t}));p+=t*u}else e._normalizeValue(i,l,p),p+=u}}_validateAttributeUpdaters(){let{settings:e}=this;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function fy(e){let{source:t,target:i,start:r=0,size:n,getData:s}=e,o=e.end||i.length,a=t.length,l=o-r;if(a>l)return void i.set(t.subarray(0,l),r);if(i.set(t,r),!s)return;let u=a;for(;u<l;){let e=s(u,t);for(let t=0;t<n;t++)i[r+u]=e[t]||0,u++}}function py(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function gy(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function my(e){e.push(e.shift())}function _y({device:e,source:t,target:i}){return(!i||i.byteLength<t.byteLength)&&(i?.destroy(),i=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),i}function vy({device:e,buffer:t,attribute:i,fromLength:r,toLength:n,fromStartIndices:s,getData:o=(e=>e)}){let a=i.doublePrecision&&i.value instanceof Float64Array?2:1,l=i.size*a,u=i.byteOffset,h=i.settings.bytesPerElement<4?u/i.settings.bytesPerElement*4:u,c=i.startIndices,d=s&&c,f=i.isConstant;if(!d&&t&&r>=n)return t;let p=i.value instanceof Float64Array?Float32Array:i.value.constructor,g=f?i.value:new p(i.getBuffer().readSyncWebGL(u,n*p.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!f){let e=o;o=(t,r)=>i.normalizeConstant(e(t,r))}let m=f?(e,t)=>o(g,t):(e,t)=>o(g.subarray(e+u,e+u+l),t),_=t?new Float32Array(t.readSyncWebGL(h,4*r).buffer):new Float32Array(0),v=new Float32Array(n);return function({source:e,target:t,size:i,getData:r,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return fy({source:e,target:t,size:i,getData:r}),t;let o=0,a=0,l=r&&((e,t)=>r(e+a,t)),u=Math.min(n.length,s.length);for(let r=1;r<u;r++){let u=n[r]*i,h=s[r]*i;fy({source:e.subarray(o,u),target:t,start:a,end:h,size:i,getData:l}),o=u,a=h}a<t.length&&fy({source:[],target:t,start:a,size:i,getData:l})}({source:_,target:v,sourceStartIndices:s,targetStartIndices:c,size:l,getData:m}),(!t||t.byteLength<v.byteLength+h)&&(t?.destroy(),t=e.createBuffer({byteLength:v.byteLength+h,usage:35050})),t.write(v,h),t}var yy=class{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new hg(i),this.attribute=t,this.attributeInTransition=function(e){let{device:t,settings:i,value:r}=e,n=new dy(t,i);return n.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),n}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){let{doublePrecision:i,settings:r,value:n,size:s}=e,o=i&&n instanceof Float64Array?2:1,a=0,{shaderAttributes:l}=e.settings;if(l)for(let e of Object.values(l))a=Math.max(a,e.vertexOffset??0);return(r.noAlloc?n.length:(t+a)*s)*o}(this.attribute,t),this.transition.start({...e,duration:i})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let e of this.buffers)e.destroy();this.buffers.length=0}},by="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",Ay="#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",Ey="#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}",wy={interpolation:class extends yy{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=function(e,t){let i=py(t.size);return new mp(e,{vs:by,bufferLayout:[{name:"aFrom",format:gy(t.size)},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"]})}(e,t)}start(e,t){let i=this.currentLength,r=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();let{buffers:n,attribute:s}=this;my(n),n[0]=vy({device:this.device,buffer:n[0],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),n[1]=_y({device:this.device,source:n[0],target:n[1]}),this.setBuffer(n[1]);let{transform:o}=this,a=o.model;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?(a.setAttributes({aFrom:n[0]}),a.setConstantAttributes({aTo:s.value})):a.setAttributes({aFrom:n[0],aTo:s.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:n[1]})}onUpdate(){let{duration:e,easing:t}=this.settings,{time:i}=this.transition,r=i/e;t&&(r=t(r));let{model:n}=this.transform;n.setUniforms({time:r}),n.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends yy{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){let i=py(t.size),r=gy(t.size);return new mp(e,{vs:Ay,fs:Ey,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){let i=this.currentLength,r=this.currentStartIndices;super.start(e,t);let{buffers:n,attribute:s}=this;for(let t=0;t<2;t++)n[t]=vy({device:this.device,buffer:n[t],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});n[2]=_y({device:this.device,source:n[0],target:n[2]}),this.setBuffer(n[1]);let{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?o.setConstantAttributes({aTo:s.value}):o.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:e,transform:t,framebuffer:i,transition:r}=this,n=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]}),t.model.setUniforms({stiffness:n.stiffness,damping:n.damping}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),my(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}},xy="attributeManager.invalidate",Ty=class{constructor(e,{id:t="attribute-manager",stats:i,timeline:r}={}){this.mergeBoundsMemoized=Xc(_f),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new class{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(let i in e){let r=e[i],n=r.getTransitionSetting(t);n&&this._updateAttribute(i,r,n)}for(let i in this.transitions){let r=e[i];(!r||!r.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(let e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){let r=this.transitions[e],n=!r||r.type!==i.type;if(n){r&&this._removeTransition(e);let s=wy[i.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(wi.error(`unsupported transition type '${i.type}'`)(),n=!1)}(n||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}(e,{id:`${t}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(let t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let i=this._invalidateTrigger(e,t);Ci(xy,this,e,i)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Ci(xy,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:r,props:n={},buffers:s={},context:o={}}){let a=!1;Ci("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let r in this.attributes){let l=this.attributes[r],u=l.settings.accessor;l.startIndices=i,l.numInstances=t,n[r]&&wi.removed(`props.${r}`,`data.attributes.${r}`)(),l.setExternalBuffer(s[r])||l.setBinaryValue("string"==typeof u?s[u]:void 0,e.startIndices)||"string"==typeof u&&!s[u]&&l.setConstantValue(n[u])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:n,context:o})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}a&&Ci("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:r})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let t=e.map((e=>this.attributes[e]?.getBounds()));return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(let n in t){let s=t[n];s.needsRedraw(e)&&!i.hasAttribute(n)&&(r[n]=s)}return r}getBufferLayouts(e,t={}){e||(e=this.getAttributes());let i=[];for(let r in e)t[r]||i.push(e[r].getBufferLayout());return i}_add(e,t={}){for(let i in e){let r=e[i];this.attributes[i]=this._createAttribute(i,r,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,i){let r={...t,id:e,size:(t.isIndexed?1:t.size)||1,divisor:i.instanced?1:t.divisor||0};return new dy(this.device,r)}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach((i=>{e[i]||(e[i]=[]),e[i].push(t)}));this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:i,updateTriggers:r}=this,n=r[e];return n&&n.forEach((e=>{let r=i[e];r&&r.setNeedsUpdate(r.id,t)})),n}_updateAttribute(e){let{attribute:t,numInstances:i}=e;Ci("attribute.updateStart",t),t.constant?t.setConstantValue(t.value):(t.allocate(i)&&Ci("attribute.allocate",t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Ci("attribute.updateEnd",t,i)))}},Cy=1e-5;function Sy(e,t,i,r,n){let s=t-e;return(i-t)*n+-s*r+s+t}function Py(e,t){if(Array.isArray(e)){let i=0;for(let r=0;r<e.length;r++){let n=e[r]-t[r];i+=n*n}return Math.sqrt(i)}return Math.abs(e-t)}var My={interpolation:class extends hg{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:i,duration:r,easing:n}}=this,s=n(e/r);this._value=wo(t,i,s)}},spring:class extends hg{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:i,stiffness:r}=this.settings,{_prevValue:n=e,_currValue:s=e}=this,o=function(e,t,i,r,n){if(Array.isArray(i)){let s=[];for(let o=0;o<i.length;o++)s[o]=Sy(e[o],t[o],i[o],r,n);return s}return Sy(e,t,i,r,n)}(n,s,t,i,r),a=Py(o,t),l=Py(o,s);a<Cy&&l<Cy&&(o=t,this.end()),this._prevValue=s,this._currValue=o}}};function Ry(e,t){let i=By({newProps:e,oldProps:t,propTypes:e[Jp],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=function(e,t){if(null===t)return"oldProps is null, initial diff";let i=!1,{dataComparator:r,_dataDiff:n}=e;return r?r(e.data,t.data)||(i="Data comparator detected a change"):e.data!==t.data&&(i="A new data container was supplied"),i&&n&&(i=n(e.data,t.data)||i),i}(e,t),n=!1;return r||(n=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers&&Fy(e,t,"all"))return{all:!0};let i={},r=!1;for(let n in e.updateTriggers)"all"!==n&&Fy(e,t,n)&&(i[n]=!0,r=!0);return!!r&&i}(e,t)),{dataChanged:r,propsChanged:i,updateTriggersChanged:n,extensionsChanged:Oy(e,t),transitionsChanged:Iy(e,t)}}function Iy(e,t){if(!e.transitions)return!1;let i={},r=e[Jp],n=!1;for(let s in e.transitions){let o=r[s],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&Ly(e[s],t[s],o)&&(i[s]=!0,n=!0)}return!!n&&i}function By({newProps:e,oldProps:t,ignoreProps:i={},propTypes:r={},triggerName:n="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${n} changed shallowly`;if("object"!=typeof t||null===t)return`${n} changed shallowly`;for(let s of Object.keys(e))if(!(s in i)){if(!(s in t))return`${n}.${s} added`;let i=Ly(e[s],t[s],r[s]);if(i)return`${n}.${s} ${i}`}for(let s of Object.keys(t))if(!(s in i)){if(!(s in e))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){let i=Ly(e[s],t[s],r[s]);if(i)return`${n}.${s} ${i}`}}return!1}function Ly(e,t,i){let r=i&&i.equal;return r&&!r(e,t,i)||!r&&(r=e&&t&&e.equals,r&&!r.call(e,t))?"changed deeply":r||t===e?null:"changed shallowly"}function Oy(e,t){if(null===t)return!0;let i=t.extensions,{extensions:r}=e;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let e=0;e<r.length;e++)if(!r[e].equals(i[e]))return!0;return!1}function Fy(e,t,i){let r=e.updateTriggers[i];r=r??{};let n=t.updateTriggers[i];return n=n??{},By({oldProps:n,newProps:r,triggerName:i})}var Ny="count(): argument not an object",Dy="count(): argument not a container";function ky(e){if(!function(e){return null!==e&&"object"==typeof e}(e))throw new Error(Ny);if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error(Dy)}function Uy(e,t){if(!t)return e;let i={...e,...t};if("defines"in t&&(i.defines={...e.defines,...t.defines}),"modules"in t&&(i.modules=(e.modules||[]).concat(t.modules),t.modules.some((e=>"project64"===e.name)))){let e=i.modules.findIndex((e=>"project32"===e.name));e>=0&&i.modules.splice(e,1)}if("inject"in t)if(e.inject){let r={...e.inject};for(let e in t.inject)r[e]=(r[e]||"")+t.inject[e];i.inject=r}else i.inject=t.inject;return i}var Gy={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},zy={},Vy={boolean:{validate:(e,t)=>!0,equal:(e,t,i)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||Wy(e)&&(3===e.length||4===e.length),equal:(e,t,i)=>sg(e,t,1)},accessor:{validate(e,t){let i=Xy(e);return"function"===i||i===Xy(t.value)},equal:(e,t,i)=>"function"==typeof t||sg(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||Wy(e),equal(e,t,i){let{compare:r}=i,n=Number.isInteger(r)?r:r?1:0;return r?sg(e,t,n):e===t}},object:{equal(e,t,i){if(i.ignore)return!0;let{compare:r}=i,n=Number.isInteger(r)?r:r?1:0;return r?sg(e,t,n):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,i)=>!i.compare&&!1!==i.ignore||e===t},data:{transform:(e,t,i)=>{if(!e)return e;let{dataTransform:r}=i.props;return r?r(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,i)=>{let r=i.context;return r&&r.device?function(e,t,i,r){if(i instanceof Hr)return i;i.constructor&&"Object"!==i.constructor.name&&(i={data:i});let n=null;i.compressed&&(n={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});let s=t.createTexture({...i,sampler:{...Gy,...n,...r}});return zy[s.id]=e,s}(i.id,r.device,e,{...t.parameters,...i.props.textureParameters}):null},release:(e,t,i)=>{!function(e,t){!t||!(t instanceof Hr)||zy[t.id]===e&&(t.delete(),delete zy[t.id])}(i.id,e)}}};function jy(e,t){switch(Xy(t)){case"object":return Hy(e,t);case"array":return Hy(e,{type:"array",value:t,compare:!1});case"boolean":return Hy(e,{type:"boolean",value:t});case"number":return Hy(e,{type:"number",value:t});case"function":return Hy(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Hy(e,t){return"type"in t?{name:e,...Vy[t.type],...t}:"value"in t?{name:e,type:Xy(t.value),...t}:{name:e,type:"object",value:t}}function Wy(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Xy(e){return Wy(e)?"array":null===e?"null":typeof e}var qy="_mergedDefaultProps";function Ky(e,t){let i=qy;if(t)for(let e of t){let t=e.constructor;t&&(i+=`:${t.extensionName||t.name}`)}return Yy(e,i)||(e[i]=function(e,t){if(!e.prototype)return null;let i=Object.getPrototypeOf(e),r=Ky(i),n=Yy(e,"defaultProps")||{},s=function(e){let t={},i={},r={};for(let[n,s]of Object.entries(e)){let e=s?.deprecatedFor;if(e)r[n]=Array.isArray(e)?e:[e];else{let e=jy(n,s);t[n]=e,i[n]=e.value}}return{propTypes:t,defaultProps:i,deprecatedProps:r}}(n),o=Object.assign(Object.create(null),r,s.defaultProps),a=Object.assign(Object.create(null),r?.[Jp],s.propTypes),l=Object.assign(Object.create(null),r?.[Yp],s.deprecatedProps);for(let e of t){let t=Ky(e.constructor);t&&(Object.assign(o,t),Object.assign(a,t[Jp]),Object.assign(l,t[Yp]))}return function(e,t){let i=function(e){let t=e.componentName;return t||wi.warn(`${e.name}.componentName not specified`)(),t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:i}})}(o,e),function(e,t){let i={},r={};for(let e in t){let n=t[e],{name:s,value:o}=n;n.async&&(i[s]=o,r[s]=$y(s))}e[Zp]=i,e[Qp]={},Object.defineProperties(e,r)}(o,a),function(e,t){for(let i in t)Object.defineProperty(e,i,{enumerable:!1,set(e){let r=`${this.id}: ${i}`;for(let r of t[i])Jy(this,r)||(this[r]=e);wi.deprecated(r,t[i].join("/"))()}})}(o,l),o[Jp]=a,o[Yp]=l,0===t.length&&!Jy(e,"_propTypes")&&(e._propTypes=a),o}(e,t||[]))}function $y(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||oy(t)?this[Qp][e]=t:this[eg][e]=t},get(){if(this[eg]){if(e in this[eg])return this[eg][e]||this[Zp][e];if(e in this[Qp]){let t=this[$p]&&this[$p].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Zp][e]}}return this[Zp][e]}}}function Jy(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Yy(e,t){return Jy(e,t)&&e[t]}var Zy=0,Qy=class{constructor(...e){this.props=function(e,t){let i;for(let e=t.length-1;e>=0;e--){let r=t[e];"extensions"in r&&(i=r.extensions)}let r=Ky(e.constructor,i),n=Object.create(r);n[$p]=e,n[Qp]={},n[eg]={};for(let e=0;e<t.length;++e){let i=t[e];for(let e in i)n[e]=i[e]}return Object.freeze(n),n}(this,e),this.id=this.props.id,this.count=Zy++}clone(e){let{props:t}=this,i={};for(let e in t[Zp])e in t[eg]?i[e]=t[eg][e]:e in t[Qp]&&(i[e]=t[Qp][e]);return new this.constructor({...t,...i,...e})}},eb=Qy;Qy.componentName="Component",Qy.defaultProps={};var tb=Object.freeze({}),ib=class{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||tb}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[$p]||this.component;let t=e[eg]||{},i=e[Qp]||e,r=e[Zp]||{};for(let e in t){let i=t[e];this._createAsyncPropData(e,r[e]),this._updateAsyncProp(e,i),t[e]=this.getAsyncProp(e)}for(let e in i){let t=i[e];this._createAsyncPropData(e,r[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise)return void this._watchPromise(e,t);if(oy(t))return void this._resolveAsyncIterable(e,t);this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){let i=this.asyncProps[e];return t!==i.resolvedValue&&t!==i.lastValue&&(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){let r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),r.resolvedValue=t,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let r=i.pendingLoadCount;t.then((t=>{this.component&&(t=this._postProcessValue(i,t),this._setAsyncPropValue(e,t,r),this._onResolve(e,t))})).catch((t=>{this._onError(e,t)}))}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let r=i.pendingLoadCount,n=[],s=0;for await(let i of t){if(!this.component)return;let{dataTransform:t}=this.component.props;n=t?t(i,n):n.concat(i),Object.defineProperty(n,"__diff",{enumerable:!1,value:[{startRow:s,endRow:n.length}]}),s=n.length,this._setAsyncPropValue(e,n,r)}this._onResolve(e,n)}_postProcessValue(e,t){let i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let i=this.component&&this.component.props[Jp];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}},rb=class extends ib{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){let i=this.layer,r=i?.props.fetch;return r?r(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){let i=this.layer;if(i){let r=i.props.onDataLoad;"data"===e&&r&&r(t,{propName:e,layer:i})}}_onError(e,t){let i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}},nb=2**24-1,sb=Object.freeze([]),ob=Xc((({oldViewport:e,viewport:t})=>e.equals(t))),ab=new Uint8ClampedArray(0),lb={data:{type:"data",value:sb,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:i,loaders:r,loadOptions:n,signal:s})=>{let{resourceManager:o}=i.context;n=n||i.getLoadOptions(),r=r||i.props.loaders,s&&(n={...n,fetch:{...n?.fetch,signal:s}});let a=o.contains(e);return!a&&!n&&(o.add({resourceId:e,data:Zt(e,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:e,onChange:e=>i.internalState?.reloadAsyncProp(t,e),consumerId:i.id,requestId:t}):Zt(e,r,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Nc.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},ub=class extends eb{constructor(){super(...arguments),this.internalState=null,this.lifecycle=jp,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){gg(this.internalState);let t=this.internalState.viewport||this.context.viewport,i=Pf(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,n,s]=Pd(i,t.pixelProjectionMatrix);return 2===e.length?[r,n]:[r,n,s]}unproject(e){return gg(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return gg(this.internalState),Mf(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(let t of this.getModels())t.updateModuleSettings(e)}setShaderModuleProps(...e){for(let t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===Nc.DEFAULT||e===Nc.LNGLAT||e===Nc.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){gg(e instanceof Uint8Array);let[t,i,r]=e;return t+256*i+65536*r-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:ky(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=Uy(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let t of this.props.extensions)e=Uy(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(let e of i)t.invalidateAll(e);else t.invalidateAll();if(t){let{props:i}=e,r=this.internalState.hasPickingBuffer,n=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some((e=>e.getNeedsPickingBuffer.call(this,e)));if(r!==n){this.internalState.hasPickingBuffer=n;let{pickingColors:e,instancePickingColors:i}=t.attributes,r=e||i;r&&(n&&r.constant&&(r.constant=!1,t.invalidate(r.id)),!r.value&&!n&&(r.constant=!0,r.value=[0,0,0]))}}}finalizeState(e){for(let e of this.getModels())e.destroy();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:i}){let{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,(!t||!ob({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(let i in e)e[i].layoutChanged()&&(t=!0);for(let i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let n=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),i=Object.create(this.props);for(let e in t)Object.defineProperty(i,e,{value:t[e]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let i=Math.floor(ab.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>nb&&wi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ab=hf.allocate(ab,t,{size:4,copy:!0,maxCount:Math.max(t,nb)});let e=Math.floor(ab.length/4),r=[];for(let t=i;t<e;t++)this.encodePickingColor(t,r),ab[4*t+0]=r[0],ab[4*t+1]=r[1],ab[4*t+2]=r[2]}e.value=ab.subarray(0,4*t)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){let i=this.getAttributeManager();e.setBufferLayout(i.getBufferLayouts()),t=i.getAttributes()}let r=e.userData?.excludeAttributes||{},n={},s={};for(let i in t){if(r[i])continue;let o=t[i].getValue();for(let r in o){let a=o[r];a instanceof Ar?t[i].settings.isIndexed?e.setIndexBuffer(a):n[r]=a:a&&(s[r]=a)}}e.setAttributes(n),e.setConstantAttributes(s)}disablePickingIndex(e){let t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);let{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,n=i||r,s=n&&t.attributes&&t.attributes[n.id];if(s&&s.value){let i=s.value,r=this.encodePickingColor(e);for(let e=0;e<t.length;e++){let t=n.getVertexOffset(e);i[t]===r[0]&&i[t+1]===r[1]&&i[t+2]===r[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,r=t||i;if(!r)return;let n=r.getVertexOffset(e),s=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(s-n),n)}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==ab.buffer&&(i.value=ab.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){gg(!this.internalState),gg(Number.isFinite(this.props.coordinateSystem)),Ci("layer.initialize",this);let e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new rb({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(wi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new class{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,r){let{transitions:n}=this;if(n.has(e)){let i=n.get(e),{value:r=i.settings.fromValue}=i;t=r,this.remove(e)}if(!(r=cy(r)))return;let s=My[r.type];if(!s)return void wi.error(`unsupported transition type '${r.type}'`)();let o=new s(this.timeline);o.start({...r,fromValue:t,toValue:i}),n.set(e,o)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}}(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ci("layer.matched",this,this===e);let{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(Ci("layer.update",this,e),!e)return;let t=this.props,i=this.context,r=this.internalState,n=i.viewport,s=this._updateUniformTransition();r.propsInTransition=s,i.viewport=r.viewport||n,this.props=s;try{let e=this._getUpdateParams(),t=this.getModels();if(i.device)this.updateState(e);else try{this.updateState(e)}catch{}for(let t of this.props.extensions)t.updateState.call(this,e,t);let r=this.getModels()[0]!==t[0];this._postUpdate(e,r)}finally{i.viewport=n,this.props=t,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ci("layer.finalize",this),this.finalizeState(this.context);for(let e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:t=null,uniforms:i={},parameters:r={}}){this._updateAttributeTransition();let n=this.props,s=this.context;this.props=this.internalState.propsInTransition||n;let o=this.props.opacity;i.opacity=Math.pow(o,1/2.2);try{if(t){let{isActive:e,isAttribute:i}=t.picking;this.setModuleParameters(t),this.setShaderModuleProps({picking:{isActive:e,isAttribute:i}})}let{getPolygonOffset:n}=this.props,o=n&&n(i)||[0,0];s.device.setParametersWebGL({polygonOffset:o});for(let e of this.getModels())e.setParameters(r);s.device.withParametersWebGL(r,(()=>{let n={renderPass:e,moduleParameters:t,uniforms:i,parameters:r,context:s};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)}))}finally{this.props=n}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let i in e)if(e[i]){let r=!1;if("dataChanged"===i){let n=e[i],s=t[i];n&&Array.isArray(s)&&(t.dataChanged=Array.isArray(n)?s.concat(n):n,r=!0)}t[i]||(t[i]=e[i],r=!0),r&&Ci("layer.changeFlag",this,i,e)}let i=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let i=Ry(e,t);if(i.updateTriggersChanged)for(let e in i.updateTriggersChanged)i.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(i.transitionsChanged)for(let r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],e.transitions?.[r]);return this.setChangeFlags(i)}validateProps(){!function(e){let t=e[Jp];for(let i in t){let r=t[i],{validate:n}=r;if(n&&!n(e[i],r))throw new Error(`Invalid prop ${i}: ${e[i]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&"function"==typeof i&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new Ty(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes(),this.state.model?.setInstanceCount(this.getNumInstances());let{autoHighlight:n,highlightedObjectIndex:s,highlightColor:o}=i;if(t||r.autoHighlight!==n||r.highlightedObjectIndex!==s||r.highlightColor!==o){let e={};n||(e.highlightedObjectColor=null),Array.isArray(o)&&(e.highlightColor=o),(t||s!==r.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;let i=this.getAttributeManager(),r=!!i&&i.getNeedsRedraw(e);if(t=t||r,t)for(let e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}},hb=ub;ub.defaultProps=lb,ub.layerName="Layer";var cb=class extends hb{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){let{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if("function"==typeof e){let t={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,r)}return e}getSubLayerProps(e={}){let{opacity:t,pickable:i,visible:r,parameters:n,getPolygonOffset:s,highlightedObjectIndex:o,autoHighlight:a,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:c,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m,_subLayerProps:_}=this.props,v={id:"",updateTriggers:{},opacity:t,pickable:i,visible:r,parameters:n,getPolygonOffset:s,highlightedObjectIndex:o,autoHighlight:a,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:c,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m},y=_&&e.id&&_[e.id],b=y&&y.updateTriggers,A=e.id||"sublayer";if(y){let t=this.props[Jp],i=e.type?e.type._propTypes:{};for(let e in y){let r=i[e]||t[e];r&&"accessor"===r.type&&(y[e]=this.getSubLayerAccessor(y[e]))}}Object.assign(v,e,y),v.id=`${this.props.id}-${A}`,v.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...b};for(let e of p){let t=e.getSubLayerProps.call(this,e);t&&Object.assign(v,t,{updateTriggers:Object.assign(v.updateTriggers,t.updateTriggers)})}return v}_updateAutoHighlight(e){for(let t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers,r=!i||this.needsUpdate();r&&(i=tg(this.renderLayers(),Boolean),this.internalState.subLayers=i),Ci("compositeLayer.renderLayers",this,r,i);for(let e of i)e.parent=this}},db=cb;cb.layerName="CompositeLayer";var fb=Math.PI/180,pb=180/Math.PI,gb=6370972,mb=256;function _b(){let e=mb/gb,t=Math.PI/180*mb;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}var vb=class extends wf{constructor(e={}){let{latitude:t=0,longitude:i=0,zoom:r=0,nearZMultiplier:n=.1,farZMultiplier:s=2,resolution:o=10}=e,{height:a,altitude:l=1.5}=e;a=a||1,l=Math.max(.75,l);let u=(new Oh).lookAt({eye:[0,-l,0],up:[0,0,1]}),h=Math.pow(2,r);u.rotateX(t*fb),u.rotateZ(-i*fb),u.scale(h/a);let c=Math.atan(.5/l),d=512*h/a;super({...e,height:a,viewMatrix:u,longitude:i,latitude:t,zoom:r,distanceScales:_b(),fovyRadians:2*c,focalDistance:l,near:n,far:Math.min(2,1/d+1)*l*s}),this.latitude=t,this.longitude=i,this.resolution=o}get projectionMode(){return Dc.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),r=this.unproject([this.width/2,0],t),n=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return n[0]<this.longitude&&(n[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],n[0],r[0],s[0]),Math.min(i[1],n[1],r[1],s[1]),Math.max(i[0],n[0],r[0],s[0]),Math.max(i[1],n[1],r[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let r,[n,s,o]=e,a=t?s:this.height-s,{pixelUnprojectionMatrix:l}=this;if(Number.isFinite(o))r=yb(l,[n,a,o,1]);else{let e=yb(l,[n,a,-1,1]),t=yb(l,[n,a,1,1]),s=((i||0)/gb+1)*mb,o=Ra.sqrLen(Ra.sub([],e,t)),u=Ra.sqrLen(e),h=Ra.sqrLen(t),c=(4*u*h-(o-u-h)**2)/16*4/o,d=(Math.sqrt(u-c)-Math.sqrt(Math.max(0,s*s-c)))/Math.sqrt(o);r=Ra.lerp([],e,t,d)}let[u,h,c]=this.unprojectPosition(r);return Number.isFinite(o)?[u,h,c]:Number.isFinite(i)?[u,h,i]:[u,h]}projectPosition(e){let[t,i,r=0]=e,n=t*fb,s=i*fb,o=Math.cos(s),a=(r/gb+1)*mb;return[Math.sin(n)*o*a,-Math.cos(n)*o*a,Math.sin(s)*a]}unprojectPosition(e){let[t,i,r]=e,n=Ra.len(e),s=Math.asin(r/n);return[Math.atan2(t,-i)*pb,s*pb,(n/mb-1)*gb]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){let i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}};function yb(e,t){let i=ku.transformMat4([],t,e);return ku.scale(i,i,1/i[3]),i}var bb=Math.PI/180;function Ab({height:e,focalDistance:t,orbitAxis:i,rotationX:r,rotationOrbit:n,zoom:s}){let o="Z"===i?[0,0,1]:[0,1,0],a="Z"===i?[0,-t,0]:[0,0,t],l=(new Oh).lookAt({eye:a,up:o});l.rotateX(r*bb),"Z"===i?l.rotateZ(n*bb):l.rotateY(n*bb);let u=Math.pow(2,s)/e;return l.scale(u),l}var Eb=class extends wf{constructor(e){let{height:t,projectionMatrix:i,fovy:r=50,orbitAxis:n="Z",target:s=[0,0,0],rotationX:o=0,rotationOrbit:a=0,zoom:l=0}=e,u=i?i[5]/2:Sd(r);super({...e,longitude:void 0,viewMatrix:Ab({height:t||1,focalDistance:u,orbitAxis:n,rotationX:o,rotationOrbit:a,zoom:l}),fovy:r,focalDistance:u,position:s,zoom:l}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:t=!0}={}){let[i,r,n=this.projectedCenter[2]]=e,s=t?r:this.height-r,[o,a,l]=Md([i,s,n],this.pixelUnprojectionMatrix);return[o,a,l]}panByPosition(e,t){let i=this.project(e),r=[this.width/2+i[0]-t[0],this.height/2+i[1]-t[1],this.projectedCenter[2]];return{target:this.unproject(r)}}},wb=(new Oh).lookAt({eye:[0,0,1]});function xb({width:e,height:t,near:i,far:r,padding:n}){let s=-e/2,o=e/2,a=-t/2,l=t/2;if(n){let{left:i=0,right:r=0,top:u=0,bottom:h=0}=n,c=Eo((i+e-r)/2,0,e)-e/2,d=Eo((u+t-h)/2,0,t)-t/2;s-=c,o-=c,a+=d,l+=d}return(new Oh).ortho({left:s,right:o,bottom:a,top:l,near:i,far:r})}var Tb=class extends wf{constructor(e){let t,{width:i,height:r,near:n=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:l=null,flipY:u=!0}=e,h=Array.isArray(o)?o[0]:o,c=Array.isArray(o)?o[1]:o,d=Math.min(h,c),f=Math.pow(2,d);if(h!==c){let e=Math.pow(2,h),i=Math.pow(2,c);t={unitsPerMeter:[e/f,i/f,1],metersPerUnit:[f/e,f/i,1]}}super({...e,longitude:void 0,position:a,viewMatrix:wb.clone().scale([f,f*(u?-1:1),f]),projectionMatrix:xb({width:i||1,height:r||1,padding:l,near:n,far:s}),zoom:d,distanceScales:t})}projectFlat([e,t]){let{unitsPerMeter:i}=this.distanceScales;return[e*i[0],t*i[1]]}unprojectFlat([e,t]){let{metersPerUnit:i}=this.distanceScales;return[e*i[0],t*i[1]]}panByPosition(e,t){let i=Md(t,this.pixelUnprojectionMatrix),r=this.projectFlat(e),n=Io.add([],r,Io.negate([],i)),s=Io.add([],this.center,n);return{target:this.unprojectFlat(s)}}},Cb=class extends wf{constructor(e){let{longitude:t,latitude:i,modelMatrix:r,bearing:n=0,pitch:s=0,up:o=[0,0,1]}=e,a=new Zh({bearing:n,pitch:-90===s?1e-4:90+s}).toVector3().normalize(),l=r?new Oh(r).transformAsVector(a):a,u=Number.isFinite(i)?Ed({latitude:i}):0,h=Math.pow(2,u),c=(new Oh).lookAt({eye:[0,0,0],center:l,up:o}).scale(h);super({...e,zoom:u,viewMatrix:c}),this.latitude=i,this.longitude=t}},Sb=20,Pb=class extends Rg{constructor(e){let{width:t,height:i,position:r=[0,0,0],bearing:n=0,pitch:s=0,longitude:o=null,latitude:a=null,maxPitch:l=90,minPitch:u=-90,startRotatePos:h,startBearing:c,startPitch:d,startZoomPosition:f,startPanPos:p,startPanPosition:g}=e;super({width:t,height:i,position:r,bearing:n,pitch:s,longitude:o,latitude:a,maxPitch:l,minPitch:u},{startRotatePos:h,startBearing:c,startPitch:d,startZoomPosition:f,startPanPos:p,startPanPosition:g}),this.makeViewport=e.makeViewport}panStart({pos:e}){let{position:t}=this.getViewportProps();return this._getUpdatedState({startPanPos:e,startPanPosition:t})}pan({pos:e}){if(!e)return this;let{startPanPos:t=[0,0],startPanPosition:i=[0,0]}=this.getState(),{width:r,height:n,bearing:s,pitch:o}=this.getViewportProps(),a=500*(e[0]-t[0])/r,l=500*(e[1]-t[1])/n,u=new Zh({bearing:s,pitch:o}),h=new Zh({bearing:s,pitch:-90}),c=u.toVector3().normalize(),d=h.toVector3().cross(c).normalize();return this._getUpdatedState({position:new Rl(i).add(d.scale(a)).add(c.scale(l))})}panEnd(){return this._getUpdatedState({startPanPos:null,startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let r,{startRotatePos:n,startBearing:s,startPitch:o}=this.getState(),{width:a,height:l}=this.getViewportProps();return n&&void 0!==s&&void 0!==o?(r=e?{bearing:s-(e[0]-n[0])/a*180,pitch:o-(e[1]-n[1])/l*90}:{bearing:s-t,pitch:o-i},this._getUpdatedState(r)):this}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({pos:e,scale:t}){let i=this.getViewportProps(),r=this.getState().startZoomPosition||i.position,n=this.makeViewport(i),{projectionMatrix:s,width:o}=n,a=2*Math.atan(1/s[0])*(e[0]/o-.5),l=this.getDirection(!0);return this._move(l.rotateZ({radians:-a}),Math.log2(t)*Sb,r)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(e=20){let t=this.getDirection(!0);return this._move(t.rotateZ({radians:Math.PI/2}),e)}moveRight(e=20){let t=this.getDirection(!0);return this._move(t.rotateZ({radians:-Math.PI/2}),e)}moveUp(e=20){let t=this.getDirection(!0);return this._move(t,e)}moveDown(e=20){let t=this.getDirection(!0);return this._move(t.negate(),e)}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}zoomIn(e=20){return this._move(new Rl(0,0,1),e)}zoomOut(e=20){return this._move(new Rl(0,0,-1),e)}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:n}=i;return Math.abs(r-t.bearing)>180&&(i.bearing=r<0?r+360:r-360),null!==n&&null!==t.longitude&&Math.abs(n-t.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}_move(e,t,i=this.getViewportProps().position){let r=e.scale(t);return this._getUpdatedState({position:new Rl(i).add(r)})}getDirection(e=!1){return new Zh({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(e){return new Pb({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){let{pitch:t,maxPitch:i,minPitch:r,longitude:n,bearing:s}=e;return e.pitch=Eo(t,r,i),null!==n&&(n<-180||n>180)&&(e.longitude=cf(n+180,360)-180),(s<-180||s>180)&&(e.bearing=cf(s+180,360)-180),e}},Mb=class extends Mg{constructor(){super(...arguments),this.ControllerState=Pb,this.transition={transitionDuration:300,transitionInterpolator:new yg(["position","pitch","bearing"])}}},Rb=class extends ug{get ViewportType(){return Cb}get ControllerType(){return Mb}},Ib=Rb;Rb.displayName="FirstPersonView";var Bb=class extends Rg{constructor(e){let{width:t,height:i,rotationX:r=0,rotationOrbit:n=0,target:s=[0,0,0],zoom:o=0,minRotationX:a=-90,maxRotationX:l=90,minZoom:u=-1/0,maxZoom:h=1/0,startPanPosition:c,startRotatePos:d,startRotationX:f,startRotationOrbit:p,startZoomPosition:g,startZoom:m}=e;super({width:t,height:i,rotationX:r,rotationOrbit:n,target:s,zoom:o,minRotationX:a,maxRotationX:l,minZoom:u,maxZoom:h},{startPanPosition:c,startRotatePos:d,startRotationX:f,startRotationOrbit:p,startZoomPosition:g,startZoom:m}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){let i=this.getState().startPanPosition||t;if(!i)return this;let r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let r,{startRotatePos:n,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!n||void 0===s||void 0===o)return this;if(e){let t=(e[0]-n[0])/a;(s<-90||s>90)&&(t*=-1),r={rotationX:s+(e[1]-n[1])/l*180,rotationOrbit:o+180*t}}else r={rotationX:s+i,rotationOrbit:o+t};return this._getUpdatedState(r)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-t.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:r,startZoomPosition:n}=this.getState();if(n||(r=this.getViewportProps().zoom,n=this._unproject(t)||this._unproject(e)),!n)return this;let s=this._calculateNewZoom({scale:i,startZoom:r}),o=this.makeViewport({...this.getViewportProps(),zoom:s});return this._getUpdatedState({zoom:s,...o.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){let{maxZoom:i,minZoom:r}=this.getViewportProps();return void 0===t&&(t=this.getViewportProps().zoom),Eo(t+Math.log2(e),r,i)}_panFromCenter(e){let{width:t,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:r,maxRotationX:n,minRotationX:s,rotationOrbit:o}=e;return e.zoom=Array.isArray(r)?[Eo(r[0],i,t),Eo(r[1],i,t)]:Eo(r,i,t),e.rotationX=Eo(e.rotationX,s,n),(o<-180||o>180)&&(e.rotationOrbit=cf(o+180,360)-180),e}},Lb=class extends Mg{constructor(){super(...arguments),this.ControllerState=Bb,this.transition={transitionDuration:300,transitionInterpolator:new yg({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}},Ob=class extends ug{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}get ViewportType(){return Eb}get ControllerType(){return Lb}},Fb=Ob;Ob.displayName="OrbitView";var Nb=class extends Bb{constructor(e){super(e),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:t}){let{maxZoom:i,minZoom:r}=this.getViewportProps();void 0===t&&(t=this.getViewportProps().zoom);let n=Math.log2(e);if(Array.isArray(t)){let[e,s]=t;switch(this.zoomAxis){case"X":e=Eo(e+n,r,i);break;case"Y":s=Eo(s+n,r,i);break;default:let t=Math.min(e+n,s+n);t<r&&(n+=r-t),t=Math.max(e+n,s+n),t>i&&(n+=i-t),e+=n,s+=n}return[e,s]}return Eo(t+n,r,i)}},Db=class extends Mg{constructor(){super(...arguments),this.ControllerState=Nb,this.transition={transitionDuration:300,transitionInterpolator:new yg(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}},kb=class extends ug{get ViewportType(){return Tb}get ControllerType(){return Db}},Ub=kb;kb.displayName="OrthographicView";var Gb=class extends Ig{applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:r}=e;e.zoom=Eo(r,i,t);let{longitude:n,latitude:s}=e;return(n<-180||n>180)&&(e.longitude=cf(n+180,360)-180),e.latitude=Eo(s,-89,89),e}},zb=class extends Mg{constructor(){super(...arguments),this.ControllerState=Gb,this.transition={transitionDuration:300,transitionInterpolator:new yg(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}},Vb=class extends ug{get ViewportType(){return vb}get ControllerType(){return zb}},jb=Vb;Vb.displayName="GlobeView";var Hb=class{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e||this.constructor===e.constructor&&sg(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){let{defaultProps:t}=e.constructor,i={updateTriggers:{}};for(let e in t)if(e in this.props){let r=t[e],n=this.props[e];i[e]=n,r&&"accessor"===r.type&&(i.updateTriggers[e]=this.props.updateTriggers[e],"function"==typeof n&&(i[e]=this.getSubLayerAccessor(n)))}return i}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}},Wb=Hb;Hb.defaultProps={},Hb.extensionName="LayerExtension";var Xb={bearing:0,pitch:0,position:[0,0,0]},qb={speed:1.2,curve:1.414},Kb=class extends mg{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...qb,...e}}interpolateProps(e,t,i){let r=function(e,t,i,r){let{startZoom:n,startCenterXY:s,uDelta:o,w0:a,u1:l,S:u,rho:h,rho2:c,r0:d}=Nd(e,t,r);if(l<Ld){let r={};for(let n of Od){let s=e[n],o=t[n];r[n]=od(s,o,i)}return r}let f=i*u,p=Math.cosh(d)/Math.cosh(d+h*f),g=a*((Math.cosh(d)*Math.tanh(d+h*f)-Math.sinh(d))/c)/l,m=n+yd(1/p),_=Io.scale([],o,g);Io.add(_,_,s);let v=Ad(_);return{longitude:v[0],latitude:v[1],zoom:m}}(e,t,i,this.opts);for(let n in Xb)r[n]=wo(e[n]||Xb[n],t[n]||Xb[n],i);return r}getDuration(e,t){let{transitionDuration:i}=t;return"auto"===i&&(i=function(e,t,i){let r,n={...Fd,...i},{screenSpeed:s,speed:o,maxDuration:a}=n,{S:l,rho:u}=Nd(e,t,n),h=1e3*l;return r=Number.isFinite(s)?h/(s/u):h/o,Number.isFinite(a)&&r>a?0:r}(e,t,this.opts)),i}},$b=class{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:t={}}=e;this.typedArrayManager=hf,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:t,buffers:i={},getGeometry:r,geometryBuffer:n,positionFormat:s,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=r,this.positionSize=n&&n.size||("XY"===s?2:3),this.buffers=i,this.normalize=a,n&&(gg(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(n),a||(i.vertexPositions=n)),this.geometryBuffer=i.vertexPositions,Array.isArray(o))for(let e of o)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){let t=e.value||e;return ArrayBuffer.isView(t)?ay(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){let{attributes:i,buffers:r,_attributeDefs:n,typedArrayManager:s}=this;for(let o in n)if(o in r)s.release(i[o]),i[o]=null;else{let r=n[o];r.copy=t,i[o]=s.allocate(i[o],e,r)}}_forEachGeometry(e,t,i){let{data:r,getGeometry:n}=this,{iterable:s,objectInfo:o}=sy(r,t,i);for(let t of s)o.index++,e(n?n(t,o):null,o.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:r}=this,{data:n,geometryBuffer:s}=this,{startRow:o=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],i=[0]),this.normalize||!s)this._forEachGeometry(((e,t)=>{let r=e&&this.normalizeGeometry(e);l[t]=r,i[t+1]=i[t]+(r?this.getGeometrySize(r):0)}),o,a),r=i[i.length-1];else if(i=n.startIndices,r=i[n.length]||0,ArrayBuffer.isView(s))r=r||s.length/this.positionSize;else if(s instanceof Ar){let e=4*this.positionSize;r=r||s.byteLength/e}else if(s.buffer){let e=s.stride||4*this.positionSize;r=r||s.buffer.byteLength/e}else if(s.value){let e=s.value,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;r=r||e.length/t}this._allocate(r,Boolean(e)),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=r;let u={};this._forEachGeometry(((e,n)=>{let s=l[n]||e;u.vertexStart=i[n],u.indexStart=t[n];let o=n<i.length-1?i[n+1]:r;u.geometrySize=o-i[n],u.geometryIndex=n,this.updateGeometryAttributes(s,u)}),o,a),this.vertexCount=t[t.length-1]}},Jb=[0,0,0,255],Yb={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:Jb},getTargetColor:{type:"accessor",value:Jb},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Zb=class extends hb{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME arc-layer-vertex-shader\nin vec3 positions;\nin vec4 instanceSourceColors;\nin vec4 instanceTargetColors;\nin vec3 instanceSourcePositions;\nin vec3 instanceSourcePositions64Low;\nin vec3 instanceTargetPositions;\nin vec3 instanceTargetPositions64Low;\nin vec3 instancePickingColors;\nin float instanceWidths;\nin float instanceHeights;\nin float instanceTilts;\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int widthUnits;\nout vec4 vColor;\nout vec2 uv;\nout float isValid;\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\nfloat deltaZ = targetZ - sourceZ;\nfloat dh = distance * instanceHeights;\nif (dh == 0.0) {\nreturn sourceZ + deltaZ * ratio;\n}\nfloat unitZ = deltaZ / dh;\nfloat p2 = unitZ * unitZ + 1.0;\nfloat dir = step(deltaZ, 0.0);\nfloat z0 = mix(sourceZ, targetZ, dir);\nfloat r = mix(ratio, 1.0 - ratio, dir);\nreturn sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\nvec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn dir_screenspace * offset_direction * width / 2.0;\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\nfloat distance = length(source.xy - target.xy);\nfloat z = paraboloid(distance, source.z, target.z, segmentRatio);\nfloat tiltAngle = radians(instanceTilts);\nvec2 tiltDirection = normalize(target.xy - source.xy);\nvec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\nreturn vec3(\nmix(source.xy, target.xy, segmentRatio) + tilt,\nz * cos(tiltAngle)\n);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 sourceRadians = radians(source);\nvec2 targetRadians = radians(target);\nvec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\nvec2 shd_sq = sin_half_delta * sin_half_delta;\nfloat a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\nreturn 2.0 * asin(sqrt(a));\n}\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\nvec2 lngLat;\nif(abs(angularDist - PI) < 0.001) {\nlngLat = (1.0 - t) * source.xy + t * target.xy;\n} else {\nfloat a = sin((1.0 - t) * angularDist);\nfloat b = sin(t * angularDist);\nvec3 p = source3D.yxz * a + target3D.yxz * b;\nlngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n}\nfloat z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\nreturn vec3(lngLat, z);\n}\nvoid main(void) {\ngeometry.worldPosition = instanceSourcePositions;\ngeometry.worldPositionAlt = instanceTargetPositions;\nfloat segmentIndex = positions.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\nfloat nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nisValid = 1.0;\nuv = vec2(segmentRatio, positions.y);\ngeometry.uv = uv;\ngeometry.pickingColor = instancePickingColors;\nvec4 curr;\nvec4 next;\nvec3 source;\nvec3 target;\nif ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nsource = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\ntarget = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\nfloat angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\nvec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\nvec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\nvec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\nif (abs(currPos.x - prevPos.x) > 180.0) {\nindexDir = -1.0;\nisValid = 0.0;\n} else if (abs(currPos.x - nextPos.x) > 180.0) {\nindexDir = 1.0;\nisValid = 0.0;\n}\nnextPos = indexDir < 0.0 ? prevPos : nextPos;\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nif (isValid == 0.0) {\nnextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\nfloat t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\ncurrPos = mix(currPos, nextPos, t);\nsegmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n}\nvec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\nvec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\ncurr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\nnext = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n} else {\nvec3 source_world = instanceSourcePositions;\nvec3 target_world = instanceTargetPositions;\nif (useShortestPath) {\nsource_world.x = mod(source_world.x + 180., 360.0) - 180.;\ntarget_world.x = mod(target_world.x + 180., 360.0) - 180.;\nfloat deltaLng = target_world.x - source_world.x;\nif (deltaLng > 180.) target_world.x -= 360.;\nif (deltaLng < -180.) source_world.x -= 360.;\n}\nsource = project_position(source_world, instanceSourcePositions64Low);\ntarget = project_position(target_world, instanceTargetPositions64Low);\nfloat antiMeridianX = 0.0;\nif (useShortestPath) {\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nantiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n}\nfloat thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\nif (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\nisValid = 0.0;\nindexDir = sign(segmentRatio - thresholdRatio);\nsegmentRatio = thresholdRatio;\n}\n}\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nvec3 currPos = interpolateFlat(source, target, segmentRatio);\nvec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\nif (useShortestPath) {\nif (nextPos.x < antiMeridianX) {\ncurrPos.x += TILE_SIZE;\nnextPos.x += TILE_SIZE;\n}\n}\ncurr = project_common_position_to_clipspace(vec4(currPos, 1.0));\nnext = project_common_position_to_clipspace(vec4(nextPos, 1.0));\ngeometry.position = vec4(currPos, 1.0);\n}\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels\n);\nvec3 offset = vec3(\ngetExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\nDECKGL_FILTER_GL_POSITION(curr, geometry);\ngl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\nvec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\nvColor = vec4(color.rgb, color.a * opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME arc-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 uv;\nin float isValid;\nout vec4 fragColor;\nvoid main(void) {\nif (isValid == 0.0) {\ndiscard;\n}\nfragColor = vColor;\ngeometry.uv = uv;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Vd]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Jb},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Jb},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:r}=e;(r.extensionsChanged||t.numSegments!==i.numSegments)&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:t,widthScale:i,widthMinPixels:r,widthMaxPixels:n,greatCircle:s,wrapLongitude:o}=this.props,a=this.state.model;a.setUniforms(e),a.setUniforms({greatCircle:s,widthUnits:kc[t],widthScale:i,widthMinPixels:r,widthMaxPixels:n,useShortestPath:o}),a.draw(this.context.renderPass)}_getModel(){let{numSegments:e}=this.props,t=[];for(let i=0;i<e;i++)t=t.concat([i,1,0,i,-1,0]);let i=new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0});return i.setUniforms({numSegments:e}),i}},Qb=Zb;Zb.layerName="ArcLayer",Zb.defaultProps=Yb;var eA=new Uint32Array([0,2,1,0,3,2]),tA=new Float32Array([0,1,0,0,1,0,1,1]);function iA(e,t){if(!t)return function(e){let t=new Float64Array(12);for(let i=0;i<e.length;i++)t[3*i+0]=e[i][0],t[3*i+1]=e[i][1],t[3*i+2]=e[i][2]||0;return{vertexCount:6,positions:t,indices:eA,texCoords:tA}}(e);let i=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),r=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),n=Math.ceil(i/t)+1,s=Math.ceil(r/t)+1,o=(n-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(n*s*2),u=new Float64Array(n*s*3),h=0,c=0;for(let t=0;t<n;t++){let i=t/(n-1);for(let r=0;r<s;r++){let n=r/(s-1),o=rA(e,i,n);u[3*h+0]=o[0],u[3*h+1]=o[1],u[3*h+2]=o[2]||0,l[2*h+0]=i,l[2*h+1]=1-n,t>0&&r>0&&(a[c++]=h-s,a[c++]=h-s-1,a[c++]=h-1,a[c++]=h-s,a[c++]=h-1,a[c++]=h),h++}}return{vertexCount:o,positions:u,indices:a,texCoords:l}}function rA(e,t,i){return wo(wo(e[0],e[1],i),wo(e[3],e[2],i),t)}var nA={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Nc.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},sA=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nin vec2 texCoords;\nin vec3 positions;\nin vec3 positions64Low;\n\nout vec2 vTexCoord;\nout vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nin vec2 vTexCoord;\nin vec2 vTexPos;\n\nout vec4 fragColor;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture(bitmapTexture, uv);\n\n  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  if (bool(picking.isActive) && !bool(picking.isAttribute)) {\n    // Since instance information is not used, we can use picking color for pixel index\n    fragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n",modules:[rd,Vd]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]);let t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:i}){let r=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll()),e.bounds!==t.bounds){let e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(let i in t)e&&e[i]!==t[i]&&r.invalidate(i);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;let{width:r,height:n}=t;i.index=0;let s=function(e){let[t,i,r]=e,n=(240&r)/256,s=(15&r)/16;return[(t+s)/256,(i+n)/256]}(i.color);return i.bitmap={size:{width:r,height:n},uv:s,pixel:[Math.floor(s[0]*r),Math.floor(s[1]*n)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,t=e;return aA(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),iA(t,this.context.viewport.resolution)}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{uniforms:t,moduleParameters:i}=e,{model:r,coordinateConversion:n,bounds:s,disablePicking:o}=this.state,{image:a,desaturate:l,transparentColor:u,tintColor:h}=this.props;i.picking.isActive&&o||a&&r&&(r.setUniforms(t),r.setBindings({bitmapTexture:a}),r.setUniforms({desaturate:l,transparentColor:u.map((e=>e/255)),tintColor:h.slice(0,3).map((e=>e/255)),coordinateConversion:n,bounds:s}),r.draw(this.context.renderPass))}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=Nc,{_imageCoordinateSystem:r}=this.props;if(r!==i){let{bounds:i}=this.props;if(!aA(i))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let n=this.context.viewport.resolution?e:t;if(r=r===e?e:t,r===e&&n===t)return{coordinateConversion:-1,bounds:i};if(r===t&&n===e){let e=bd([i[0],i[1]]),t=bd([i[2],i[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}},oA=sA;function aA(e){return Number.isFinite(e[0])}sA.layerName="BitmapLayer",sA.defaultProps=nA;var lA=()=>{},uA={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},hA={x:0,y:0,width:0,height:0};function cA(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function dA(e,t,i,r){let n=Math.min(i/t.width,r/t.height),s=Math.floor(t.width*n),o=Math.floor(t.height*n);return 1===n?{data:t,width:s,height:o}:(e.canvas.height=o,e.canvas.width=s,e.clearRect(0,0,s,o),e.drawImage(t,0,0,t.width,t.height,0,0,s,o),{data:e.canvas,width:s,height:o})}function fA(e){return e&&(e.id||e.url)}function pA(e,t,i){for(let r=0;r<t.length;r++){let{icon:n,xOffset:s}=t[r];e[fA(n)]={...n,x:s,y:i}}}var gA=class{constructor(e,{onUpdate:t=lA,onError:i=lA}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let t=this._autoPacking?fA(e):e;return this._mapping[t]||hA}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:r,textureParameters:n}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),r&&(this._mapping=r),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),n&&(this._textureParameters=n)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;let i=Object.values(function(e,t,i){if(!e||!t)return null;i=i||{};let r={},{iterable:n,objectInfo:s}=sy(e);for(let e of n){s.index++;let n=t(e,s),o=fA(n);if(!n)throw new Error("Icon is missing.");if(!n.url)throw new Error("Icon url is missing.");!r[o]&&(!i[o]||n.url!==i[o].url)&&(r[o]={...n,source:e,sourceIndex:s.index})}return r}(e,t,this._mapping)||{});if(i.length>0){let{mapping:e,xOffset:t,yOffset:r,rowHeight:n,canvasHeight:s}=function({icons:e,buffer:t,mapping:i={},xOffset:r=0,yOffset:n=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<e.length;l++){let u=e[l];if(!i[fA(u)]){let{height:e,width:l}=u;r+l+t>o&&(pA(i,a,n),r=0,n=s+n+t,s=0,a=[]),a.push({icon:u,xOffset:r}),r=r+l+t,s=Math.max(s,e)}}return a.length>0&&pA(i,a,n),{mapping:i,rowHeight:s,xOffset:r,yOffset:n,canvasWidth:o,canvasHeight:cA(s+n+t)}}({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=n,this._mapping=e,this._xOffset=t,this._yOffset=r,this._canvasHeight=s,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||uA})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,i,r){let{width:n,height:s,device:o}=e,a=o.createTexture({format:"rgba8unorm",width:t,height:i,sampler:r}),l=o.createCommandEncoder();return l.copyTextureToTexture({source:e,destination:a,width:n,height:s}),l.finish(),e.destroy(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||uA)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){let t=this._canvas.getContext("2d",{willReadFrequently:!0});for(let i of e)this._pendingCount++,Zt(i.url,this._loadOptions).then((e=>{let r=fA(i),n=this._mapping[r],{x:s,y:o,width:a,height:l}=n,{data:u,width:h,height:c}=dA(t,e,a,l);this._texture.setSubImageData({data:u,x:s+(a-h)/2,y:o+(l-c)/2,width:h,height:c}),n.width=h,n.height=c,this._texture.generateMipmap(),this.onUpdate()})).catch((e=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:e})})).finally((()=>{this._pendingCount--}))}},mA=[0,0,0,255],_A={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:mA},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},vA=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME icon-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceSizes;\nin float instanceAngles;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec4 instanceIconFrames;\nin float instanceColorModes;\nin vec2 instanceOffsets;\nin vec2 instancePixelOffset;\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\nout float vColorMode;\nout vec4 vColor;\nout vec2 vTextureCoords;\nout vec2 uv;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = angle * PI / 180.0;\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvec2 iconSize = instanceIconFrames.zw;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\nsizeMinPixels, sizeMaxPixels\n);\nfloat instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\nvec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\npixelOffset += instancePixelOffset;\npixelOffset.y *= -1.0;\nif (billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvTextureCoords = mix(\ninstanceIconFrames.xy,\ninstanceIconFrames.xy + iconSize,\n(positions.xy + 1.0) / 2.0\n) / iconsTextureDim;\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\nvColorMode = instanceColorModes;\n}\n",fs:"#version 300 es\n#define SHADER_NAME icon-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\nin float vColorMode;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec4 texColor = texture(iconsTexture, vTextureCoords);\nvec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\nfloat a = texColor.a * opacity * vColor.a;\nif (a < alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color, a);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Vd]})}initializeState(){this.state={iconManager:new gA(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:mA},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:r}=e,n=this.getAttributeManager(),{iconAtlas:s,iconMapping:o,data:a,getIcon:l,textureParameters:u}=t,{iconManager:h}=this.state;if("string"==typeof s)return;let c=s||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:t.loadOptions,autoPacking:!c,iconAtlas:s,iconMapping:c?o:null,textureParameters:u}),c?i.iconMapping!==t.iconMapping&&n.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&h.packIcons(a,l),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:n,billboard:s,alphaCutoff:o}=this.props,{iconManager:a}=this.state,l=a.getTexture();if(l){let a=this.state.model;a.setBindings({iconsTexture:l}),a.setUniforms(e),a.setUniforms({iconsTextureDim:[l.width,l.height],sizeUnits:kc[n],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:r,billboard:s,alphaCutoff:o}),a.draw(this.context.renderPass)}}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let t=this.getCurrentLayer()?.props.onIconError;t?t(e):wi.error(e.error.message)()}getInstanceOffset(e){let{width:t,height:i,anchorX:r=t/2,anchorY:n=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-r,i/2-n]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){let{x:t,y:i,width:r,height:n}=this.state.iconManager.getIconMapping(e);return[t,i,r,n]}},yA=vA;vA.defaultProps=_A,vA.layerName="IconLayer";var bA={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},AA=class extends hb{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME line-layer-vertex-shader\nin vec3 positions;\nin vec3 instanceSourcePositions;\nin vec3 instanceTargetPositions;\nin vec3 instanceSourcePositions64Low;\nin vec3 instanceTargetPositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin float instanceWidths;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float useShortestPath;\nuniform int widthUnits;\nout vec4 vColor;\nout vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\nvec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn dir_screenspace * offset_direction * width / 2.0;\n}\nvec3 splitLine(vec3 a, vec3 b, float x) {\nfloat t = (x - a.x) / (b.x - a.x);\nreturn vec3(x, mix(a.yz, b.yz, t));\n}\nvoid main(void) {\ngeometry.worldPosition = instanceSourcePositions;\ngeometry.worldPositionAlt = instanceTargetPositions;\nvec3 source_world = instanceSourcePositions;\nvec3 target_world = instanceTargetPositions;\nvec3 source_world_64low = instanceSourcePositions64Low;\nvec3 target_world_64low = instanceTargetPositions64Low;\nif (useShortestPath > 0.5 || useShortestPath < -0.5) {\nsource_world.x = mod(source_world.x + 180., 360.0) - 180.;\ntarget_world.x = mod(target_world.x + 180., 360.0) - 180.;\nfloat deltaLng = target_world.x - source_world.x;\nif (deltaLng * useShortestPath > 180.) {\nsource_world.x += 360. * useShortestPath;\nsource_world = splitLine(source_world, target_world, 180. * useShortestPath);\nsource_world_64low = vec3(0.0);\n} else if (deltaLng * useShortestPath < -180.) {\ntarget_world.x += 360. * useShortestPath;\ntarget_world = splitLine(source_world, target_world, 180. * useShortestPath);\ntarget_world_64low = vec3(0.0);\n} else if (useShortestPath < 0.) {\ngl_Position = vec4(0.);\nreturn;\n}\n}\nvec4 source_commonspace;\nvec4 target_commonspace;\nvec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);\nvec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);\nfloat segmentIndex = positions.x;\nvec4 p = mix(source, target, segmentIndex);\ngeometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\nuv = positions.xy;\ngeometry.uv = uv;\ngeometry.pickingColor = instancePickingColors;\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels\n);\nvec3 offset = vec3(\ngetExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\nDECKGL_FILTER_GL_POSITION(p, geometry);\ngl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\nvColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME line-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Vd]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:t,widthScale:i,widthMinPixels:r,widthMaxPixels:n,wrapLongitude:s}=this.props,o=this.state.model;o.setUniforms(e),o.setUniforms({widthUnits:kc[t],widthScale:i,widthMinPixels:r,widthMaxPixels:n,useShortestPath:s?1:0}),o.draw(this.context.renderPass),s&&(o.setUniforms({useShortestPath:-1}),o.draw(this.context.renderPass))}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}}),isInstanced:!0})}},EA=AA;AA.layerName="LineLayer",AA.defaultProps=bA;var wA=[0,0,0,255],xA=[0,0,1],TA={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:xA},getColor:{type:"accessor",value:wA},material:!0,radiusPixels:{deprecatedFor:"pointSize"}},CA=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME point-cloud-layer-vertex-shader\nin vec3 positions;\nin vec3 instanceNormals;\nin vec4 instanceColors;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radiusPixels;\nuniform int sizeUnits;\nout vec4 vColor;\nout vec2 unitPosition;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.normal = project_normal(instanceNormals);\nunitPosition = positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\nvec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\nvec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, instanceColors.a * opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME point-cloud-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 unitPosition;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition);\nif (distToCenter > 1.0) {\ndiscard;\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Ic,Vd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:xA},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:wA}})}updateState(e){let{changeFlags:t,props:i}=e;super.updateState(e),t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&function(e){let{header:t,attributes:i}=e;if(t&&i&&(e.length=t.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){let{size:e,value:t}=i.COLOR_0;i.instanceColors={size:e,type:"unorm8",value:t}}}(i.data)}draw({uniforms:e}){let{pointSize:t,sizeUnits:i}=this.props,r=this.state.model;r.setUniforms(e),r.setUniforms({sizeUnits:kc[i],radiusPixels:t}),r.draw(this.context.renderPass)}_getModel(){let e=[];for(let t=0;t<3;t++){let i=t/3*Math.PI*2;e.push(2*Math.cos(i),2*Math.sin(i),0)}return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}},SA=CA;CA.layerName="PointCloudLayer",CA.defaultProps=TA;var PA=[0,0,0,255],MA={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:PA},getLineColor:{type:"accessor",value:PA},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},RA=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\nradiusMinPixels, radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\nlineWidthMinPixels, lineWidthMaxPixels\n);\nouterRadiusPixels += stroked * lineWidthPixels / 2.0;\nfloat edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\nif (billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (stroked > 0.5) {\nfloat isLine = antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (filled) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (!filled) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Vd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:t,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:n,stroked:s,filled:o,billboard:a,antialiasing:l,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:c,lineWidthMaxPixels:d}=this.props,f=this.state.model;f.setUniforms(e),f.setUniforms({stroked:s?1:0,filled:o,billboard:a,antialiasing:l,radiusUnits:kc[t],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:n,lineWidthUnits:kc[u],lineWidthScale:h,lineWidthMinPixels:c,lineWidthMaxPixels:d}),f.draw(this.context.renderPass)}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0})}},IA=RA;RA.defaultProps=MA,RA.layerName="ScatterplotLayer";var BA=1,LA=-1;function OA(e,t,i={}){return function(e,t={}){return Math.sign(NA(e,t))}(e,i)!==t&&(function(e,t){let{start:i=0,end:r=e.length,size:n=2}=t,s=(r-i)/n,o=Math.floor(s/2);for(let t=0;t<o;++t){let r=i+t*n,o=i+(s-1-t)*n;for(let t=0;t<n;++t){let i=e[r+t];e[r+t]=e[o+t],e[o+t]=i}}}(e,i),!0)}var FA={x:0,y:1,z:2};function NA(e,t={}){let{start:i=0,end:r=e.length,plane:n="xy"}=t,s=t.size||2,o=0,a=FA[n[0]],l=FA[n[1]];for(let t=i,n=r-s;t<r;t+=s)o+=(e[t+a]-e[n+a])*(e[t+l]+e[n+l]),n=t;return o/2}function DA(e,t){let i=t.length,r=e.length;if(r>0){let n=!0;for(let s=0;s<i;s++)if(e[r-i+s]!==t[s]){n=!1;break}if(n)return!1}for(let n=0;n<i;n++)e[r+n]=t[n];return!0}function kA(e,t){let i=t.length;for(let r=0;r<i;r++)e[r]=t[r]}function UA(e,t,i,r,n=[]){let s=r+t*i;for(let t=0;t<i;t++)n[t]=e[s+t];return n}function GA(e,t,i,r,n=[]){let s,o;if(8&i)s=(r[3]-e[1])/(t[1]-e[1]),o=3;else if(4&i)s=(r[1]-e[1])/(t[1]-e[1]),o=1;else if(2&i)s=(r[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&i))return null;s=(r[0]-e[0])/(t[0]-e[0]),o=0}for(let i=0;i<e.length;i++)n[i]=(1&o)===i?r[o]:s*(t[i]-e[i])+e[i];return n}function zA(e,t){let i=0;return e[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}function VA(e,t){let i,r,{size:n=2,broken:s=!1,gridResolution:o=10,gridOffset:a=[0,0],startIndex:l=0,endIndex:u=e.length}=t||{},h=(u-l)/n,c=[],d=[c],f=UA(e,0,n,l),p=qA(f,o,a,[]),g=[];DA(c,f);for(let t=1;t<h;t++){for(i=UA(e,t,n,l,i),r=zA(i,p);r;){GA(f,i,r,p,g);let e=zA(g,p);e&&(GA(f,g,e,p,g),r=e),DA(c,g),kA(f,g),KA(p,o,r),s&&c.length>n&&(c=[],d.push(c),DA(c,f)),r=zA(i,p)}DA(c,i),kA(f,i)}return s?d:d[0]}var jA=0,HA=1;function WA(e,t=null,i){if(!e.length)return[];let{size:r=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:o=!1}=i||{},a=[],l=[{pos:e,types:o?new Array(e.length/r).fill(HA):null,holes:t||[]}],u=[[],[]],h=[];for(;l.length;){let{pos:e,types:t,holes:i}=l.shift();$A(e,r,i[0]||e.length,u),h=qA(u[0],n,s,h);let c=zA(u[1],h);if(c){let n=XA(e,t,r,0,i[0]||e.length,h,c),s={pos:n[0].pos,types:n[0].types,holes:[]},a={pos:n[1].pos,types:n[1].types,holes:[]};l.push(s,a);for(let l=0;l<i.length;l++)n=XA(e,t,r,i[l],i[l+1]||e.length,h,c),n[0]&&(s.holes.push(s.pos.length),s.pos=JA(s.pos,n[0].pos),o&&(s.types=JA(s.types,n[0].types))),n[1]&&(a.holes.push(a.pos.length),a.pos=JA(a.pos,n[1].pos),o&&(a.types=JA(a.types,n[1].types)))}else{let r={positions:e};o&&(r.edgeTypes=t),i.length&&(r.holeIndices=i),a.push(r)}}return a}function XA(e,t,i,r,n,s,o){let a,l,u,h=(n-r)/i,c=[],d=[],f=[],p=[],g=[],m=UA(e,h-1,i,r),_=Math.sign(8&o?m[1]-s[3]:m[0]-s[2]),v=t&&t[h-1],y=0,b=0;for(let n=0;n<h;n++)a=UA(e,n,i,r,a),l=Math.sign(8&o?a[1]-s[3]:a[0]-s[2]),u=t&&t[r/i+n],l&&_&&_!==l&&(GA(m,a,o,s,g),DA(c,g)&&f.push(v),DA(d,g)&&p.push(v)),l<=0?(DA(c,a)&&f.push(u),y-=l):f.length&&(f[f.length-1]=jA),l>=0?(DA(d,a)&&p.push(u),b+=l):p.length&&(p[p.length-1]=jA),kA(m,a),_=l,v=u;return[y?{pos:c,types:t&&f}:null,b?{pos:d,types:t&&p}:null]}function qA(e,t,i,r){let n=Math.floor((e[0]-i[0])/t)*t+i[0],s=Math.floor((e[1]-i[1])/t)*t+i[1];return r[0]=n,r[1]=s,r[2]=n+t,r[3]=s+t,r}function KA(e,t,i){8&i?(e[1]+=t,e[3]+=t):4&i?(e[1]-=t,e[3]-=t):2&i?(e[0]+=t,e[2]+=t):1&i&&(e[0]-=t,e[2]-=t)}function $A(e,t,i,r){let n=1/0,s=-1/0,o=1/0,a=-1/0;for(let r=0;r<i;r+=t){let t=e[r],i=e[r+1];n=t<n?t:n,s=t>s?t:s,o=i<o?i:o,a=i>a?i:a}return r[0][0]=n,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function JA(e,t){for(let i=0;i<t.length;i++)e.push(t[i]);return e}var YA=85.051129;function ZA(e,t,i,r){let n=-1,s=-1;for(let o=i+1;o<r;o+=t){let t=Math.abs(e[o]);t>n&&(n=t,s=o-1)}return s}function QA(e,t,i,r,n=YA){let s=e[i],o=e[r-t];if(Math.abs(s-o)>180){let r=UA(e,0,t,i);r[0]+=360*Math.round((o-s)/360),DA(e,r),r[1]=Math.sign(r[1])*n,DA(e,r),r[0]=s,DA(e,r)}}function eE(e,t,i,r){let n,s=e[0];for(let o=i;o<r;o+=t){n=e[o];let t=n-s;(t>180||t<-180)&&(n-=360*Math.round(t/360)),e[o]=s=n}}function tE(e,t){let i,r=e.length/t;for(let n=0;n<r&&(i=e[n*t],(i+180)%360==0);n++);let n=360*-Math.round(i/360);if(0!==n)for(let i=0;i<r;i++)e[i*t]+=n}var iE=class extends vp{constructor(e){let{indices:t,attributes:i}=function(e){let{radius:t,height:i=1,nradial:r=10}=e,{vertices:n}=e;n&&(wi.assert(n.length>=r),n=n.flatMap((e=>[e[0],e[1]])),OA(n,LA));let s=i>0,o=r+1,a=s?3*o+1:r,l=2*Math.PI/r,u=new Uint16Array(s?3*r*2:0),h=new Float32Array(3*a),c=new Float32Array(3*a),d=0;if(s){for(let e=0;e<o;e++){let s=e*l,o=e%r,a=Math.sin(s),u=Math.cos(s);for(let e=0;e<2;e++)h[d+0]=n?n[2*o]:u*t,h[d+1]=n?n[2*o+1]:a*t,h[d+2]=(.5-e)*i,c[d+0]=n?n[2*o]:u,c[d+1]=n?n[2*o+1]:a,d+=3}h[d+0]=h[d-3],h[d+1]=h[d-2],h[d+2]=h[d-1],d+=3}for(let e=s?0:1;e<o;e++){let s=Math.floor(e/2)*Math.sign(.5-e%2),o=s*l,a=(s+r)%r,u=Math.sin(o),f=Math.cos(o);h[d+0]=n?n[2*a]:f*t,h[d+1]=n?n[2*a+1]:u*t,h[d+2]=i/2,c[d+2]=1,d+=3}if(s){let e=0;for(let t=0;t<r;t++)u[e++]=2*t+0,u[e++]=2*t+2,u[e++]=2*t+0,u[e++]=2*t+1,u[e++]=2*t+1,u[e++]=2*t+3}return{indices:u,attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:c}}}}(e);super({...e,indices:t,attributes:i})}},rE=[0,0,0,255],nE={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:rE},getLineColor:{type:"accessor",value:rE},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},sE=class extends hb{getShaders(){let e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME column-layer-vertex-shader\nin vec3 positions;\nin vec3 normals;\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool stroked;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int radiusUnits;\nuniform int widthUnits;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec4 position_commonspace;\n#endif\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nvec4 color = isStroke ? instanceLineColors : instanceFillColors;\nmat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\nfloat elevation = 0.0;\nfloat strokeOffsetRatio = 1.0;\nif (extruded) {\nelevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n} else if (stroked) {\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels) / 2.0;\nfloat halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\nif (isStroke) {\nstrokeOffsetRatio -= sign(positions.z) * halfOffset;\n} else {\nstrokeOffsetRatio -= halfOffset;\n}\n}\nfloat shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\nfloat dotRadius = radius * coverage * shouldRender;\ngeometry.pickingColor = instancePickingColors;\nvec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\nvec3 centroidPosition64Low = instancePositions64Low;\nvec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;\nif (radiusUnits == UNIT_METERS) {\noffset = project_size(offset);\n}\nvec3 pos = vec3(offset, 0.);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\ngeometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (extruded && !isStroke) {\n#ifdef FLAT_SHADING\nposition_commonspace = geometry.position;\nvColor = vec4(color.rgb, color.a * opacity);\n#else\nvec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, color.a * opacity);\n#endif\n} else {\nvColor = vec4(color.rgb, color.a * opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\nprecision highp float;\nuniform vec3 project_uCameraPosition;\nuniform bool extruded;\nuniform bool isStroke;\nout vec4 fragColor;\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec4 position_commonspace;\n#endif\nvoid main(void) {\nfragColor = vColor;\n#ifdef FLAT_SHADING\nif (extruded && !isStroke && !bool(picking.isActive)) {\nvec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\nfragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n}\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:e,modules:[rd,t?Bc:Ic,Vd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:rE},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:rE},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:r}=e,n=r.extensionsChanged||t.flatShading!==i.flatShading;n&&(this.state.models?.forEach((e=>e.destroy())),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(n||t.diskResolution!==i.diskResolution||t.vertices!==i.vertices||(t.extruded||t.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(t)}getGeometry(e,t,i){let r=new iE({radius:1,height:i?2:0,vertices:t,nradial:e}),n=0;if(t)for(let i=0;i<e;i++){let r=t[i];n+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else n=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*n}),r}_getModels(){let e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),i=new fp(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),r=new fp(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:i,wireframeModel:r,models:[r,i]}}_updateGeometry({diskResolution:e,vertices:t,extruded:i,stroked:r}){let n=this.getGeometry(e,t,i||r);this.setState({fillVertexCount:n.attributes.POSITION.value.length/3});let s=this.state.fillModel,o=this.state.wireframeModel;s.setGeometry(n),s.setTopology("triangle-strip"),s.setIndexBuffer(null),o.setGeometry(n),o.setTopology("line-list")}draw({uniforms:e}){let{lineWidthUnits:t,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:n,radiusUnits:s,elevationScale:o,extruded:a,filled:l,stroked:u,wireframe:h,offset:c,coverage:d,radius:f,angle:p}=this.props,g=this.state.fillModel,m=this.state.wireframeModel,{fillVertexCount:_,edgeDistance:v}=this.state,y={...e,radius:f,angle:p/180*Math.PI,offset:c,extruded:a,stroked:u,coverage:d,elevationScale:o,edgeDistance:v,radiusUnits:kc[s],widthUnits:kc[t],widthScale:i,widthMinPixels:r,widthMaxPixels:n};a&&h&&(m.setUniforms(y),m.setUniforms({isStroke:!0}),m.draw(this.context.renderPass)),g.setUniforms(y),l&&(g.setVertexCount(_),g.setUniforms({isStroke:!1}),g.draw(this.context.renderPass)),!a&&u&&(g.setVertexCount(2*_/3),g.setUniforms({isStroke:!0}),g.draw(this.context.renderPass))}},oE=sE;sE.layerName="ColumnLayer",sE.defaultProps=nE;var aE={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},lE=class extends oE{_updateGeometry(){let e=new xp;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{elevationScale:t,extruded:i,offset:r,coverage:n,cellSize:s,angle:o,radiusUnits:a}=this.props,l=this.state.fillModel;l.setUniforms(e),l.setUniforms({radius:s/2,radiusUnits:kc[a],angle:o,offset:r,extruded:i,coverage:n,elevationScale:t,edgeDistance:1,isStroke:!1}),l.draw(this.context.renderPass)}},uE=lE;function hE(e,t,i,r){let n;if(Array.isArray(e[0])){let i=e.length*t;n=new Array(i);for(let i=0;i<e.length;i++)for(let r=0;r<t;r++)n[i*t+r]=e[i][r]||0}else n=e;return i?VA(n,{size:t,gridResolution:i}):r?function(e,t){let{size:i=2,startIndex:r=0,endIndex:n=e.length,normalize:s=!0}=t||{},o=e.slice(r,n);eE(o,i,0,n-r);let a=VA(o,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(let e of a)tE(e,i);return a}(n,{size:t}):n}lE.layerName="GridCellLayer",lE.defaultProps=aE;var cE=class extends $b{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?hE(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(dE(e)){let t=0;for(let i of e)t+=this.getGeometrySize(i);return t}let t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&dE(e))for(let i of e){let e=this.getGeometrySize(i);t.geometrySize=e,this.updateGeometryAttributes(i,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){let i=this.attributes.segmentTypes,r=!!e&&this.isClosed(e),{vertexStart:n,geometrySize:s}=t;i.fill(0,n,n+s),r?(i[n]=4,i[n+s-2]=4):(i[n]+=1,i[n+s-2]+=2),i[n+s-1]=4}_updatePositions(e,t){let{positions:i}=this.attributes;if(!i||!e)return;let{vertexStart:r,geometrySize:n}=t,s=new Array(3);for(let t=r,o=0;o<n;t++,o++)this.getPointOnPath(e,o,s),i[3*t]=s[0],i[3*t+1]=s[1],i[3*t+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){let{positionSize:r}=this;t*r>=e.length&&(t+=1-e.length/r);let n=t*r;return i[0]=e[n],i[1]=e[n+1],i[2]=3===r&&e[n+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);let{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(2===t||e[2]===e[i+2])}};function dE(e){return Array.isArray(e[0])}var fE=[0,0,0,255],pE={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:fE},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},gE={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e},mE=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = capType;\n} else {\nvJointType = jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels) / 2.0);\nvec3 width;\nif (billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nuniform float miterLimit;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Vd]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:gE,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:gE,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:gE,defaultValue:fE},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:i})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,i)}}),this.setState({pathTesselator:new cE({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:t,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){let{pathTesselator:e}=this.state,n=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:n.getPath,buffers:n,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),i.dataChanged||r.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i}=t,r=this.props.data;return r[0]&&r[0].__source&&(t.object=r.find((e=>e.__source.index===i))),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:t,capRounded:i,billboard:r,miterLimit:n,widthUnits:s,widthScale:o,widthMinPixels:a,widthMaxPixels:l}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(t),capType:Number(i),billboard:r,widthUnits:kc[s],widthScale:o,miterLimit:n,widthMinPixels:a,widthMaxPixels:l}),u.draw(this.context.renderPass)}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}},_E=mE;mE.defaultProps=pE,mE.layerName="PathLayer";var vE=h(f(),1),yE=BA,bE=LA,AE={isClosed:!0};function EE(e){return"positions"in e?e.positions:e}function wE(e){return"holeIndices"in e?e.holeIndices:null}function xE(e,t,i,r,n){let s=t,o=i.length;for(let t=0;t<o;t++)for(let n=0;n<r;n++)e[s++]=i[t][n]||0;if(!function(e){let t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]}(i))for(let t=0;t<r;t++)e[s++]=i[0][t]||0;return AE.start=t,AE.end=s,AE.size=r,OA(e,n,AE),s}function TE(e,t,i,r,n=0,s,o){let a=(s=s||i.length)-n;if(a<=0)return t;let l=t;for(let t=0;t<a;t++)e[l++]=i[n+t];if(!function(e,t,i,r){for(let n=0;n<t;n++)if(e[i+n]!==e[r-t+n])return!1;return!0}(i,r,n,s))for(let t=0;t<r;t++)e[l++]=i[n+t];return AE.start=t,AE.end=l,AE.size=r,OA(e,o,AE),l}function CE(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);let i=[],r=[];if("positions"in e){let{positions:n,holeIndices:s}=e;if(s){let e=0;for(let o=0;o<=s.length;o++)e=TE(i,e,n,t,s[o-1],s[o],0===o?yE:bE),r.push(e);return r.pop(),{positions:i,holeIndices:r}}e=n}if(!function(e){return Array.isArray(e[0])}(e))return TE(i,0,e,t,0,i.length,yE),i;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let n=0;for(let[s,o]of e.entries())n=xE(i,n,o,t,0===s?yE:bE),r.push(n);return r.pop(),{positions:i,holeIndices:r}}return xE(i,0,e,t,yE),i}function SE(e,t,i){let r=e.length/3,n=0;for(let s=0;s<r;s++){let o=(s+1)%r;n+=e[3*s+t]*e[3*o+i],n-=e[3*o+t]*e[3*s+i]}return Math.abs(n/2)}function PE(e,t,i,r){let n=e.length/3;for(let s=0;s<n;s++){let n=3*s,o=e[n+0],a=e[n+1],l=e[n+2];e[n+t]=o,e[n+i]=a,e[n+r]=l}}var ME=class extends $b{constructor(e){let{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){let{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);let t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let t=CE(e,this.positionSize);return this.opts.resolution?WA(EE(t),wE(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,i){let{size:r=2,normalize:n=!0,edgeTypes:s=!1}=i||{};t=t||[];let o=[],a=[],l=0,u=0;for(let n=0;n<=t.length;n++){let s=t[n]||e.length,h=u,c=ZA(e,r,l,s);for(let t=c;t<s;t++)o[u++]=e[t];for(let t=l;t<c;t++)o[u++]=e[t];eE(o,r,h,u),QA(o,r,h,u,i?.maxLatitude),l=s,a[n]=u}a.pop();let h=WA(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(let e of h)tE(e.positions,r);return h}(EE(t),wE(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(RE(e)){let t=0;for(let i of e)t+=this.getGeometrySize(i);return t}return EE(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&RE(e))for(let i of e){let e=this.getGeometrySize(i);t.geometrySize=e,this.updateGeometryAttributes(i,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{let i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:r}){let{attributes:n,indexStarts:s,typedArrayManager:o}=this,a=n.indices;if(!a||!e)return;let l=r,u=function(e,t,i,r){let n=wE(e);n&&(n=n.map((e=>e/t)));let s=EE(e),o=r&&3===t;if(i){let e=s.length;s=s.slice();let r=[];for(let n=0;n<e;n+=t){r[0]=s[n],r[1]=s[n+1],o&&(r[2]=s[n+2]);let e=i(r);s[n]=e[0],s[n+1]=e[1],o&&(s[n+2]=e[2])}}if(o){let e=SE(s,0,1),t=SE(s,0,2),r=SE(s,1,2);if(!e&&!t&&!r)return[];e>t&&e>r||(t>r?(i||(s=s.slice()),PE(s,0,2,1)):(i||(s=s.slice()),PE(s,2,0,1)))}return(0,vE.default)(s,n,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);a=o.allocate(a,r+u.length,{copy:!0});for(let e=0;e<u.length;e++)a[l++]=u[e]+i;s[t+1]=r+u.length,n.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:i}){let{attributes:{positions:r},positionSize:n}=this;if(!r||!e)return;let s=EE(e);for(let e=t,o=0;o<i;e++,o++){let t=s[o*n],i=s[o*n+1],a=n>2?s[o*n+2]:0;r[3*e]=t,r[3*e+1]=i,r[3*e+2]=a}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){let{positionSize:r}=this,n=this.attributes.vertexValid,s=e&&wE(e);if(e&&e.edgeTypes?n.set(e.edgeTypes,t):n.fill(1,t,t+i),s)for(let e=0;e<s.length;e++)n[t+s[e]/r-1]=0;n[t+i-1]=0}};function RE(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}var IE="uniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\nout vec4 vColor;\nstruct PolygonProps {\nvec4 fillColors;\nvec4 lineColors;\nvec3 positions;\nvec3 positions64Low;\nvec3 pickingColors;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project_uCommonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = isWireframe ? props.lineColors : props.fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = props.pickingColors;\nif (extruded) {\npos.z += props.elevations * elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",BE=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\nin vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\n${IE}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.fillColors = fillColors;\nprops.lineColors = lineColors;\nprops.pickingColors = pickingColors;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,LE=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instanceNextPositions;\nin vec3 instancePositions64Low;\nin vec3 instanceNextPositions64Low;\nin float instanceElevations;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nin float instanceVertexValid;\n${IE}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = instancePositions;\npos64Low = instancePositions64Low;\nnextPos = instanceNextPositions;\nnextPos64Low = instanceNextPositions64Low;\n#else\npos = instanceNextPositions;\npos64Low = instanceNextPositions64Low;\nnextPos = instancePositions;\nnextPos64Low = instancePositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = instanceElevations * positions.y;\nprops.fillColors = instanceFillColors;\nprops.lineColors = instanceLineColors;\nprops.pickingColors = instancePickingColors;\ncalculatePosition(props);\n}\n`,OE=[0,0,0,255],FE={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:OE},getLineColor:{type:"accessor",value:OE},material:!0},NE={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e},DE=class extends hb{getShaders(e){return super.getShaders({vs:"top"===e?BE:LE,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[rd,Ic,Vd]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let e,{viewport:t}=this.context,{coordinateSystem:i}=this.props,{_full3d:r}=this.props;t.isGeospatial&&i===Nc.DEFAULT&&(i=Nc.LNGLAT),i===Nc.LNGLAT&&(e=r?t.projectPosition.bind(t):t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new ME({preproject:e,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let n=this.getAttributeManager(),s=!0;n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:NE,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{instancePositions:{vertexOffset:0,divisor:1},instanceNextPositions:{vertexOffset:1,divisor:1}}},instanceVertexValid:{size:1,type:"uint16",divisor:1,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:NE,accessor:"getElevation",shaderAttributes:{instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:NE,accessor:"getFillColor",defaultValue:OE,shaderAttributes:{instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:NE,accessor:"getLineColor",defaultValue:OE,shaderAttributes:{instanceLineColors:{divisor:1}}},pickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:i})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,i),shaderAttributes:{instancePickingColors:{divisor:1}}}})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i}=t,r=this.props.data;return r[0]&&r[0].__source&&(t.object=r.find((e=>e.__source.index===i))),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:t,filled:i,wireframe:r,elevationScale:n}=this.props,{topModel:s,sideModel:o,wireframeModel:a,polygonTesselator:l}=this.state,u={...e,extruded:Boolean(t),elevationScale:n};a&&r&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&i&&(o.setInstanceCount(l.instanceCount-1),o.setUniforms(u),o.draw(this.context.renderPass)),s&&i&&(s.setVertexCount(l.vertexCount),s.setUniforms(u),s.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:t,oldProps:i,changeFlags:r}=e,n=this.getAttributeManager();(r.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(this.state.models?.forEach((e=>e.destroy())),this.setState(this._getModels()),n.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){let{polygonTesselator:t}=this.state,r=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:r.getPolygon,buffers:r,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let e,t,i,{id:r,filled:n,extruded:s}=this.props,o=this.getAttributeManager().getBufferLayouts();if(n){let t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1,e=new fp(this.context.device,{...t,id:`${r}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:o,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}return s&&(t=new fp(this.context.device,{...this.getShaders("side"),id:`${r}-side`,bufferLayout:o,uniforms:{isWireframe:!1},geometry:new vp({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}}),i=new fp(this.context.device,{...this.getShaders("side"),id:`${r}-wireframe`,bufferLayout:o,uniforms:{isWireframe:!0},geometry:new vp({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}})),{models:[t,i,e].filter(Boolean),topModel:e,sideModel:t,wireframeModel:i}}calculateIndices(e){let{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){let{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}},kE=DE;function UE({data:e,getIndex:t,dataRange:i,replace:r}){let{startRow:n=0,endRow:s=1/0}=i,o=e.length,a=o,l=o;for(let i=0;i<o;i++){let r=t(e[i]);if(a>i&&r>=n&&(a=i),r>=s){l=i;break}}let u=a,h=l-a!==r.length?e.slice(l):void 0;for(let t=0;t<r.length;t++)e[u++]=r[t];if(h){for(let t=0;t<h.length;t++)e[u++]=h[t];e.length=u}return{startRow:a,endRow:a+r.length}}DE.defaultProps=FE,DE.layerName="SolidPolygonLayer";var GE=[0,0,0,255],zE={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:GE},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},VE=class extends db{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&wi.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){let t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){let t=this.state.paths.slice(),i=e.dataChanged.map((e=>UE({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:i})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){let{data:t,getPolygon:i,positionFormat:r,_normalize:n}=this.props,s=[],o="XY"===r?2:3,{startRow:a,endRow:l}=e,{iterable:u,objectInfo:h}=sy(t,a,l);for(let e of u){h.index++;let t=i(e,h);n&&(t=CE(t,o));let{holeIndices:r}=t,a=t.positions||t;if(r)for(let t=0;t<=r.length;t++){let i=a.slice(r[t-1]||0,r[t]||a.length);s.push(this.getSubLayerRow({path:i},e,h.index))}else s.push(this.getSubLayerRow({path:a},e,h.index))}return s}renderLayers(){let{data:e,_dataDiff:t,stroked:i,filled:r,extruded:n,wireframe:s,_normalize:o,_windingOrder:a,elevationScale:l,transitions:u,positionFormat:h}=this.props,{lineWidthUnits:c,lineWidthScale:d,lineWidthMinPixels:f,lineWidthMaxPixels:p,lineJointRounded:g,lineMiterLimit:m,lineDashJustified:_}=this.props,{getFillColor:v,getLineColor:y,getLineWidth:b,getLineDashArray:A,getElevation:E,getPolygon:w,updateTriggers:x,material:T}=this.props,{paths:C,pathsDiff:S}=this.state,P=this.getSubLayerClass("fill",kE),M=this.getSubLayerClass("stroke",_E),R=this.shouldRenderSubLayer("fill",C)&&new P({_dataDiff:t,extruded:n,elevationScale:l,filled:r,wireframe:s,_normalize:o,_windingOrder:a,getElevation:E,getFillColor:v,getLineColor:n&&s?y:GE,material:T,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:x&&{getPolygon:x.getPolygon,getElevation:x.getElevation,getFillColor:x.getFillColor,lineColors:n&&s,getLineColor:x.getLineColor}}),{data:e,positionFormat:h,getPolygon:w});return[!n&&R,!n&&i&&this.shouldRenderSubLayer("stroke",C)&&new M({_dataDiff:S&&(()=>S),widthUnits:c,widthScale:d,widthMinPixels:f,widthMaxPixels:p,jointRounded:g,miterLimit:m,dashJustified:_,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(y),getWidth:this.getSubLayerAccessor(b),getDashArray:this.getSubLayerAccessor(A)},this.getSubLayerProps({id:"stroke",updateTriggers:x&&{getWidth:x.getLineWidth,getColor:x.getLineColor,getDashArray:x.getLineDashArray}}),{data:C,positionFormat:h,getPath:e=>e.path}),n&&R]}},jE=VE;VE.layerName="PolygonLayer",VE.defaultProps=zE;var HE=.75,WE=[],XE={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},qE=class extends yA{getShaders(){return{...super.getShaders(),fs:"#version 300 es\n#define SHADER_NAME multi-icon-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float sdfBuffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nif (!bool(picking.isActive)) {\nfloat alpha = texture(iconsTexture, vTextureCoords).a;\nvec4 color = vColor;\nif (sdf) {\nfloat distance = alpha;\nalpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);\nif (outlineBuffer > 0.0) {\nfloat inFill = alpha;\nfloat inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\ncolor = mix(outlineColor, vColor, inFill);\nalpha = inBorder;\n}\n}\nfloat a = alpha * color.a;\nif (a < alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color.rgb, a * opacity);\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:t,target:i})=>this.encodePickingColor(t,i)}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e,{outlineColor:r}=t;r!==i.outlineColor&&(r=r.map((e=>e/255)),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!t.sdf&&t.outlineWidth&&wi.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:t,smoothing:i,outlineWidth:r}=this.props,{outlineColor:n}=this.state,s=r?Math.max(i,HE*(1-r)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:HE,outlineBuffer:s,gamma:i,sdf:Boolean(t),outlineColor:n},super.draw(e),t&&r){let{iconManager:e}=this.state,t=e.getTexture(),i=this.state.model;t&&(i.setUniforms({outlineBuffer:HE}),i.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap((e=>super.getInstanceOffset(e))):WE}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap((e=>super.getInstanceIconFrame(e))):WE}},KE=qE;function $E(e,t,i,r,n,s,o,a,l){for(let u=t;u<t+r;u++)JE(e,i*s+u,s,n,o,a,l);for(let u=i;u<i+n;u++)JE(e,u*s+t,1,r,o,a,l)}function JE(e,t,i,r,n,s,o){s[0]=0,o[0]=-1e20,o[1]=1e20,n[0]=e[t];for(let a=1,l=0,u=0;a<r;a++){n[a]=e[t+a*i];let r=a*a;do{let e=s[l];u=(n[a]-n[e]+r-e*e)/(a-e)/2}while(u<=o[l]&&--l>-1);l++,s[l]=a,o[l]=u,o[l+1]=1e20}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;let r=s[l],u=a-r;e[t+a*i]=n[r]+u*u}}qE.defaultProps=XE,qE.layerName="MultiIconLayer";var YE=32,ZE=[];function QE(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function ew(e,t,i,r){let n=0;for(let s=t;s<i;s++){let t=e[s];n+=r[t]?.layoutWidth||0}return n}function tw(e,t,i,r,n,s){let o=t,a=0;for(let l=t;l<i;l++){let t=ew(e,l,l+1,n);a+t>r&&(o<l&&s.push(l),o=l,a=0),a+=t}return a}function iw(e,t,i,r,n=0,s){void 0===s&&(s=e.length);let o=[];return"break-all"===t?tw(e,n,s,i,r,o):function(e,t,i,r,n,s){let o=t,a=t,l=t,u=0;for(let h=t;h<i;h++)if((" "===e[h]||" "===e[h+1]||h+1===i)&&(l=h+1),l>a){let t=ew(e,a,l,n);u+t>r&&(o<a&&(s.push(a),o=a,u=0),t>r&&(t=tw(e,a,l,r,n,s),o=s[s.length-1])),a=l,u+=t}}(e,n,s,i,r,o),o}function rw(e,t,i,r,n,s){let o=0,a=0;for(let s=t;s<i;s++){let t=e[s],i=r[t];i?(a||(a=i.layoutHeight),n[s]=o+i.layoutWidth/2,o+=i.layoutWidth):(wi.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),n[s]=o,o+=YE)}s[0]=o,s[1]=a}var nw=class{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}},sw={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){let e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},ow=new nw(3);function aw(e,t){for(let i=0;i<e.length;i++)t.data[4*i+3]=e[i]}function lw(e,t,i,r){e.font=`${r} ${i}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}var uw=class{constructor(){this.props={...sw}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let t=function(e,t){let i;i="string"==typeof t?new Set(Array.from(t)):new Set(t);let r=ow.get(e);if(!r)return i;for(let e in r.mapping)i.has(e)&&i.delete(e);return i}(this._key,this.props.characterSet),i=ow.get(this._key);if(i&&0===t.size)return void(this._atlas!==i&&(this._atlas=i));let r=this._generateFontAtlas(t,i);this._atlas=r,ow.set(this._key,r)}_generateFontAtlas(e,t){let{fontFamily:i,fontWeight:r,fontSize:n,buffer:s,sdf:o,radius:a,cutoff:l}=this.props,u=t&&t.data;u||(u=document.createElement("canvas"),u.width=1024);let h=u.getContext("2d",{willReadFrequently:!0});lw(h,i,n,r);let{mapping:c,canvasHeight:d,xOffset:f,yOffset:p}=function({characterSet:e,getFontWidth:t,fontHeight:i,buffer:r,maxCanvasWidth:n,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,u=o,h=i+2*r;for(let o of e)if(!s[o]){let e=t(o);u+e+2*r>n&&(u=0,l++),s[o]={x:u+r,y:a+l*h+r,width:e,height:h,layoutWidth:e,layoutHeight:i},u+=e+2*r}return{mapping:s,xOffset:u,yOffset:a+l*h,canvasHeight:QE(a+(l+1)*h)}}({getFontWidth:e=>h.measureText(e).width,fontHeight:1.2*n,buffer:s,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(u.height!==d){let e=h.getImageData(0,0,u.width,u.height);u.height=d,h.putImageData(e,0,0)}if(lw(h,i,n,r),o){let t=new class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:s="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;let a=this.size=e+4*t,l=this._createCanvas(a),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${o} ${s} ${e}px ${n}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:s}=this.ctx.measureText(e),o=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-n))),l=Math.min(this.size-this.buffer,o+Math.ceil(r)),u=a+2*this.buffer,h=l+2*this.buffer,c=Math.max(u*h,0),d=new Uint8ClampedArray(c),f={data:d,width:u,height:h,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return f;let{ctx:p,buffer:g,gridInner:m,gridOuter:_}=this;p.clearRect(g,g,a,l),p.fillText(e,g,g+o);let v=p.getImageData(g,g,a,l);_.fill(1e20,0,c),m.fill(0,0,c);for(let e=0;e<l;e++)for(let t=0;t<a;t++){let i=v.data[4*(e*a+t)+3]/255;if(0===i)continue;let r=(e+g)*u+t+g;if(1===i)_[r]=0,m[r]=1e20;else{let e=.5-i;_[r]=e>0?e*e:0,m[r]=e<0?e*e:0}}$E(_,0,0,u,h,u,this.f,this.v,this.z),$E(m,g,g,a,l,u,this.f,this.v,this.z);for(let e=0;e<c;e++){let t=Math.sqrt(_[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}}({fontSize:n,buffer:s,radius:a,cutoff:l,fontFamily:i,fontWeight:`${r}`});for(let i of e){let{data:e,width:r,height:s,glyphTop:o}=t.draw(i);c[i].width=r,c[i].layoutOffsetY=.9*n-o;let a=h.createImageData(r,s);aw(e,a),h.putImageData(a,c[i].x,c[i].y)}}else for(let t of e)h.fillText(t,c[t].x,c[t].y+s+.9*n);return{xOffset:f,yOffset:p,mapping:c,data:u,width:u.width,height:u.height}}_getKey(){let{fontFamily:e,fontWeight:t,fontSize:i,buffer:r,sdf:n,radius:s,cutoff:o}=this.props;return n?`${e} ${t} ${i} ${r} ${s} ${o}`:`${e} ${t} ${i} ${r}`}},hw={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},cw=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME text-background-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceRects;\nin float instanceSizes;\nin float instanceAngles;\nin vec2 instancePixelOffsets;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout float vLineWidth;\nout vec2 uv;\nout vec2 dimensions;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = radians(angle);\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvLineWidth = instanceLineWidths;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\nsizeMinPixels, sizeMaxPixels\n);\ndimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\nvec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\npixelOffset += instancePixelOffsets;\npixelOffset.y *= -1.0;\nif (billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME text-background-layer-fragment-shader\nprecision highp float;\nuniform bool stroked;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin float vLineWidth;\nin vec2 uv;\nin vec2 dimensions;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec2 pixelPosition = uv * dimensions;\nif (stroked) {\nfloat distToEdge = min(\nmin(pixelPosition.x, dimensions.x - pixelPosition.x),\nmin(pixelPosition.y, dimensions.y - pixelPosition.y)\n);\nfloat isBorder = smoothedge(distToEdge, vLineWidth);\nfragColor = mix(vFillColor, vLineColor, isBorder);\n} else {\nfragColor = vFillColor;\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[rd,Vd]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:t,sizeScale:i,sizeUnits:r,sizeMinPixels:n,sizeMaxPixels:s,getLineWidth:o}=this.props,{padding:a}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]);let l=this.state.model;l.setUniforms(e),l.setUniforms({billboard:t,stroked:Boolean(o),padding:a,sizeUnits:kc[r],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:s}),l.draw(this.context.renderPass)}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}},dw=cw;cw.defaultProps=hw,cw.layerName="TextBackgroundLayer";var fw={start:1,middle:0,end:-1},pw={top:1,center:0,bottom:-1},gw=[0,0,0,255],mw={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:gw},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:sw.characterSet},fontFamily:sw.fontFamily,fontWeight:sw.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:gw},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:gw},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},_w=class extends db{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,r]}=this.transformParagraph(e,t),{fontSize:n}=this.state.fontAtlasManager.props;i/=n,r/=n;let{getTextAnchor:s,getAlignmentBaseline:o}=this.props;return[(fw["function"==typeof s?s(e,t):s]-1)*i/2,(pw["function"==typeof o?o(e,t):o]-1)*r/2,i,r]},this.getIconOffsets=(e,t)=>{let{getTextAnchor:i,getAlignmentBaseline:r}=this.props,{x:n,y:s,rowWidth:o,size:[a,l]}=this.transformParagraph(e,t),u=fw["function"==typeof i?i(e,t):i],h=pw["function"==typeof r?r(e,t):r],c=n.length,d=new Array(2*c),f=0;for(let e=0;e<c;e++){let t=(1-u)*(a-o[e])/2;d[f++]=(u-1)*a/2+t+n[e],d[f++]=(h-1)*l/2+s[e]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new uw},this.props.maxWidth>0&&wi.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:t,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:n}=this.state,s={...e,characterSet:n,fontFamily:t,fontWeight:i};if(!r.mapping)return r.setProps(s),!0;for(let e in s)if(s[e]!==r.props[e])return r.setProps(s),!0;return!1}_updateText(){let e,{data:t,characterSet:i}=this.props,r=t.attributes?.getText,{getText:n}=this.props,s=t.startIndices,o="auto"===i&&new Set;if(r&&s){let{texts:i,characterCount:a}=function({value:e,length:t,stride:i,offset:r,startIndices:n,characterSet:s}){let o=e.BYTES_PER_ELEMENT,a=i?i/o:1,l=r?r/o:0,u=n[t]||Math.ceil((e.length-l)/a),h=s&&new Set,c=new Array(t),d=e;if(a>1||l>0){d=new(0,e.constructor)(u);for(let t=0;t<u;t++)d[t]=e[t*a+l]}for(let e=0;e<t;e++){let t=n[e],i=n[e+1]||u,r=d.subarray(t,i);c[e]=String.fromCodePoint.apply(null,r),h&&r.forEach(h.add,h)}if(h)for(let e of h)s.add(String.fromCodePoint(e));return{texts:c,characterCount:u}}({...ArrayBuffer.isView(r)?{value:r}:r,length:t.length,startIndices:s,characterSet:o});e=a,n=(e,{index:t})=>i[t]}else{let{iterable:i,objectInfo:r}=sy(t);s=[0],e=0;for(let t of i){r.index++;let i=Array.from(n(t,r)||"");o&&i.forEach(o.add,o),e+=i.length,s.push(e)}}this.setState({getText:n,startIndices:s,numInstances:e,characterSet:o||i})}transformParagraph(e,t){let{fontAtlasManager:i}=this.state,r=i.mapping,n=this.state.getText,{wordBreak:s,lineHeight:o,maxWidth:a}=this.props;return function(e,t,i,r,n){let s=Array.from(e),o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),h=("break-word"===i||"break-all"===i)&&isFinite(r)&&r>0,c=[0,0],d=[0,0],f=0,p=0,g=0;for(let e=0;e<=o;e++){let m=s[e];if(("\n"===m||e===o)&&(g=e),g>p){let e=h?iw(s,i,r,n,p,g):ZE;for(let i=0;i<=e.length;i++){let r=0===i?p:e[i-1],o=i<e.length?e[i]:g;rw(s,r,o,n,a,d);for(let e=r;e<o;e++){let t=s[e],i=n[t]?.layoutOffsetY||0;l[e]=f+d[1]/2+i,u[e]=d[0]}f+=d[1]*t,c[0]=Math.max(c[0],d[0])}p=g}"\n"===m&&(a[p]=0,l[p]=0,u[p]=0,p++)}return c[1]=f,{x:a,y:l,rowWidth:u,size:c}}(n(e,t)||"",o,s,a*i.props.fontSize,r)}renderLayers(){let{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:r,atlas:n,mapping:s},styleVersion:o}=this.state,{data:a,_dataDiff:l,getPosition:u,getColor:h,getSize:c,getAngle:d,getPixelOffset:f,getBackgroundColor:p,getBorderColor:g,getBorderWidth:m,backgroundPadding:_,background:v,billboard:y,fontSettings:b,outlineWidth:A,outlineColor:E,sizeScale:w,sizeUnits:x,sizeMinPixels:T,sizeMaxPixels:C,transitions:S,updateTriggers:P}=this.props,M=this.getSubLayerClass("characters",KE),R=this.getSubLayerClass("background",dw);return[v&&new R({getFillColor:p,getLineColor:g,getLineWidth:m,padding:_,getPosition:u,getSize:c,getAngle:d,getPixelOffset:f,billboard:y,sizeScale:w,sizeUnits:x,sizeMinPixels:T,sizeMaxPixels:C,transitions:S&&{getPosition:S.getPosition,getAngle:S.getAngle,getSize:S.getSize,getFillColor:S.getBackgroundColor,getLineColor:S.getBorderColor,getLineWidth:S.getBorderWidth,getPixelOffset:S.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:P.getPosition,getAngle:P.getAngle,getSize:P.getSize,getFillColor:P.getBackgroundColor,getLineColor:P.getBorderColor,getLineWidth:P.getBorderWidth,getPixelOffset:P.getPixelOffset,getBoundingRect:{getText:P.getText,getTextAnchor:P.getTextAnchor,getAlignmentBaseline:P.getAlignmentBaseline,styleVersion:o}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new M({sdf:b.sdf,smoothing:Number.isFinite(b.smoothing)?b.smoothing:sw.smoothing,outlineWidth:A/(b.radius||sw.radius),outlineColor:E,iconAtlas:n,iconMapping:s,getPosition:u,getColor:h,getSize:c,getAngle:d,getPixelOffset:f,billboard:y,sizeScale:w*r,sizeUnits:x,sizeMinPixels:T*r,sizeMaxPixels:C*r,transitions:S&&{getPosition:S.getPosition,getAngle:S.getAngle,getColor:S.getColor,getSize:S.getSize,getPixelOffset:S.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:P.getText,getPosition:P.getPosition,getAngle:P.getAngle,getColor:P.getColor,getSize:P.getSize,getPixelOffset:P.getPixelOffset,getIconOffsets:{getTextAnchor:P.getTextAnchor,getAlignmentBaseline:P.getAlignmentBaseline,styleVersion:o}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){!function(e){wi.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),ow=new nw(e)}(e)}},vw=_w;_w.defaultProps=mw,_w.layerName="TextLayer";var yw={circle:{type:IA,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:yA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:vw,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},bw={type:_E,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Aw={type:kE,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ew({type:e,props:t}){let i={};for(let r in t)i[r]=e.defaultProps[t[r]];return i}function ww(e,t){let{transitions:i,updateTriggers:r}=e.props,n={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(let s in t){let o=t[s],a=e.props[s];s.startsWith("get")&&(a=e.getSubLayerAccessor(a),n.updateTriggers[o]=r[s],i&&(n.transitions[o]=i[s])),n[o]=a}return n}function xw(e,t,i={}){let r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=e.length}=i;for(let i=n;i<s;i++){let n=e[i],{geometry:s}=n;if(s)if("GeometryCollection"===s.type){wi.assert(Array.isArray(s.geometries),"GeoJSON does not have geometries array");let{geometries:e}=s;for(let s=0;s<e.length;s++)Tw(e[s],r,t,n,i)}else Tw(s,r,t,n,i)}return r}function Tw(e,t,i,r,n){let{type:s,coordinates:o}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:u,polygonOutlineFeatures:h}=t;if(function(e,t){let i=Cw[e];for(wi.assert(i,`Unknown GeoJSON type ${e}`);t&&--i>0;)t=t[0];return t&&Number.isFinite(t[0])}(s,o))switch(s){case"Point":a.push(i({geometry:e},r,n));break;case"MultiPoint":o.forEach((e=>{a.push(i({geometry:{type:"Point",coordinates:e}},r,n))}));break;case"LineString":l.push(i({geometry:e},r,n));break;case"MultiLineString":o.forEach((e=>{l.push(i({geometry:{type:"LineString",coordinates:e}},r,n))}));break;case"Polygon":u.push(i({geometry:e},r,n)),o.forEach((e=>{h.push(i({geometry:{type:"LineString",coordinates:e}},r,n))}));break;case"MultiPolygon":o.forEach((e=>{u.push(i({geometry:{type:"Polygon",coordinates:e}},r,n)),e.forEach((e=>{h.push(i({geometry:{type:"LineString",coordinates:e}},r,n))}))}))}else wi.warn(`${s} coordinates are malformed`)()}var Cw={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Sw(e){return e.geometry.coordinates}function Pw(e,t){let i={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:r,lines:n,polygons:s}=e,o=function(e,t){let i={points:null,lines:null,polygons:null};for(let r in i){let n=e[r].globalFeatureIds.value;i[r]=new Uint8ClampedArray(3*n.length);let s=[];for(let e=0;e<n.length;e++)t(n[e],s),i[r][3*e+0]=s[0],i[r][3*e+1]=s[1],i[r][3*e+2]=s[2]}return i}(e,t);return i.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:3,value:o.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines._pathType="open",i.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygons._normalize=!1,s.triangles&&(i.polygons.data.attributes.indices=s.triangles.value),i.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygonsOutline._pathType="open",i}var Mw=["points","linestrings","polygons"],Rw={...Ew(yw.circle),...Ew(yw.icon),...Ew(yw.text),...Ew(bw),...Ew(Aw),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},Iw=class extends db{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;let{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){let i=Pw(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){let i=function(e){if(Array.isArray(e))return e;switch(wi.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return wi.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),r=this.getSubLayerRow.bind(this),n={},s={};if(Array.isArray(t.dataChanged)){let e=this.state.features;for(let t in e)n[t]=e[t].slice(),s[t]=[];for(let o of t.dataChanged){let t=xw(i,r,o);for(let i in e)s[i].push(UE({data:n[i],getIndex:e=>e.__source.index,dataRange:o,replace:t[i]}))}}else n=xw(i,r);let o=function(e,t){let i={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:r,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:o}=e;return i.points.data=r,i.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),i.points.getPosition=Sw,i.lines.data=n,i.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),i.lines.getPath=Sw,i.polygons.data=s,i.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),i.polygons.getPolygon=Sw,i.polygonsOutline.data=o,i.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),i.polygonsOutline.getPath=Sw,i}(n,s);this.setState({features:n,featuresDiff:s,layerProps:o})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i,sourceLayer:r}=t;return t.featureType=Mw.find((e=>r.id.startsWith(`${this.id}-${e}-`))),i>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){let t=`${this.id}-points-`,i="points"===e.featureType;for(let r of this.getSubLayers())r.id.startsWith(t)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,r="polygons-fill",n=this.shouldRenderSubLayer(r,i.polygons?.data)&&this.getSubLayerClass(r,Aw.type);if(n){let s=ww(this,Aw.props),o=e&&t;return o||delete s.getLineColor,s.updateTriggers.lineColors=o,new n(s,this.getSubLayerProps({id:r,updateTriggers:s.updateTriggers}),i.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,r="polygons-stroke",n="linestrings",s=!e&&t&&this.shouldRenderSubLayer(r,i.polygonsOutline?.data)&&this.getSubLayerClass(r,bw.type),o=this.shouldRenderSubLayer(n,i.lines?.data)&&this.getSubLayerClass(n,bw.type);if(s||o){let e=ww(this,bw.props);return[s&&new s(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),i.polygonsOutline),o&&new o(e,this.getSubLayerProps({id:n,updateTriggers:e.updateTriggers}),i.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:t,binary:i}=this.state,{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=t.points.data.findIndex((e=>e.__source.index===r)));let n=new Set(e.split("+")),s=[];for(let e of n){let n=`points-${e}`,o=yw[e],a=o&&this.shouldRenderSubLayer(n,t.points?.data)&&this.getSubLayerClass(n,o.type);if(a){let l=ww(this,o.props),u=t.points;if("text"===e&&i){let{instancePickingColors:e,...t}=u.data.attributes;u={...u,data:{...u.data,attributes:t}}}s.push(new a(l,this.getSubLayerProps({id:n,updateTriggers:l.updateTriggers,highlightedObjectIndex:r}),u))}}return s}renderLayers(){let{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){let{binary:t}=this.state;return t&&"function"==typeof e?(t,i)=>{let{data:r,index:n}=i,s=function(e,t){if(!e)return null;let i="startIndices"in e?e.startIndices[t]:t,r=e.featureIds.value[i];return-1!==i?function(e,t,i){let r={properties:{...e.properties[t]}};for(let t in e.numericProps)r.properties[t]=e.numericProps[t].value[i];return r}(e,r,i):null}(r,n);return e(s,i)}:super.getSubLayerAccessor(e)}},Bw=Iw;function Lw(e){return"string"==typeof e?e.charAt(0).toLowerCase()+e.slice(1):e}function Ow(e){if(Array.isArray(e))return e.map((e=>Ow(e)));if(e&&"object"==typeof e){let t={};for(let[i,r]of Object.entries(e))t[Lw(i)]=Ow(r);return t}return e}Iw.layerName="GeoJsonLayer",Iw.defaultProps=Rw;var Fw=h(P(),1);function Nw(e,t){if(null!=t&&t._parser&&"fast-xml-parser"!==t._parser)throw new Error(t?._parser);let i=function(e,t){return new Fw.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(e)}(e,{allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t?.removeNSPrefix,textNodeName:t?.textNodeName,isArray:(e,i,r,n)=>{var s;return Boolean(null==t||null===(s=t.arrayPaths)||void 0===s?void 0:s.some((e=>i===e)))},...t?._fastXML});return null!=t&&t.uncapitalizeKeys?Ow(i):i}var Dw={name:"XML",id:"xml",module:"xml",version:"4.1.4",worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(e,t)=>Nw((new TextDecoder).decode(e),{...Dw.options.xml,...t?.xml}),parseTextSync:(e,t)=>Nw(e,{...Dw.options.xml,...t?.xml})},kw={id:"wms-error",name:"WMS Error",module:"wms",version:"4.1.4",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{wms:{throwOnError:!1}},parse:async(e,t)=>Uw((new TextDecoder).decode(e),t),parseSync:(e,t)=>Uw((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>Uw(e,t)};function Uw(e,t){let i={...kw.options.wms,...t?.wms},r=function(e,t){var i,r,n;let s=null===(i=Dw.parseTextSync)||void 0===i?void 0:i.call(Dw,e,t),o=(null==s||null===(r=s.ServiceExceptionReport)||void 0===r?void 0:r.ServiceException)||(null==s||null===(n=s["ogc:ServiceExceptionReport"])||void 0===n?void 0:n["ogc:ServiceException"]);return"string"==typeof o?o:o.value||o.code||"Unknown error"}(e,i),n=i.minimalErrors?r:`WMS Service error: ${r}`;if(i.throwOnError)throw new Error(n);return n}function Gw(e){return Array.isArray(e)?e:e?[e]:[]}function zw(e){let t=Gw(e);return t.length>0&&t.every((e=>"string"==typeof e))?t:[]}function Vw(e){switch(typeof e){case"number":return e;case"string":return parseFloat(e);default:return}}function jw(e){switch(typeof e){case"number":return e;case"string":return parseInt(e,10);default:return}}function Hw(e){switch(e){case"true":case"1":return!0;default:return!1}}function Ww(e,t){var i;let r=null===(i=Dw.parseTextSync)||void 0===i?void 0:i.call(Dw,e,t),n=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,s=function(e){var t,i,r,n,s,o,a,l,u,h,c,d,f,p,g,m;let _={version:String(e.version||""),name:String((null===(t=e.Service)||void 0===t?void 0:t.Name)||"unnamed"),title:null!==(i=e.Service)&&void 0!==i&&i.Title?String(null===(r=e.Service)||void 0===r?void 0:r.Title):void 0,abstract:null!==(n=e.Service)&&void 0!==n&&n.Abstract?String(null===(s=e.Service)||void 0===s?void 0:s.Abstract):void 0,keywords:zw(null===(o=e.Service)||void 0===o||null===(a=o.KeywordList)||void 0===a?void 0:a.Keyword),fees:null!==(l=e.Service)&&void 0!==l&&l.Fees?JSON.stringify(null===(u=e.Service)||void 0===u?void 0:u.Fees):void 0,accessConstraints:null!==(h=e.Service)&&void 0!==h&&h.AccessConstraints?JSON.stringify(null===(c=e.Service)||void 0===c?void 0:c.AccessConstraints):void 0,layerLimit:jw(null===(d=e.Service)||void 0===d?void 0:d.LayerLimit),maxWidth:jw(null===(f=e.Service)||void 0===f?void 0:f.maxWidth),maxHeight:jw(null===(p=e.Service)||void 0===p?void 0:p.maxHeight),layers:[],requests:Xw(null===(g=e.Capability)||void 0===g?void 0:g.Request),exceptions:qw(e.Exception)},v=Gw(null===(m=e.Capability)||void 0===m?void 0:m.Layer);for(let e of v)_.layers.push(Kw(e));for(let[e,t]of Object.entries(_))void 0===t&&delete _[e];return _}(n);if(null!=t&&t.inheritedLayerProps)for(let e of s.layers)$w(e,null);return null!=t&&t.includeRawJSON&&(s.json=n),null!=t&&t.includeXMLText&&(s.xml=e),s}function Xw(e){let t={};for(let[i,r]of Object.entries(e||{})){let e=zw(r?.Format);t[i]={mimeTypes:e}}return t}function qw(e){if(Gw(e?.Format).length>0)return{mimeTypes:zw(e)}}function Kw(e){var t;let i={title:String(e?.Title||""),name:e?.Name&&String(e?.Name),abstract:e?.Name&&String(e?.Abstract),keywords:zw(null===(t=e.KeywordList)||void 0===t?void 0:t.Keyword)},r=e?.CRS||e?.SRS;r&&Array.isArray(r)&&r.every((e=>"string"==typeof e))&&(i.crs=r);let n=e?.EX_GeographicBoundingBox&&function(e){let{westBoundLongitude:t,northBoundLatitude:i,eastBoundLongitude:r,southBoundLatitude:n}=e;return[[t,n],[r,i]]}(e?.EX_GeographicBoundingBox);n&&(i.geographicBoundingBox=n),n=e?.LatLonBoundingBox&&function(e){let{minx:t,miny:i,maxx:r,maxy:n}=e;return[[t,i],[r,n]]}(e?.LatLonBoundingBox),n&&(i.geographicBoundingBox=n);let s=e?.BoundingBox&&function(e){return Gw(e).map((e=>function(e){let{CRS:t,SRS:i,minx:r,miny:n,maxx:s,maxy:o,resx:a,resy:l}=e,u={crs:t||i,boundingBox:[[Vw(r),Vw(n)],[Vw(s),Vw(o)]]};return a&&(u.xResolution=a),l&&(u.yResolution=l),u}(e)))}(e?.BoundingBox);s&&s.length>0&&(i.boundingBoxes=s);let o=Gw(e?.Dimension).map((e=>function(e){let{name:t,units:i,value:r}=e,n={name:t,units:i,extent:r};return e.unitSymbol&&(n.unitSymbol=e.unitSymbol),e.default&&(n.defaultValue=e.default),e.multipleValues&&(n.multipleValues=Hw(e.multipleValues)),e.nearestValue&&(n.nearestValue=Hw(e.nearestValue)),e.current&&(n.current=Hw(e.current)),n}(e)));o.length&&(i.dimensions=o),null!=e&&e.opaque&&(i.opaque=Hw(e?.opaque)),null!=e&&e.cascaded&&(i.cascaded=Hw(e?.cascaded)),null!=e&&e.queryable&&(i.queryable=Hw(e?.queryable));let a=Gw(e?.Layer),l=[];for(let e of a)l.push(Kw(e));l.length>0&&(i.layers=l);for(let[e,t]of Object.entries(i))void 0===t&&delete i[e];return i}function $w(e,t){null!=t&&t.geographicBoundingBox&&!e.geographicBoundingBox&&(e.geographicBoundingBox=[...t.geographicBoundingBox]),null!=t&&t.crs&&!e.crs&&(e.crs=[...t.crs]),null!=t&&t.boundingBoxes&&!e.boundingBoxes&&(e.boundingBoxes=[...t.boundingBoxes]),null!=t&&t.dimensions&&!e.dimensions&&(e.dimensions=[...t.dimensions]);for(let t of e.layers||[])$w(t,e)}var Jw={id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:"4.1.4",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{wms:{}},parse:async(e,t)=>Ww((new TextDecoder).decode(e),t?.wms),parseTextSync:(e,t)=>Ww(e,t?.wms)};function Yw(e,t){var i,r;let n=(null===(r=(null===(i=Dw.parseTextSync)||void 0===i?void 0:i.call(Dw,e,t)).FeatureInfoResponse)||void 0===r?void 0:r.FIELDS)||[];return{features:(Array.isArray(n)?n:[n]).map((e=>function(e){return{attributes:e||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}(e)))}}var Zw={...Jw,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(e,t)=>Yw((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>Yw(e,t)};function Qw(e,t){var i;return null===(i=Dw.parseTextSync)||void 0===i?void 0:i.call(Dw,e,t)}var ex={...Jw,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(e,t)=>Qw((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>Qw(e,t)},tx={type:"wms",testURL:e=>e.toLowerCase().includes("wms"),create:e=>new ix(e)},ix=class extends Be{constructor(e){var t;super(e),this.url=void 0,this.data=void 0,this.substituteCRS84=void 0,this.flipCRS=void 0,this.wmsParameters=void 0,this.vendorParameters=void 0,this.capabilities=null,this.url=e.url,this.data=e.url,this.substituteCRS84=null!==(t=e.substituteCRS84)&&void 0!==t&&t,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...e.wmsParameters},this.vendorParameters=e.vendorParameters||{}}async getMetadata(){let e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){let{boundingBox:t,bbox:i,...r}=e,n={bbox:t?[...t[0],...t[1]]:i,...r};return await this.getMap(n)}normalizeMetadata(e){return e}async getCapabilities(e,t){let i=this.getCapabilitiesURL(e,t),r=await this.fetch(i),n=await r.arrayBuffer();this._checkResponse(r,n);let s=await Jw.parse(n,this.loadOptions);return this.capabilities=s,s}async getMap(e,t){let i=this.getMapURL(e,t),r=await this.fetch(i),n=await r.arrayBuffer();this._checkResponse(r,n);try{return await bi.parse(n,this.loadOptions)}catch{throw this._parseError(n)}}async getFeatureInfo(e,t){let i=this.getFeatureInfoURL(e,t),r=await this.fetch(i),n=await r.arrayBuffer();return this._checkResponse(r,n),await Zw.parse(n,this.loadOptions)}async getFeatureInfoText(e,t){let i=this.getFeatureInfoURL(e,t),r=await this.fetch(i),n=await r.arrayBuffer();return this._checkResponse(r,n),(new TextDecoder).decode(n)}async describeLayer(e,t){let i=this.describeLayerURL(e,t),r=await this.fetch(i),n=await r.arrayBuffer();return this._checkResponse(r,n),await ex.parse(n,this.loadOptions)}async getLegendGraphic(e,t){let i=this.getLegendGraphicURL(e,t),r=await this.fetch(i),n=await r.arrayBuffer();this._checkResponse(r,n);try{return await bi.parse(n,this.loadOptions)}catch{throw this._parseError(n)}}getCapabilitiesURL(e,t){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",i,t)}getMapURL(e,t){e=this._getWMS130Parameters(e);let i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",i,t)}getFeatureInfoURL(e,t){e=this._getWMS130Parameters(e);let i={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",i,t)}describeLayerURL(e,t){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",i,t)}getLegendGraphicURL(e,t){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",i,t)}_parseWMSUrl(e){let[t,i]=e.split("?"),r=i.split("&"),n={};for(let e of r){let[t,i]=e.split("=");n[t]=i}return{url:t,parameters:n}}_getWMSUrl(e,t,i){let r=this.url,n=!0,s={service:"WMS",version:t.version,request:e,...t,...this.vendorParameters,...i},o=["transparent","time","elevation"];for(let[e,i]of Object.entries(s))(!o.includes(e)||i)&&(r+=n?"?":"&",n=!1,r+=this._getURLParameter(e,i,t));return encodeURI(r)}_getWMS130Parameters(e){let t={...e};return t.srs&&(t.crs=t.crs||t.srs,delete t.srs),t}_getURLParameter(e,t,i){switch(e){case"crs":"1.3.0"!==i.version?e="srs":this.substituteCRS84&&"EPSG:4326"===t&&(t="CRS:84");break;case"srs":"1.3.0"===i.version&&(e="crs");break;case"bbox":let r=this._flipBoundingBox(t,i);r&&(t=r)}return e=e.toUpperCase(),Array.isArray(t)?`${e}=${t.join(",")}`:`${e}=${t?String(t):""}`}_flipBoundingBox(e,t){if(!Array.isArray(e)||4!==e.length)return null;let i=e;return"1.3.0"!==t.version||!this.flipCRS.includes(t.crs||"")||this.substituteCRS84&&"EPSG:4326"===t.crs?i:[i[1],i[0],i[3],i[2]]}async _fetchArrayBuffer(e){let t=await this.fetch(e),i=await t.arrayBuffer();return this._checkResponse(t,i),i}_checkResponse(e,t){let i=e.headers["content-type"];if(!e.ok||kw.mimeTypes.includes(i)){var r;let e=k(this.loadOptions,{wms:{throwOnError:!0}}),i=null===(r=kw.parseSync)||void 0===r?void 0:r.call(kw,t,e);throw new Error(i)}}_parseError(e){var t;let i=null===(t=kw.parseSync)||void 0===t?void 0:t.call(kw,e,this.loadOptions);return new Error(i)}},rx=class extends Be{constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){let t=this.getGranularParameters(e),i=this.getURLFromTemplate(t),r=await(await this.fetch(i)).arrayBuffer();return await bi.parse(r)}getGranularParameters(e){let[[t,i],[r,n]]=e.boundingBox;return{...e,east:t,north:i,south:n,west:r}}getURLFromTemplate(e){let t=this.props.url;for(let[i,r]of Object.entries(e))t=t.replace(`\${${i}}`,String(r)),t=t.replace(`{${i}}`,String(r));return t}};rx.type="template",rx.testURL=e=>e.toLowerCase().includes("{");var nx=class extends rx{constructor(e){super(e),this.data=void 0,this.data=e.url}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.props.url}?f=pjson`}exportImageURL(e){let t=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,i=`size=${e.width},${e.height}`,r={...e,bbox:t,size:i};return delete r.width,delete r.height,this.getUrl("exportImage",r)}getUrl(e,t,i){let r=`${this.props.url}/${e}`,n=!0;for(let[e,i]of Object.entries(t))r+=n?"?":"&",n=!1,Array.isArray(i)?r+=`${e.toUpperCase()}=${i.join(",")}`:r+=`${e.toUpperCase()}=${i?String(i):""}`;return r}async checkResponse(e){if(!e.ok)throw new Error("error")}},sx={type:"arcgis-image-server",testURL:e=>e.toLowerCase().includes("ImageServer"),create:e=>new nx(e)},ox=[tx,sx];function ax(e){return function(e,t){let{type:i="auto"}=e,r="auto"===i?function(e,t){for(let i of t)if(i.testURL&&i.testURL(e))return i;return null}(e.url,t):function(e,t){for(let i of t)if(i.type===e)return i;return null}(i,t);if(!r)throw new Error("Not a valid image source type");return r.create(e)}(e,ox)}var lx=6378137*Math.PI;function ux(e){let t=bd(e);return t[0]=(t[0]/256-1)*lx,t[1]=(t[1]/256-1)*lx,t}var hx={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(e,t)=>console.error(t,e)}},cx=class extends db{get isLoaded(){return 0===this.state?.loadCounter&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:t,oldProps:i}){let{viewport:r}=this.context;e.dataChanged||t.serviceType!==i.serviceType?(this.state.imageSource=this._createImageSource(t),this._loadMetadata(),this.debounce((()=>this.loadImage(r,"image source changed")),0)):sg(t.layers,i.layers,1)?e.viewportChanged&&this.debounce((()=>this.loadImage(r,"viewport changed"))):this.debounce((()=>this.loadImage(r,"layers changed")),0)}finalizeState(){}renderLayers(){let{bounds:e,image:t,lastRequestParameters:i}=this.state;return t&&new oA({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:"EPSG:4326"===i.srs?Nc.LNGLAT:Nc.CARTESIAN,bounds:e,image:t})}async getFeatureInfoText(e,t){let{lastRequestParameters:i}=this.state;return i?await(this.state.imageSource.getFeatureInfoText?.({...i,query_layers:i.layers,x:e,y:t,info_format:"application/vnd.ogc.gml"})):""}_createImageSource(e){if(e.data instanceof Be)return e.data;if("string"==typeof e.data)return ax({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){let{imageSource:e}=this.state;try{this.state.loadCounter++;let t=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(t)}catch(e){this.getCurrentLayer()?.props.onMetadataLoadError(e)}finally{this.state.loadCounter--}}async loadImage(e,t){let{layers:i,serviceType:r}=this.props;if("wms"===r&&0===i.length)return;let n=e.getBounds(),{width:s,height:o}=e,a=this.getRequestId(),{srs:l}=this.props;"auto"===l&&(l=e.resolution?"EPSG:4326":"EPSG:3857");let u={width:s,height:o,boundingBox:[[n[0],n[1]],[n[2],n[3]]],layers:i,crs:l};if("EPSG:3857"===l){let e=ux([n[0],n[1]]),t=ux([n[2],n[3]]);u.boundingBox=[e,t]}try{this.state.loadCounter++,this.props.onImageLoadStart(a);let e=await this.state.imageSource.getImage(u);this.state.lastRequestId<a&&(this.getCurrentLayer()?.props.onImageLoad(a),this.setState({image:e,bounds:n,lastRequestParameters:u,lastRequestId:a}))}catch(e){this.raiseError(e,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(a,e)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,t=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout((()=>e()),t)}},dx=cx;cx.layerName="WMSLayer",cx.defaultProps=hx;var fx={getHeight:{type:"accessor",value:0},greatCircle:!0},px=class extends Qb{},gx=px;px.layerName="GreatCircleLayer",px.defaultProps=fx;var mx={...jE.defaultProps},_x=class extends db{indexToBounds(){return null}renderLayers(){let{elevationScale:e,extruded:t,wireframe:i,filled:r,stroked:n,lineWidthUnits:s,lineWidthScale:o,lineWidthMinPixels:a,lineWidthMaxPixels:l,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:c,getElevation:d,getFillColor:f,getLineColor:p,getLineWidth:g}=this.props,{updateTriggers:m,material:_,transitions:v}=this.props,y=this.getSubLayerClass("cell",jE),{updateTriggers:b,...A}=this.indexToBounds()||{};return new y({filled:r,wireframe:i,extruded:t,elevationScale:e,stroked:n,lineWidthUnits:s,lineWidthScale:o,lineWidthMinPixels:a,lineWidthMaxPixels:l,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:c,material:_,transitions:v,getElevation:d,getFillColor:f,getLineColor:p,getLineWidth:g},this.getSubLayerProps({id:"cell",updateTriggers:m&&{...b,getElevation:m.getElevation,getFillColor:m.getFillColor,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}),A)}},vx=_x;_x.layerName="GeoCellLayer",_x.defaultProps=mx;var yx=h(M(),1),bx=3,Ax=61,Ex=180/Math.PI;function wx(e,t,i){let r=1<<t;return[(e[0]+i[0])/r,(e[1]+i[1])/r]}function xx(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Tx(e){return[xx(e[0]),xx(e[1])]}function Cx(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function Sx([e,t,i]){let r=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*Ex,r*Ex]}function Px(e,t,i,r){if(0===r){1===i&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let r=t[0];t[0]=t[1],t[1]=r}}var Mx=h(M(),1),Rx=100;function Ix(e){if("string"==typeof e){if(e.indexOf("/")>0)return e;e=function(e){let t=e.padEnd(16,"0");return Mx.default.fromString(t,16)}(e)}return function(e){let t=yx.default.fromString(e,!0,10).toString(2);for(;t.length<bx+Ax;)t="0"+t;let i=t.lastIndexOf("1"),r=t.substring(0,3),n=t.substring(3,i),s=n.length/2,o=yx.default.fromString(r,!0,2).toString(10),a=yx.default.fromString(n,!0,2).toString(4);for(;a.length<s;)a="0"+a;return`${o}/${a}`}(e.toString())}function Bx(e){let t=function(e){let t,i=e.split("/"),r=parseInt(i[0],10),n=i[1],s=n.length,o=[0,0];for(let e=s-1;e>=0;e--){t=s-e;let i=n[e],r=0,a=0;"1"===i?a=1:"2"===i?(r=1,a=1):"3"===i&&(r=1);let l=Math.pow(2,t-1);Px(l,o,r,a),o[0]+=l*r,o[1]+=l*a}if(r%2==1){let e=o[0];o[0]=o[1],o[1]=e}return{face:r,ij:o,level:t}}(Ix(e));return function({face:e,ij:t,level:i}){let r=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(Rx*Math.pow(2,-i))),s=new Float64Array(4*n*2+2),o=0,a=0;for(let l=0;l<4;l++){let u=r[l].slice(0),h=r[l+1],c=(h[0]-u[0])/n,d=(h[1]-u[1])/n;for(let r=0;r<n;r++){u[0]+=c,u[1]+=d;let r=Sx(Cx(e,Tx(wx(t,i,u))));Math.abs(r[1])>89.999&&(r[0]=a);let n=r[0]-a;r[0]+=n>180?-360:n<-180?360:0,s[o++]=r[0],s[o++]=r[1],a=r[0]}}return s[o++]=s[0],s[o++]=s[1],s}(t)}var Lx={getS2Token:{type:"accessor",value:e=>e.token}},Ox=class extends vx{indexToBounds(){let{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(e,i)=>Bx(t(e,i))}}},Fx=Ox;Ox.layerName="S2Layer",Ox.defaultProps=Lx;var Nx=512;function Dx(e,t=1){let[i,r]=function(e,t){let i=0,r=0,n=1<<e.length,s=n/Nx;for(let t=0;t<e.length;t++){n>>=1;let s=parseInt(e[t]);s%2&&(i|=n),s>1&&(r|=n)}return[[i/s,Nx-r/s],[(i+t)/s,Nx-(r+t)/s]]}(e,t),[n,s]=Ad(i),[o,a]=Ad(r);return[o,s,o,a,n,a,n,s,o,s]}var kx={getQuadkey:{type:"accessor",value:e=>e.quadkey}},Ux=class extends vx{indexToBounds(){let{data:e,extruded:t,getQuadkey:i}=this.props,r=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(e,t)=>Dx(i(e,t),r),updateTriggers:{getPolygon:r}}}},Gx=Ux;Ux.layerName="QuadkeyLayer",Ux.defaultProps=kx;var zx=class{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,this.boundingBox="west"in e?[[e.west,e.south],[e.east,e.north]]:[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then((()=>this.data)):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:r}){let{index:n,id:s,bbox:o,userData:a,zoom:l}=this,u=this._loaderId;this._abortController=new AbortController;let{signal:h}=this._abortController,c=await t.scheduleRequest(this,(e=>e.isSelected?1:-1));if(!c)return void(this._isCancelled=!0);if(this._isCancelled)return void c.done();let d,f=null;try{f=await e({index:n,id:s,bbox:o,userData:a,zoom:l,signal:h})}catch(e){d=e||!0}finally{c.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=f,this._isCancelled&&!f)return void(this._isLoaded=!1);this._isLoaded=!0,this._isCancelled=!1,d?r(d,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}},Vx=-1,jx=0,Hx=1,Wx=new Rl,Xx=new Rl,qx=class{constructor(e=[0,0,0],t=[0,0,0],i){i=i||Wx.copy(e).add(t).scale(.5),this.center=new Rl(i),this.halfDiagonal=new Rl(t).subtract(this.center),this.minimum=new Rl(e),this.maximum=new Rl(t)}clone(){return new qx(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:t}=this,i=Xx.from(e.normal),r=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),n=this.center.dot(i)+e.distance;return n-r>0?Hx:n+r<0?Vx:jx}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t,i=Wx.from(e).subtract(this.center),{halfDiagonal:r}=this,n=0;return t=Math.abs(i.x)-r.x,t>0&&(n+=t*t),t=Math.abs(i.y)-r.y,t>0&&(n+=t*t),t=Math.abs(i.z)-r.z,t>0&&(n+=t*t),n}},Kx=new Rl,$x=new Rl,Jx=class{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new Rl,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Kx.from(t),this.center=(new Rl).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Jx(this.center,this.radius)}union(e){let t=this.center,i=this.radius,r=e.center,n=e.radius,s=Kx.copy(r).subtract(t),o=s.magnitude();if(i>=o+n)return this.clone();if(n>=o+i)return e.clone();let a=.5*(i+o+n);return $x.copy(s).scale((-i+a)/o).add(t),this.center.copy($x),this.radius=a,this}expand(e){let t=Kx.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);let t=Ul.getScaling(Kx,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){let t=this.distanceTo(e);return t*t}distanceTo(e){let t=Kx.from(e).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){let t=this.center,i=this.radius,r=e.normal.dot(t)+e.distance;return r<-i?Vx:r<i?jx:Hx}},Yx=new Rl,Zx=new Rl,Qx=new Rl,eT=new Rl,tT=new Rl,iT=new Rl,rT=new Rl,nT=0,sT=1,oT=2,aT=3,lT=4,uT=5,hT=6,cT=7,dT=8,fT=class{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=(new Rl).from(e),this.halfAxes=new Dl(t)}get halfSize(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Rl(e).len(),new Rl(t).len(),new Rl(i).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new Rl(e).normalize(),n=new Rl(t).normalize(),s=new Rl(i).normalize();return(new Jh).fromMatrix3(new Dl([...r,...n,...s]))}fromCenterHalfSizeQuaternion(e,t,i){let r=new Jh(i),n=(new Dl).fromQuaternion(r);return n[0]=n[0]*t[0],n[1]=n[1]*t[0],n[2]=n[2]*t[0],n[3]=n[3]*t[1],n[4]=n[4]*t[1],n[5]=n[5]*t[1],n[6]=n[6]*t[2],n[7]=n[7]*t[2],n[8]=n[8]*t[2],this.center=(new Rl).from(e),this.halfAxes=n,this}clone(){return new fT(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Jx){let t=this.halfAxes,i=t.getColumn(0,Qx),r=t.getColumn(1,eT),n=t.getColumn(2,tT),s=Yx.copy(i).add(r).add(n);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){let t=this.center,i=e.normal,r=this.halfAxes,n=i.x,s=i.y,o=i.z,a=Math.abs(n*r[nT]+s*r[sT]+o*r[oT])+Math.abs(n*r[aT]+s*r[lT]+o*r[uT])+Math.abs(n*r[hT]+s*r[cT]+o*r[dT]),l=i.dot(t)+e.distance;return l<=-a?Vx:l>=a?Hx:jx}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t=Zx.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,Qx),n=i.getColumn(1,eT),s=i.getColumn(2,tT),o=r.magnitude(),a=n.magnitude(),l=s.magnitude();r.normalize(),n.normalize(),s.normalize();let u,h=0;return u=Math.abs(t.dot(r))-o,u>0&&(h+=u*u),u=Math.abs(t.dot(n))-a,u>0&&(h+=u*u),u=Math.abs(t.dot(s))-l,u>0&&(h+=u*u),h}computePlaneDistances(e,t,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=this.center,o=this.halfAxes,a=o.getColumn(0,Qx),l=o.getColumn(1,eT),u=o.getColumn(2,tT),h=iT.copy(a).add(l).add(u).add(s),c=rT.copy(h).subtract(e),d=t.dot(c);return r=Math.min(d,r),n=Math.max(d,n),h.copy(s).add(a).add(l).subtract(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),h.copy(s).add(a).subtract(l).add(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),h.copy(s).add(a).subtract(l).subtract(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),s.copy(h).subtract(a).add(l).add(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),s.copy(h).subtract(a).add(l).subtract(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),s.copy(h).subtract(a).subtract(l).add(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),s.copy(h).subtract(a).subtract(l).subtract(u),c.copy(h).subtract(e),d=t.dot(c),r=Math.min(d,r),n=Math.max(d,n),i[0]=r,i[1]=n,i}transform(e){this.center.transformAsPoint(e);let t=this.halfAxes.getColumn(0,Qx);t.transformAsPoint(e);let i=this.halfAxes.getColumn(1,eT);i.transformAsPoint(e);let r=this.halfAxes.getColumn(2,tT);return r.transformAsPoint(e),this.halfAxes=new Dl([...t,...i,...r]),this}getTransform(){throw new Error("not implemented")}},pT=new Rl,gT=new Rl,mT=class{constructor(e=[0,0,1],t=0){this.normal=new Rl,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Mo(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=pT.from(e),this.normal.from(t).normalize();let i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,r){return this.normal.set(e,t,i),Mo(xo(this.normal.len(),1)),this.distance=r,this}clone(){return new mT(this.normal,this.distance)}equals(e){return xo(this.distance,e.distance)&&xo(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let t=gT.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){let i=pT.from(e),r=this.getPointDistance(i),n=gT.copy(this.normal).scale(r);return i.subtract(n).to(t)}},_T=[new Rl([1,0,0]),new Rl([0,1,0]),new Rl([0,0,1])],vT=new Rl,yT=new Rl,bT=class{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*_T.length;let t=e.center,i=e.radius,r=0;for(let e of _T){let n=this.planes[r],s=this.planes[r+1];n||(n=this.planes[r]=new mT),s||(s=this.planes[r+1]=new mT);let o=vT.copy(e).scale(-i).add(t);n.fromPointNormal(o,e);let a=vT.copy(e).scale(i).add(t),l=yT.copy(e).negate();s.fromPointNormal(a,l),r+=2}return this}computeVisibility(e){let t=Hx;for(let i of this.planes)switch(e.intersectPlane(i)){case Vx:return Vx;case jx:t=jx}return t}computeVisibilityWithPlaneMask(e,t){if(Mo(Number.isFinite(t),"parentPlaneMask is required."),t===bT.MASK_OUTSIDE||t===bT.MASK_INSIDE)return t;let i=bT.MASK_INSIDE,r=this.planes;for(let n=0;n<this.planes.length;++n){let s=n<31?1<<n:0;if(n<31&&!(t&s))continue;let o=r[n],a=e.intersectPlane(o);if(a===Vx)return bT.MASK_OUTSIDE;a===jx&&(i|=s)}return i}};bT.MASK_OUTSIDE=4294967295,bT.MASK_INSIDE=0,bT.MASK_INDETERMINATE=2147483647,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl;var AT=new Dl,ET=new Dl,wT=new Dl,xT=new Dl,TT=new Dl;function CT(e,t={}){let i=Qh.EPSILON20,r=0,n=0,s=ET,o=wT;s.identity(),o.copy(e);let a=i*function(e){let t=0;for(let i=0;i<9;++i){let r=e[i];t+=r*r}return Math.sqrt(t)}(o);for(;n<10&&MT(o)>a;)RT(o,xT),TT.copy(xT).transpose(),o.multiplyRight(xT),o.multiplyLeft(TT),s.multiplyRight(xT),++r>2&&(++n,r=0);return t.unitary=s.toTarget(t.unitary),t.diagonal=o.toTarget(t.diagonal),t}var ST=[1,0,0],PT=[2,2,1];function MT(e){let t=0;for(let i=0;i<3;++i){let r=e[AT.getElementIndex(PT[i],ST[i])];t+=2*r*r}return Math.sqrt(t)}function RT(e,t){let i=Qh.EPSILON15,r=0,n=1;for(let t=0;t<3;++t){let i=Math.abs(e[AT.getElementIndex(PT[t],ST[t])]);i>r&&(n=t,r=i)}let s=ST[n],o=PT[n],a=1,l=0;if(Math.abs(e[AT.getElementIndex(o,s)])>i){let t,i=(e[AT.getElementIndex(o,o)]-e[AT.getElementIndex(s,s)])/2/e[AT.getElementIndex(o,s)];t=i<0?-1/(-i+Math.sqrt(1+i*i)):1/(i+Math.sqrt(1+i*i)),a=1/Math.sqrt(1+t*t),l=t*a}return Dl.IDENTITY.to(t),t[AT.getElementIndex(s,s)]=t[AT.getElementIndex(o,o)]=a,t[AT.getElementIndex(o,s)]=l,t[AT.getElementIndex(s,o)]=-l,t}var IT=new Rl,BT=new Rl,LT=new Rl,OT=new Rl,FT=new Rl,NT=new Dl,DT={diagonal:new Dl,unitary:new Dl};function kT(e,t=new fT){if(!e||0===e.length)return t.halfAxes=new Dl([0,0,0,0,0,0,0,0,0]),t.center=new Rl,t;let i=e.length,r=new Rl(0,0,0);for(let t of e)r.add(t);let n=1/i;r.multiplyByScalar(n);let s=0,o=0,a=0,l=0,u=0,h=0;for(let t of e){let e=IT.copy(t).subtract(r);s+=e.x*e.x,o+=e.x*e.y,a+=e.x*e.z,l+=e.y*e.y,u+=e.y*e.z,h+=e.z*e.z}s*=n,o*=n,a*=n,l*=n,u*=n,h*=n;let c=NT;c[0]=s,c[1]=o,c[2]=a,c[3]=o,c[4]=l,c[5]=u,c[6]=a,c[7]=u,c[8]=h;let{unitary:d}=CT(c,DT),f=t.halfAxes.copy(d),p=f.getColumn(0,LT),g=f.getColumn(1,OT),m=f.getColumn(2,FT),_=-Number.MAX_VALUE,v=-Number.MAX_VALUE,y=-Number.MAX_VALUE,b=Number.MAX_VALUE,A=Number.MAX_VALUE,E=Number.MAX_VALUE;for(let t of e)IT.copy(t),_=Math.max(IT.dot(p),_),v=Math.max(IT.dot(g),v),y=Math.max(IT.dot(m),y),b=Math.min(IT.dot(p),b),A=Math.min(IT.dot(g),A),E=Math.min(IT.dot(m),E);p=p.multiplyByScalar(.5*(b+_)),g=g.multiplyByScalar(.5*(A+v)),m=m.multiplyByScalar(.5*(E+y)),t.center.copy(p).add(g).add(m);let w=BT.set(_-b,v-A,y-E).multiplyByScalar(.5),x=new Dl([w[0],0,0,0,w[1],0,0,0,w[2]]);return t.halfAxes.multiplyRight(x),t}var UT=512,GT=3,zT=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],VT=zT.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),jT=VT.concat([[.25,.5],[.75,.5]]),HT=class{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){let e=2*this.x,t=2*this.y,i=this.z+1;this._children=[new HT(e,t,i),new HT(e,t+1,i),new HT(e+1,t,i),new HT(e+1,t+1,i)]}return this._children}update(e){let{viewport:t,cullingVolume:i,elevationBounds:r,minZ:n,maxZ:s,bounds:o,offset:a,project:l}=e,u=this.getBoundingVolume(r,a,l);if(o&&!this.insideBounds(o)||i.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:e}=this;if(e<s&&e>=n){let i=u.distanceTo(t.cameraPosition)*t.scale/t.height;e+=Math.floor(Math.log2(i))}if(e>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let t of this.children)t.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,r]){let n=Math.pow(2,this.z),s=UT/n;return this.x*s<i&&this.y*s<r&&(this.x+1)*s>e&&(this.y+1)*s>t}getBoundingVolume(e,t,i){if(i){let t=this.z<1?jT:this.z<2?VT:zT,r=[];for(let n of t){let t=QT(this.x+n[0],this.y+n[1],this.z);t[2]=e[0],r.push(i(t)),e[0]!==e[1]&&(t[2]=e[1],r.push(i(t)))}return kT(r)}let r=Math.pow(2,this.z),n=UT/r,s=this.x*n+t*UT,o=UT-(this.y+1)*n;return new qx([s,o,e[0]],[s+n,o+n,e[1]])}},WT=512,XT=[-1/0,-1/0,1/0,1/0],qT={type:"object",value:null,validate:(e,t)=>t.optional&&null===e||"string"==typeof e||Array.isArray(e)&&e.every((e=>"string"==typeof e)),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;let i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}};function KT(e,t){let i=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...i.map((e=>e[0]))),Math.min(...i.map((e=>e[1]))),Math.max(...i.map((e=>e[0]))),Math.max(...i.map((e=>e[1])))]}function $T(e,t){if(!e||!e.length)return null;let{index:i,id:r}=t;if(Array.isArray(e)){let t=function(e){return Math.abs(e.split("").reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)|0),0))}(r)%e.length;e=e[t]}let n=e;for(let e of Object.keys(i)){let t=new RegExp(`{${e}}`,"g");n=n.replace(t,String(i[e]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),n}function JT({viewport:e,z:t,cullRect:i}){return(e.subViewports||[e]).map((e=>YT(e,t||0,i)))}function YT(e,t,i){if(!Array.isArray(t)){let r=i.x-e.x,n=i.y-e.y,{width:s,height:o}=i,a={targetZ:t},l=e.unproject([r,n],a),u=e.unproject([r+s,n],a),h=e.unproject([r,n+o],a),c=e.unproject([r+s,n+o],a);return[Math.min(l[0],u[0],h[0],c[0]),Math.min(l[1],u[1],h[1],c[1]),Math.max(l[0],u[0],h[0],c[0]),Math.max(l[1],u[1],h[1],c[1])]}let r=YT(e,t[0],i),n=YT(e,t[1],i);return[Math.min(r[0],n[0]),Math.min(r[1],n[1]),Math.max(r[2],n[2]),Math.max(r[3],n[3])]}function ZT(e,t){return Math.pow(2,e)*WT/t}function QT(e,t,i){let r=ZT(i,WT),n=e/r*360-180,s=Math.PI-2*Math.PI*t/r;return[n,180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)))]}function eC(e,t,i,r){let n=ZT(i,r);return[e/n*WT,t/n*WT]}function tC(e,t,i,r,n=WT){if(e.isGeospatial){let[e,n]=QT(t,i,r),[s,o]=QT(t+1,i+1,r);return{west:e,north:n,east:s,south:o}}let[s,o]=eC(t,i,r,n),[a,l]=eC(t+1,i+1,r,n);return{left:s,top:o,right:a,bottom:l}}function iC(e,t,i,r,n){let s=function(e,t,i){let r;if(t&&2===t.length){let[i,n]=t,s=e.getBounds({z:i}),o=e.getBounds({z:n});r=[Math.min(s[0],o[0]),Math.min(s[1],o[1]),Math.max(s[2],o[2]),Math.max(s[3],o[3])]}else r=e.getBounds();return e.isGeospatial?[Math.max(r[0],i[0]),Math.max(r[1],i[1]),Math.min(r[2],i[2]),Math.min(r[3],i[3])]:[Math.max(Math.min(r[0],i[2]),i[0]),Math.max(Math.min(r[1],i[3]),i[1]),Math.min(Math.max(r[2],i[0]),i[2]),Math.min(Math.max(r[3],i[1]),i[3])]}(e,null,r),o=ZT(t,i),[a,l,u,h]=function(e,t,i){return i?KT(e,i).map((e=>e*t/WT)):e.map((e=>e*t/WT))}(s,o,n),c=[];for(let e=Math.floor(a);e<u;e++)for(let i=Math.floor(l);i<h;i++)c.push({x:e,y:i,z:t});return c}function rC({viewport:e,maxZoom:t,minZoom:i,zRange:r,extent:n,tileSize:s=WT,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let u=e.isGeospatial?Math.round(e.zoom+Math.log2(WT/s))+l:Math.ceil(e.zoom)+l;if("number"==typeof i&&Number.isFinite(i)&&u<i){if(!n)return[];u=i}"number"==typeof t&&Number.isFinite(t)&&u>t&&(u=t);let h=n;return o&&a&&n&&!e.isGeospatial&&(h=KT(n,o)),e.isGeospatial?function(e,t,i,r){let n=e instanceof vb&&e.resolution?e.projectPosition:null,s=Object.values(e.getFrustumPlanes()).map((({normal:e,distance:t})=>new mT(e.clone().negate(),t))),o=new bT(s),a=e.distanceScales.unitsPerMeter[2],l=i&&i[0]*a||0,u=i&&i[1]*a||0,h=e instanceof Tf&&e.pitch<=60?t:0;if(r){let[e,t,i,n]=r,s=bd([e,n]),o=bd([i,t]);r=[s[0],UT-s[1],o[0],UT-o[1]]}let c=new HT(0,0,0),d={viewport:e,project:n,cullingVolume:o,elevationBounds:[l,u],minZ:h,maxZ:t,bounds:r,offset:0};if(c.update(d),e instanceof Tf&&e.subViewports&&e.subViewports.length>1){for(d.offset=-1;c.update(d)&&!(--d.offset<-GT););for(d.offset=1;c.update(d)&&!(++d.offset>GT););}return c.getSelected()}(e,u,r,n):iC(e,u,s,h||XT,a)}function nC(e,t){if(e===t)return!0;if(Array.isArray(e)){let i=e.length;if(!t||t.length!==i)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}return!1}var sC=2,oC="best-available",aC={[oC]:function(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&!hC(t)&&cC(t);for(let t of e)t.isVisible=Boolean(t.state&sC)},"no-overlap":function(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&hC(t);let t=Array.from(e).sort(((e,t)=>e.zoom-t.zoom));for(let e of t)if(e.isVisible=Boolean(e.state&sC),e.children&&(e.isVisible||1&e.state))for(let t of e.children)t.state=1;else e.isSelected&&cC(e)},never:()=>{}},lC={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},uC=class{constructor(e){this._getCullBounds=function(e){let t,i={};return r=>{for(let n in r)if(!nC(r[n],i[n])){t=e(r),i=r;break}return t}}(JT),this.opts={...lC,...e},this.setOptions(this.opts),this.onTileLoad=e=>{this.opts.onTileLoad?.(e),this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new ye({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Oh,this._modelMatrixInverse=new Oh}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every((e=>e.isLoaded))}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some((e=>e.needsReload))}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let t=this._cache.get(e);this._selectedTiles&&this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e,{zRange:t,modelMatrix:i}={zRange:null,modelMatrix:null}){let r=i?new Oh(i):new Oh,n=!r.equals(this._modelMatrix);if(this._viewport&&e.equals(this._viewport)&&xo(this._zRange,t)&&!n)this.needsReload&&(this._selectedTiles=this._selectedTiles.map((e=>this._getTile(e.index,!0))));else{n&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=t;let i=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=i.map((e=>this._getTile(e,!0))),this._dirty&&this._rebuildTree()}let s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:r}=e;for(let[e,t,n,s]of i){let i;if("west"in r)i=r.west<n&&r.east>e&&r.south<s&&r.north>t;else{let o=Math.min(r.top,r.bottom),a=Math.max(r.top,r.bottom);i=r.left<n&&r.right>e&&o<s&&a>t}if(i)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:r,modelMatrix:n,modelMatrixInverse:s}){let{tileSize:o,extent:a,zoomOffset:l}=this.opts;return rC({viewport:e,maxZoom:t,minZoom:i,zRange:r,tileSize:o,extent:a,modelMatrix:n,modelMatrixInverse:s,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:t}=this.opts;return{bbox:tC(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){return{x:Math.floor(e.x/2),y:Math.floor(e.y/2),z:e.z-1}}updateTileStates(){let e=this.opts.refinementStrategy||oC,t=new Array(this._cache.size),i=0;for(let e of this._cache.values())t[i++]=e.isVisible,e.isSelected=!1,e.isVisible=!1;for(let e of this._selectedTiles)e.isSelected=!0,e.isVisible=!0;("function"==typeof e?e:aC[e])(Array.from(this._cache.values())),i=0;for(let e of this._cache.values())if(t[i++]!==e.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,t=[],i=0;for(let e of this._cache.values())e.isLoading&&(i++,!e.isSelected&&!e.isVisible&&t.push(e));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){let{_cache:e}=this;for(let t of e.values())t.parent=null,t.children&&(t.children.length=0);for(let t of e.values()){let e=this._getNearestAncestor(t);t.parent=e,e?.children&&e.children.push(t)}}_resizeCache(){let{_cache:e,opts:t}=this,i=t.maxCacheSize||(t.maxCacheByteSize?1/0:5*this.selectedTiles.length),r=t.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>r){for(let[n,s]of e)if(!s.isVisible&&!s.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize?s.byteLength:0,e.delete(n),this.opts.onTileUnload?.(s)),e.size<=i&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(((e,t)=>e.zoom-t.zoom)),this._dirty=!1)}_getTile(e,t){let i=this.getTileId(e),r=this._cache.get(i),n=!1;return!r&&t?(r=new zx(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:i,zoom:this.getTileZoom(r.index)}),n=!0,this._cache.set(i,r),this._dirty=!0):r&&r.needsReload&&(n=!0),r&&n&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){let{_minZoom:t=0}=this,i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);let e=this._getTile(i);if(e)return e}return null}};function hC(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=sC,!0;t=t.parent}return!1}function cC(e){for(let t of e.children)t.isLoaded||t.content?t.state|=sC:cC(t)}var dC={TilesetClass:uC,data:{type:"data",value:[]},dataComparator:qT.equal,renderSubLayers:{type:"function",value:e=>new Bw(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:oC,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},fC=class extends db{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return Boolean(this.state?.tileset?.selectedTiles?.every((e=>e.isLoaded&&e.layers&&e.layers.every((e=>e.isLoaded)))))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state,i=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),r?t.reloadAll():t.tiles.forEach((e=>{e.layers=null}))):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:r,extent:n,maxZoom:s,minZoom:o,maxRequests:a,debounceTime:l,zoomOffset:u}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:s,minZoom:o,tileSize:e,refinementStrategy:r,extent:n,maxRequests:a,debounceTime:l,zoomOffset:u,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,r=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:n}=e,s=this.state.isLoaded!==n,o=this.state.frameNumber!==r;n&&(s||o)&&this._onViewportLoad(),o&&this.setState({frameNumber:r}),this.state.isLoaded=n}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:t,getTileData:i,fetch:r}=this.props,{signal:n}=e;return e.url="string"==typeof t||Array.isArray(t)?$T(t,e):null,i?i(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:n}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let t=e.sourceLayer.props.tile,i=e.info;return i.picked&&(i.tile=t),i.sourceTile=t,i}_updateAutoHighlight(e){let t=e.sourceTile;if(t&&t.layers)for(let i of t.layers)i.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map((e=>{let t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some((i=>e.layers[0].props[i]!==t[i]))&&(e.layers=e.layers.map((e=>e.clone(t))));else{let i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=tg(i,Boolean).map((i=>i.clone({tile:e,...t})))}return e.layers}))}filterSubLayer({layer:e,cullRect:t}){let{tile:i}=e.props;return this.state.tileset.isTileVisible(i,t)}},pC=fC;fC.defaultProps=dC,fC.layerName="TileLayer";var gC={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}},mC=class extends _E{getShaders(){let e=super.getShaders();return e.inject={"vs:#decl":"uniform float trailLength;\nin float instanceTimestamps;\nin float instanceNextTimestamps;\nout float vTime;\n","vs:#main-end":"vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform bool fadeTrail;\nuniform float trailLength;\nuniform float currentTime;\nin float vTime;\n","fs:#main-start":"if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"if(fadeTrail) {\n  color.a *= 1.0 - (currentTime - vTime) / trailLength;\n}\n"},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){let{fadeTrail:t,trailLength:i,currentTime:r}=this.props;e.uniforms={...e.uniforms,fadeTrail:t,trailLength:i,currentTime:r},super.draw(e)}},_C=mC;mC.layerName="TripsLayer",mC.defaultProps=gC;var vC=h(R(),1),yC=h(R(),1),bC=h(R(),1);function AC(e,t){t=void 0===t?e[0][0]:t;for(let i of e){let e=i[0]-t;e>180?i[0]-=360:e<-180&&(i[0]+=360)}}function EC(e,t,i){let r=e(t,i),[n,s]=(0,bC.cellToLatLng)(r);return[s,n]}function wC(e,t=1){let i=(0,bC.cellToBoundary)(e,!0);return 1!==t?function(e,t,i){let[r,n]=(0,bC.cellToLatLng)(e),s=t.length;AC(t,n);let o=t[0]===t[s-1]?s-1:s;for(let e=0;e<o;e++)t[e][0]=wo(n,t[e][0],i),t[e][1]=wo(r,t[e][1],i)}(e,i,t):AC(i),i}var xC={...jE.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0},TC=class extends db{initializeState(){TC._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(!0!==e.highPrecision&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){let e=this._calculateH3DataProps();this.setState(e)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,i=!1,{iterable:r,objectInfo:n}=sy(this.props.data);for(let s of r){n.index++;let r=this.props.getHexagon(s,n),o=(0,yC.getResolution)(r);if(e<0){if(e=o,!this.props.highPrecision)break}else if(e!==o){i=!0;break}if((0,yC.isPentagon)(r)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?(0,yC.getHexagonEdgeLengthAvg)(e,"km"):0,hasMultipleRes:i,hasPentagon:t}}_shouldUseHighPrecision(){if("auto"===this.props.highPrecision){let{resolution:e,hasPentagon:t,hasMultipleRes:i}=this.state,{viewport:r}=this.context;return Boolean(r?.resolution)||i||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;let{resolution:t,edgeLengthKM:i,centerHex:r}=this.state;if(t<0)return;let n=this.props.centerHexagon||(0,yC.latLngToCell)(e.latitude,e.longitude,t);if(r===n)return;if(r)try{if((0,yC.gridDistance)(r,n)*i<10)return}catch{}let{unitsPerMeter:s}=e.distanceScales,o=wC(n),[a,l]=(0,yC.cellToLatLng)(n),[u,h]=e.projectFlat([l,a]);o=o.map((t=>{let i=e.projectFlat(t);return[(i[0]-u)/s[0],(i[1]-h)/s[1]]})),this.setState({centerHex:n,vertices:o})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){let{elevationScale:e,material:t,coverage:i,extruded:r,wireframe:n,stroked:s,filled:o,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:u,lineWidthMaxPixels:h,getFillColor:c,getElevation:d,getLineColor:f,getLineWidth:p,transitions:g,updateTriggers:m}=this.props;return{elevationScale:e,extruded:r,coverage:i,wireframe:n,stroked:s,filled:o,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:u,lineWidthMaxPixels:h,material:t,getElevation:d,getFillColor:c,getLineColor:f,getLineWidth:p,transitions:g,updateTriggers:{getFillColor:m.getFillColor,getElevation:m.getElevation,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}}_renderPolygonLayer(){let{data:e,getHexagon:t,updateTriggers:i,coverage:r}=this.props,n=this.getSubLayerClass("hexagon-cell-hifi",jE),s=this._getForwardProps();return s.updateTriggers.getPolygon=function(e,t){let i;return i=null==e?t:"object"==typeof e?{...e,coverage:t}:{getHexagon:e,coverage:t},i}(i.getHexagon,r),new n(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(e,i)=>function(e){let t=new Float64Array(2*e.length),i=0;for(let r of e)t[i++]=r[0],t[i++]=r[1];return t}(wC(t(e,i),r))})}_renderColumnLayer(){let{data:e,getHexagon:t,updateTriggers:i}=this.props,r=this.getSubLayerClass("hexagon-cell",oE),n=this._getForwardProps();return n.updateTriggers.getPosition=i.getHexagon,new r(n,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:n.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:EC.bind(null,t)})}},CC=TC;TC.defaultProps=xC,TC.layerName="H3HexagonLayer",TC._checkH3Lib=()=>{};var SC={getHexagons:{type:"accessor",value:e=>e.hexagons}},PC=class extends vx{initializeState(){CC._checkH3Lib()}updateState({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagons){let{data:t,getHexagons:i}=e,r=[],{iterable:n,objectInfo:s}=sy(t);for(let e of n){s.index++;let t=i(e,s),n=(0,vC.cellsToMultiPolygon)(t,!0);for(let t of n){for(let e of t)AC(e);r.push(this.getSubLayerRow({polygon:t},e,s.index))}}this.setState({polygons:r})}}indexToBounds(){let{getElevation:e,getFillColor:t,getLineColor:i,getLineWidth:r}=this.props;return{data:this.state.polygons,getPolygon:e=>e.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(r)}}},MC=PC;PC.layerName="H3ClusterLayer",PC.defaultProps=SC;var RC=Math.PI/180,IC=new Float32Array(16),BC=new Float32Array(12);function LC(e,t,i){let r=t[0]*RC,n=t[1]*RC,s=t[2]*RC,o=Math.sin(s),a=Math.sin(r),l=Math.sin(n),u=Math.cos(s),h=Math.cos(r),c=Math.cos(n),d=i[0],f=i[1],p=i[2];e[0]=d*c*h,e[1]=d*l*h,e[2]=d*-a,e[3]=f*(-l*u+c*a*o),e[4]=f*(c*u+l*a*o),e[5]=f*h*o,e[6]=p*(l*o+c*a*u),e[7]=p*(-c*o+l*a*u),e[8]=p*h*u}function OC(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}var FC={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:i}){let{data:r,getOrientation:n,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),u=l&&16===a.length,h=Array.isArray(s),c=Array.isArray(n),d=Array.isArray(o),f=u||!l&&Boolean(a(r[0]));e.constant=f?u:c&&h&&d;let p=e.value;if(e.constant){let t;f?(IC.set(a),t=OC(IC)):(t=BC,LC(t,n,s),t.set(o,9)),e.value=new Float32Array(t)}else{let l=t*e.size,{iterable:g,objectInfo:m}=sy(r,t,i);for(let e of g){let t;m.index++,f?(IC.set(u?a:a(e,m)),t=OC(IC)):(t=BC,LC(t,c?n:n(e,m),h?s:s(e,m)),t.set(d?o:o(e,m),9)),p[l++]=t[0],p[l++]=t[1],p[l++]=t[2],p[l++]=t[3],p[l++]=t[4],p[l++]=t[5],p[l++]=t[6],p[l++]=t[7],p[l++]=t[8],p[l++]=t[9],p[l++]=t[10],p[l++]=t[11]}}}};function NC(e,t){return t===Nc.CARTESIAN||t===Nc.METER_OFFSETS||t===Nc.DEFAULT&&!e.isGeospatial}function DC(e){let t=e.positions||e.POSITION;wi.assert(t,'no "postions" or "POSITION" attribute in mesh');let i=t.value.length/t.size,r=e.COLOR_0||e.colors;r||(r={size:3,value:new Float32Array(3*i).fill(1)});let n=e.NORMAL||e.normals;n||(n={size:3,value:new Float32Array(3*i).fill(0)});let s=e.TEXCOORD_0||e.texCoords;return s||(s={size:2,value:new Float32Array(2*i).fill(0)}),{positions:t,colors:r,normals:n,texCoords:s}}function kC(e){return e instanceof vp?(e.attributes=DC(e.attributes),e):e.attributes?new vp({...e,topology:"triangle-list",attributes:DC(e.attributes)}):new vp({topology:"triangle-list",attributes:DC(e)})}var UC,GC={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},zC=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = texCoords;\ngeometry.pickingColor = instancePickingColors;\nvTexCoord = texCoords;\ncameraPosition = project_uCameraPosition;\nvColor = vec4(colors * instanceColors.rgb, instanceColors.a);\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\nif (composeModelMatrix) {\nDECKGL_FILTER_SIZE(pos, geometry);\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\ngeometry.worldPosition += pos;\ngl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\ngeometry.position = position_commonspace;\n}\nelse {\npos = project_size(pos);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\ngeometry.position = position_commonspace;\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\n}\ngeometry.normal = normals_commonspace;\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\nprecision highp float;\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vTexCoord;\nvec3 normal;\nif (flatShading) {\nnormal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n} else {\nnormal = normals_commonspace;\n}\nvec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\nDECKGL_FILTER_COLOR(color, geometry);\nvec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\nfragColor = vec4(lightColor, color.a * opacity);\n}\n",modules:[rd,Bc,Vd]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;let{mesh:t}=this.props;if(!t)return null;if(e=t.header?.boundingBox,!e){let{attributes:i}=kC(t);i.POSITION=i.POSITION||i.positions,e=Jt(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:FC}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:r}=e;if(t.mesh!==i.mesh||r.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);let e=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(e.NORMAL||e.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==i.texture&&t.texture instanceof Hr&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){let{model:t}=this.state;if(!t)return;let{viewport:i,renderPass:r}=this.context,{sizeScale:n,coordinateSystem:s,_instanced:o}=this.props;t.setUniforms(e),t.setUniforms({sizeScale:n,composeModelMatrix:!o||NC(i,s),flatShading:!this.state.hasNormals}),t.draw(r)}get isLoaded(){return Boolean(this.state?.model&&super.isLoaded)}getModel(e){let t=new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:kC(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:r}=this.state;return t.setBindings({sampler:i||r}),t.setUniforms({hasTexture:Boolean(i)}),t}setTexture(e){let{emptyTexture:t,model:i}=this.state;i&&(i.setBindings({sampler:e||t}),i.setUniforms({hasTexture:Boolean(e)}))}},VC=zC;function jC(e,t,i,r){let n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:s}=r;return s&&(n.bindings.u_DiffuseEnvSampler=s.diffuseEnvSampler,n.bindings.u_SpecularEnvSampler=s.specularEnvSampler,n.bindings.u_brdfLUT=s.brdfLutTexture,n.uniforms.u_ScaleIBLAmbient=[1,1]),r?.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],n.uniforms.u_ScaleFGDSpec=[0,0,0,0]),i.NORMAL&&(n.defines.HAS_NORMALS=1),i.TANGENT&&r?.useTangents&&(n.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(n.defines.HAS_UV=1),r?.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),r?.lights&&(n.defines.USE_LIGHTS=1),t&&function(e,t,i){if(i.uniforms.pbr_uUnlit=Boolean(t.unlit),t.pbrMetallicRoughness&&function(e,t,i){t.baseColorTexture&&HC(e,t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&HC(e,t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);let{metallicFactor:r=1,roughnessFactor:n=1}=t;i.uniforms.u_MetallicRoughnessValues=[r,n]}(e,t.pbrMetallicRoughness,i),t.normalTexture){HC(e,t.normalTexture,"u_NormalSampler","HAS_NORMALMAP",i);let{scale:r=1}=t.normalTexture;i.uniforms.u_NormalScale=r}if(t.occlusionTexture){HC(e,t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",i);let{strength:r=1}=t.occlusionTexture;i.uniforms.u_OcclusionStrength=r}switch(t.emissiveTexture&&(HC(e,t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":let{alphaCutoff:e=.5}=t;i.defines.ALPHA_CUTOFF=1,i.uniforms.u_AlphaCutoff=e;break;case"BLEND":dr.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=UC.FUNC_ADD,i.glParameters.blendFunc=[UC.SRC_ALPHA,UC.ONE_MINUS_SRC_ALPHA,UC.ONE,UC.ONE_MINUS_SRC_ALPHA]}}(e,t,n),n}function HC(e,t,i,r=null,n){let s,o=t?.texture?.sampler?.parameters||{},a=t.texture.source.image,l={};a.compressed?(s=a,l={[UC.TEXTURE_MIN_FILTER]:a.data.length>1?UC.LINEAR_MIPMAP_NEAREST:UC.LINEAR}):s={data:a};let u=e.createTexture({id:t.uniformName||t.id,parameters:{...o,...l},pixelStore:{[UC.UNPACK_FLIP_Y_WEBGL]:!1},...s});n.bindings[i]=u,r&&(n.defines[r]=1),n.generatedTextures.push(u)}zC.defaultProps=GC,zC.layerName="SimpleMeshLayer",function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"}(UC||(UC={}));var WC,XC,qC={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};async function KC(e){let t=e.modules||{};return t.basis?t.basis:(WC=WC||async function(e){let t=null,i=null;return[t,i]=await Promise.all([await se(qC.TRANSCODER,"textures",e),await se(qC.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){let i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{let{BasisFile:i,initializeBasis:r}=e;r(),t({BasisFile:i})}))}))}(t,i)}(e),await WC)}async function $C(e){let t=e.modules||{};return t.basisEncoder?t.basisEncoder:(XC=XC||async function(e){let t=null,i=null;return[t,i]=await Promise.all([await se(qC.ENCODER,"textures",e),await se(qC.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){let i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{let{BasisFile:i,KTX2File:r,initializeBasis:n,BasisEncoder:s}=e;n(),t({BasisFile:i,KTX2File:r,BasisEncoder:s})}))}))}(t,i)}(e),await XC)}var JC,YC,ZC,QC,eS,tS,iS,rS,nS=33776,sS=33779,oS=35840,aS=35842,lS=36196,uS=37808,hS=["","WEBKIT_","MOZ_"],cS={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},dS=null;function fS(e){if(!dS){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}()||void 0,dS=new Set;for(let t of hS)for(let i in cS)if(e&&e.getExtension(`${t}${i}`)){let e=cS[i];dS.add(e)}}return dS}(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(JC||(JC={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(YC||(YC={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(ZC||(ZC={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(QC||(QC={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(eS||(eS={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(tS||(tS={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(iS||(iS={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(rS||(rS={}));var pS=[171,75,84,88,32,50,48,187,13,10,26,10],gS={etc1:{basisFormat:0,compressed:!0,format:lS},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:nS},bc3:{basisFormat:3,compressed:!0,format:sS},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:oS},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:aS},"astc-4x4":{basisFormat:10,compressed:!0,format:uS},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function mS(e,t,i){let r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");let e=r.getNumImages(),t=[];for(let n=0;n<e;n++){let e=r.getNumLevels(n),s=[];for(let t=0;t<e;t++)s.push(_S(r,n,t,i));t.push(s)}return t}finally{r.close(),r.delete()}}function _S(e,t,i,r){let n=e.getImageWidth(t,i),s=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:a,format:l,basisFormat:u}=bS(r,o),h=e.getImageTranscodedSizeInBytes(t,i,u),c=new Uint8Array(h);if(!e.transcodeImage(c,t,i,u,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:c,compressed:a,format:l,hasAlpha:o}}function vS(e,t,i){let r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");let e=r.getLevels(),t=[];for(let n=0;n<e;n++){t.push(yS(r,n,i));break}return[t]}finally{r.close(),r.delete()}}function yS(e,t,i){let{alphaFlag:r,height:n,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=bS(i,r),u=e.getImageTranscodedSizeInBytes(t,0,0,l),h=new Uint8Array(u);if(!e.transcodeImage(h,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:h,compressed:o,levelSize:u,hasAlpha:r,format:a}}function bS(e,t){let i=e&&e.basis&&e.basis.format;return"auto"===i&&(i=AS()),"object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),gS[i]}function AS(){let e=fS();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}var ES={name:"Basis",id:"basis",module:"textures",version:"4.1.4",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function(e,t){if("auto"===t.basis.containerFormat){if(function(e){let t=new Uint8Array(e);return!(t.byteLength<pS.length||t[0]!==pS[0]||t[1]!==pS[1]||t[2]!==pS[2]||t[3]!==pS[3]||t[4]!==pS[4]||t[5]!==pS[5]||t[6]!==pS[6]||t[7]!==pS[7]||t[8]!==pS[8]||t[9]!==pS[9]||t[10]!==pS[10]||t[11]!==pS[11])}(e))return vS((await $C(t)).KTX2File,e,t);let{BasisFile:i}=await KC(t);return mS(i,e,t)}if("encoder"===t.basis.module){let i=await $C(t);return"ktx2"===t.basis.containerFormat?vS(i.KTX2File,e,t):mS(i.BasisFile,e,t)}{let{BasisFile:i}=await KC(t);return mS(i,e,t)}}},wS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function TS(e){if(!e._animation){let t=xS[e.componentType],i=wS[e.type],r=i*e.count,{buffer:n,byteOffset:s}=e.bufferView.data,o=new t(n,s+(e.byteOffset||0),r);if(1===i)e._animation=Array.from(o);else{let t=[];for(let e=0;e<o.length;e+=i)t.push(Array.from(o.slice(e,e+i)));e._animation=t}}return e._animation}var CS=new Oh,SS=new Jh;function PS(e,t){return`#version 300 es\n${t}`}var MS,RS={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};function IS(e,t,i){let r=new class{device;options;gltf;constructor(e,t={}){this.device=e,this.options={...RS,...t}}instantiate(e){return this.gltf=e,(e.scenes||[]).map((e=>this.createScene(e)))}createAnimator(){return Array.isArray(this.gltf.animations)?new class{animations;constructor(e){this.animations=e.animations.map(((t,i)=>{let r=t.name||`Animation-${i}`,n=t.samplers.map((({input:t,interpolation:i="LINEAR",output:r})=>({input:TS(e.accessors[t]),interpolation:i,output:TS(e.accessors[r])}))),s=t.channels.map((({sampler:t,target:i})=>({sampler:n[t],target:e.nodes[i.node],path:i.path})));return new class{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;let t=(e/1e3-this.startTime)*this.speed;this.channels.forEach((({sampler:e,target:i,path:r})=>{(function(e,{input:t,interpolation:i,output:r},n,s){let o=e%t[t.length-1],a=t.findIndex((e=>e>=o)),l=Math.max(0,a-1);if(!Array.isArray(n[s]))switch(s){case"translation":n[s]=[0,0,0];break;case"rotation":n[s]=[0,0,0,1];break;case"scale":n[s]=[1,1,1];break;default:dr.warn(`Bad animation path ${s}`)()}Lr(n[s].length===r[l].length);let u=t[l],h=t[a];switch(i){case"STEP":!function(e,t,i){for(let r=0;r<i.length;r++)e[t][r]=i[r]}(n,s,r[l]);break;case"LINEAR":if(h>u){let e=(o-u)/(h-u);!function(e,t,i,r,n){if("rotation"===t){SS.slerp({start:i,target:r,ratio:n});for(let i=0;i<SS.length;i++)e[t][i]=SS[i]}else for(let s=0;s<i.length;s++)e[t][s]=n*r[s]+(1-n)*i[s]}(n,s,r[l],r[a],e)}break;case"CUBICSPLINE":if(h>u){let e=(o-u)/(h-u),t=h-u;!function(e,t,{p0:i,outTangent0:r,inTangent1:n,p1:s,tDiff:o,ratio:a}){for(let l=0;l<e[t].length;l++){let u=r[l]*o,h=n[l]*o;e[t][l]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*i[l]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*u+(-2*Math.pow(a,3)+3*Math.pow(a,2))*s[l]+(Math.pow(a,3)-Math.pow(a,2))*h}}(n,s,{p0:r[3*l+1],outTangent0:r[3*l+2],inTangent1:r[3*a+0],p1:r[3*a+1],tDiff:t,ratio:e})}break;default:dr.warn(`Interpolation ${i} not supported`)()}})(t,e,i,r),function(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){let i=CS.fromQuaternion(e.rotation);t.matrix.multiplyRight(i)}e.scale&&t.matrix.scale(e.scale)}(i,i._node)}))}}({name:r,channels:s})}))}animate(e){this.setTime(e)}setTime(e){this.animations.forEach((t=>t.animate(e)))}getAnimations(){return this.animations}}(this.gltf):null}createScene(e){let t=(e.nodes||[]).map((e=>this.createNode(e)));return new Ep({id:e.name||e.id,children:t})}createNode(e){if(!e._node){let t=(e.children||[]).map((e=>this.createNode(e)));e.mesh&&t.push(this.createMesh(e.mesh));let i=new Ep({id:e.name||e.id,children:t});if(e.matrix)i.setMatrix(e.matrix);else{if(i.matrix.identity(),e.translation&&i.matrix.translate(e.translation),e.rotation){let t=(new Oh).fromQuaternion(e.rotation);i.matrix.multiplyRight(t)}e.scale&&i.matrix.scale(e.scale)}e._node=i}return e._node}createMesh(e){if(!e._mesh){let t=(e.primitives||[]).map(((t,i)=>this.createPrimitive(t,i,e))),i=new Ep({id:e.name||e.id,children:t});e._mesh=i}return e._mesh}createPrimitive(e,t,i){let r=e.name||`${i.name||i.id}-primitive-${t}`,n=function(e){switch(e){case MS.POINTS:return"point-list";case MS.LINES:return"line-list";case MS.LINE_STRIP:return"line-strip";case MS.LINE_LOOP:return"line-loop-webgl";case MS.TRIANGLES:return"triangle-list";case MS.TRIANGLE_STRIP:return"triangle-strip";case MS.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(e)}}(e.mode||4),s=e.indices?e.indices.count:this.getVertexCount(e.attributes),o=function(e,t){let{id:i,geometry:r,material:n,vertexCount:s,materialOptions:o,modelOptions:a}=t,l=jC(e,n,r.attributes,o);dr.info(4,"createGLTFModel defines: ",l.defines)();let u={id:i,geometry:r,topology:r.topology,vertexCount:s,modules:[Lc],vs:PS(0,"\n#pragma vscode_glsllint_stage: vert\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  // _attr vec4 POSITION;\n  _attr vec4 positions;\n\n  #ifdef HAS_NORMALS\n    // _attr vec4 NORMAL;\n    _attr vec4 normals;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    // _attr vec2 TEXCOORD_0;\n    _attr vec2 texCoords;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = normals;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = texCoords;\n    #endif\n\n    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * positions;\n  }\n"),fs:PS(0,"\n#pragma vscode_glsllint_stage: frag\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    vec3 pos = pbr_vPosition;\n    fragmentColor = pbr_filterColor(vec4(1.0));\n  }\n"),...a,bindings:{...l.bindings,...a.bindings},defines:{...l.defines,...a.defines},parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back",...l.parameters,...a.parameters},uniforms:{...l.uniforms,...a.uniforms}},h=new fp(e,u);return new wp({managedResources:[],model:h})}(this.device,{id:r,geometry:this.createGeometry(r,e,n),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:s});return o.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],o}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,i){let r={};for(let[e,i]of Object.entries(t.attributes)){let{components:t,size:n,value:s}=i;r[e]={size:n??t,value:s}}return new vp({id:e,topology:i,indices:t.indices.value,attributes:r})}createBuffer(e,t){e.bufferView||(e.bufferView={});let{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[t]||(i.lumaBuffers[t]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}(e,i);return{scenes:r.instantiate(t),animator:r.createAnimator()}}!function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(MS||(MS={}));var BS={};function LS(e,t){if(!e)throw new Error(t||"assert failed: gltf")}l(BS,{decode:()=>uP,name:()=>lP});var OS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},FS={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},NS=1.33,DS=["SCALAR","VEC2","VEC3","VEC4"],kS=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],US=new Map(kS),GS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zS={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},VS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function jS(e){return DS[e-1]||DS[0]}function HS(e){let t=US.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function WS(e,t){let i=VS[e.componentType],r=GS[e.type],n=zS[e.componentType],s=e.count*r,o=e.count*r*n;return LS(o>=0&&o<=t.byteLength),{ArrayType:i,length:s,byteLength:o,componentByteSize:FS[e.componentType],numberOfComponentsInElement:OS[e.type]}}function XS(e){let{images:t,bufferViews:i}=e;t=t||[],i=i||[];let r=t.map((e=>e.bufferView));i=i.filter((e=>!r.includes(e)));let n=i.reduce(((e,t)=>e+t.byteLength),0),s=t.reduce(((e,t)=>{let{width:i,height:r}=t.image;return e+i*r}),0);return n+Math.ceil(4*s*NS)}var qS=class{constructor(e){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:e?.json||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let t=this.getUsedExtensions().find((t=>t===e)),i=this.getRequiredExtensions().find((t=>t===e));return"string"==typeof t||"string"==typeof i}getExtension(e){let t=this.getUsedExtensions().find((t=>t===e)),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find((t=>t===e))?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;let i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){let t=(e=this.getBufferView(e)).buffer,i=this.gltf.buffers[t];LS(i);let r=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){let t=this.getAccessor(e);return function(e,t,i){var r,n;let s="number"==typeof i?null===(r=e.accessors)||void 0===r?void 0:r[i]:i;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);let o=null===(n=e.bufferViews)||void 0===n?void 0:n[s.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);let{arrayBuffer:a,byteOffset:l}=t[o.buffer],u=(l||0)+(s.byteOffset||0)+(o.byteOffset||0),{ArrayType:h,length:c,componentByteSize:d,numberOfComponentsInElement:f}=WS(s,o),p=d*f,g=o.byteStride||p;if(typeof o.byteStride>"u"||o.byteStride===p)return new h(a,u,c);let m=new h(c);for(let e=0;e<s.count;e++){let t=new h(a,u+e*g,f);m.set(t,e*f)}return m}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);let t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(i,r,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){(e.extensions||{})[t]=i}removeObjectExtension(e,t){let i=e?.extensions||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}delete i[t]}addExtension(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return LS(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return LS(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if(null!==(t=this.json.extensions)&&void 0!==t&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){let{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];let r={mesh:t};return i&&(r.matrix=i),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){let{attributes:t,indices:i,material:r,mode:n=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:n}]};if(i){let e=this._addIndices(i);s.primitives[0].indices=e}return Number.isFinite(r)&&(s.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){let t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){let i=vi(e),r=t||i?.mimeType,n={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}addBufferView(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.byteLength,r=e.byteLength;LS(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);let n={buffer:t,byteOffset:i,byteLength:r};return this.byteLength+=fe(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(e,t){let i={bufferView:e,type:jS(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},i=this.addBufferView(e),r={min:t.min,max:t.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,t.size));let n={size:t.size,componentType:HS(e),count:Math.round(e.length/t.size),min:r.min,max:r.max};return this.addAccessor(i,Object.assign(n,t))}addTexture(e){let{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];let i=this.byteLength,r=new ArrayBuffer(i),n=new Uint8Array(r),s=0;for(let e of this.sourceBuffers||[])s=pe(e,n,s);null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,t){let i=!0;for(;i;){let r=e.indexOf(t);r>-1?e.splice(r,1):i=!1}}_addAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};for(let i in e){let r=e[i],n=this._getGltfAttributeName(i),s=this.addBinaryBuffer(r.value,r);t[n]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){let i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];let r=e.subarray(0,t);for(let e of r)i.min.push(e),i.max.push(e);for(let r=t;r<e.length;r+=t)for(let n=0;n<t;n++)i.min[0+n]=Math.min(i.min[0+n],e[r+n]),i.max[0+n]=Math.max(i.max[0+n],e[r+n]);return i}};function KS(e){return(e%1+1)%1}var $S={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},JS={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},YS={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function ZS(e,t){return YS[t]*$S[e]}function QS(e,t,i,r){if("UINT8"!==i&&"UINT16"!==i&&"UINT32"!==i&&"UINT64"!==i)return null;let n=eP(e.getTypedArrayForBufferView(t),"SCALAR",i,r+1);return n instanceof BigInt64Array||n instanceof BigUint64Array?null:n}function eP(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=$S[t],s=JS[i],o=YS[i],a=r*n,l=a*o,u=e.buffer,h=e.byteOffset;return h%o!=0&&(u=new Uint8Array(u).slice(h,h+l).buffer,h=0),new s(u,h,a)}function tP(e,t,i){var r,n;let s=`TEXCOORD_${t.texCoord||0}`,o=i.attributes[s],a=e.getTypedArrayForAccessor(o),l=e.gltf.json,u=t.index,h=null===(r=l.textures)||void 0===r||null===(n=r[u])||void 0===n?void 0:n.source;if(typeof h<"u"){var c,d,f;let i=null===(c=l.images)||void 0===c||null===(d=c[h])||void 0===d?void 0:d.mimeType,r=null===(f=e.gltf.images)||void 0===f?void 0:f[h];if(r&&typeof r.width<"u"){let e=[];for(let n=0;n<a.length;n+=2){let s=rP(r,i,a,n,t.channels);e.push(s)}return e}}return[]}function iP(e,t,i,r,n){if(null==i||!i.length)return;let s=[];for(let e of i){let t=r.findIndex((t=>t===e));-1===t&&(t=r.push(e)-1),s.push(t)}let o=new Uint32Array(s),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=e.addBufferView(o,a,0),u=e.addAccessor(l,{size:1,componentType:HS(o),count:o.length});n.attributes[t]=u}function rP(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0],s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[r],a=i[r+1],l=1;t&&(-1!==t.indexOf("image/jpeg")||-1!==t.indexOf("image/png"))&&(l=4);let u=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=i.width,s=KS(e)*(n-1),o=Math.round(s),a=i.height,l=KS(t)*(a-1),u=Math.round(l),h=i.components?i.components:r;return(u*n+o)*h}(o,a,e,l),h=0;for(let t of n){let i="number"==typeof t?Object.values(s)[t]:s[t],r=u+i.offset,n=oi(e);if(n.data.length<=r)throw new Error(`${n.data.length} <= ${r}`);h|=n.data[r]<<i.shift}return h}function nP(e,t,i,r,n){let s=[];for(let o=0;o<t;o++){let t=i[o],a=i[o+1]-i[o];if(a+t>r)break;let l=t/n,u=a/n;s.push(e.slice(l,l+u))}return s}function sP(e,t,i){let r=[];for(let n=0;n<t;n++){let t=n*i;r.push(e.slice(t,t+i))}return r}function oP(e,t,i,r){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){let i=[],n=new TextDecoder("utf8"),s=0;for(let o=0;o<e;o++){let e=r[o+1]-r[o];if(e+s<=t.length){let r=t.subarray(s,e+s),o=n.decode(r);i.push(o),s+=e}}return i}return[]}var aP="EXT_mesh_features",lP=aP;async function uP(e,t){!function(e,t){let i=e.gltf.json;if(i.meshes)for(let r of i.meshes)for(let i of r.primitives)hP(e,i,t)}(new qS(e),t)}function hP(e,t,i){var r,n;if(null==i||null===(r=i.gltf)||void 0===r||!r.loadBuffers)return;let s=null===(n=t.extensions)||void 0===n?void 0:n[aP],o=s?.featureIds;if(o)for(let r of o){var a;let n;if(typeof r.attribute<"u"){let i=`_FEATURE_ID_${r.attribute}`,s=t.attributes[i];n=e.getTypedArrayForAccessor(s)}else n=typeof r.texture<"u"&&null!=i&&null!==(a=i.gltf)&&void 0!==a&&a.loadImages?tP(e,r.texture,t):[];r.data=n}}var cP={};l(cP,{decode:()=>pP,name:()=>fP});var dP="EXT_structural_metadata",fP=dP;async function pP(e,t){!function(e,t){var i,r;if(null===(i=t.gltf)||void 0===i||!i.loadBuffers)return;let n=e.getExtension(dP);n&&(null!==(r=t.gltf)&&void 0!==r&&r.loadImages&&function(e,t){let i=t.propertyTextures,r=e.gltf.json;if(i&&r.meshes)for(let n of r.meshes)for(let r of n.primitives)mP(e,i,r,t)}(e,n),function(e,t){let i=t.schema;if(!i)return;let r=i.classes,n=t.propertyTables;if(r&&n)for(let t in r){let r=gP(n,t);r&&vP(e,i,r)}}(e,n))}(new qS(e),t)}function gP(e,t){for(let i of e)if(i.class===t)return i;return null}function mP(e,t,i,r){var n;if(!t)return;let s=null===(n=i.extensions)||void 0===n?void 0:n[dP],o=s?.propertyTextures;if(o)for(let n of o)_P(e,t[n],i,r)}function _P(e,t,i,r){if(!t.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);let n=t.class;for(let o in t.properties){var s;let a=`${n}_${o}`,l=null===(s=t.properties)||void 0===s?void 0:s[o];if(!l)continue;l.data||(l.data=[]);let u=l.data,h=tP(e,l,i);null!==h&&(iP(e,a,h,u,i),l.data=u,r.dataAttributeNames.push(a))}}function vP(e,t,i){var r;let n=null===(r=t.classes)||void 0===r?void 0:r[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);let s=i.count;for(let r in n.properties){var o;let a=n.properties[r],l=null===(o=i.properties)||void 0===o?void 0:o[r];if(l){let i=yP(e,t,a,s,l);l.data=i}}}function yP(e,t,i,r,n){let s=[],o=n.values,a=e.getTypedArrayForBufferView(o),l=function(e,t,i,r){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?QS(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",r):null}(e,i,n,r),u=function(e,t,i){return typeof t.stringOffsets<"u"?QS(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}(e,n,r);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":s=function(e,t,i,r){let n,s=e.array,o=e.count,a=ZS(e.type,e.componentType),l=i.byteLength/a;return n=e.componentType?eP(i,e.type,e.componentType,l):i,s?r?nP(n,t,r,i.length,a):o?sP(n,t,o):[]:n}(i,r,a,l);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":s=oP(r,a,l,u);break;case"ENUM":s=function(e,t,i,r,n){var s;let o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let a=null===(s=e.enums)||void 0===s?void 0:s[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);let l=a.valueType||"UINT16",u=ZS(t.type,l),h=r.byteLength/u,c=eP(r,t.type,l,h);if(c||(c=r),t.array){if(n)return function(e){let{valuesData:t,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n,elementSize:s,enumEntry:o}=e,a=[];for(let e=0;e<i;e++){let i=r[e],l=r[e+1]-r[e];if(l+i>n)break;let u=bP(t,i/s,l/s,o);a.push(u)}return a}({valuesData:c,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r.length,elementSize:u,enumEntry:a});let e=t.count;return e?function(e,t,i,r){let n=[];for(let s=0;s<t;s++){let t=bP(e,i*s,i,r);n.push(t)}return n}(c,i,e,a):[]}return bP(c,0,i,a)}(t,i,r,a,l);break;default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function bP(e,t,i,r){let n=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)n.push("");else{let i=AP(r,e[t+s]);i?n.push(i.name):n.push("")}return n}function AP(e,t){for(let i of e.values)if(i.value===t)return i;return null}var EP={};l(EP,{decode:()=>TP,name:()=>xP});var wP="EXT_feature_metadata",xP=wP;async function TP(e,t){!function(e,t){var i,r;if(null===(i=t.gltf)||void 0===i||!i.loadBuffers)return;let n=e.getExtension(wP);n&&(null!==(r=t.gltf)&&void 0!==r&&r.loadImages&&function(e,t){let i=t.schema;if(!i)return;let r=i.classes,{featureTextures:n}=t;if(r&&n)for(let t in r){let i=r[t],s=SP(n,t);s&&MP(e,s,i)}}(e,n),function(e,t){let i=t.schema;if(!i)return;let r=i.classes,n=t.featureTables;if(r&&n)for(let t in r){let r=CP(n,t);r&&PP(e,i,r)}}(e,n))}(new qS(e),t)}function CP(e,t){for(let i in e){let r=e[i];if(r.class===t)return r}return null}function SP(e,t){for(let i in e){let r=e[i];if(r.class===t)return r}return null}function PP(e,t,i){var r;if(!i.class)return;let n=null===(r=t.classes)||void 0===r?void 0:r[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);let s=i.count;for(let t in n.properties){var o;let r=n.properties[t],a=null===(o=i.properties)||void 0===o?void 0:o[t];if(a){let t=RP(e,0,r,s,a);a.data=t}}}function MP(e,t,i){let r=t.class;for(let s in i.properties){var n;let i=null==t||null===(n=t.properties)||void 0===n?void 0:n[s];if(i){let t=IP(e,i,r);i.data=t}}}function RP(e,t,i,r,n){let s=[],o=n.bufferView,a=e.getTypedArrayForBufferView(o),l=function(e,t,i,r){return"ARRAY"===t.type&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?QS(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",r):null}(e,i,n,r),u=function(e,t,i,r){return typeof i.stringOffsetBufferView<"u"?QS(e,i.stringOffsetBufferView,i.offsetType||"UINT32",r):null}(e,0,n,r);return"STRING"===i.type||"STRING"===i.componentType?s=oP(r,a,l,u):function(e){let t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}(i)&&(s=function(e,t,i,r){let n="ARRAY"===e.type,s=e.componentCount,o="SCALAR",a=e.componentType||e.type,l=ZS(o,a),u=i.byteLength/l,h=eP(i,o,a,u);return n?r?nP(h,t,r,i.length,l):s?sP(h,t,s):[]:h}(i,r,a,l)),s}function IP(e,t,i){let r=e.gltf.json;if(!r.meshes)return[];let n=[];for(let s of r.meshes)for(let r of s.primitives)BP(e,i,t,n,r);return n}function BP(e,t,i,r,n){let s=tP(e,{channels:i.channels,...i.texture},n);s&&iP(e,t,s,r,n)}var LP=!0,OP=1735152710,FP=12,NP=8,DP=1313821514,kP=5130562,UP=0,GP=0,zP=1;function VP(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new DataView(t),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(r,i+0),s=r.getUint32(i+4,LP),o=r.getUint32(i+8,LP);switch(Object.assign(e,{header:{byteOffset:i,byteLength:o,hasBinChunk:!1},type:n,version:s,json:{},binChunks:[]}),i+=FP,e.version){case 1:return function(e,t,i){F(e.header.byteLength>FP+NP);let r=t.getUint32(i+0,LP),n=t.getUint32(i+4,LP);return i+=NP,F(n===UP),jP(e,t,i,r),i+=r,i+=HP(e,t,i,e.header.byteLength)}(e,r,i);case 2:return function(e,t,i,r){return F(e.header.byteLength>FP+NP),function(e,t,i,r){for(;i+8<=e.header.byteLength;){let n=t.getUint32(i+0,LP),s=t.getUint32(i+4,LP);switch(i+=NP,s){case DP:jP(e,t,i,n);break;case kP:HP(e,t,i,n);break;case GP:r.strict||jP(e,t,i,n);break;case zP:r.strict||HP(e,t,i,n)}i+=fe(n,4)}}(e,t,i,r),i+e.header.byteLength}(e,r,i,{});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function jP(e,t,i,r){let n=new Uint8Array(t.buffer,i,r),s=new TextDecoder("utf8").decode(n);return e.json=JSON.parse(s),fe(r,4)}function HP(e,t,i,r){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:r,arrayBuffer:t.buffer}),fe(r,4)}function WP(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;let i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}var XP={};l(XP,{decode:()=>rM,name:()=>iM});var qP,KP="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",$P="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",JP=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),YP=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),ZP={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},QP={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function eM(e,t,i,r,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NONE",o=await async function(){return qP||(qP=async function(){let e=KP;WebAssembly.validate(JP)&&(e=$P,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let t=await WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let i=0;i<e.length;++i){let r=e.charCodeAt(i);t[i]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let r=0;r<e.length;++r)t[i++]=t[r]<60?YP[t[r]]:64*(t[r]-60)+t[++r];return t.buffer.slice(0,i)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}()),qP}();!function(e,t,i,r,n,s,o){let a=e.exports.sbrk,l=r+3&-4,u=a(l*n),h=a(s.length),c=new Uint8Array(e.exports.memory.buffer);c.set(s,h);let d=t(u,r,n,h,s.length);if(0===d&&o&&o(u,l,n),i.set(c.subarray(u,u+r*n)),a(u-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(o,o.exports[QP[n]],e,t,i,r,o.exports[ZP[s||"NONE"]])}var tM="EXT_meshopt_compression",iM=tM;async function rM(e,t){var i,r;let n=new qS(e);if(null==t||null===(i=t.gltf)||void 0===i||!i.decompressMeshes||null===(r=t.gltf)||void 0===r||!r.loadBuffers)return;let s=[];for(let t of e.json.bufferViews||[])s.push(nM(n,t));await Promise.all(s),n.removeExtension(tM)}async function nM(e,t){let i=e.getObjectExtension(t,tM);if(i){let{byteOffset:r=0,byteLength:n=0,byteStride:s,count:o,mode:a,filter:l="NONE",buffer:u}=i,h=e.gltf.buffers[u],c=new Uint8Array(h.arrayBuffer,h.byteOffset+r,n),d=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await eM(d,o,s,c,a,l),e.removeObjectExtension(t,tM)}}var sM={};l(sM,{name:()=>aM,preprocess:()=>lM});var oM="EXT_texture_webp",aM=oM;function lM(e,t){let i=new qS(e);if(!Ei("image/webp")){if(i.getRequiredExtensions().includes(oM))throw new Error(`gltf: Required extension ${oM} not supported by browser`);return}let{json:r}=i;for(let e of r.textures||[]){let t=i.getObjectExtension(e,oM);t&&(e.source=t.source),i.removeObjectExtension(e,oM)}i.removeExtension(oM)}var uM={};l(uM,{name:()=>cM,preprocess:()=>dM});var hM="KHR_texture_basisu",cM=hM;function dM(e,t){let i=new qS(e),{json:r}=i;for(let e of r.textures||[]){let t=i.getObjectExtension(e,hM);t&&(e.source=t.source,i.removeObjectExtension(e,hM))}i.removeExtension(hM)}var fM={};l(fM,{decode:()=>MM,encode:()=>RM,name:()=>SM,preprocess:()=>PM});var pM={name:"Draco",id:"draco",module:"draco",version:"4.1.4",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function gM(e,t,i){return Yt(e,t,i?mM(i.metadata):void 0)}function mM(e){let t={};for(let i in e)t[`${i}.string`]=JSON.stringify(e[i]);return t}var _M,vM={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},yM={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},bM="https://www.gstatic.com/draco/versioned/decoders/1.5.6",AM={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},EM={[AM.DECODER]:`${bM}/${AM.DECODER}`,[AM.DECODER_WASM]:`${bM}/${AM.DECODER_WASM}`,[AM.FALLBACK_DECODER]:`${bM}/${AM.FALLBACK_DECODER}`,[AM.ENCODER]:`https://raw.githubusercontent.com/google/draco/1.4.1/javascript/${AM.ENCODER}`};async function wM(e){let t=e.modules||{};return _M=t.draco3d?_M||t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):_M||async function(e){let t,i;return"js"===(e.draco&&e.draco.decoderType)?t=await se(EM[AM.FALLBACK_DECODER],"draco",e,AM.FALLBACK_DECODER):[t,i]=await Promise.all([await se(EM[AM.DECODER],"draco",e,AM.DECODER),await se(EM[AM.DECODER_WASM],"draco",e,AM.DECODER_WASM)]),t=t||globalThis.DracoDecoderModule,await function(e,t){let i={};return t&&(i.wasmBinary=t),new Promise((t=>{e({...i,onModuleLoaded:e=>t({draco:e})})}))}(t,i)}(e),await _M}var xM={...pM,parse:async function(e,t){let{draco:i}=await wM(t),r=new class{constructor(e){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);let r=this.decoder.GetEncodedGeometryType(i),n=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(r){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(i,n);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(i,n);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!n.ptr){let t=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(t)}let s=this._getDracoLoaderData(n,r,t),o=this._getMeshData(n,s,t),a=Jt(o.attributes),l=function(e,t,i){let r=mM(t.metadata),n=[],s=function(e){let t={};for(let i in e){let r=e[i];t[r.name||"undefined"]=r}return t}(t.attributes);for(let t in e){let i=gM(t,e[t],s[t]);n.push(i)}if(i){let e=gM("indices",i);n.push(e)}return{fields:n,metadata:r}}(o.attributes,s,o.indices);return{loader:"draco",loaderData:s,header:{vertexCount:n.num_points(),boundingBox:a},...o,schema:l}}finally{this.draco.destroy(i),n&&this.draco.destroy(n)}}_getDracoLoaderData(e,t,i){let r=this._getTopLevelMetadata(e),n=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:n}}_getDracoAttributes(e,t){let i={};for(let r=0;r<e.num_attributes();r++){let n=this.decoder.GetAttribute(e,r),s=this._getAttributeMetadata(e,r);i[n.unique_id()]={unique_id:n.unique_id(),attribute_type:n.attribute_type(),data_type:n.data_type(),num_components:n.num_components(),byte_offset:n.byte_offset(),byte_stride:n.byte_stride(),normalized:n.normalized(),attribute_index:r,metadata:s};let o=this._getQuantizationTransform(n,t);o&&(i[n.unique_id()].quantization_transform=o);let a=this._getOctahedronTransform(n,t);a&&(i[n.unique_id()].octahedron_transform=a)}return i}_getMeshData(e,t,i){let r=this._getMeshAttributes(t,e,i);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===i.topology?{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,t,i){let r={};for(let n of Object.values(e.attributes)){let e=this._deduceAttributeName(n,i);n.name=e;let{value:s,size:o}=this._getAttributeValues(t,n);r[e]={value:s,size:o,byteOffset:n.byte_offset,byteStride:n.byte_stride,normalized:n.normalized}}return r}_getTriangleListIndices(e){let t=3*e.num_faces(),i=4*t,r=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,r),new Uint32Array(this.draco.HEAPF32.buffer,r,t).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(e){let t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){let t=e.size(),i=new Int32Array(t);for(let r=0;r<t;r++)i[r]=e.GetValue(r);return i}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){let i,r=yM[t.data_type],n=t.num_components,s=e.num_points()*n,o=s*r.BYTES_PER_ELEMENT,a=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,r),l=this.draco._malloc(o);try{let n=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,n,a,o,l),i=new r(this.draco.HEAPF32.buffer,l,s).slice()}finally{this.draco._free(l)}return{value:i,size:n}}_deduceAttributeName(e,t){let i=e.unique_id;for(let[e,r]of Object.entries(t.extraAttributes||{}))if(r===i)return e;let r=e.attribute_type;for(let e in vM)if(this.draco[e]===r)return vM[e];let n=t.attributeNameEntry||"name";return e.metadata[n]?e.metadata[n].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){let t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){let i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let t={},i=this.metadataQuerier.NumEntries(e);for(let r=0;r<i;r++){let i=this.metadataQuerier.GetEntryName(e,r);t[i]=this._getDracoMetadataField(e,i)}return t}_getDracoMetadataField(e,t){let i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);let r=function(e){let t=e.size(),i=new Int32Array(t);for(let r=0;r<t;r++)i[r]=e.GetValue(r);return i}(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:r}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){let{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,r=[...t,...i];for(let e of r)this.decoder.SkipAttributeTransform(this.draco[e])}_getQuantizationTransform(e,t){let{quantizedAttributes:i=[]}=t,r=e.attribute_type();if(i.map((e=>this.decoder[e])).includes(r)){let t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map((e=>t.min_value(e)))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){let{octahedronAttributes:i=[]}=t,r=e.attribute_type();if(i.map((e=>this.decoder[e])).includes(r)){let t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}(i);try{return r.parseSync(e,t?.draco)}finally{r.destroy()}}};function TM(e){let{buffer:t,size:i,count:r}=function(e){let t=e,i=1,r=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e?Array.isArray(e)?new t(e):!i||e instanceof t?e:new t(e):null}(t,Float32Array)),r=t.length/i),{buffer:t,size:i,count:r}}(e);return{value:t,size:i,byteOffset:0,count:r,type:jS(i),componentType:HS(t)}}var CM="KHR_draco_mesh_compression",SM=CM;function PM(e,t,i){let r=new qS(e);for(let e of LM(r))r.getObjectExtension(e,CM)}async function MM(e,t,i){var r;if(null==t||null===(r=t.gltf)||void 0===r||!r.decompressMeshes)return;let n=new qS(e),s=[];for(let e of LM(n))n.getObjectExtension(e,CM)&&s.push(IM(n,e,t,i));await Promise.all(s),n.removeExtension(CM)}function RM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new qS(e);for(let e of i.json.meshes||[])BM(e,t),i.addRequiredExtension(CM)}async function IM(e,t,i,r){let n=e.getObjectExtension(t,CM);if(!n)return;let s=e.getTypedArrayForBufferView(n.bufferView),o=de(s.buffer,s.byteOffset),a={...i};delete a["3d-tiles"];let l=await O(o,xM,a,r),u=function(e){let t={};for(let i in e){let r=e[i];if("indices"!==i){let e=TM(r);t[i]=e}}return t}(l.attributes);for(let[i,r]of Object.entries(u))if(i in t.attributes){let n=t.attributes[i],s=e.getAccessor(n);null!=s&&s.min&&null!=s&&s.max&&(r.min=s.min,r.max=s.max)}t.attributes=u,l.indices&&(t.indices=TM(l.indices)),e.removeObjectExtension(t,CM),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function BM(e,t){var i;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let o=n.DracoWriter.encodeSync({attributes:e}),a=null==s||null===(i=s.parseSync)||void 0===i?void 0:i.call(s,{attributes:e}),l=n._addFauxAttributes(a.attributes),u=n.addBufferView(o);return{primitives:[{attributes:l,mode:r,extensions:{[CM]:{bufferView:u,attributes:l}}}]}}function*LM(e){for(let t of e.json.meshes||[])for(let e of t.primitives)yield e}var OM={};l(OM,{decode:()=>GM,name:()=>NM});var FM="KHR_texture_transform",NM=FM,DM=new Rl,kM=new Dl,UM=new Dl;async function GM(e,t){var i;if(!new qS(e).hasExtension(FM)||null===(i=t.gltf)||void 0===i||!i.loadBuffers)return;let r=e.json.materials||[];for(let t=0;t<r.length;t++)zM(t,e)}function zM(e,t){var i,r,n;let s=[],o=null===(i=t.json.materials)||void 0===i?void 0:i[e],a=null==o||null===(r=o.pbrMetallicRoughness)||void 0===r?void 0:r.baseColorTexture;a&&VM(t,e,a,s);let l=o?.emissiveTexture;l&&VM(t,e,l,s);let u=o?.normalTexture;u&&VM(t,e,u,s);let h=o?.occlusionTexture;h&&VM(t,e,h,s);let c=null==o||null===(n=o.pbrMetallicRoughness)||void 0===n?void 0:n.metallicRoughnessTexture;c&&VM(t,e,c,s)}function VM(e,t,i,r){let n=function(e,t){var i;let r=null===(i=e.extensions)||void 0===i?void 0:i[FM],{texCoord:n=0}=e,{texCoord:s=n}=r;if(-1===t.findIndex((e=>{let[t,i]=e;return t===n&&i===s}))){let i=function(e){let{offset:t=[0,0],rotation:i=0,scale:r=[1,1]}=e,n=(new Dl).set(1,0,0,0,1,0,t[0],t[1],1),s=kM.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=UM.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(o)}(r);return n!==s&&(e.texCoord=s),t.push([n,s]),{originalTexCoord:n,texCoord:s,matrix:i}}return null}(i,r);if(!n)return;let s=e.json.meshes||[];for(let i of s)for(let r of i.primitives){let i=r.material;Number.isFinite(i)&&t===i&&jM(e,r,n)}}function jM(e,t,i){let{originalTexCoord:r,texCoord:n,matrix:s}=i,o=t.attributes[`TEXCOORD_${r}`];if(Number.isFinite(o)){var a;let i=null===(a=e.json.accessors)||void 0===a?void 0:a[o];if(i&&i.bufferView){var l;let o=null===(l=e.json.bufferViews)||void 0===l?void 0:l[i.bufferView];if(o){let{arrayBuffer:a,byteOffset:l}=e.buffers[o.buffer],u=(l||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:h,length:c}=WS(i,o),d=FS[i.componentType],f=OS[i.type],p=o.byteStride||d*f,g=new Float32Array(c);for(let e=0;e<i.count;e++){let t=new h(a,u+e*p,2);DM.set(t[0],t[1],1),DM.transformByMatrix3(s),g.set([DM[0],DM[1]],e*f)}r===n?function(e,t,i,r){e.componentType=5126,i.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(i,o,e.buffers,g):function(e,t,i,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});let s=r.json.bufferViews;if(!s)return;s.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});let o=r.json.accessors;o&&(o.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}(n,i,t,e,g)}}}}var HM={};l(HM,{decode:()=>qM,encode:()=>KM,name:()=>XM});var WM="KHR_lights_punctual",XM=WM;async function qM(e){let t=new qS(e),{json:i}=t,r=t.getExtension(WM);r&&(t.json.lights=r.lights,t.removeExtension(WM));for(let e of i.nodes||[]){let i=t.getObjectExtension(e,WM);i&&(e.light=i.light),t.removeObjectExtension(e,WM)}}async function KM(e){let t=new qS(e),{json:i}=t;if(i.lights){let e=t.addExtension(WM);LS(!e.lights),e.lights=i.lights,delete i.lights}if(t.json.lights){for(let e of t.json.lights){let i=e.node;t.addObjectExtension(i,WM,e)}delete t.json.lights}}var $M={};l($M,{decode:()=>ZM,encode:()=>QM,name:()=>YM});var JM="KHR_materials_unlit",YM=JM;async function ZM(e){let t=new qS(e),{json:i}=t;for(let e of i.materials||[])e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),t.removeObjectExtension(e,JM);t.removeExtension(JM)}function QM(e){let t=new qS(e),{json:i}=t;if(t.materials)for(let e of i.materials||[])e.unlit&&(delete e.unlit,t.addObjectExtension(e,JM,{}),t.addExtension(JM))}var eR={};l(eR,{decode:()=>rR,encode:()=>nR,name:()=>iR});var tR="KHR_techniques_webgl",iR=tR;async function rR(e){let t=new qS(e),{json:i}=t,r=t.getExtension(tR);if(r){let e=function(e,t){let{programs:i=[],shaders:r=[],techniques:n=[]}=e,s=new TextDecoder;return r.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=s.decode(t.getTypedArrayForBufferView(e.bufferView))})),i.forEach((e=>{e.fragmentShader=r[e.fragmentShader],e.vertexShader=r[e.vertexShader]})),n.forEach((e=>{e.program=i[e.program]})),n}(r,t);for(let r of i.materials||[]){let i=t.getObjectExtension(r,tR);i&&(r.technique=Object.assign({},i,e[i.technique]),r.technique.values=sR(r.technique,t)),t.removeObjectExtension(r,tR)}t.removeExtension(tR)}}async function nR(e,t){}function sR(e,t){let i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in i)&&(i[t]=e.uniforms[t].value)})),Object.keys(i).forEach((e=>{"object"==typeof i[e]&&void 0!==i[e].index&&(i[e].texture=t.getTexture(i[e].index))})),i}var oR=[cP,BS,XP,sM,uM,fM,HM,$M,eR,OM,EP];function aR(e,t){var i;let r=(null==t||null===(i=t.gltf)||void 0===i?void 0:i.excludeExtensions)||{};return!(e in r&&!r[e])}var lR="KHR_binary_glTF",uR={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},hR={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},cR=class{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(e,t){this.json=e.json;let i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn(`glTF: Unknown version ${i.asset.version}`)}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),function(e){let t=new qS(e),{json:i}=t;for(let e of i.images||[]){let i=t.getObjectExtension(e,lR);i&&Object.assign(e,i),t.removeObjectExtension(e,lR)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(lR)}(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let t in uR)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){let i=e[t];if(i&&!Array.isArray(i)){e[t]=[];for(let r in i){let n=i[r];n.id=n.id||r;let s=e[t].length;e[t].push(n),this.idToIndexMap[t][r]=s}}}_convertObjectIdsToArrayIndices(e){for(let t in uR)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(let t of e.textures)this._convertTextureIds(t);for(let t of e.meshes)this._convertMeshIds(t);for(let t of e.nodes)this._convertNodeIds(t);for(let t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let t of e.primitives){let{attributes:e,indices:i,material:r}=t;for(let t in e)e[t]=this._convertIdToIndex(e[t],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(let i of e[t])for(let e in i){let t=i[e],r=this._convertIdToIndex(t,e);i[e]=r}}_convertIdToIndex(e,t){let i=hR[t];if(i in this.idToIndexMap){let r=this.idToIndexMap[i][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(let e of this.json.buffers)delete e.type}_updateMaterial(e){for(let n of e.materials){var t,i,r;n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let s=(null===(t=n.values)||void 0===t?void 0:t.tex)||(null===(i=n.values)||void 0===i?void 0:i.texture2d_0)||(null===(r=n.values)||void 0===r?void 0:r.diffuseTex),o=e.textures.findIndex((e=>e.id===s));-1!==o&&(n.pbrMetallicRoughness.baseColorTexture={index:o})}}};async function dR(e,t){var i,r,n;let s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return function(e,t,i,r){if(r.uri&&(e.baseUri=r.uri),t instanceof ArrayBuffer&&!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new DataView(e),{magic:n=OP}=i,s=r.getUint32(t,!1);return s===n||s===OP}(t,i,r)&&(t=(new TextDecoder).decode(t)),"string"==typeof t)e.json=ue(t);else if(t instanceof ArrayBuffer){let n={};i=VP(n,t,i,r.glb),LS("glTF"===n.type,`Invalid GLB magic string ${n.type}`),e._glb=n,e.json=n.json}else LS(!1,"GLTF: must be ArrayBuffer or string");let n=e.json.buffers||[];if(e.buffers=new Array(n.length).fill(null),e._glb&&e._glb.header.hasBinChunk){let{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}let s=e.json.images||[];e.images=new Array(s.length).fill({})}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(new cR).normalize(e,t)}(e,{normalize:null==s||null===(i=s.gltf)||void 0===i?void 0:i.normalize}),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=oR.filter((e=>aR(e.name,t)));for(let s of r){var n;null===(n=s.preprocess)||void 0===n||n.call(s,e,t,i)}}(e,s,o),null!=s&&null!==(r=s.gltf)&&void 0!==r&&r.loadBuffers&&e.json.buffers&&await async function(e,t,i){let r=e.json.buffers||[];for(let o=0;o<r.length;++o){let a=r[o];if(a.uri){var n,s;let{fetch:r}=i;LS(r);let l=WP(a.uri,t),u=await(null==i||null===(n=i.fetch)||void 0===n?void 0:n.call(i,l)),h=await(null==u||null===(s=u.arrayBuffer)||void 0===s?void 0:s.call(u));e.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else null===e.buffers[o]&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}(e,s,o),null!=s&&null!==(n=s.gltf)&&void 0!==n&&n.loadImages&&await async function(e,t,i){let r=function(e){let t=new Set,i=e.json.textures||[];for(let e of i)void 0!==e.source&&t.add(e.source);return Array.from(t).sort()}(e),n=e.json.images||[],s=[];for(let o of r)s.push(fR(e,n[o],o,t,i));return await Promise.all(s)}(e,s,o),await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=oR.filter((e=>aR(e.name,t)));for(let s of r){var n;await(null===(n=s.decode)||void 0===n?void 0:n.call(s,e,t,i))}}(e,s,o),e}async function fR(e,t,i,r,n){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){let e=WP(t.uri,r),{fetch:i}=n;s=await(await i(e)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){let i=function(e,t,i){let r=e.bufferViews[i];LS(r);let n=t[r.buffer];LS(n);let s=(r.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,s,r.byteLength)}(e.json,e.buffers,t.bufferView);s=de(i.buffer,i.byteOffset,i.byteLength)}LS(s,"glTF image has no data");let o=await O(s,[bi,ES],{...r,mimeType:t.mimeType,basis:r.basis||{format:AS()}},n);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}var pR={name:"glTF",id:"gltf",module:"gltf",version:"4.1.4",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;t={...pR.options,...t},t.gltf={...pR.options.gltf,...t.gltf};let{byteOffset:r=0}=t;return await dR({},e,r,t,i)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}},gR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},mR={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},_R=10240,vR=10241,yR=10242,bR=10243,AR=10497,ER={magFilter:_R,minFilter:vR,wrapS:yR,wrapT:bR},wR={[_R]:9729,[vR]:9986,[yR]:AR,[bR]:AR},xR=class{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{json:i,buffers:r=[],images:n=[]}=e,{baseUri:s=""}=e;return LS(i),this.baseUri=s,this.buffers=r,this.images=n,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e){let t={...e};return this.json=t,e.bufferViews&&(t.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(t.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(t.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(t.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(t.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(t.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(t.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(t.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t))),t.nodes=t.nodes.map(((e,t)=>this._resolveNodeChildren(e)))),e.skins&&(t.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(t.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),"number"==typeof this.json.scene&&t.scenes&&(t.scene=t.scenes[this.json.scene]),t}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if("object"==typeof t)return t;let i=e&&e[t];return i||console.warn(`glTF file error: Could not find ${e}[${t}]`),i}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map((e=>this.getNode(e)))}}_resolveNode(e,t){let i={...e,id:e?.id||`node-${t}`};return void 0!==e.mesh&&(i.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(i.camera=this.getCamera(e.camera)),void 0!==e.skin&&(i.skin=this.getSkin(e.skin)),void 0!==e.meshes&&e.meshes.length&&(i.mesh=e.meshes.reduce(((e,t)=>{let i=this.getMesh(t);return e.id=i.id,e.primitives=e.primitives.concat(i.primitives),e}),{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map((e=>this.getNode(e)))),e}_resolveSkin(e,t){let i="number"==typeof e.inverseBindMatrices?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:i}}_resolveMesh(e,t){let i={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map((e=>{let t={...e,attributes:{},indices:void 0,material:void 0},i=e.attributes;for(let e in i)t.attributes[e]=this.getAccessor(i[e]);return void 0!==e.indices&&(t.indices=this.getAccessor(e.indices)),void 0!==e.material&&(t.material=this.getMaterial(e.material)),t}))),i}_resolveMaterial(e,t){let i={...e,id:e.id||`material-${t}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};let e=i.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,t){let i=function(e){return mR[e]}(e.componentType),r=function(e){return gR[e]}(e.type),n=i*r,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:i,components:r,bytesPerElement:n,value:void 0,bufferView:void 0,sparse:void 0};if(void 0!==e.bufferView&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){let e=s.bufferView.buffer,{ArrayType:t,byteLength:i}=WS(s,s.bufferView),r=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+e.byteOffset,n=e.arrayBuffer.slice(r,r+i);s.bufferView.byteStride&&(n=this._getValueFromInterleavedBuffer(e,r,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new t(n)}return s}_getValueFromInterleavedBuffer(e,t,i,r,n){let s=new Uint8Array(n*r);for(let o=0;o<n;o++){let n=t+o*i;s.set(new Uint8Array(e.arrayBuffer.slice(n,n+r)),o*r)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:"number"==typeof e.sampler?this.getSampler(e.sampler):{id:"default-sampler",parameters:wR},source:"number"==typeof e.source?this.getImage(e.source):void 0}}_resolveSampler(e,t){let i={id:e.id||`sampler-${t}`,...e,parameters:{}};for(let e in i){let t=this._enumSamplerParameter(e);void 0!==t&&(i.parameters[t]=i[e])}return i}_enumSamplerParameter(e){return ER[e]}_resolveImage(e,t){let i={...e,id:e.id||`image-${t}`,image:null,bufferView:void 0!==e.bufferView?this.getBufferView(e.bufferView):void 0},r=this.images[t];return r&&(i.image=r),i}_resolveBufferView(e,t){let i=e.buffer,r=this.buffers[i].arrayBuffer,n=this.buffers[i].byteOffset||0;return e.byteOffset&&(n+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[i],data:new Uint8Array(r,n,e.byteLength)}}_resolveCamera(e,t){let i={...e,id:e.id||`camera-${t}`};return i.perspective,i.orthographic,i}};function TR(e,t){return(new xR).postProcess(e,t)}async function CR(e){let t=[];return e.scenes.forEach((e=>{e.traverse((e=>{Object.values(e.model.uniforms).forEach((e=>{!1===e.loaded&&t.push(e)}))}))})),await async function(e){for(;e();)await new Promise((e=>requestAnimationFrame(e)))}((()=>t.some((e=>!e.loaded))))}var SR=[255,255,255,255],PR={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?"object"==typeof e.scene?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:SR},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[pR]},MR=class extends hb{getShaders(){let e=[rd,Vd];return"pbr"===this.props._lighting&&e.push(Lc),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scenegraph-layer-vertex-shader\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec3 positions;\n#ifdef HAS_UV\nin vec2 texCoords;\n#endif\n#ifdef MODULE_PBR\n#ifdef HAS_NORMALS\nin vec3 normals;\n#endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n#ifdef HAS_UV\nout vec2 vTEXCOORD_0;\n#endif\n#endif\nvoid main(void) {\n#if defined(HAS_UV) && !defined(MODULE_PBR)\nvTEXCOORD_0 = texCoords;\ngeometry.uv = texCoords;\n#endif\ngeometry.worldPosition = instancePositions;\ngeometry.pickingColor = instancePickingColors;\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvec3 normal = vec3(0.0, 0.0, 1.0);\n#ifdef MODULE_PBR\n#ifdef HAS_NORMALS\nnormal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;\n#endif\n#endif\nfloat originalSize = project_size_to_pixel(sizeScale);\nfloat clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\nvec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\nif(composeModelMatrix) {\nDECKGL_FILTER_SIZE(pos, geometry);\ngeometry.normal = project_normal(normal);\ngeometry.worldPosition += pos;\ngl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n}\nelse {\npos = project_size(pos);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\ngeometry.normal = project_normal(normal);\n}\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n#ifdef MODULE_PBR\npbr_vPosition = geometry.position.xyz;\n#ifdef HAS_NORMALS\npbr_vNormal = geometry.normal;\n#endif\n#ifdef HAS_UV\npbr_vUV = texCoords;\n#else\npbr_vUV = vec2(0., 0.);\n#endif\ngeometry.uv = pbr_vUV;\n#endif\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scenegraph-layer-fragment-shader\nuniform float opacity;\nin vec4 vColor;\nout vec4 fragColor;\n#ifndef MODULE_PBR\n#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\nin vec2 vTEXCOORD_0;\nuniform sampler2D u_BaseColorSampler;\n#endif\n#endif\nvoid main(void) {\n#ifdef MODULE_PBR\nfragColor = vColor * pbr_filterColor(vec4(0));\ngeometry.uv = pbr_vUV;\n#else\n#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\nfragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);\ngeometry.uv = vTEXCOORD_0;\n#else\nfragColor = vColor;\n#endif\n#endif\nfragColor.a *= opacity;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:SR,transition:!0},instanceModelMatrix:FC})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e;t.scenegraph!==i.scenegraph?this._updateScenegraph():t._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){return Boolean(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let e=this.props,{device:t}=this.context,i=null;if(e.scenegraph instanceof Ap)i={scenes:[e.scenegraph]};else if(e.scenegraph&&"object"==typeof e.scenegraph){let r=e.scenegraph,n=r.json?TR(r):r,s=IS(t,n,this._getModelOptions());i={gltf:n,...s},CR(s).then((()=>{this.setNeedsRedraw()}))}let r={layer:this,device:this.context.device},n=e.getScene(i,r),s=e.getAnimator(i,r);n instanceof Ep?(this._deleteScenegraph(),this._applyAllAttributes(n),this._applyAnimationsProp(n,s,e._animations),this.setState({scenegraph:n,animator:s})):null!==n&&wi.warn("invalid scenegraph:",n)()}_applyAllAttributes(e){if(this.state.attributesAvailable){let t=this.getAttributeManager().getAttributes();e.traverse((e=>{e instanceof wp&&this._setModelAttributes(e.model,t,!1)}))}}_applyAnimationsProp(e,t,i){if(!e||!t||!i)return;let r=t.getAnimations();Object.keys(i).sort().forEach((e=>{let t=i[e];if("*"===e)r.forEach((e=>{Object.assign(e,t)}));else if(Number.isFinite(Number(e))){let i=Number(e);i>=0&&i<r.length?Object.assign(r[i],t):wi.warn(`animation ${e} not found`)()}else{let i=r.find((({name:t})=>t===e));i?Object.assign(i,t):wi.warn(`animation ${e} not found`)()}}))}_deleteScenegraph(){let{scenegraph:e}=this.state;e instanceof Ap&&e.delete()}_getModelOptions(){let e,{_imageBasedLightingEnvironment:t}=this.props;return t&&(e="function"==typeof t?t({gl:this.context.gl,layer:this}):t),{imageBasedLightingEnvironment:e,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}updateAttributes(e){if(this.setState({attributesAvailable:!0}),!this.state.scenegraph)return;let t=!1;for(let i in e)e[i].layoutChanged()&&(t=!0);this.state.scenegraph.traverse((i=>{i instanceof wp&&this._setModelAttributes(i.model,e,t)}))}draw({moduleParameters:e=null,parameters:t={},context:i}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());let{viewport:r,renderPass:n}=this.context,{sizeScale:s,sizeMinPixels:o,sizeMaxPixels:a,opacity:l,coordinateSystem:u}=this.props,h=this.getNumInstances();this.state.scenegraph.traverse(((t,{worldMatrix:i})=>{if(t instanceof wp){let{model:c}=t;c.setInstanceCount(h),e&&c.updateModuleSettings(e),c.setUniforms({sizeScale:s,opacity:l,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:NC(r,u),sceneModelMatrix:i,u_Camera:c.uniforms.project_uCameraPosition}),c.draw(n)}}))}},RR=MR;MR.defaultProps=PR,MR.layerName="ScenegraphLayer";var IR={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},BR=class extends VC{getShaders(){let e=super.getShaders();return e.modules.push(Lc),{...e,vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool pickFeatureIds;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\nvec2 applyUVRegion(vec2 uv) {\n#ifdef HAS_UV_REGIONS\nreturn fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n#else\nreturn uv;\n#endif\n}\nvoid main(void) {\nvec2 uv = applyUVRegion(texCoords);\ngeometry.uv = uv;\nif (pickFeatureIds) {\ngeometry.pickingColor = featureIdsPickingColors;\n} else {\ngeometry.pickingColor = instancePickingColors;\n}\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvTexCoord = uv;\ncameraPosition = project_uCameraPosition;\nvColor = vec4(colors * instanceColors.rgb, instanceColors.a);\nvec3 pos = (instanceModelMatrix * positions) * sizeScale;\nvec3 projectedPosition = project_position(positions);\nposition_commonspace = vec4(projectedPosition, 1.0);\ngl_Position = project_common_position_to_clipspace(position_commonspace);\ngeometry.position = position_commonspace;\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\ngeometry.normal = normals_commonspace;\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n#ifdef MODULE_PBR\npbr_vPosition = geometry.position.xyz;\n#ifdef HAS_NORMALS\npbr_vNormal = geometry.normal;\n#endif\n#ifdef HAS_UV\npbr_vUV = uv;\n#else\npbr_vUV = vec2(0., 0.);\n#endif\ngeometry.uv = pbr_vUV;\n#endif\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\nprecision highp float;\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\n#ifdef MODULE_PBR\nfragColor = vColor * pbr_filterColor(vec4(0));\ngeometry.uv = pbr_vUV;\nfragColor.a *= opacity;\n#else\ngeometry.uv = vTexCoord;\nvec3 normal;\nif (flatShading) {\nnormal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n} else {\nnormal = normals_commonspace;\n}\nvec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\nvec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\nfragColor = vec4(lightColor, color.a * opacity);\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){let{featureIds:e}=this.props;super.initializeState();let t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e;t.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){let{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:Boolean(t)}),super.draw(e))}getModel(e){let{id:t,pbrMaterial:i}=this.props,r=this.parseMaterial(i,e);this.setState({parsedPBRMaterial:r});let n=this.getShaders();return function(e){let t=e.positions||e.POSITION,i=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(4*i).fill(255),normalized:!0})}(e.attributes),new fp(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...n.defines,...r?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:r?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){let{model:t}=this.state;if(t){let{mesh:i}=this.props,r=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:r}),t.setBindings(r.bindings),t.setUniforms(r.uniforms)}}parseMaterial(e,t){let i=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return jC(this.context.device,{unlit:i,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){let t=this.props.featureIds,i=new Uint8ClampedArray(t.length*e.size),r=[];for(let e=0;e<t.length;e++)this.encodePickingColor(t[e],r),i[3*e]=r[0],i[3*e+1]=r[1],i[3*e+2]=r[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach((e=>e.destroy())),this.setState({parsedPBRMaterial:null})}},LR=BR;function OR(e){return e}function FR(e,t=[]){return function(e,t=[],i=OR){return"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):"x"in e?(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}(e,t,go._cartographicRadians?OR:vo)}function NR(e,t){return function(e,t,i=OR){return"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):"x"in t?(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}(e,t,go._cartographicRadians?OR:yo)}BR.layerName="MeshLayer",BR.defaultProps=IR,new Rl;var DR=new Rl,kR={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},UR={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},GR={east:new Rl,north:new Rl,up:new Rl,west:new Rl,south:new Rl,down:new Rl},zR=new Rl,VR=new Rl,jR=new Rl;function HR(e,t,i,r,n,s){let o=kR[t]&&kR[t][i];Mo(o&&(!r||r===o));let a,l,u,h=DR.copy(n);if(xo(h.x,0,1e-14)&&xo(h.y,0,1e-14)){let e=Math.sign(h.z);a=zR.fromArray(UR[t]),"east"!==t&&"west"!==t&&a.scale(e),l=VR.fromArray(UR[i]),"east"!==i&&"west"!==i&&l.scale(e),u=jR.fromArray(UR[r]),"east"!==r&&"west"!==r&&u.scale(e)}else{let{up:n,east:s,north:o}=GR;s.set(-h.y,h.x,0).normalize(),e.geodeticSurfaceNormal(h,n),o.copy(n).cross(s);let{down:c,west:d,south:f}=GR;c.copy(n).scale(-1),d.copy(s).scale(-1),f.copy(o).scale(-1),a=GR[t],l=GR[i],u=GR[r]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=l.x,s[5]=l.y,s[6]=l.z,s[7]=0,s[8]=u.x,s[9]=u.y,s[10]=u.z,s[11]=0,s[12]=h.x,s[13]=h.y,s[14]=h.z,s[15]=1,s}var WR=new Rl,XR=new Rl,qR=new Rl,KR=new Rl,$R=new Rl,JR=new Rl,YR=new Rl,ZR=new Rl,QR=new Rl,eI=class{constructor(e=0,t=0,i=0){this.centerToleranceSquared=Qh.EPSILON1,Mo(e>=0),Mo(t>=0),Mo(i>=0),this.radii=new Rl(e,t,i),this.radiiSquared=new Rl(e*e,t*t,i*i),this.radiiToTheFourth=new Rl(e*e*e*e,t*t*t*t,i*i*i*i),this.oneOverRadii=new Rl(0===e?0:1/e,0===t?0:1/t,0===i?0:1/i),this.oneOverRadiiSquared=new Rl(0===e?0:1/(e*e),0===t?0:1/(t*t),0===i?0:1/(i*i)),this.minimumRadius=Math.min(e,t,i),this.maximumRadius=Math.max(e,t,i),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){let i=$R,r=JR,[,,n]=e;this.geodeticSurfaceNormalCartographic(e,i),r.copy(this.radiiSquared).scale(i);let s=Math.sqrt(i.dot(r));return r.scale(1/s),i.scale(n),r.add(i),r.to(t)}cartesianToCartographic(e,t=[0,0,0]){QR.from(e);let i=this.scaleToGeodeticSurface(QR,YR);if(!i)return;let r=this.geodeticSurfaceNormal(i,$R),n=ZR;return n.copy(QR).subtract(i),NR([Math.atan2(r.y,r.x),Math.asin(r.z),Math.sign(Ra.dot(n,QR))*Ra.length(n)],t)}eastNorthUpToFixedFrame(e,t=new Oh){return HR(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,r,n=new Oh){return HR(this,e,t,i,r,n)}geocentricSurfaceNormal(e,t=[0,0,0]){return KR.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){let i=FR(e),r=i[0],n=i[1],s=Math.cos(n);return KR.set(s*Math.cos(r),s*Math.sin(r),Math.sin(n)).normalize(),KR.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return KR.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return function(e,t,i=[]){let{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:s}=t;WR.from(e);let o=WR.x,a=WR.y,l=WR.z,u=r.x,h=r.y,c=r.z,d=o*o*u*u,f=a*a*h*h,p=l*l*c*c,g=d+f+p,m=Math.sqrt(1/g);if(!Number.isFinite(m))return;let _=XR;if(_.copy(e).scale(m),g<s)return _.to(i);let v=n.x,y=n.y,b=n.z,A=qR;A.set(_.x*v*2,_.y*y*2,_.z*b*2);let E,w,x,T,C=(1-m)*WR.len()/(.5*A.len()),S=0;do{C-=S,E=1/(1+C*v),w=1/(1+C*y),x=1/(1+C*b);let e=E*E,t=w*w,i=x*x;T=d*e+f*t+p*i-1,S=T/(-2*(d*(e*E)*v+f*(t*w)*y+p*(i*x)*b))}while(Math.abs(T)>Qh.EPSILON12);return WR.scale([E,w,x]).to(i)}(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){YR.from(e);let i=YR.x,r=YR.y,n=YR.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(i*i*s.x+r*r*s.y+n*n*s.z);return YR.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return YR.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return YR.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){Mo(xo(this.radii.x,this.radii.y,Qh.EPSILON15)),Mo(this.radii.z>0),YR.from(e);let r=YR.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-t))return YR.set(0,0,r).to(i)}};eI.WGS84=new eI(6378137,6378137,6356752.314245179);var tI=new Rl,iI=new Rl,rI=new bT([new mT,new mT,new mT,new mT,new mT,new mT]);function nI(e,t){let{cameraDirection:i,cameraUp:r,height:n}=e,{metersPerUnit:s}=e.distanceScales,o=oI(e,e.center),a=eI.WGS84.eastNorthUpToFixedFrame(o),l=e.unprojectPosition(e.cameraPosition),u=eI.WGS84.cartographicToCartesian(l,new Rl),h=new Rl(a.transformAsVector(new Rl(i).scale(s))).normalize(),c=new Rl(a.transformAsVector(new Rl(r).scale(s))).normalize();!function(e){let t=e.getFrustumPlanes(),i=sI(t.near,e.cameraPosition),r=oI(e,i),n=oI(e,e.cameraPosition,iI),s=0;rI.planes[s++].fromPointNormal(r,tI.copy(r).subtract(n));for(let n in t){if("near"===n)continue;let o=oI(e,sI(t[n],i,iI),iI);rI.planes[s++].fromPointNormal(o,tI.copy(r).subtract(o))}}(e);let d=e.constructor,{longitude:f,latitude:p,width:g,bearing:m,zoom:_}=e;return{camera:{position:u,direction:h,up:c},viewport:e,topDownViewport:new d({longitude:f,latitude:p,height:n,width:g,bearing:m,zoom:_,pitch:0}),height:n,cullingVolume:rI,frameNumber:t,sseDenominator:1.15}}function sI(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rl,r=e.normal.dot(t);return i.copy(e.normal).scale(e.distance-r).add(t),i}function oI(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rl,r=e.unprojectPosition(t);return eI.WGS84.cartographicToCartesian(r,i)}var aI=6356752.314245179,lI=new Rl;function uI(e,t){if(e instanceof fT){let{halfAxes:i}=e,r=function(e){e.getColumn(0,lI);let t=e.getColumn(1),i=e.getColumn(2);return lI.add(t).add(i).len()}(i);return Math.log2(aI/(r+t[2]))}if(e instanceof Jx){let{radius:i}=e;return Math.log2(aI/(i+t[2]))}if(e.width&&e.height){let{width:t,height:i}=e;return(Math.log2(6378137/t)+Math.log2(6378137/i))/2}return 1}function hI(e,t,i){eI.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],lI);let r=Math.sqrt(Math.pow(lI[0]-i[0],2)+Math.pow(lI[1]-i[1],2)+Math.pow(lI[2]-i[2],2));return Math.log2(aI/(r+t[2]))}var cI=0,dI=1,fI=3,pI=4,gI=5,mI=function(e){return e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE",e}({}),_I=function(e){return e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh",e}({}),vI=function(e){return e.I3S="I3S",e.TILES3D="TILES3D",e}({}),yI=function(e){return e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold",e}({}),bI=1;function AI(e){return null!=e}var EI=new Rl,wI=new Rl,xI=new Rl,TI=new Rl,CI=new Rl,SI=new Rl,PI=new Rl,MI=new Rl;function RI(e,t,i){if(F(e,"3D Tile: boundingVolume must be defined"),e.box)return BI(e.box,t,i);if(e.region)return function(e){let[t,i,r,n,s,o]=e,a=eI.WGS84.cartographicToCartesian([Ao(t),Ao(n),s],xI),l=eI.WGS84.cartographicToCartesian([Ao(r),Ao(i),o],TI),u=(new Rl).addVectors(a,l).multiplyByScalar(.5);return eI.WGS84.cartesianToCartographic(u,CI),eI.WGS84.cartographicToCartesian([Ao(r),CI[1],CI[2]],SI),eI.WGS84.cartographicToCartesian([CI[0],Ao(n),CI[2]],PI),eI.WGS84.cartographicToCartesian([CI[0],CI[1],o],MI),BI([...u,...SI.subtract(u),...PI.subtract(u),...MI.subtract(u)],new Oh)}(e.region);if(e.sphere)return function(e,t,i){let r=new Rl(e[0],e[1],e[2]);t.transform(r,r);let n=t.getScale(wI),s=Math.max(Math.max(n[0],n[1]),n[2]),o=e[3]*s;return AI(i)?(i.center=r,i.radius=o,i):new Jx(r,o)}(e.sphere,t,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function II(e,t){if(e.box)return function(e){let t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],{halfAxes:i}=e,r=new Rl(i.getColumn(0)),n=new Rl(i.getColumn(1)),s=new Rl(i.getColumn(2));for(let i=0;i<2;i++){for(let i=0;i<2;i++){for(let i=0;i<2;i++)EI.copy(e.center),EI.add(r),EI.add(n),EI.add(s),LI(t,EI),s.negate();n.negate()}r.negate()}return t}(t);if(e.region){let[t,i,r,n,s,o]=e.region;return[[Ao(t),Ao(i),s],[Ao(r),Ao(n),o]]}if(e.sphere)return function(e){let t,i=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]],{center:r,radius:n}=e,s=eI.WGS84.scaleToGeodeticSurface(r,EI);t=s?eI.WGS84.geodeticSurfaceNormal(s):new Rl(0,0,1);let o=new Rl(t[2],-t[1],0);o.len()>0?o.normalize():o=new Rl(0,1,0);let a=o.clone().cross(t);for(let e of[o,a,t]){wI.copy(e).scale(n);for(let e=0;e<2;e++)EI.copy(r),EI.add(wI),LI(i,EI),wI.negate()}return i}(t);throw new Error("Unkown boundingVolume type")}function BI(e,t,i){let r=new Rl(e[0],e[1],e[2]);t.transform(r,r);let n=[];if(10===e.length){let t=e.slice(3,6),i=new Jh;i.fromArray(e,6);let r=new Rl([1,0,0]),s=new Rl([0,1,0]),o=new Rl([0,0,1]);r.transformByQuaternion(i),r.scale(t[0]),s.transformByQuaternion(i),s.scale(t[1]),o.transformByQuaternion(i),o.scale(t[2]),n=[...r.toArray(),...s.toArray(),...o.toArray()]}else n=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];let s=t.transformAsVector(n.slice(0,3)),o=t.transformAsVector(n.slice(3,6)),a=t.transformAsVector(n.slice(6,9)),l=new Dl([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return AI(i)?(i.center=r,i.halfAxes=l,i):new fT(r,l)}function LI(e,t){eI.WGS84.cartesianToCartographic(t,EI),e[0][0]=Math.min(e[0][0],EI[0]),e[0][1]=Math.min(e[0][1],EI[1]),e[0][2]=Math.min(e[0][2],EI[2]),e[1][0]=Math.max(e[1][0],EI[0]),e[1][1]=Math.max(e[1][1],EI[1]),e[1][2]=Math.max(e[1][2],EI[2])}function OI(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){let i=e.dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor;return function(e,t){let i=e*t;return 1-Math.exp(-i*i)}(t,i)*r}return 0}new Rl,new Rl,new Oh,new Rl,new Rl,new Rl;var FI=new Rl,NI=new Rl,DI=new Rl,kI=new Rl,UI=new Rl,GI=new Oh,zI=new Oh;function VI(e,t){let{topDownViewport:i}=t,r=e.header.mbs[1],n=e.header.mbs[0],s=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],l=i.unprojectPosition(i.cameraPosition);eI.WGS84.cartographicToCartesian(l,FI),NI.copy(FI).subtract(a).normalize(),eI.WGS84.eastNorthUpToFixedFrame(a,GI),zI.copy(GI).invert(),DI.copy(FI).transform(zI);let u=Math.sqrt(DI[0]*DI[0]+DI[1]*DI[1]),h=u*u/DI[2];kI.copy([DI[0],DI[1],h]);let c=kI.transform(GI).subtract(a).normalize(),d=NI.cross(c).normalize().scale(o).add(a),f=eI.WGS84.cartesianToCartographic(d),p=i.project([n,r,s]),g=i.project(f);return UI.copy(p).subtract(g).magnitude()}var jI=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._map=new Map,this._array=void 0,this._length=void 0,this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return F(e<this._array.length),this._array[e]}set(e,t){F(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){let t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){let t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){let e=this._array[--this.length];return this._map.delete(e),e}reserve(e){F(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){F(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}},HI={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""},WI=class{traversalFinished(e){return!0}constructor(e){this.options=void 0,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={},this.lastUpdate=(new Date).getTime(),this.updateDebounceTime=1e3,this._traversalStack=new jI,this._emptyTraversalStack=new jI,this._frameNumber=null,this.options={...HI,...e}}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){let i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){let e=i.pop(),r=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),r=this.updateAndPushChildren(e,t,i,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));let n=e.parent,s=Boolean(!n||n._shouldRefine),o=!r;e.hasRenderContent?e.refine===mI.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===mI.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=r&&s}let r=(new Date).getTime();(this.traversalFinished(t)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(t))}updateChildTiles(e,t){let i=e.children;for(let e of i)this.updateTile(e,t)}updateAndPushChildren(e,t,i,r){let{loadSiblings:n,skipLevelOfDetail:s}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));let a=e.refine===mI.REPLACE&&e.hasRenderContent&&!s,l=!1,u=!0;for(let e of o)if(e._selectionDepth=r,e.isVisibleAndInRequestVolume?(i.find(e)&&i.delete(e),i.push(e),l=!0):(a||n)&&(this.loadTile(e,t),this.touchTile(e,t)),a){let i;if(i=!!e._inRequestVolume&&(e.hasRenderContent?e.contentAvailable:this.executeEmptyTraversal(e,t)),u=u&&i,!u)return!1}return l||(u=!1),u}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!(!r&&!e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,i))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(t,!0)),r>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){let i=[];if(this.options.viewportTraversersMap)for(let e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===t.viewport.id&&i.push(e);else i.push(t.viewport.id);e.updateVisibility(t,i)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let i=!1;for(let r of e.children)r.updateVisibility(t),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0,r=this._emptyTraversalStack;for(r.push(e);r.length>0;){let e=r.pop(),n=!e.hasRenderContent&&this.canTraverse(e,t,!1,!1),s=!e.hasRenderContent&&0===e.children.length;if(!n&&!e.contentAvailable&&!s&&(i=!1),this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t)),n){let t=e.children;for(let e of t)r.push(e)}}return i}},XI=new Rl,qI=class{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.tileset=void 0,this.header=void 0,this.id=void 0,this.url=void 0,this.parent=void 0,this.refine=void 0,this.type=void 0,this.contentUrl=void 0,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=cI,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this.transform=new Oh,this.extensions=null,this.implicitTiling=null,this.userData={},this.computedTransform=void 0,this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.traverser=new WI({}),this._cacheNode=null,this._frameNumber=null,this._expireDate=null,this._expiredContent=null,this._boundingBox=void 0,this._distanceToCamera=0,this._screenSpaceError=0,this._visibilityPlaneMask=void 0,this._visible=void 0,this._contentBoundingVolume=void 0,this._viewerRequestVolume=void 0,this._initialTransform=new Oh,this._priority=0,this._selectedFrame=0,this._requestedFrame=0,this._selectionDepth=0,this._touchedFrame=0,this._centerZDepth=0,this._shouldRefine=!1,this._stackLength=0,this._visitedFrame=0,this._inRequestVolume=!1,this._lodJudge=null,this.header=t,this.tileset=e,this.id=r||t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===fI||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===cI}get contentExpired(){return this.contentState===pI}get contentFailed(){return this.contentState===gI}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=II(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case vI.I3S:return VI(this,e);case vI.TILES3D:return function(e,t,i){let r=e.tileset,n=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=i?n:e.lodMetricValue;if(0===s)return 0;let o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:u}=r.options,h=s*a*(u||1)/(o*l);return h-=OI(r,o),h}(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,i=this.refine===mI.ADD||t;if(i&&!this.isVisible&&void 0!==this._visible||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===cI)return-1;let r=this.parent,n=!r||i&&0!==this._screenSpaceError&&!r.hasTilesetContent?this._screenSpaceError:r._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-n,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=dI;let e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=cI,!1;try{let e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,i={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await Zt(e,t,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=fI,this._onContentLoaded(),!0}catch(e){throw this.contentState=gI,e}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=cI,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;let i=this.parent,r=i?i._visibilityPlaneMask:bT.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let e=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==bT.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){let{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,t)}contentVisibility(){return!0}distanceToTile(e){let t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e,i=this.boundingVolume;return XI.subVectors(i.center,t.position),t.direction.dot(XI)}insideViewerRequestVolume(e){let t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(function(e){return null!=e}(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){let e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=pI,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Oh(e.transform):new Oh;let t=this.parent,i=this.tileset,r=t&&t.computedTransform?t.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Oh(r).multiplyRight(this.transform);let n=t&&t._initialTransform?t._initialTransform.clone():new Oh;this._initialTransform=new Oh(n).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=cI,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=bT.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||mI.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=RI(e.boundingVolume,this.computedTransform,this.boundingVolume);let t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=RI(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=RI(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){let e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oh).clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:function(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}(this.tileset.tileset)}},KI=class extends WI{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;let i=e.children.length>0;if(e.hasTilesetContent&&i){let i=e.children[0];return this.updateTileVisibility(i,t),void(e._visible=i._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);let r=e.refine===mI.REPLACE,n=e._optimChildrenWithinParent===bI;r&&n&&i&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){let{parent:i}=e;return!(!i||i.hasTilesetContent||i.refine!==mI.ADD||this.shouldRefine(e,t,!0))}},$I="REQUESTED",JI="COMPLETED",YI="ERROR",ZI=class extends WI{constructor(e){super(e),this._tileManager=void 0,this._tileManager=new class{constructor(){this._statusMap=void 0,this.pendingTilesRegister=new class{constructor(){this.frameNumberMap=new Map}register(e,t){let i=this.frameNumberMap.get(e)||new Map,r=i.get(t)||0;i.set(t,r+1),this.frameNumberMap.set(e,i)}deregister(e,t){let i=this.frameNumberMap.get(e);if(!i)return;let r=i.get(t)||1;i.set(t,r-1)}isZero(e,t){var i;return 0===((null===(i=this.frameNumberMap.get(e))||void 0===i?void 0:i.get(t))||0)}},this._statusMap={}}add(e,t,i,r){if(!this._statusMap[t]){let{frameNumber:n,viewport:{id:s}}=r;this._statusMap[t]={request:e,callback:i,key:t,frameState:r,status:$I},this.pendingTilesRegister.register(s,n),e().then((e=>{this._statusMap[t].status=JI;let{frameNumber:i,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,i),this._statusMap[t].callback(e,r)})).catch((e=>{this._statusMap[t].status=YI;let{frameNumber:r,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,r),i(e)}))}}update(e,t){if(this._statusMap[e]){let{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i);let{frameNumber:n,viewport:{id:s}}=t;this.pendingTilesRegister.register(s,n),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";let i=2*VI(e,t);return i<2?"OUT":!e.header.children||i<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){let i=e.header.children||[],r=e.children,n=e.tileset;for(let s of i){let i=`${s.id}-${t.viewport.id}`,o=r&&r.find((e=>e.id===i));if(o)o&&this.updateTile(o,t);else{let r=()=>this._loadTile(s.id,n);this._tileManager.find(i)?this._tileManager.update(i,t):(n.tileset.nodePages&&(r=()=>n.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(r,i,(t=>this._onTileLoad(t,e,i)),t))}}return!1}async _loadTile(e,t){let{loader:i}=t,r=t.getTileUrl(`${t.url}/nodes/${e}`),n={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await Zt(r,i,n)}_onTileLoad(e,t,i){let r=new qI(t.tileset,e,t,i);t.children.push(r);let n=this._tileManager.find(r.id).frameState;this.updateTile(r,n),this._frameNumber===n.frameNumber&&(this.traversalFinished(n)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,n)}},QI={description:"",ellipsoid:eI.WGS84,modelMatrix:new Oh,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},eB="Tiles In Tileset(s)",tB="Tiles In Memory",iB="Tiles In View",rB="Tiles To Render",nB="Tiles Loaded",sB="Tiles Loading",oB="Tiles Unloaded",aB="Failed Tile Loads",lB="Points/Vertices",uB="Tile Memory Use",hB="Maximum Screen Space Error",cB="4.1.4",dB={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function fB(e,t,i){F(e instanceof ArrayBuffer);let r=new TextDecoder("utf8"),n=new Uint8Array(e,t,i);return r.decode(n)}var pB={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},gB={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...pB},mB={[pB.DOUBLE]:Float64Array,[pB.FLOAT]:Float32Array,[pB.UNSIGNED_SHORT]:Uint16Array,[pB.UNSIGNED_INT]:Uint32Array,[pB.UNSIGNED_BYTE]:Uint8Array,[pB.BYTE]:Int8Array,[pB.SHORT]:Int16Array,[pB.INT]:Int32Array},_B={DOUBLE:pB.DOUBLE,FLOAT:pB.FLOAT,UNSIGNED_SHORT:pB.UNSIGNED_SHORT,UNSIGNED_INT:pB.UNSIGNED_INT,UNSIGNED_BYTE:pB.UNSIGNED_BYTE,BYTE:pB.BYTE,SHORT:pB.SHORT,INT:pB.INT},vB="Failed to convert GL type",yB=class{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(let t in mB)if(mB[t]===e)return t;throw new Error(vB)}static fromName(e){let t=_B[e];if(!t)throw new Error(vB);return t}static getArrayType(e){switch(e){case pB.UNSIGNED_SHORT_5_6_5:case pB.UNSIGNED_SHORT_4_4_4_4:case pB.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let t=mB[e];if(!t)throw new Error(vB);return t}}static getByteSize(e){return yB.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(yB.getArrayType(e))}static createTypedArray(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return void 0===r&&(r=(t.byteLength-i)/yB.getByteSize(e)),new(yB.getArrayType(e))(t,i,r)}};function bB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],i=e>>11&31,r=e>>5&63,n=31&e;return t[0]=i<<3,t[1]=r<<2,t[2]=n<<3,t}function AB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Eo(e,0,t)/t*2-1}function EB(e){return e<0?-1:1}function wB(e,t,i,r){if(function(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}(r),e<0||e>i||t<0||t>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(r.x=AB(e,i),r.y=AB(t,i),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){let e=r.x;r.x=(1-Math.abs(r.y))*EB(e),r.y=(1-Math.abs(e))*EB(r.y)}return r.normalize()}function xB(e,t,i){return wB(e,t,255,i)}new Ma,new Rl,new Ma,new Ma;var TB=class{constructor(e,t){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gB.UNSIGNED_INT,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,r.byteOffset):r}getPropertyArray(e,t,i){let r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=yB.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}getProperty(e,t,i,r,n){let s=this.json[e];if(!s)return s;let o=this.getPropertyArray(e,t,i);if(1===i)return o[r];for(let e=0;e<i;++e)n[e]=o[i*r+e];return n}_getTypedArrayFromBinary(e,t,i,r,n){let s=this._cachedTypedArrays,o=s[e];return o||(o=yB.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+n,r*i),s[e]=o),o}_getTypedArrayFromArray(e,t,i){let r=this._cachedTypedArrays,n=r[e];return n||(n=yB.createTypedArray(t,i),r[e]=n),n}},CB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},SB={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},PB={SCALAR:(e,t,i)=>{t[i]=e},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1]},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2]},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9]},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15]}},MB=e=>void 0!==e;function RB(e,t,i){if(!t)return null;let r=e.getExtension("3DTILES_batch_table_hierarchy"),n=t.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?function(e,t){let i,r,n,s,o=e.instancesLength,a=e.classes,l=e.classIds,u=e.parentCounts,h=e.parentIds,c=o;if(MB(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,n=getBinaryAccessor(l),l=n.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,o)),MB(u))for(MB(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,n=getBinaryAccessor(u),u=n.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,o)),s=new Uint16Array(o),c=0,i=0;i<o;++i)s[i]=c,c+=u[i];MB(h)&&MB(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,n=getBinaryAccessor(h),h=n.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,c));let d=a.length;for(i=0;i<d;++i){let e=a[i].length,r=a[i].instances,n=getBinaryProperties(e,r,t);a[i].instances=combine(n,r)}let f=new Array(d).fill(0),p=new Uint16Array(o);for(i=0;i<o;++i)r=l[i],p[i]=f[r],++f[r];let g={classes:a,classIds:l,classIndexes:p,parentCounts:u,parentIndexes:s,parentIds:h};return function(e){let t=e.classIds.length;for(let i=0;i<t;++i)BB(e,i,stack)}(g),g}(r,i):null}function IB(e,t,i){if(!e)return;let r=e.parentCounts;return e.parentIds?i(e,t):r>0?function(e,t,i){let r=e.classIds,n=e.parentCounts,s=e.parentIds,o=e.parentIndexes,a=r.length,l=scratchVisited;l.length=Math.max(l.length,a);let u=++marker,h=scratchStack;for(h.length=0,h.push(t);h.length>0;){if(l[t=h.pop()]===u)continue;l[t]=u;let r=i(e,t);if(MB(r))return r;let a=n[t],c=o[t];for(let e=0;e<a;++e){let i=s[c+e];i!==t&&h.push(i)}}return null}(e,t,i):function(e,t,i){let r=!0;for(;r;){let n=i(e,t);if(MB(n))return n;let s=e.parentIds[t];r=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}(e,t,i)}function BB(e,t,i){let r=e.parentCounts,n=e.parentIds,s=e.parentIndexes,o=e.classIds.length;if(!MB(n))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===i.indexOf(t),"Circular dependency detected in the batch table hierarchy."),i.push(t);let a=MB(r)?r[t]:1,l=MB(r)?s[t]:t;for(let r=0;r<a;++r){let s=n[l+r];s!==t&&BB(e,s,i)}i.pop(t)}function LB(e){return null!=e}var OB=(e,t)=>e,FB={HIERARCHY:!0,extensions:!0,extras:!0},NB=class{constructor(e,t,i){var r;let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,F(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=(null===(r=this.json)||void 0===r?void 0:r.extensions)||{},this._properties={};for(let e in this.json)FB[e]||(this._properties[e]=this.json[e]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=RB(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){return this._checkBatchId(e),F("string"==typeof t,t),!!this._hierarchy&&LB(IB(this._hierarchy,e,((e,i)=>{let r=e.classIds[i];return e.classes[r].name===t})))}isExactClass(e,t){return F("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){let t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),F("string"==typeof t,t),LB(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=LB(t)?t:[]).length=0;let i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),F("string"==typeof t,t),this._binaryProperties){let i=this._binaryProperties[t];if(LB(i))return this._getBinaryProperty(i,e)}let i=this._properties[t];if(LB(i))return OB(i[e]);if(this._hierarchy){let i=this._getHierarchyProperty(e,t);if(LB(i))return i}}setProperty(e,t,i){let r=this.featureCount;if(this._checkBatchId(e),F("string"==typeof t,t),this._binaryProperties){let r=this._binaryProperties[t];if(r)return void this._setBinaryProperty(r,e,i)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let n=this._properties[t];LB(n)||(this._properties[t]=new Array(r),n=this._properties[t]),n[e]=OB(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(let t in this._properties){let i=this._properties[t],r=this._initializeBinaryProperty(t,i);r&&(e=e||{},e[t]=r)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){let i=t;F(this.binary,`Property ${e} requires a batch table binary.`),F(i.type,`Property ${e} requires a type.`);let r=function(e,t,i,r){let{componentType:n}=e;F(e.componentType);let s="string"==typeof n?yB.fromName(n):n,o=CB[e.type],a=SB[e.type],l=PB[e.type];return i+=e.byteOffset,{values:yB.createTypedArray(s,t,i,o*r),type:s,size:o,unpacker:a,packer:l}}(i,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;let i=IB(this._hierarchy,e,((e,i)=>{let r=e.classIds[i];return LB(e.classes[r].instances[t])}));return LB(i)}_getPropertyNamesInHierarchy(e,t){IB(this._hierarchy,e,((e,i)=>{let r=e.classIds[i],n=e.classes[r].instances;for(let e in n)n.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e)}))}_getHierarchyProperty(e,t){return IB(this._hierarchy,e,((e,i)=>{let r=e.classIds[i],n=e.classes[r],s=e.classIndexes[i],o=n.instances[t];return LB(o)?LB(o.typedArray)?this._getBinaryProperty(o,s):OB(o[s]):null}))}_setHierarchyProperty(e,t,i,r){let n=IB(this._hierarchy,t,((e,n)=>{let s=e.classIds[n],o=e.classes[s],a=e.classIndexes[n],l=o.instances[i];return!!LB(l)&&(F(n===t,`Inherited property "${i}" is read-only.`),LB(l.typedArray)?this._setBinaryProperty(l,a,r):l[a]=OB(r),!0)}));return LB(n)}};function DB(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new DataView(t);if(e.magic=r.getUint32(i,!0),i+=4,e.version=r.getUint32(i,!0),i+=4,e.byteLength=r.getUint32(i,!0),i+=4,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return i}var kB=4,UB="b3dm tile in legacy format.";function GB(e,t,i){let r,n=new DataView(t);e.header=e.header||{};let s=n.getUint32(i,!0);i+=kB;let o=n.getUint32(i,!0);i+=kB;let a=n.getUint32(i,!0);i+=kB;let l=n.getUint32(i,!0);return i+=kB,a>=570425344?(i-=2*kB,r=s,a=o,l=0,s=0,o=0,console.warn(UB)):l>=570425344&&(i-=kB,r=a,a=s,l=o,s=0,o=0,console.warn(UB)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=l,e.header.batchLength=r,i}function zB(e,t,i,r){return i=function(e,t,i,r){let{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},n&&n>0){let r=fB(t,i,n);e.featureTableJson=JSON.parse(r)}return i+=n||0,e.featureTableBinary=new Uint8Array(t,i,s),i+=s||0}(e,t,i),i=function(e,t,i,r){let{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=e.header||{};if(n&&n>0){let r=fB(t,i,n);e.batchTableJson=JSON.parse(r),i+=n,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,i,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=s)}return i}(e,t,i),i}function VB(e,t,i){if(!(t||e&&e.batchIds&&i))return null;let{batchIds:r,isRGB565:n,pointCount:s=0}=e;if(r&&i){let e=new Uint8ClampedArray(3*s);for(let t=0;t<s;t++){let n=r[t],s=i.getProperty(n,"dimensions").map((e=>255*e));e[3*t]=s[0],e[3*t+1]=s[1],e[3*t+2]=s[2]}return{type:gB.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(t&&n){let e=new Uint8ClampedArray(3*s);for(let i=0;i<s;i++){let r=bB(t[i]);e[3*i]=r[0],e[3*i+1]=r[1],e[3*i+2]=r[2]}return{type:gB.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*s?{type:gB.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:gB.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}var jB=new Rl;function HB(e,t,i){return e.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){let i=new Rl,r=new Float32Array(3*e.pointCount);for(let n=0;n<e.pointCount;n++)i.set(t[3*n],t[3*n+1],t[3*n+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(r,3*n);return r}(e,t)):{type:gB.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}async function WB(e,t,i,r,n){i=zB(e,t,i=GB(e,t,i=DB(e,t,i))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}(e);let{featureTable:s,batchTable:o}=function(e){let t=new TB(e.featureTableJson,e.featureTableBinary),i=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=i,e.featuresLength=i,e.pointsLength=i,e.pointCount=i,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",gB.FLOAT,3);let r=function(e,t){let i=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",gB.UNSIGNED_SHORT,1),e.batchIds)){let r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:n,batchTableBinary:s}=e;i=new NB(n,s,r)}return i}(e,t);return{featureTable:t,batchTable:r}}(e);return await async function(e,t,i,r,n){let s,o,a,l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);let u=t.getExtension("3DTILES_draco_point_compression");if(u){o=u.properties;let t=u.byteOffset,i=u.byteLength;if(!o||!Number.isFinite(t)||!i)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(e.featureTableBinary||[]).slice(t,t+i),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;let h={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(e,t,i,r){if(!r)return;let n={...i,draco:{...i?.draco,extraAttributes:t.batchTableProperties||{}}};delete n["3d-tiles"];let s=await O(t.buffer,xM,n,r),o=s.attributes.POSITION&&s.attributes.POSITION.value,a=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,l=s.attributes.NORMAL&&s.attributes.NORMAL.value,u=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,h=o&&s.attributes.POSITION.value.quantization,c=l&&s.attributes.NORMAL.value.quantization;if(h){let t=s.POSITION.data.quantization,i=t.range;e.quantizedVolumeScale=new Rl(i,i,i),e.quantizedVolumeOffset=new Rl(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}c&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);let d={};if(t.batchTableProperties)for(let e of Object.keys(t.batchTableProperties))s.attributes[e]&&s.attributes[e].value&&(d[e.toLowerCase()]=s.attributes[e].value);e.attributes={positions:o,colors:VB(e,a,void 0),normals:l,batchIds:u,...d}}(e,h,r,n)}(e,s,0,r,n),function(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",gB.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){let r=t.getPropertyArray("POSITION_QUANTIZED",gB.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",gB.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",gB.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=HB(e,r,i)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,s,r),function(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",gB.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",gB.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",gB.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=VB(e,r,i)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",gB.UNSIGNED_BYTE,4))}(e,s,o),function(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let i=null;t.hasProperty("NORMAL")?i=t.getPropertyArray("NORMAL",gB.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(i=t.getPropertyArray("NORMAL_OCT16P",gB.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){let i=new Float32Array(3*(e.pointsLength||0));for(let r=0;r<(e.pointsLength||0);r++)xB(t[2*r],t[2*r+1],jB),jB.toArray(i,3*r);return{type:gB.FLOAT,size:2,value:i}}return{type:gB.FLOAT,size:2,value:t}}(e,i)}}(e,s),i}var XB={URI:0,EMBEDDED:1};function qB(e,t,i,r){e.rotateYtoZ=!0;let n=(e.byteOffset||0)+(e.byteLength||0)-i;if(0===n)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=null!=r&&r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=de(t,i,n),e.gltfByteOffset=0,e.gltfByteLength=n,i%4==0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function KB(e,t,i,r){let n=i?.["3d-tiles"]||{};if(function(e,t,i){switch(t){case XB.URI:if(e.gltfArrayBuffer){let t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(t);e.gltfUrl=i.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case XB.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),n.loadGLTF){if(!r)return;if(e.gltfUrl){let{fetch:t}=r,n=await t(e.gltfUrl,i);e.gltfArrayBuffer=await n.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){let t=await O(e.gltfArrayBuffer,pR,i,r);e.gltf=TR(t),e.gpuMemoryUsageInBytes=XS(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}async function $B(e,t,i,r,n){var s;i=function(e,t,i,r,n){i=DB(e,t,i),i=GB(e,t,i),i=zB(e,t,i),i=qB(e,t,i,r);let s=new TB(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",gB.FLOAT,3),i}(e,t,i,r),await KB(e,XB.EMBEDDED,r,n);let o=null==e||null===(s=e.gltf)||void 0===s?void 0:s.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),i}async function JB(e,t,i,r,n){return i=function(e,t,i,r,n){var s;if(i=DB(e,t,i),1!==e.version)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);i=GB(e,t,i);let o=new DataView(t);if(e.gltfFormat=o.getUint32(i,!0),i=zB(e,t,i+=4),i=qB(e,t,i,r),null==e||null===(s=e.header)||void 0===s||!s.featureTableJsonByteLength||0===e.header.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");let a=new TB(e.featureTableJson,e.featureTableBinary),l=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return e.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=a.getGlobalProperty("RTC_CENTER",gB.FLOAT,3),new NB(e.batchTableJson,e.batchTableBinary,l),function(e,t,i,r){let n=new Array(r),s=new Rl;new Rl,new Rl,new Rl;let o=new Dl,a=new Jh,l=new Rl,u={},h=new Oh,c=[],d=[],f=[],p=[];for(let i=0;i<r;i++){let r;if(t.hasProperty("POSITION"))r=t.getProperty("POSITION",gB.FLOAT,3,i,s);else if(t.hasProperty("POSITION_QUANTIZED")){r=t.getProperty("POSITION_QUANTIZED",gB.UNSIGNED_SHORT,3,i,s);let e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",gB.FLOAT,3);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let n=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",gB.FLOAT,3);if(!n)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let o=65535;for(let t=0;t<3;t++)r[t]=r[t]/o*n[t]+e[t]}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(r),u.translation=s,e.normalUp=t.getProperty("NORMAL_UP",gB.FLOAT,3,i,c),e.normalRight=t.getProperty("NORMAL_RIGHT",gB.FLOAT,3,i,d),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",gB.UNSIGNED_SHORT,2,i,c),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",gB.UNSIGNED_SHORT,2,i,d),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(eI.WGS84.eastNorthUpToFixedFrame(s,h),h.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),u.rotation=a,l.set(1,1,1);let g=t.getProperty("SCALE",gB.FLOAT,1,i,f);Number.isFinite(g)&&l.multiplyByScalar(g);let m=t.getProperty("SCALE_NON_UNIFORM",gB.FLOAT,3,i,c);m&&l.scale(m),u.scale=l;let _=t.getProperty("BATCH_ID",gB.UNSIGNED_SHORT,1,i,p);void 0===_&&(_=i);let v=(new Oh).fromQuaternion(u.rotation);h.identity(),h.translate(u.translation),h.multiplyRight(v),h.scale(u.scale);let y=h.clone();n[i]={modelMatrix:y,batchId:_}}e.instances=n}(e,a,0,l),i}(e,t,i,r),await KB(e,e.gltfFormat||0,r,n),i}async function YB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{shape:"tile3d"};switch(n.byteOffset=t,n.type=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new DataView(e);return`${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}(e,t),n.type){case dB.COMPOSITE:return await async function(e,t,i,r,n,s){i=DB(e,t,i);let o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-i>12;){let o={shape:"tile3d"};e.tiles.push(o),i=await s(t,i,r,n,o)}return i}(n,e,t,i,r,YB);case dB.BATCHED_3D_MODEL:return await $B(n,e,t,i,r);case dB.GLTF:return await async function(e,t,i,r){var n,s;if(e.rotateYtoZ=!0,e.gltfUpAxis=null!=i&&null!==(n=i["3d-tiles"])&&void 0!==n&&n.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",null!=i&&null!==(s=i["3d-tiles"])&&void 0!==s&&s.loadGLTF){if(!r)return t.byteLength;let n=await O(t,pR,i,r);e.gltf=TR(n),e.gpuMemoryUsageInBytes=XS(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}(n,e,i,r);case dB.INSTANCED_3D_MODEL:return await JB(n,e,t,i,r);case dB.POINT_CLOUD:return await WB(n,e,t,i,r);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}async function ZB(e,t,i,r){let n=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if("number"!=typeof n)return;let s=e.bufferViews[n],o=e.buffers[s.buffer];if(null==r||!r.baseUrl)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){let e=`${r?.baseUrl||""}/${o.uri}`,i=await(await r.fetch(e)).arrayBuffer();return void(t.explicitBitstream=new Uint8Array(i,s.byteOffset,s.byteLength))}let a=e.buffers.slice(0,s.buffer).reduce(((e,t)=>e+t.byteLength),0);t.explicitBitstream=new Uint8Array(i.slice(a,a+o.byteLength),s.byteOffset,s.byteLength)}function QB(e){let t=new DataView(e);return t.getUint32(0,!0)+2**32*t.getUint32(4,!0)}var eL={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:cB,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(e,t,i){if(1952609651!==new Uint32Array(e.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(e.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");let r=QB(e.slice(8,16)),n=new Uint8Array(e,24,r),s=new TextDecoder("utf8").decode(n),o=JSON.parse(s),a=QB(e.slice(16,24)),l=new ArrayBuffer(0);if(a&&(l=e.slice(24+r)),await ZB(o,o.tileAvailability,l,i),Array.isArray(o.contentAvailability))for(let e of o.contentAvailability)await ZB(o,e,l,i);else await ZB(o,o.contentAvailability,l,i);return await ZB(o,o.childSubtreeAvailability,l,i),o},options:{}},tL=null;try{tL=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function iL(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function rL(e){return!0===(e&&e.__isLong__)}function nL(e){var t=Math.clz32(e&-e);return e?31-t:t}iL.prototype.__isLong__,Object.defineProperty(iL.prototype,"__isLong__",{value:!0}),iL.isLong=rL;var sL={},oL={};function aL(e,t){var i,r,n;return t?(n=0<=(e>>>=0)&&e<256)&&(r=oL[e])?r:(i=uL(e,0,!0),n&&(oL[e]=i),i):(n=-128<=(e|=0)&&e<128)&&(r=sL[e])?r:(i=uL(e,e<0?-1:0,!1),n&&(sL[e]=i),i)}function lL(e,t){if(isNaN(e))return t?vL:_L;if(t){if(e<0)return vL;if(e>=pL)return wL}else{if(e<=-gL)return xL;if(e+1>=gL)return EL}return e<0?lL(-e,t).neg():uL(e%fL|0,e/fL|0,t)}function uL(e,t,i){return new iL(e,t,i)}iL.fromInt=aL,iL.fromNumber=lL,iL.fromBits=uL;var hL=Math.pow;function cL(e,t,i){if(0===e.length)throw Error("empty string");if("number"==typeof t?(i=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?vL:_L;if((i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return cL(e.substring(1),t,i).neg();for(var n=lL(hL(i,8)),s=_L,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),l=parseInt(e.substring(o,o+a),i);if(a<8){var u=lL(hL(i,a));s=s.mul(u).add(lL(l))}else s=(s=s.mul(n)).add(lL(l))}return s.unsigned=t,s}function dL(e,t){return"number"==typeof e?lL(e,t):"string"==typeof e?cL(e,t):uL(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}iL.fromString=cL,iL.fromValue=dL;var fL=4294967296,pL=fL*fL,gL=pL/2,mL=aL(1<<24),_L=aL(0);iL.ZERO=_L;var vL=aL(0,!0);iL.UZERO=vL;var yL=aL(1);iL.ONE=yL;var bL=aL(1,!0);iL.UONE=bL;var AL=aL(-1);iL.NEG_ONE=AL;var EL=uL(-1,2147483647,!1);iL.MAX_VALUE=EL;var wL=uL(-1,-1,!0);iL.MAX_UNSIGNED_VALUE=wL;var xL=uL(0,-2147483648,!1);iL.MIN_VALUE=xL;var TL=iL.prototype;TL.toInt=function(){return this.unsigned?this.low>>>0:this.low},TL.toNumber=function(){return this.unsigned?(this.high>>>0)*fL+(this.low>>>0):this.high*fL+(this.low>>>0)},TL.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(xL)){var t=lL(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=lL(hL(e,6),this.unsigned),s=this,o="";;){var a=s.div(n),l=(s.sub(a.mul(n)).toInt()>>>0).toString(e);if((s=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},TL.getHighBits=function(){return this.high},TL.getHighBitsUnsigned=function(){return this.high>>>0},TL.getLowBits=function(){return this.low},TL.getLowBitsUnsigned=function(){return this.low>>>0},TL.getNumBitsAbs=function(){if(this.isNegative())return this.eq(xL)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},TL.isZero=function(){return 0===this.high&&0===this.low},TL.eqz=TL.isZero,TL.isNegative=function(){return!this.unsigned&&this.high<0},TL.isPositive=function(){return this.unsigned||this.high>=0},TL.isOdd=function(){return 1==(1&this.low)},TL.isEven=function(){return 0==(1&this.low)},TL.equals=function(e){return rL(e)||(e=dL(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},TL.eq=TL.equals,TL.notEquals=function(e){return!this.eq(e)},TL.neq=TL.notEquals,TL.ne=TL.notEquals,TL.lessThan=function(e){return this.comp(e)<0},TL.lt=TL.lessThan,TL.lessThanOrEqual=function(e){return this.comp(e)<=0},TL.lte=TL.lessThanOrEqual,TL.le=TL.lessThanOrEqual,TL.greaterThan=function(e){return this.comp(e)>0},TL.gt=TL.greaterThan,TL.greaterThanOrEqual=function(e){return this.comp(e)>=0},TL.gte=TL.greaterThanOrEqual,TL.ge=TL.greaterThanOrEqual,TL.compare=function(e){if(rL(e)||(e=dL(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},TL.comp=TL.compare,TL.negate=function(){return!this.unsigned&&this.eq(xL)?xL:this.not().add(yL)},TL.neg=TL.negate,TL.add=function(e){rL(e)||(e=dL(e));var t=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,s=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=0,u=0,h=0,c=0;return h+=(c+=n+(65535&e.low))>>>16,u+=(h+=r+a)>>>16,l+=(u+=i+o)>>>16,l+=t+s,uL((h&=65535)<<16|(c&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},TL.subtract=function(e){return rL(e)||(e=dL(e)),this.add(e.neg())},TL.sub=TL.subtract,TL.multiply=function(e){if(this.isZero())return this;if(rL(e)||(e=dL(e)),tL)return uL(tL.mul(this.low,this.high,e.low,e.high),tL.get_high(),this.unsigned);if(e.isZero())return this.unsigned?vL:_L;if(this.eq(xL))return e.isOdd()?xL:_L;if(e.eq(xL))return this.isOdd()?xL:_L;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(mL)&&e.lt(mL))return lL(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,s=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=65535&e.low,u=0,h=0,c=0,d=0;return c+=(d+=n*l)>>>16,h+=(c+=r*l)>>>16,c&=65535,h+=(c+=n*a)>>>16,u+=(h+=i*l)>>>16,h&=65535,u+=(h+=r*a)>>>16,h&=65535,u+=(h+=n*o)>>>16,u+=t*l+i*a+r*o+n*s,uL((c&=65535)<<16|(d&=65535),(u&=65535)<<16|(h&=65535),this.unsigned)},TL.mul=TL.multiply,TL.divide=function(e){if(rL(e)||(e=dL(e)),e.isZero())throw Error("division by zero");var t,i,r;if(tL)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?uL((this.unsigned?tL.div_u:tL.div_s)(this.low,this.high,e.low,e.high),tL.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?vL:_L;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return vL;if(e.gt(this.shru(1)))return bL;r=vL}else{if(this.eq(xL))return e.eq(yL)||e.eq(AL)?xL:e.eq(xL)?yL:(t=this.shr(1).div(e).shl(1)).eq(_L)?e.isNegative()?yL:AL:(i=this.sub(e.mul(t)),r=t.add(i.div(e)));if(e.eq(xL))return this.unsigned?vL:_L;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=_L}for(i=this;i.gte(e);){t=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var n=Math.ceil(Math.log(t)/Math.LN2),s=n<=48?1:hL(2,n-48),o=lL(t),a=o.mul(e);a.isNegative()||a.gt(i);)a=(o=lL(t-=s,this.unsigned)).mul(e);o.isZero()&&(o=yL),r=r.add(o),i=i.sub(a)}return r},TL.div=TL.divide,TL.modulo=function(e){return rL(e)||(e=dL(e)),tL?uL((this.unsigned?tL.rem_u:tL.rem_s)(this.low,this.high,e.low,e.high),tL.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},TL.mod=TL.modulo,TL.rem=TL.modulo,TL.not=function(){return uL(~this.low,~this.high,this.unsigned)},TL.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},TL.clz=TL.countLeadingZeros,TL.countTrailingZeros=function(){return this.low?nL(this.low):nL(this.high)+32},TL.ctz=TL.countTrailingZeros,TL.and=function(e){return rL(e)||(e=dL(e)),uL(this.low&e.low,this.high&e.high,this.unsigned)},TL.or=function(e){return rL(e)||(e=dL(e)),uL(this.low|e.low,this.high|e.high,this.unsigned)},TL.xor=function(e){return rL(e)||(e=dL(e)),uL(this.low^e.low,this.high^e.high,this.unsigned)},TL.shiftLeft=function(e){return rL(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?uL(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):uL(0,this.low<<e-32,this.unsigned)},TL.shl=TL.shiftLeft,TL.shiftRight=function(e){return rL(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?uL(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):uL(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},TL.shr=TL.shiftRight,TL.shiftRightUnsigned=function(e){return rL(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?uL(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):uL(32===e?this.high:this.high>>>e-32,0,this.unsigned)},TL.shru=TL.shiftRightUnsigned,TL.shr_u=TL.shiftRightUnsigned,TL.rotateLeft=function(e){var t;return rL(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?uL(this.high,this.low,this.unsigned):e<32?(t=32-e,uL(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(t=32-(e-=32),uL(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},TL.rotl=TL.rotateLeft,TL.rotateRight=function(e){var t;return rL(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?uL(this.high,this.low,this.unsigned):e<32?(t=32-e,uL(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(t=32-(e-=32),uL(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},TL.rotr=TL.rotateRight,TL.toSigned=function(){return this.unsigned?uL(this.low,this.high,!1):this},TL.toUnsigned=function(){return this.unsigned?this:uL(this.low,this.high,!0)},TL.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},TL.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},TL.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},iL.fromBytes=function(e,t,i){return i?iL.fromBytesLE(e,t):iL.fromBytesBE(e,t)},iL.fromBytesLE=function(e,t){return new iL(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},iL.fromBytesBE=function(e,t){return new iL(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var CL=iL,SL=16;function PL(e){"X"===e&&(e="");let t=e.padEnd(SL,"0");return CL.fromString(t,!0,16)}var ML=3,RL=61,IL=180/Math.PI;function BL(e,t,i){let r=1<<t;return[(e[0]+i[0])/r,(e[1]+i[1])/r]}function LL(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function OL(e){return[LL(e[0]),LL(e[1])]}function FL(e,t){let[i,r]=t;switch(e){case 0:return[1,i,r];case 1:return[-i,1,r];case 2:return[-i,-r,1];case 3:return[-1,-r,-i];case 4:return[r,-1,-i];case 5:return[r,i,-1];default:throw new Error("Invalid face")}}function NL(e){let[t,i,r]=e,n=Math.atan2(r,Math.sqrt(t*t+i*i));return[Math.atan2(i,t)*IL,n*IL]}function DL(e,t,i,r){if(0===r){1===i&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let r=t[0];t[0]=t[1],t[1]=r}}var kL=100;function UL(e){let{face:t,ij:i,level:r}=e,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(kL*Math.pow(2,-r))),o=new Float64Array(4*s*2+2),a=0,l=0;for(let e=0;e<4;e++){let u=n[e].slice(0),h=n[e+1],c=(h[0]-u[0])/s,d=(h[1]-u[1])/s;for(let e=0;e<s;e++){u[0]+=c,u[1]+=d;let e=NL(FL(t,OL(BL(i,r,u))));Math.abs(e[1])>89.999&&(e[0]=l);let n=e[0]-l;e[0]+=n>180?-360:n<-180?360:0,o[a++]=e[0],o[a++]=e[1],l=e[0]}}return o[a++]=o[0],o[a++]=o[1],o}function zL(e){let t=function(e){if(e.indexOf("/")>0)return e;let t=PL(e);return function(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<ML+RL;)t="0"+t;let i=t.lastIndexOf("1"),r=t.substring(0,3),n=t.substring(3,i),s=n.length/2,o=CL.fromString(r,!0,2).toString(10),a="";if(0!==s)for(a=CL.fromString(n,!0,2).toString(4);a.length<s;)a="0"+a;return`${o}/${a}`}(t)}(e);return function(e){if(0===e.length)throw new Error(`Invalid Hilbert quad key ${e}`);let t=e.split("/"),i=parseInt(t[0],10),r=t[1],n=r.length,s=0,o=[0,0];for(let e=n-1;e>=0;e--){s=n-e;let t=r[e],i=0,a=0;"1"===t?a=1:"2"===t?(i=1,a=1):"3"===t&&(i=1);let l=Math.pow(2,s-1);DL(l,o,i,a),o[0]+=l*i,o[1]+=l*a}if(i%2==1){let e=o[0];o[0]=o[1],o[1]=e}return{face:i,ij:o,level:s}}(t)}function VL(e){return function(e){let t=OL(BL(e.ij,e.level,[.5,.5]));return NL(FL(e.face,t))}(zL(e))}function jL(e){if(e.length%2!=0)throw new Error("Invalid corners");let t=[],i=[];for(let r=0;r<e.length;r+=2)t.push(e[r]),i.push(e[r+1]);return t.sort(((e,t)=>e-t)),i.sort(((e,t)=>e-t)),{west:t[0],east:t[t.length-1],north:i[i.length-1],south:i[0]}}function HL(e,t){let i=t?.minimumHeight||0,r=t?.maximumHeight||0,n=function(e){let t;if(2===e.face||5===e.face){let i=null,r=0;for(let t=0;t<4;t++){let n=UL(zL(`${e.face}/${t}`));(typeof i>"u"||null===i)&&(i=new Float64Array(4*n.length)),i.set(n,r),r+=n.length}t=jL(i)}else t=jL(UL(e));return t}(zL(e)),s=n.west,o=n.south,a=n.east,l=n.north,u=[];return u.push(new Rl(s,l,i)),u.push(new Rl(a,l,i)),u.push(new Rl(a,o,i)),u.push(new Rl(s,o,i)),u.push(new Rl(s,l,r)),u.push(new Rl(a,l,r)),u.push(new Rl(a,o,r)),u.push(new Rl(s,o,r)),u}function WL(e){let t=e.token,i={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},r=HL(t,i),n=VL(t),s=n[0],o=n[1],a=eI.WGS84.cartographicToCartesian([s,o,i.maximumHeight]),l=new Rl(a[0],a[1],a[2]);r.push(l);let u=kT(r);return[...u.center,...u.halfAxes]}var XL={QUADTREE:4,OCTREE:8};function qL(e,t,i){if(null!=e&&e.box){let r=function(e,t){let i=function(e){return e.and(e.not().add(1))}(e).shiftRightUnsigned(2);return e.add(CL.fromNumber(2*t+1-4).multiply(i))}(PL(e.s2VolumeInfo.token),t),n=function(e){if(e.isZero())return"X";let t=e.countTrailingZeros();t=(t-t%4)/4;let i=t;t*=4;let r=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-i-r.length).join("0")+r}(r),s={...e.s2VolumeInfo};if("OCTREE"===(s.token=n,i)){let t=e.s2VolumeInfo,i=t.maximumHeight-t.minimumHeight,r=i/2,n=t.minimumHeight+i/2;t.minimumHeight=n-r,t.maximumHeight=n+r}return{box:WL(s),s2VolumeInfo:s}}}async function KL(e){let{implicitOptions:t,parentData:i={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,s2VolumeBox:n,loaderOptions:s}=e,{subtree:o,level:a=0,globalData:l={level:0,mortonIndex:0,x:0,y:0,z:0}}=e,{subdivisionScheme:u,subtreeLevels:h,maximumLevel:c,contentUrlTemplate:d,subtreesUriTemplate:f,basePath:p}=t,g={children:[],lodMetricValue:0,contentUrl:""};if(!c)return vt.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${d} won't be loaded...`),g;let m=a+l.level;if(m>c)return g;let _=XL[u],v=Math.log2(_),y=1&r,b=r>>1&1,A=r>>2&1,E=(_**a-1)/(_-1),w=YL(i.mortonIndex,r,v),x=E+w,T=YL(i.x,y,1),C=YL(i.y,b,1),S=YL(i.z,A,1),P=!1;a>=h&&(P=$L(o.childSubtreeAvailability,w));let M=YL(l.x,T,a),R=YL(l.y,C,a),I=YL(l.z,S,a);if(P){let e=ZL(`${p}/${f}`,m,M,R,I);o=await Zt(e,eL,s),l={mortonIndex:w,x:T,y:C,z:S,level:a},w=0,x=0,T=0,C=0,S=0,a=0}if(!$L(o.tileAvailability,x))return g;$L(o.contentAvailability,x)&&(g.contentUrl=ZL(d,m,M,R,I));let B=a+1,L={mortonIndex:w,x:T,y:C,z:S};for(let e=0;e<_;e++){let i=qL(n,e,u),r=await KL({subtree:o,implicitOptions:t,loaderOptions:s,parentData:L,childIndex:e,level:B,globalData:{...l},s2VolumeBox:i});if(r.contentUrl||r.children.length){let e=JL(r,m+1,{childTileX:T,childTileY:C,childTileZ:S},t,n);g.children.push(e)}}return g}function $L(e,t){let i;return Array.isArray(e)?(i=e[0],e.length>1&&vt.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=e,"constant"in i?Boolean(i.constant):!!i.explicitBitstream&&function(e,t){let i=Math.floor(e/8),r=e%8;return 1==(t[i]>>r&1)}(t,i.explicitBitstream)}function JL(e,t,i,r,n){let{basePath:s,refine:o,getRefine:a,lodMetricType:l,getTileType:u,rootLodMetricValue:h,rootBoundingVolume:c}=r,d=e.contentUrl&&e.contentUrl.replace(`${s}/`,""),f=h/2**t,p=function(e,t,i){if(t.region){let{childTileX:r,childTileY:n,childTileZ:s}=i,[o,a,l,u,h,c]=t.region,d=2**e,f=(l-o)/d,p=(u-a)/d,g=(c-h)/d,[m,_]=[o+f*r,o+f*(r+1)],[v,y]=[a+p*n,a+p*(n+1)],[b,A]=[h+g*s,h+g*(s+1)];return{region:[m,v,_,y,b,A]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${t}`)}(t,null!=n&&n.box?{box:n.box}:c,i);return{children:e.children,contentUrl:e.contentUrl,content:{uri:d},id:e.contentUrl,refine:a(o),type:u(e),lodMetricType:l,lodMetricValue:f,geometricError:f,transform:e.transform,boundingVolume:p}}function YL(e,t,i){return(e<<i)+t}function ZL(e,t,i,r,n){let s=function(e){let t={};for(let i in e)t[`{${i}}`]=e[i];return t}({level:t,x:i,y:r,z:n});return e.replace(/{level}|{x}|{y}|{z}/gi,(e=>s[e]))}function QL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)return _I.EMPTY;let i=t.split("?")[0].split(".").pop();switch(i){case"pnts":return _I.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return _I.SCENEGRAPH;default:return i||_I.EMPTY}}function eO(e){switch(e){case"REPLACE":case"replace":return mI.REPLACE;case"ADD":case"add":return mI.ADD;default:return e}}function tO(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){let i=new URL(e,`${t}/`);return decodeURI(i.toString())}return e.startsWith("/")?e:we.resolve(t,e)}function iO(e,t){if(!e)return null;let i;if(e.content){var r;let n=e.content.uri||(null===(r=e.content)||void 0===r?void 0:r.url);typeof n<"u"&&(i=tO(n,t))}return{...e,id:i,contentUrl:i,lodMetricType:yI.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:QL(e,i),refine:eO(e.refine)}}async function rO(e,t,i,r,n){var s,o,a;let{subdivisionScheme:l,maximumLevel:u,availableLevels:h,subtreeLevels:c,subtrees:{uri:d}}=r,f=tO(ZL(d,0,0,0,0),i),p=await Zt(f,eL,n),g=null===(s=e.content)||void 0===s?void 0:s.uri,m=g?tO(g,i):"",_=null==t||null===(o=t.root)||void 0===o?void 0:o.refine,v=e.geometricError,y=null===(a=e.boundingVolume.extensions)||void 0===a?void 0:a["3DTILES_bounding_volume_S2"];if(y){let t={box:WL(y),s2VolumeInfo:y};e.boundingVolume=t}let b=e.boundingVolume,A={contentUrlTemplate:m,subtreesUriTemplate:d,subdivisionScheme:l,subtreeLevels:c,maximumLevel:Number.isFinite(h)?h-1:u,refine:_,basePath:i,lodMetricType:yI.GEOMETRIC_ERROR,rootLodMetricValue:v,rootBoundingVolume:b,getTileType:QL,getRefine:eO};return await async function(e,t,i,r,n){if(!e)return null;let s,{children:o,contentUrl:a}=await KL({subtree:i,implicitOptions:r,loaderOptions:n}),l=null;return a&&(s=a,l={uri:a.replace(`${t}/`,"")}),{...e,id:s,contentUrl:s,lodMetricType:yI.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:QL(e,s),refine:eO(e.refine),content:l||e.content,children:o}}(e,i,p,A,n)}function nO(e){var t;return(null==e||null===(t=e.extensions)||void 0===t?void 0:t["3DTILES_implicit_tiling"])||e?.implicitTiling}var sO={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:cB,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=i["3d-tiles"]||{};return t="auto"===n.isTileset?r?.url&&-1!==r.url.indexOf(".json"):n.isTileset,t?async function(e,t,i){var r;let n=JSON.parse((new TextDecoder).decode(e)),s=i?.url||"",o=function(e){return we.dirname(e)}(s),a=await async function(e,t,i){let r=null,n=nO(e.root);r=n&&e.root?await rO(e.root,e,t,n,i):iO(e.root,t);let s=[];for(s.push(r);s.length>0;){let r=s.pop()||{},n=r.children||[],o=[];for(let r of n){let n,a=nO(r);n=a?await rO(r,e,t,a,i):iO(r,t),n&&(o.push(n),s.push(n))}r.children=o}return r}(n,o,t||{});return{...n,shape:"tileset3d",loader:sO,url:s,queryString:i?.queryString||"",basePath:o,root:a||n.root,type:vI.TILES3D,lodMetricType:yI.GEOMETRIC_ERROR,lodMetricValue:(null===(r=n.root)||void 0===r?void 0:r.geometricError)||0}}(e,i,r):async function(e,t,i){let r={content:{shape:"tile3d",featureIds:null}};return await YB(e,0,t,i,r.content),r.content}(e,i,r)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},oO=[0],aO={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:sO,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,i)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}},lO=class extends db{initializeState(){"onTileLoadFail"in this.props&&wi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return Boolean(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:i}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),i.viewportChanged){let{activeViewports:e}=this.state;Object.keys(e).length&&(this._updateTileset(e),this.state.lastUpdatedViewports=e,this.state.activeViewports={})}if(i.propsChanged){let{layerMap:e}=this.state;for(let t in e)e[t].needsUpdate=!0}}activateViewport(e){let{activeViewports:t,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,t[e.id]=e;let r=i?.[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){let i=t&&t.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:t}){let{tile:i}=e.props,{id:r}=t;return i.selected&&i.viewportIds.includes(r)}_updateAutoHighlight(e){let t=e.sourceTile,i=this.state.layerMap[t?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){let{loadOptions:t={}}=this.props,i=this.props.loader||this.props.loaders,r=Array.isArray(i)?i[0]:i,n={loadOptions:{...t}},s=e;if(r.preload){let i=await r.preload(e,t);i.url&&(s=i.url),i.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:i.headers}),Object.assign(n,i)}let o=await Zt(s,r,n.loadOptions),a=new class{constructor(e,t){this.options=void 0,this.loadOptions=void 0,this.type=void 0,this.tileset=void 0,this.loader=void 0,this.url=void 0,this.basePath=void 0,this.modelMatrix=void 0,this.ellipsoid=void 0,this.lodMetricType=void 0,this.lodMetricValue=void 0,this.refine=void 0,this.root=null,this.roots={},this.asset={},this.description="",this.properties=void 0,this.extras=null,this.attributions={},this.credits={},this.stats=void 0,this.contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.dynamicScreenSpaceErrorComputedDensity=0,this.maximumMemoryUsage=32,this.gpuMemoryUsageInBytes=0,this.memoryAdjustedScreenSpaceError=0,this._cacheBytes=0,this._cacheOverflowBytes=0,this._frameNumber=0,this._queryParams={},this._extensionsUsed=[],this._tiles={},this._pendingCount=0,this.selectedTiles=[],this.traverseCounter=0,this.geometricError=0,this.lastUpdatedVieports=null,this._requestedTiles=[],this._emptyTiles=[],this.frameStateData={},this._traverser=void 0,this._cache=new class{constructor(){this._list=void 0,this._sentinel=void 0,this._trimTiles=void 0,this._list=new class{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(e){let t=new class{constructor(e,t,i){this.item=void 0,this.previous=void 0,this.next=void 0,this.item=e,this.previous=t,this.next=i}}(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){let i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length}},this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){let t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,i){t._cacheNode||(t._cacheNode=this._list.add(t),i&&i(e,t))}unloadTile(e,t,i){let r=t._cacheNode;r&&(this._list.remove(r),t._cacheNode=null,i&&i(e,t))}unloadTiles(e,t){let i=this._trimTiles;this._trimTiles=!1;let r=this._list,n=1024*e.maximumMemoryUsage*1024,s=this._sentinel,o=r.head;for(;o!==s&&(e.gpuMemoryUsageInBytes>n||i);){let i=o.item;o=o.next,this.unloadTile(e,i,t)}}trim(){this._trimTiles=!0}},this._requestScheduler=void 0,this.updatePromise=null,this.tilesetInitializationPromise=void 0,this.options={...QI,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||we.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new ye({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1024*this.options.maximumMemoryUsage*1024,this._cacheOverflowBytes=1024*this.options.memoryCacheOverflow*1024,this.stats=new _e({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let t=e;return this.queryParams.length&&(t=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),t}hasExtension(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tilesetInitializationPromise.then((()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)}))}async selectTiles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise((e=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;let i=[];for(let e of t){let t=e.id;this._needTraverse(t)?i.push(t):this.traverseCounter--}for(let e of t){let t=e.id;if(this.roots[t]||(this.roots[t]=this._initializeTileHeaders(this.tileset,null)),!i.includes(t))continue;let r=nI(e,this._frameNumber);this._traverser.traverse(this.roots[t],r,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){let t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let i=this.frameStateData[t],r=Object.values(this._traverser.selectedTiles),[n,s]=function(e,t,i){if(0===i||e.length<=i)return[e,[]];let r=[],{longitude:n,latitude:s}=t.viewport;for(let[t,i]of e.entries()){let[e,o]=i.header.mbs,a=Math.abs(n-e),l=Math.abs(s-o),u=Math.sqrt(l*l+a*a);r.push([t,u])}let o=r.sort(((e,t)=>e[1]-t[1])),a=[];for(let t=0;t<i;t++)a.push(e[o[t][0]]);let l=[];for(let t=i;t<o.length;t++)l.push(e[o[t][0]]);return[a,l]}(r,e,this.options.maximumTilesSelected);i.selectedTiles=n;for(let e of s)e.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(let e in this.frameStateData){let t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(let e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;let i=new Set(e.map((e=>e.id))),r=new Set(t.map((e=>e.id))),n=e.filter((e=>!r.has(e.id))).length>0;return n=n||t.filter((e=>!i.has(e.id))).length>0,n}_loadTiles(){for(let e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)))}_updateStats(){let e=0,t=0;for(let i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?t+=i.content.pointCount:t+=i.content.vertexCount);this.stats.get(iB).count=this.selectedTiles.length,this.stats.get(rB).count=e,this.stats.get(lB).count=t,this.stats.get(hB).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===vI.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===vI.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===vI.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;let t=this.tileset.fullExtent;if(t){let{xmin:e,xmax:i,ymin:r,ymax:n,zmin:s,zmax:o}=t;return this.cartographicCenter=new Rl(e+(i-e)/2,r+(n-r)/2,s+(o-s)/2),this.cartesianCenter=new Rl,eI.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=hI(t,this.cartographicCenter,this.cartesianCenter))}let i=null===(e=this.tileset.store)||void 0===e?void 0:e.extent;if(i){let[e,t,r,n]=i;return this.cartographicCenter=new Rl(e+(r-e)/2,t+(n-t)/2,0),this.cartesianCenter=new Rl,eI.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=function(e,t,i){let[r,n,s,o]=e;return hI({xmin:r,xmax:s,ymin:n,ymax:o,zmin:0,zmax:0},t,i)}(i,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Rl,this.zoom=1}calculateViewPropsTiles3D(){let e=this.root,{center:t}=e.boundingVolume;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Rl,void(this.zoom=1);0!==t[0]||0!==t[1]||0!==t[2]?(this.cartographicCenter=new Rl,eI.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new Rl(0,0,-eI.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=uI(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(eB),this.stats.get(sB),this.stats.get(tB),this.stats.get(iB),this.stats.get(rB),this.stats.get(nB),this.stats.get(oB),this.stats.get(aB),this.stats.get(lB),this.stats.get(uB,"memory"),this.stats.get(hB)}_initializeTileHeaders(e,t){let i=new qI(this,e.root,t);if(t&&(t.children.push(i),i.depth=t.depth+1),this.type===vI.TILES3D){let e=[];for(e.push(i);e.length>0;){let t=e.pop();this.stats.get(eB).incrementCount();let i=t.header.children||[];for(let n of i){var r;let i=new qI(this,n,t);if(null!==(r=i.contentUrl)&&void 0!==r&&r.includes("?session=")){let e=new URL(i.contentUrl).searchParams.get("session");e&&(this._queryParams.session=e)}t.children.push(i),i.depth=t.depth+1,e.push(i)}}}return i}_initializeTraverser(){let e;switch(this.type){case vI.TILES3D:e=KI;break;case vI.I3S:e=ZI;break;default:e=WI}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(t){this._onTileLoadError(e,t instanceof Error?t:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(aB).incrementCount();let i=t.message||t.toString(),r=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,r)}_onTileLoad(e,t){if(t){if(this.type===vI.I3S){var i,r;let e=(null===(i=this.tileset)||void 0===i||null===(r=i.nodePagesTile)||void 0===r?void 0:r.nodesInNodePages)||0;this.stats.get(eB).reset(),this.stats.get(eB).addCount(e)}e&&e.content&&function(e,t){F(e),F(t);let{rtcCenter:i,gltfUpAxis:r}=t,{computedTransform:n,boundingVolume:{center:s}}=e,o=new Oh(n);switch(i&&o.translate(i),r){case"Z":break;case"Y":let e=(new Oh).rotateX(Math.PI/2);o=o.multiplyRight(e);break;case"X":let t=(new Oh).rotateY(-Math.PI/2);o=o.multiplyRight(t)}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);let a=new Rl(s);t.cartesianModelMatrix=o,t.cartesianOrigin=a;let l=eI.WGS84.cartesianToCartographic(a,new Rl),u=eI.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=u.multiplyRight(o),t.cartographicOrigin=l,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===vI.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===vI.TILES3D){var t;let{extensionsRemoved:i=[]}=(null===(t=e.content)||void 0===t?void 0:t.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(sB).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(sB).decrementCount()}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)))}_updateCacheStats(e){this.stats.get(nB).incrementCount(),this.stats.get(tB).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(uB).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(tB).decrementCount(),this.stats.get(oB).incrementCount(),this.stats.get(uB).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){let e=[];for(this.root&&e.push(this.root);e.length>0;){let t=e.pop();for(let i of t.children)e.push(i);this._destroyTile(t)}this.root=null}_destroySubtree(e){let t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(let t of e.children)i.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){let t=new URLSearchParams(e.queryString),i=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){let{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;let{tileset3d:t}=this.state,{timeline:i}=this.context,r=Object.keys(e).length;!i||!r||!t||t.selectTiles(Object.values(e)).then((e=>{this.state.frameNumber!==e&&this.setState({frameNumber:e})}))}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case _I.POINTCLOUD:return this._makePointCloudLayer(e,t);case _I.SCENEGRAPH:return this._make3DModelLayer(e);case _I.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){let{attributes:i,pointCount:r,constantRGBA:n,cartographicOrigin:s,modelMatrix:o}=e.content,{positions:a,normals:l,colors:u}=i;if(!a)return null;let h=t&&t.props.data||{header:{vertexCount:r},attributes:{POSITION:a,NORMAL:l,COLOR_0:u}},{pointSize:c,getPointColor:d}=this.props;return new(this.getSubLayerClass("pointcloud",SA))({pointSize:c},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:h,coordinateSystem:Nc.METER_OFFSETS,coordinateOrigin:s,modelMatrix:o,getColor:n||d,_offset:0})}_make3DModelLayer(e){let{gltf:t,instances:i,cartographicOrigin:r,modelMatrix:n}=e.content;return new(this.getSubLayerClass("scenegraph",RR))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||oO,scenegraph:t,coordinateSystem:Nc.METER_OFFSETS,coordinateOrigin:r,modelMatrix:n,getTransformMatrix:e=>e.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){let i=e.content,{attributes:r,indices:n,modelMatrix:s,cartographicOrigin:o,coordinateSystem:a=Nc.METER_OFFSETS,material:l,featureIds:u}=i,{_getMeshColor:h}=this.props,c=t&&t.props.mesh||new vp({topology:"triangle-list",attributes:hO(r),indices:n});return new(this.getSubLayerClass("mesh",LR))(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:c,data:oO,getColor:h(e),pbrMaterial:l,modelMatrix:s,coordinateOrigin:o,coordinateSystem:a,featureIds:u,_offset:0})}renderLayers(){let{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map((e=>{let i=t[e.id]=t[e.id]||{tile:e},{layer:r}=i;return e.selected&&(r?i.needsUpdate&&(r=this._getSubLayer(e,r),i.needsUpdate=!1):r=this._getSubLayer(e)),i.layer=r,r})).filter(Boolean):null}},uO=lO;function hO(e){let t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}function cO(e,t,i,r){let n=r?function(e,t){e.westIndices.sort(((e,i)=>t[3*e+1]-t[3*i+1])),e.eastIndices.sort(((e,i)=>t[3*i+1]-t[3*e+1])),e.southIndices.sort(((e,i)=>t[3*i]-t[3*e])),e.northIndices.sort(((e,i)=>t[3*e]-t[3*i]));let i=[];for(let t in e){let r=e[t];for(let e=0;e<r.length-1;e++)i.push([r[e],r[e+1]])}return i}(r,e.POSITION.value):function(e){let t=[];for(let i=0;i<e.length;i+=3)t.push([e[i],e[i+1]]),t.push([e[i+1],e[i+2]]),t.push([e[i+2],e[i]]);t.sort(((e,t)=>Math.min(...e)-Math.min(...t)||Math.max(...e)-Math.max(...t)));let i=[],r=0;for(;r<t.length;){var n,s;t[r][0]===(null===(n=t[r+1])||void 0===n?void 0:n[1])&&t[r][1]===(null===(s=t[r+1])||void 0===s?void 0:s[0])?r+=2:(i.push(t[r]),r++)}return i}(t),s=new e.POSITION.value.constructor(6*n.length),o=new e.TEXCOORD_0.value.constructor(4*n.length),a=new t.constructor(6*n.length);for(let t=0;t<n.length;t++)dO({edge:n[t],edgeIndex:t,attributes:e,skirtHeight:i,newPosition:s,newTexcoord0:o,newTriangles:a});return e.POSITION.value=ce(e.POSITION.value,s),e.TEXCOORD_0.value=ce(e.TEXCOORD_0.value,o),{attributes:e,triangles:t instanceof Array?t.concat(a):ce(t,a)}}function dO(e){let{edge:t,edgeIndex:i,attributes:r,skirtHeight:n,newPosition:s,newTexcoord0:o,newTriangles:a}=e,l=r.POSITION.value.length,u=2*i,h=2*i+1;s.set(r.POSITION.value.subarray(3*t[0],3*t[0]+3),3*u),s[3*u+2]=s[3*u+2]-n,s.set(r.POSITION.value.subarray(3*t[1],3*t[1]+3),3*h),s[3*h+2]=s[3*h+2]-n,o.set(r.TEXCOORD_0.value.subarray(2*t[0],2*t[0]+2),2*u),o.set(r.TEXCOORD_0.value.subarray(2*t[1],2*t[1]+2),2*h);let c=2*i*3;a[c]=t[0],a[c+1]=l/3+h,a[c+2]=t[1],a[c+3]=l/3+h,a[c+4]=t[0],a[c+5]=l/3+u}lO.defaultProps=aO,lO.layerName="Tile3DLayer";var fO=class{constructor(e=257){this.gridSize=e;let t=e-1;if(t&t-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=t*t*2-2,this.numParentTriangles=this.numTriangles-t*t,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let e=0;e<this.numTriangles;e++){let i=e+2,r=0,n=0,s=0,o=0,a=0,l=0;for(1&i?s=o=a=t:r=n=l=t;(i>>=1)>1;){let e=r+s>>1,t=n+o>>1;1&i?(s=r,o=n,r=a,n=l):(r=s,n=o,s=a,o=l),a=e,l=t}let u=4*e;this.coords[u+0]=r,this.coords[u+1]=n,this.coords[u+2]=s,this.coords[u+3]=o}}createTile(e){return new pO(e,this)}},pO=class{constructor(e,t){let i=t.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=t,this.errors=new Float32Array(e.length),this.update()}update(){let{numTriangles:e,numParentTriangles:t,coords:i,gridSize:r}=this.martini,{terrain:n,errors:s}=this;for(let o=e-1;o>=0;o--){let e=4*o,a=i[e+0],l=i[e+1],u=i[e+2],h=i[e+3],c=a+u>>1,d=l+h>>1,f=c+d-l,p=d+a-c,g=(n[l*r+a]+n[h*r+u])/2,m=d*r+c,_=Math.abs(g-n[m]);if(s[m]=Math.max(s[m],_),o<t){let e=(l+p>>1)*r+(a+f>>1),t=(h+p>>1)*r+(u+f>>1);s[m]=Math.max(s[m],s[e],s[t])}}}getMesh(e=0){let{gridSize:t,indices:i}=this.martini,{errors:r}=this,n=0,s=0,o=t-1;function a(o,l,u,h,c,d){let f=o+u>>1,p=l+h>>1;Math.abs(o-c)+Math.abs(l-d)>1&&r[p*t+f]>e?(a(c,d,o,l,f,p),a(u,h,c,d,f,p)):(i[l*t+o]=i[l*t+o]||++n,i[h*t+u]=i[h*t+u]||++n,i[d*t+c]=i[d*t+c]||++n,s++)}i.fill(0),a(0,0,o,o,o,0),a(o,o,0,0,0,o);let l=new Uint16Array(2*n),u=new Uint32Array(3*s),h=0;function c(n,s,o,a,d,f){let p=n+o>>1,g=s+a>>1;if(Math.abs(n-d)+Math.abs(s-f)>1&&r[g*t+p]>e)c(d,f,n,s,p,g),c(o,a,d,f,p,g);else{let e=i[s*t+n]-1,r=i[a*t+o]-1,c=i[f*t+d]-1;l[2*e]=n,l[2*e+1]=s,l[2*r]=o,l[2*r+1]=a,l[2*c]=d,l[2*c+1]=f,u[h++]=e,u[h++]=r,u[h++]=c}}return c(0,0,o,o,o,0),c(o,o,0,0,0,o),{vertices:l,triangles:u}}},gO=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;this.data=e,this.width=t,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;let r=t-1,n=i-1,s=this._addPoint(0,0),o=this._addPoint(r,0),a=this._addPoint(0,n),l=this._addPoint(r,n),u=this._addTriangle(l,s,a,-1,-1,-1);this._addTriangle(s,l,o,u,-1,-1),this._flush()}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,t){return this.data[this.width*t+e]}_flush(){let e=this.coords;for(let t=0;t<this._pendingLen;t++){let i=this._pending[t],r=2*this.triangles[3*i+0],n=2*this.triangles[3*i+1],s=2*this.triangles[3*i+2];this._findCandidate(e[r],e[r+1],e[n],e[n+1],e[s],e[s+1],i)}this._pendingLen=0}_findCandidate(e,t,i,r,n,s,o){let a=Math.min(e,i,n),l=Math.min(t,r,s),u=Math.max(e,i,n),h=Math.max(t,r,s),c=mO(i,r,n,s,a,l),d=mO(n,s,e,t,a,l),f=mO(e,t,i,r,a,l),p=r-t,g=e-i,m=s-r,_=i-n,v=t-s,y=n-e,b=mO(e,t,i,r,n,s),A=this.heightAt(e,t)/b,E=this.heightAt(i,r)/b,w=this.heightAt(n,s)/b,x=0,T=0,C=0,S=0;for(let e=l;e<=h;e++){let t=0;c<0&&0!==m&&(t=Math.max(t,Math.floor(-c/m))),d<0&&0!==v&&(t=Math.max(t,Math.floor(-d/v))),f<0&&0!==p&&(t=Math.max(t,Math.floor(-f/p)));let i=c+m*t,r=d+v*t,n=f+p*t,s=!1;for(let o=a+t;o<=u;o++){if(i>=0&&r>=0&&n>=0){s=!0;let t=A*i+E*r+w*n,a=Math.abs(t-this.heightAt(o,e));S+=a*a,a>x&&(x=a,T=o,C=e)}else if(s)break;i+=m,r+=v,n+=p}c+=_,d+=y,f+=g}(T===e&&C===t||T===i&&C===r||T===n&&C===s)&&(x=0),this._candidates[2*o]=T,this._candidates[2*o+1]=C,this._rms[o]=S,this._queuePush(o,x,S)}_step(){let e=this._queuePop(),t=3*e+0,i=3*e+1,r=3*e+2,n=this.triangles[t],s=this.triangles[i],o=this.triangles[r],a=this.coords[2*n],l=this.coords[2*n+1],u=this.coords[2*s],h=this.coords[2*s+1],c=this.coords[2*o],d=this.coords[2*o+1],f=this._candidates[2*e],p=this._candidates[2*e+1],g=this._addPoint(f,p);if(0===mO(a,l,u,h,f,p))this._handleCollinear(g,t);else if(0===mO(u,h,c,d,f,p))this._handleCollinear(g,i);else if(0===mO(c,d,a,l,f,p))this._handleCollinear(g,r);else{let e=this._halfedges[t],a=this._halfedges[i],l=this._halfedges[r],u=this._addTriangle(n,s,g,e,-1,-1,t),h=this._addTriangle(s,o,g,a,-1,u+1),c=this._addTriangle(o,n,g,l,u+2,h+1);this._legalize(u),this._legalize(h),this._legalize(c)}}_addPoint(e,t){let i=this.coords.length>>1;return this.coords.push(e,t),i}_addTriangle(e,t,i,r,n,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.triangles.length,a=o/3;return this.triangles[o+0]=e,this.triangles[o+1]=t,this.triangles[o+2]=i,this._halfedges[o+0]=r,this._halfedges[o+1]=n,this._halfedges[o+2]=s,r>=0&&(this._halfedges[r]=o+0),n>=0&&(this._halfedges[n]=o+1),s>=0&&(this._halfedges[s]=o+2),this._candidates[2*a+0]=0,this._candidates[2*a+1]=0,this._queueIndices[a]=-1,this._rms[a]=0,this._pending[this._pendingLen++]=a,o}_legalize(e){let t=this._halfedges[e];if(t<0)return;let i=e-e%3,r=t-t%3,n=i+(e+1)%3,s=i+(e+2)%3,o=r+(t+2)%3,a=r+(t+1)%3,l=this.triangles[s],u=this.triangles[e],h=this.triangles[n],c=this.triangles[o],d=this.coords;if(!function(e,t,i,r,n,s,o,a){let l=e-o,u=t-a,h=i-o,c=r-a,d=n-o,f=s-a,p=l*l+u*u,g=h*h+c*c,m=d*d+f*f;return l*(c*m-g*f)-u*(h*m-g*d)+p*(h*f-c*d)<0}(d[2*l],d[2*l+1],d[2*u],d[2*u+1],d[2*h],d[2*h+1],d[2*c],d[2*c+1]))return;let f=this._halfedges[n],p=this._halfedges[s],g=this._halfedges[o],m=this._halfedges[a];this._queueRemove(i/3),this._queueRemove(r/3);let _=this._addTriangle(l,c,h,-1,g,f,i),v=this._addTriangle(c,l,u,_,p,m,r);this._legalize(_+1),this._legalize(v+2)}_handleCollinear(e,t){let i=t-t%3,r=i+(t+1)%3,n=i+(t+2)%3,s=this.triangles[n],o=this.triangles[t],a=this.triangles[r],l=this._halfedges[r],u=this._halfedges[n],h=this._halfedges[t];if(h<0){let t=this._addTriangle(e,s,o,-1,u,-1,i),r=this._addTriangle(s,e,a,t,-1,l);return this._legalize(t+1),void this._legalize(r+2)}let c=h-h%3,d=c+(h+2)%3,f=c+(h+1)%3,p=this.triangles[d],g=this._halfedges[d],m=this._halfedges[f];this._queueRemove(c/3);let _=this._addTriangle(s,o,e,u,-1,-1,i),v=this._addTriangle(o,p,e,m,-1,_+1,c),y=this._addTriangle(p,a,e,g,-1,v+1),b=this._addTriangle(a,s,e,l,_+2,y+1);this._legalize(_),this._legalize(v),this._legalize(y),this._legalize(b)}_queuePush(e,t,i){let r=this._queue.length;this._queueIndices[e]=r,this._queue.push(e),this._errors.push(t),this._rmsSum+=i,this._queueUp(r)}_queuePop(){let e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){let e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){let t=this._queueIndices[e];if(t<0){let t=this._pending.indexOf(e);if(-1===t)throw new Error("Broken triangulation (something went wrong).");return void(this._pending[t]=this._pending[--this._pendingLen])}let i=this._queue.length-1;i!==t&&(this._queueSwap(t,i),this._queueDown(t,i)||this._queueUp(t)),this._queuePopBack()}_queueLess(e,t){return this._errors[e]>this._errors[t]}_queueSwap(e,t){let i=this._queue[e],r=this._queue[t];this._queue[e]=r,this._queue[t]=i,this._queueIndices[i]=t,this._queueIndices[r]=e;let n=this._errors[e];this._errors[e]=this._errors[t],this._errors[t]=n}_queueUp(e){let t=e;for(;;){let e=t-1>>1;if(e===t||!this._queueLess(t,e))break;this._queueSwap(e,t),t=e}}_queueDown(e,t){let i=e;for(;;){let e=2*i+1;if(e>=t||e<0)break;let r=e+1,n=e;if(r<t&&this._queueLess(r,e)&&(n=r),!this._queueLess(n,i))break;this._queueSwap(i,n),i=n}return i>e}};function mO(e,t,i,r,n,s){return(i-n)*(t-s)-(r-s)*(e-n)}function _O(e,t){let i,r,{meshMaxError:n,bounds:s,elevationDecoder:o}=t,{data:a,width:l,height:u}=e;switch(t.tesselator){case"martini":i=bO(a,l,u,o,t.tesselator),r=vO(n,l,i);break;case"delatin":i=bO(a,l,u,o,t.tesselator),r=yO(n,l,u,i);break;default:l!==u||u&l-1?(i=bO(a,l,u,o,"delatin"),r=yO(n,l,u,i)):(i=bO(a,l,u,o,"martini"),r=vO(n,l,i))}let{vertices:h}=r,{triangles:c}=r,d=function(e,t,i,r,n){let s=i+1,o=e.length/2,a=new Float32Array(3*o),l=new Float32Array(2*o),[u,h,c,d]=n||[0,0,i,r],f=(c-u)/i,p=(d-h)/r;for(let n=0;n<o;n++){let o=e[2*n],h=e[2*n+1],c=h*s+o;a[3*n+0]=o*f+u,a[3*n+1]=-h*p+d,a[3*n+2]=t[c],l[2*n+0]=o/i,l[2*n+1]=h/r}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:l,size:2}}}(h,i,l,u,s),f=Jt(d);if(t.skirtHeight){let{attributes:e,triangles:i}=cO(d,c,t.skirtHeight);d=e,c=i}return{loaderData:{header:{}},header:{vertexCount:c.length,boundingBox:f},mode:4,indices:{value:Uint32Array.from(c),size:1},attributes:d}}function vO(e,t,i){let r=new fO(t+1).createTile(i),{vertices:n,triangles:s}=r.getMesh(e);return{vertices:n,triangles:s}}function yO(e,t,i,r){let n=new gO(r,t+1,i+1);n.run(e);let{coords:s,triangles:o}=n;return{vertices:s,triangles:o}}function bO(e,t,i,r,n){let{rScaler:s,bScaler:o,gScaler:a,offset:l}=r,u=new Float32Array((t+1)*(i+1));for(let r=0,n=0;n<i;n++)for(let i=0;i<t;i++,r++){let t=4*r,i=e[t+0],h=e[t+1],c=e[t+2];u[r+n]=i*s+h*a+c*o+l}if("martini"===n){for(let e=(t+1)*t,i=0;i<t;i++,e++)u[e]=u[e-t-1];for(let e=i,t=0;t<i+1;t++,e+=i+1)u[e]=u[e-1]}return u}var AO={name:"Terrain",id:"terrain",module:"terrain",version:"4.1.4",worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}},EO={...AO,parse:async function(e,t,i){let r={...t,mimeType:"application/x.image",image:{...t?.image,type:"data"}},n=await O(e,[],r,i),s={...EO.options.terrain,...t?.terrain};return _O(n,s)}},wO=[1],xO={...pC.defaultProps,elevationData:qT,texture:{...qT,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[AO]};function TO(e){return Array.isArray(e)?e.join(";"):e||""}var CO=class extends db{updateState({props:e,oldProps:t}){let i=e.elevationData!==t.elevationData;if(i){let{elevationData:t}=e,i=t&&(Array.isArray(t)||t.includes("{x}")&&t.includes("{y}"));this.setState({isTiled:i})}let r=i||e.meshMaxError!==t.meshMaxError||e.elevationDecoder!==t.elevationDecoder||e.bounds!==t.bounds;if(!this.state.isTiled&&r){let t=this.loadTerrain(e);this.setState({terrain:t})}e.workerUrl&&wi.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:t,elevationDecoder:i,meshMaxError:r,signal:n}){if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?2*r:0,...s?.terrain,bounds:t,meshMaxError:r,elevationDecoder:i}};let{fetch:o}=this.props;return o(e,{propName:"elevationData",layer:this,loadOptions:s,signal:n})}getTiledTerrainData(e){let{elevationData:t,fetch:i,texture:r,elevationDecoder:n,meshMaxError:s}=this.props,{viewport:o}=this.context,a=$T(t,e),l=r&&$T(r,e),{signal:u}=e,h=[0,0],c=[0,0];if(o.isGeospatial){let t=e.bbox;h=o.projectFlat([t.west,t.south]),c=o.projectFlat([t.east,t.north])}else{let t=e.bbox;h=[t.left,t.bottom],c=[t.right,t.top]}let d=[h[0],h[1],c[0],c[1]],f=this.loadTerrain({elevationData:a,bounds:d,elevationDecoder:n,meshMaxError:s,signal:u}),p=l?i(l,{propName:"texture",layer:this,loaders:[],signal:u}).catch((e=>null)):Promise.resolve(null);return Promise.all([f,p])}renderSubLayers(e){let t=this.getSubLayerClass("mesh",VC),{color:i,wireframe:r,material:n}=this.props,{data:s}=e;if(!s)return null;let[o,a]=s;return new t(e,{data:wO,mesh:o,texture:a,_instanced:!1,coordinateSystem:Nc.CARTESIAN,getPosition:e=>[0,0,0],getColor:i,wireframe:r,material:n})}onViewportLoad(e){if(!e)return;let{zRange:t}=this.state,i=e.map((e=>e.content)).filter(Boolean).map((e=>e[0].header.boundingBox.map((e=>e[2]))));if(0===i.length)return;let r=Math.min(...i.map((e=>e[0]))),n=Math.max(...i.map((e=>e[1])));(!t||r<t[0]||n>t[1])&&this.setState({zRange:[r,n]})}renderLayers(){let{color:e,material:t,elevationData:i,texture:r,wireframe:n,meshMaxError:s,elevationDecoder:o,tileSize:a,maxZoom:l,minZoom:u,extent:h,maxRequests:c,onTileLoad:d,onTileUnload:f,onTileError:p,maxCacheSize:g,maxCacheByteSize:m,refinementStrategy:_}=this.props;return this.state.isTiled?new pC(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:TO(i),texture:TO(r),meshMaxError:s,elevationDecoder:o}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:a,maxZoom:l,minZoom:u,extent:h,maxRequests:c,onTileLoad:d,onTileUnload:f,onTileError:p,maxCacheSize:g,maxCacheByteSize:m,refinementStrategy:_}):i?new(this.getSubLayerClass("mesh",VC))(this.getSubLayerProps({id:"mesh"}),{data:wO,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:e=>[0,0,0],getColor:e,material:t,wireframe:n}):null}},SO=CO;CO.defaultProps=xO,CO.layerName="TerrainLayer";var PO={source:0,target:1,custom:2,source_target:3},MO={name:"brushing",dependencies:[id],vs:"\nuniform bool brushing_enabled;\nuniform int brushing_target;\nuniform vec2 brushing_mousePos;\nuniform float brushing_radius;\n#ifdef NON_INSTANCED_MODEL\nin vec2 brushingTargets;\n#else\nin vec2 instanceBrushingTargets;\n#endif\nout float brushing_isVisible;\nbool brushing_isPointInRange(vec2 position) {\nif (!brushing_enabled) {\nreturn true;\n}\nvec2 source_commonspace = project_position(position);\nvec2 target_commonspace = project_position(brushing_mousePos);\nfloat distance = length((target_commonspace - source_commonspace) / project_uCommonUnitsPerMeter.xy);\nreturn distance <= brushing_radius;\n}\nbool brushing_arePointsInRange(vec2 sourcePos, vec2 targetPos) {\nreturn brushing_isPointInRange(sourcePos) || brushing_isPointInRange(targetPos);\n}\nvoid brushing_setVisible(bool visible) {\nbrushing_isVisible = float(visible);\n}\n",fs:"\nuniform bool brushing_enabled;\nin float brushing_isVisible;\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\nvec2 brushingTarget;\nvec2 brushingSource;\nif (brushing_target == 3) {\nbrushingTarget = geometry.worldPositionAlt.xy;\nbrushingSource = geometry.worldPosition.xy;\n} else if (brushing_target == 0) {\nbrushingTarget = geometry.worldPosition.xy;\n} else if (brushing_target == 1) {\nbrushingTarget = geometry.worldPositionAlt.xy;\n} else {\n#ifdef NON_INSTANCED_MODEL\nbrushingTarget = brushingTargets;\n#else\nbrushingTarget = instanceBrushingTargets;\n#endif\n}\nbool visible;\nif (brushing_target == 3) {\nvisible = brushing_arePointsInRange(brushingSource, brushingTarget);\n} else {\nvisible = brushing_isPointInRange(brushingTarget);\n}\nbrushing_setVisible(visible);\n","fs:DECKGL_FILTER_COLOR":"\n    if (brushing_enabled && brushing_isVisible < 0.5) {\n      discard;\n    }\n  "},getUniforms:e=>{if(!e||!("viewport"in e))return{};let{brushingEnabled:t=!0,brushingRadius:i=1e4,brushingTarget:r="source",mousePosition:n,viewport:s}=e;return{brushing_enabled:Boolean(t&&n&&s.containsPixel(n)),brushing_radius:i,brushing_target:PO[r]||0,brushing_mousePos:n?s.unproject([n.x-s.x,n.y-s.y]):[0,0]}}},RO={getBrushingTarget:{type:"accessor",value:[0,0]},brushingTarget:"source",brushingEnabled:!0,brushingRadius:1e4},IO=class extends Wb{getShaders(){return{modules:[MO]}}initializeState(e,t){let i=this.getAttributeManager();i&&i.add({brushingTargets:{size:2,accessor:"getBrushingTarget",shaderAttributes:{brushingTargets:{divisor:0},instanceBrushingTargets:{divisor:1}}}});let r=()=>{this.getCurrentLayer()?.setNeedsRedraw()};this.state.onMouseMove=r,e.deck&&e.deck.eventManager.on({pointermove:r,pointerleave:r})}finalizeState(e,t){if(e.deck){let t=this.state.onMouseMove;e.deck.eventManager.off({pointermove:t,pointerleave:t})}}},BO=IO;IO.defaultProps=RO,IO.extensionName="BrushingExtension";var LO="\nuniform DATAFILTER_TYPE filter_min;\nuniform DATAFILTER_TYPE filter_softMin;\nuniform DATAFILTER_TYPE filter_softMax;\nuniform DATAFILTER_TYPE filter_max;\nuniform bool filter_useSoftMargin;\nuniform bool filter_enabled;\nuniform bool filter_transformSize;\nuniform ivec4 filter_categoryBitMask;\n#ifdef NON_INSTANCED_MODEL\n#define DATAFILTER_ATTRIB filterValues\n#define DATAFILTER_ATTRIB_64LOW filterValues64Low\n#define DATACATEGORY_ATTRIB filterCategoryValues\n#else\n#define DATAFILTER_ATTRIB instanceFilterValues\n#define DATAFILTER_ATTRIB_64LOW instanceFilterValues64Low\n#define DATACATEGORY_ATTRIB instanceFilterCategoryValues\n#endif\nin DATAFILTER_TYPE DATAFILTER_ATTRIB;\n#ifdef DATAFILTER_DOUBLE\nin DATAFILTER_TYPE DATAFILTER_ATTRIB_64LOW;\nuniform DATAFILTER_TYPE filter_min64High;\nuniform DATAFILTER_TYPE filter_max64High;\n#endif\nin DATACATEGORY_TYPE DATACATEGORY_ATTRIB;\nout float dataFilter_value;\nfloat dataFilter_reduceValue(float value) {\nreturn value;\n}\nfloat dataFilter_reduceValue(vec2 value) {\nreturn min(value.x, value.y);\n}\nfloat dataFilter_reduceValue(vec3 value) {\nreturn min(min(value.x, value.y), value.z);\n}\nfloat dataFilter_reduceValue(vec4 value) {\nreturn min(min(value.x, value.y), min(value.z, value.w));\n}\nvoid dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax, DATACATEGORY_TYPE category) {\nif (filter_enabled) {\nif (filter_useSoftMargin) {\ndataFilter_value = dataFilter_reduceValue(\nsmoothstep(filter_min, filter_softMin, valueFromMin) *\n(1.0 - smoothstep(filter_softMax, filter_max, valueFromMax))\n);\n} else {\ndataFilter_value = dataFilter_reduceValue(\nstep(filter_min, valueFromMin) * step(valueFromMax, filter_max)\n);\n}\n#if DATACATEGORY_CHANNELS == 1\nint dataFilter_masks = filter_categoryBitMask[int(category / 32.0)];\n#elif DATACATEGORY_CHANNELS == 2\nivec2 dataFilter_masks = ivec2(\nfilter_categoryBitMask[int(category.x / 32.0)],\nfilter_categoryBitMask[int(category.y / 32.0) + 2]\n);\n#elif DATACATEGORY_CHANNELS == 3\nivec3 dataFilter_masks = filter_categoryBitMask.xyz;\n#else\nivec4 dataFilter_masks = filter_categoryBitMask;\n#endif\nDATACATEGORY_TYPE dataFilter_bits = DATACATEGORY_TYPE(dataFilter_masks) / pow(DATACATEGORY_TYPE(2.0), mod(category, 32.0));\ndataFilter_bits = mod(floor(dataFilter_bits), 2.0);\n#if DATACATEGORY_CHANNELS == 1\nif(dataFilter_bits == 0.0) dataFilter_value = 0.0;\n#else\nif(any(equal(dataFilter_bits, DATACATEGORY_TYPE(0.0)))) dataFilter_value = 0.0;\n#endif\n} else {\ndataFilter_value = 1.0;\n}\n}\n",OO="\nuniform bool filter_transformColor;\nin float dataFilter_value;\n";function FO(e){if(!e||!("extensions"in e))return{};let{filterRange:t=[-1,1],filterEnabled:i=!0,filterTransformSize:r=!0,filterTransformColor:n=!0}=e,s=e.filterSoftRange||t;return{...Number.isFinite(t[0])?{filter_min:t[0],filter_softMin:s[0],filter_softMax:s[1],filter_max:t[1]}:{filter_min:t.map((e=>e[0])),filter_softMin:s.map((e=>e[0])),filter_softMax:s.map((e=>e[1])),filter_max:t.map((e=>e[1]))},filter_enabled:i,filter_useSoftMargin:Boolean(e.filterSoftRange),filter_transformSize:i&&r,filter_transformColor:i&&n}}var NO={"vs:#main-start":"\n#ifdef DATAFILTER_DOUBLE\ndataFilter_setValue(\nDATAFILTER_ATTRIB - filter_min64High + DATAFILTER_ATTRIB_64LOW,\nDATAFILTER_ATTRIB - filter_max64High + DATAFILTER_ATTRIB_64LOW,\nDATACATEGORY_ATTRIB\n);\n#else\ndataFilter_setValue(DATAFILTER_ATTRIB, DATAFILTER_ATTRIB, DATACATEGORY_ATTRIB);\n#endif\n","vs:#main-end":"\nif (dataFilter_value == 0.0) {\ngl_Position = vec4(0.);\n}\n","vs:DECKGL_FILTER_SIZE":"\nif (filter_transformSize) {\nsize = size * dataFilter_value;\n}\n","fs:DECKGL_FILTER_COLOR":"\nif (dataFilter_value == 0.0) discard;\nif (filter_transformColor) {\ncolor.a *= dataFilter_value;\n}\n"},DO={name:"data-filter",vs:LO,fs:OO,inject:NO,getUniforms:FO},kO={name:"data-filter-fp64",vs:LO,fs:OO,inject:NO,getUniforms:function(e){if(!e||!("extensions"in e))return{};let t=FO(e);if(Number.isFinite(t.filter_min)){let e=Math.fround(t.filter_min);t.filter_min-=e,t.filter_softMin-=e,t.filter_min64High=e;let i=Math.fround(t.filter_max);t.filter_max-=i,t.filter_softMax-=i,t.filter_max64High=i}else{let e=t.filter_min.map(Math.fround);t.filter_min=t.filter_min.map(((t,i)=>t-e[i])),t.filter_softMin=t.filter_softMin.map(((t,i)=>t-e[i])),t.filter_min64High=e;let i=t.filter_max.map(Math.fround);t.filter_max=t.filter_max.map(((e,t)=>e-i[t])),t.filter_softMax=t.filter_softMax.map(((e,t)=>e-i[t])),t.filter_max64High=i}return t}},UO=["float32-renderable-webgl","texture-blend-float-webgl"],GO={blend:!0,blendFunc:[1,1,1,1],blendEquation:[32774,32774],depthTest:!1},zO={getFilterValue:{type:"accessor",value:0},getFilterCategory:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterCategories:[0],filterTransformSize:!0,filterTransformColor:!0},VO={categorySize:1,filterSize:1,fp64:!1,countItems:!1},jO={1:"float",2:"vec2",3:"vec3",4:"vec4"},HO=class extends Wb{constructor(e={}){super({...VO,...e})}getShaders(e){let{categorySize:t,filterSize:i,fp64:r}=e.opts;return{modules:[r?kO:DO],defines:{DATACATEGORY_TYPE:jO[t],DATACATEGORY_CHANNELS:t,DATAFILTER_TYPE:jO[i],DATAFILTER_DOUBLE:Boolean(r)}}}initializeState(e,t){let i=this.getAttributeManager(),{categorySize:r,filterSize:n,fp64:s}=t.opts;i&&i.add({filterValues:{size:n,type:s?"float64":"float32",accessor:"getFilterValue",shaderAttributes:{filterValues:{divisor:0},instanceFilterValues:{divisor:1}}},filterCategoryValues:{size:r,accessor:"getFilterCategory",transform:1===r?e=>t._getCategoryKey.call(this,e,0):e=>e.map(((e,i)=>t._getCategoryKey.call(this,e,i))),shaderAttributes:{filterCategoryValues:{divisor:0},instanceFilterCategoryValues:{divisor:1}}}});let{device:o}=this.context;if(i&&t.opts.countItems){let e=function(e){return UO.every((t=>e.features.has(t)))}(o);i.add({filterIndices:{size:e?1:2,vertexOffset:1,type:"unorm8",accessor:(t,{index:i})=>{let r=t&&t.__source?t.__source.index:i;return e?(r+1)%255:[(r+1)%255,Math.floor(r/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});let r=function(e,t){return t?e.createFramebuffer({width:1,height:1,colorAttachments:[e.createTexture({format:"rgba32float",type:5126,mipmaps:!1})]}):e.createFramebuffer({width:256,height:64,colorAttachments:[e.createTexture({format:"rgba8unorm",type:5126,mipmaps:!1})]})}(o,e),n=function(e,t,i){return t.defines.NON_INSTANCED_MODEL=1,i&&(t.defines.FLOAT_TARGET=1),new fp(e,{id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,drawMode:0,vs:"#version 300 es\n#define SHADER_NAME data-filter-vertex-shader\n\n#ifdef FLOAT_TARGET\n  in float filterIndices;\n  in float filterPrevIndices;\n#else\n  in vec2 filterIndices;\n  in vec2 filterPrevIndices;\n#endif\n\nout vec4 vColor;\nconst float component = 1.0 / 255.0;\n\nvoid main() {\n  #ifdef FLOAT_TARGET\n    dataFilter_value *= float(filterIndices != filterPrevIndices);\n    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n    vColor = vec4(0.0, 0.0, 0.0, 1.0);\n  #else\n    // Float texture is not supported: pack result into 4 channels x 256 px x 64px\n    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);\n    float col = filterIndices.x;\n    float row = filterIndices.y * 4.0;\n    float channel = floor(row);\n    row = fract(row);\n    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));\n    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);\n  #endif\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME data-filter-fragment-shader\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main() {\n  if (dataFilter_value < 0.5) {\n    discard;\n  }\n  fragColor = vColor;\n}\n",...t})}(o,t.getShaders.call(this,t),e);this.setState({filterFBO:r,filterModel:n})}}updateState({props:e,oldProps:t,changeFlags:i},r){let n=this.getAttributeManager(),{categorySize:s}=r.opts;if(this.state.filterModel){let i=n.attributes.filterValues.needsUpdate()||n.attributes.filterCategoryValues?.needsUpdate()||e.filterEnabled!==t.filterEnabled||e.filterRange!==t.filterRange||e.filterSoftRange!==t.filterSoftRange||e.filterCategories!==t.filterCategories;i&&this.setState({filterNeedsUpdate:i})}if(n?.attributes.filterCategoryValues){let r=n.attributes.filterCategoryValues.needsUpdate()||!sg(e.filterCategories,t.filterCategories,2);r&&this.setState({categoryBitMaskNeedsUpdate:r}),i.dataChanged&&(this.setState({categoryMap:Array(s).fill(0).map((()=>({})))}),n.attributes.filterCategoryValues.setNeedsUpdate("categoryMap"))}}draw(e,t){let i=this.state.filterFBO,r=this.state.filterModel,n=this.state.filterNeedsUpdate,s=this.state.categoryBitMaskNeedsUpdate,{onFilteredItemsChange:o}=this.props;if(s&&t._updateCategoryBitMask.call(this,e,t),n&&o&&r){let{attributes:{filterValues:t,filterCategoryValues:n,filterIndices:s}}=this.getAttributeManager();r.setVertexCount(this.getNumInstances()),this.context.device.clearWebGL({framebuffer:i,color:[0,0,0,0]}),r.updateModuleSettings(e.moduleParameters),r.setAttributes({...t.getValue(),...n?.getValue(),...s?.getValue()}),r.setUniforms(e.uniforms),r.device.withParametersWebGL({framebuffer:i,...GO,viewport:[0,0,i.width,i.height]},(()=>{r.draw(this.context.renderPass)}));let a=r.device.readPixelsToArrayWebGL(i),l=0;for(let e=0;e<a.length;e++)l+=a[e];o({id:this.id,count:l}),this.state.filterNeedsUpdate=!1}}finalizeState(){let e=this.state.filterFBO,t=this.state.filterModel;e?.destroy(),t?.destroy()}_updateCategoryBitMask(e,t){let{categorySize:i}=t.opts,{filterCategories:r}=this.props,n=new Uint32Array([0,0,0,0]),s=1===i?[r]:r,o=1===i?128:2===i?64:32;for(let e=0;e<s.length;e++){let i=s[e];for(let r of i){let i=t._getCategoryKey.call(this,r,e);i<o?n[e*(o/32)+Math.floor(i/32)]+=Math.pow(2,i%32):wi.warn(`Exceeded maximum number of categories (${o})`)()}}e.uniforms.filter_categoryBitMask=n,this.state.categoryBitMaskNeedsUpdate=!1}_getCategoryKey(e,t){let i=this.state.categoryMap[t];return e in i||(i[e]=Object.keys(i).length),i[e]}},WO=HO;HO.defaultProps=zO,HO.extensionName="DataFilterExtension";var{fp64ify:XO,fp64ifyMatrix4:qO}=co,KO={name:"project64",dependencies:[id,co],vs:"const vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\nuniform vec2 project_uViewProjectionMatrixFP64[16];\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n#if defined(NVIDIA_FP64_WORKAROUND)\nout_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\nout_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\nout_val[1] = sum_fp64(PI_FP64,\nlog_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\nreturn;\n}\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\nvec2 pos_fp64[2];\nmercatorProject_fp64(position_fp64, pos_fp64);\nout_val[0] = mul_fp64(pos_fp64[0], WORLD_SCALE_FP64);\nout_val[1] = mul_fp64(pos_fp64[1], WORLD_SCALE_FP64);\nreturn;\n}\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\nvec4 position64xy = vec4(\nposition.x, position64xyLow.x,\nposition.y, position64xyLow.y);\nproject_position_fp64(position64xy, out_val);\n}\nvec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\nvec2 vertex_pos_clipspace[4];\nmat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\nvertex_pos_clipspace);\nreturn vec4(\nvertex_pos_clipspace[0].x,\nvertex_pos_clipspace[1].x,\nvertex_pos_clipspace[2].x,\nvertex_pos_clipspace[3].x\n);\n}\nvec4 project_position_to_clipspace(\nvec3 position, vec3 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\nvec2 offset64[4];\nvec4_fp64(vec4(offset, 0.0), offset64);\nfloat z = project_size(position.z);\nvec2 projectedPosition64xy[2];\nproject_position_fp64(position.xy, position64xyLow.xy, projectedPosition64xy);\nvec2 commonPosition64[4];\ncommonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\ncommonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\ncommonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\ncommonPosition64[3] = vec2(1.0, 0.0);\ncommonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\nreturn project_common_position_to_clipspace_fp64(commonPosition64);\n}\nvec4 project_position_to_clipspace(\nvec3 position, vec3 position64xyLow, vec3 offset\n) {\nvec4 commonPosition;\nreturn project_position_to_clipspace(\nposition, position64xyLow, offset, commonPosition\n);\n}\n",getUniforms:function(e){if(e&&"viewport"in e){let{viewProjectionMatrix:t,scale:i}=e.viewport;return $O({viewProjectionMatrix:t,scale:i})}return{}}},$O=Xc((function({viewProjectionMatrix:e,scale:t}){let i=qO(e),r=XO(t);return{project_uViewProjectionMatrixFP64:i,project64_uViewProjectionMatrix:i,project64_uScale:r}})),JO=class extends Wb{getShaders(){let{coordinateSystem:e}=this.props;if(e!==Nc.LNGLAT&&e!==Nc.DEFAULT)throw new Error("fp64: coordinateSystem must be LNGLAT");return{modules:[KO]}}},YO=JO;JO.extensionName="Fp64Extension";var ZO={inject:{"vs:#decl":"\nin vec2 instanceDashArrays;\nin float instanceDashOffsets;\nout vec2 vDashArray;\nout float vDashOffset;\n","vs:#main-end":"\nvDashArray = instanceDashArrays;\nvDashOffset = instanceDashOffsets / width.x;\n","fs:#decl":"\nuniform float dashAlignMode;\nuniform float capType;\nuniform bool dashGapPickable;\nin vec2 vDashArray;\nin float vDashOffset;\n","fs:#main-start":"\nfloat solidLength = vDashArray.x;\nfloat gapLength = vDashArray.y;\nfloat unitLength = solidLength + gapLength;\nfloat offset;\nif (unitLength > 0.0) {\nif (dashAlignMode == 0.0) {\noffset = vDashOffset;\n} else {\nunitLength = vPathLength / round(vPathLength / unitLength);\noffset = solidLength / 2.0;\n}\nfloat unitOffset = mod(vPathPosition.y + offset, unitLength);\nif (gapLength > 0.0 && unitOffset > solidLength) {\nif (capType <= 0.5) {\nif (!(dashGapPickable && bool(picking.isActive))) {\ndiscard;\n}\n} else {\nfloat distToEnd = length(vec2(\nmin(unitOffset - solidLength, unitLength - unitOffset),\nvPathPosition.x\n));\nif (distToEnd > 1.0) {\nif (!(dashGapPickable && bool(picking.isActive))) {\ndiscard;\n}\n}\n}\n}\n}\n"}},QO={inject:{"vs:#decl":"\nin float instanceOffsets;\n","vs:DECKGL_FILTER_SIZE":"\nfloat offsetWidth = abs(instanceOffsets * 2.0) + 1.0;\nsize *= offsetWidth;\n","vs:#main-end":"\nfloat offsetWidth = abs(instanceOffsets * 2.0) + 1.0;\nfloat offsetDir = sign(instanceOffsets);\nvPathPosition.x = (vPathPosition.x + offsetDir) * offsetWidth - offsetDir;\nvPathPosition.y *= offsetWidth;\nvPathLength *= offsetWidth;\n","fs:#main-start":"\nfloat isInside;\nisInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);\nif (isInside == 0.0) {\ndiscard;\n}\n"}},eF={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1},tF=class extends Wb{constructor({dash:e=!1,offset:t=!1,highPrecisionDash:i=!1}={}){super({dash:e||i,offset:t,highPrecisionDash:i})}isEnabled(e){return"pathTesselator"in e.state}getShaders(e){if(!e.isEnabled(this))return null;let t={};return e.opts.dash&&(t=Uy(t,ZO)),e.opts.offset&&(t=Uy(t,QO)),t}initializeState(e,t){let i=this.getAttributeManager();!i||!t.isEnabled(this)||(t.opts.dash&&i.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"},instanceDashOffsets:t.opts.highPrecisionDash?{size:1,accessor:"getPath",transform:t.getDashOffsets.bind(this)}:{size:1,update:e=>{e.constant=!0,e.value=[0]}}}),t.opts.offset&&i.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}updateState(e,t){if(!t.isEnabled(this))return;let i={};t.opts.dash&&(i.dashAlignMode=this.props.dashJustified?1:0,i.dashGapPickable=Boolean(this.props.dashGapPickable)),this.state.model?.setUniforms(i)}getDashOffsets(e){let t,i,r=[0],n="XY"===this.props.positionFormat?2:3,s=Array.isArray(e[0]),o=s?e.length:e.length/n;for(let a=0;a<o-1;a++)t=s?e[a]:e.slice(a*n,a*n+n),t=this.projectPosition(t),a>0&&(r[a]=r[a-1]+Ra.dist(i,t)),i=t;return r[o-1]=0,r}},iF=tF;tF.defaultProps=eF,tF.extensionName="PathStyleExtension";var rF={name:"fill-pattern",vs:"\n#ifdef NON_INSTANCED_MODEL\n#define FILL_PATTERN_FRAME_ATTRIB fillPatternFrames\n#define FILL_PATTERN_SCALE_ATTRIB fillPatternScales\n#define FILL_PATTERN_OFFSET_ATTRIB fillPatternOffsets\n#else\n#define FILL_PATTERN_FRAME_ATTRIB instanceFillPatternFrames\n#define FILL_PATTERN_SCALE_ATTRIB instanceFillPatternScales\n#define FILL_PATTERN_OFFSET_ATTRIB instanceFillPatternOffsets\n#endif\nin vec4 FILL_PATTERN_FRAME_ATTRIB;\nin float FILL_PATTERN_SCALE_ATTRIB;\nin vec2 FILL_PATTERN_OFFSET_ATTRIB;\nuniform bool fill_patternEnabled;\nuniform vec2 fill_patternTextureSize;\nout vec2 fill_uv;\nout vec4 fill_patternBounds;\nout vec4 fill_patternPlacement;\n",fs:"\nuniform bool fill_patternEnabled;\nuniform bool fill_patternMask;\nuniform sampler2D fill_patternTexture;\nuniform vec2 fill_uvCoordinateOrigin;\nuniform vec2 fill_uvCoordinateOrigin64Low;\nin vec4 fill_patternBounds;\nin vec4 fill_patternPlacement;\nin vec2 fill_uv;\nconst float FILL_UV_SCALE = 512.0 / 40000000.0;\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\nfill_uv = geometry.position.xy;\n","vs:DECKGL_FILTER_COLOR":"\nif (fill_patternEnabled) {\nfill_patternBounds = FILL_PATTERN_FRAME_ATTRIB / vec4(fill_patternTextureSize, fill_patternTextureSize);\nfill_patternPlacement.xy = FILL_PATTERN_OFFSET_ATTRIB;\nfill_patternPlacement.zw = FILL_PATTERN_SCALE_ATTRIB * FILL_PATTERN_FRAME_ATTRIB.zw;\n}\n","fs:DECKGL_FILTER_COLOR":"\nif (fill_patternEnabled) {\nvec2 scale = FILL_UV_SCALE * fill_patternPlacement.zw;\nvec2 patternUV = mod(mod(fill_uvCoordinateOrigin, scale) + fill_uvCoordinateOrigin64Low + fill_uv, scale) / scale;\npatternUV = mod(fill_patternPlacement.xy + patternUV, 1.0);\nvec2 texCoords = fill_patternBounds.xy + fill_patternBounds.zw * patternUV;\nvec4 patternColor = texture(fill_patternTexture, texCoords);\ncolor.a *= patternColor.a;\nif (!fill_patternMask) {\ncolor.rgb = patternColor.rgb;\n}\n}\n"},dependencies:[id],getUniforms:function(e,t){if(!e)return{};if("fillPatternTexture"in e){let{fillPatternTexture:t}=e;return{fill_patternTexture:t,fill_patternTextureSize:[t.width,t.height]}}if("viewport"in e){let{fillPatternMask:i=!0,fillPatternEnabled:r=!0}=e,{project_uCommonOrigin:n}=t,s=[gf(n[0]),gf(n[1])];return{fill_uvCoordinateOrigin:n.slice(0,2),fill_uvCoordinateOrigin64Low:s,fill_patternMask:i,fill_patternEnabled:r}}return{}}},nF={fillPatternEnabled:!0,fillPatternAtlas:{type:"image",value:null,async:!0,parameters:{lodMaxClamp:0}},fillPatternMapping:{type:"object",value:{},async:!0},fillPatternMask:!0,getFillPattern:{type:"accessor",value:e=>e.pattern},getFillPatternScale:{type:"accessor",value:1},getFillPatternOffset:{type:"accessor",value:[0,0]}},sF=class extends Wb{constructor({pattern:e=!1}={}){super({pattern:e})}isEnabled(e){return null!==e.getAttributeManager()&&!("pathTesselator"in e.state)}getShaders(e){return e.isEnabled(this)?{modules:[e.opts.pattern&&rF].filter(Boolean)}:null}initializeState(e,t){if(!t.isEnabled(this))return;let i=this.getAttributeManager();t.opts.pattern&&i.add({fillPatternFrames:{size:4,accessor:"getFillPattern",transform:t.getPatternFrame.bind(this),shaderAttributes:{fillPatternFrames:{divisor:0},instanceFillPatternFrames:{divisor:1}}},fillPatternScales:{size:1,accessor:"getFillPatternScale",defaultValue:1,shaderAttributes:{fillPatternScales:{divisor:0},instanceFillPatternScales:{divisor:1}}},fillPatternOffsets:{size:2,accessor:"getFillPatternOffset",shaderAttributes:{fillPatternOffsets:{divisor:0},instanceFillPatternOffsets:{divisor:1}}}}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState({props:e,oldProps:t},i){i.isEnabled(this)&&e.fillPatternMapping&&e.fillPatternMapping!==t.fillPatternMapping&&this.getAttributeManager().invalidate("getFillPattern")}draw(e,t){if(!t.isEnabled(this))return;let{fillPatternAtlas:i}=this.props;this.setModuleParameters({fillPatternTexture:i||this.state.emptyTexture})}finalizeState(){this.state.emptyTexture?.delete()}getPatternFrame(e){let{fillPatternMapping:t}=this.getCurrentLayer().props,i=t&&t[e];return i?[i.x,i.y,i.width,i.height]:[0,0,0,0]}},oF=sF;sF.defaultProps=nF,sF.extensionName="FillStyleExtension";var aF={clipBounds:[0,0,1,1],clipByInstance:void 0},lF="\nuniform vec4 clip_bounds;\nbool clip_isInBounds(vec2 position) {\nreturn position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n",uF={name:"clip-vs",vs:lF},hF={"vs:#decl":"\nout float clip_isVisible;\n","vs:DECKGL_FILTER_GL_POSITION":"\nclip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n","fs:#decl":"\nin float clip_isVisible;\n","fs:DECKGL_FILTER_COLOR":"\nif (clip_isVisible < 0.5) discard;\n"},cF={name:"clip-fs",fs:lF},dF={"vs:#decl":"\nout vec2 clip_commonPosition;\n","vs:DECKGL_FILTER_GL_POSITION":"\nclip_commonPosition = geometry.position.xy;\n","fs:#decl":"\nin vec2 clip_commonPosition;\n","fs:DECKGL_FILTER_COLOR":"\nif (!clip_isInBounds(clip_commonPosition)) discard;\n"},fF=class extends Wb{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return void 0!==this.props.clipByInstance&&(e=Boolean(this.props.clipByInstance)),this.state.clipByInstance=e,e?{modules:[uF],inject:hF}:{modules:[cF],inject:dF}}draw({uniforms:e}){let{clipBounds:t}=this.props;if(this.state.clipByInstance)e.clip_bounds=t;else{let i=this.projectPosition([t[0],t[1],0]),r=this.projectPosition([t[2],t[3],0]);e.clip_bounds=[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[0],r[0]),Math.max(i[1],r[1])]}}},pF=fF;fF.defaultProps=aF,fF.extensionName="ClipExtension";var gF={name:"collision",dependencies:[id],vs:"\n#ifdef NON_INSTANCED_MODEL\nin float collisionPriorities;\n#else\nin float instanceCollisionPriorities;\n#endif\nuniform sampler2D collision_texture;\nuniform bool collision_sort;\nuniform bool collision_enabled;\nvec2 collision_getCoords(vec4 position) {\nvec4 collision_clipspace = project_common_position_to_clipspace(position);\nreturn (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;\n}\nfloat collision_match(vec2 tex, vec3 pickingColor) {\nvec4 collision_pickingColor = texture(collision_texture, tex);\nfloat delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));\nfloat e = 0.001;\nreturn step(delta, e);\n}\nfloat collision_isVisible(vec2 texCoords, vec3 pickingColor) {\nif (!collision_enabled) {\nreturn 1.0;\n}\nconst int N = 2;\nfloat accumulator = 0.0;\nvec2 step = vec2(1.0 / project_uViewportSize);\nconst float floatN = float(N);\nvec2 delta = -floatN * step;\nfor(int i = -N; i <= N; i++) {\ndelta.x = -step.x * floatN;\nfor(int j = -N; j <= N; j++) {\naccumulator += collision_match(texCoords + delta, pickingColor);\ndelta.x += step.x;\n}\ndelta.y += step.y;\n}\nfloat W = 2.0 * floatN + 1.0;\nreturn pow(accumulator / (W * W), 2.2);\n}\n",inject:{"vs:#decl":"\nfloat collision_fade = 1.0;\n","vs:DECKGL_FILTER_GL_POSITION":"\nif (collision_sort) {\n#ifdef NON_INSTANCED_MODEL\nfloat collisionPriority = collisionPriorities;\n#else\nfloat collisionPriority = instanceCollisionPriorities;\n#endif\nposition.z = -0.001 * collisionPriority * position.w;\n}\nif (collision_enabled) {\nvec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));\nvec2 collision_texCoords = collision_getCoords(collision_common_position);\ncollision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);\nif (collision_fade < 0.0001) {\nposition = vec4(0.0, 0.0, 2.0, 1.0);\n}\n}\n","vs:DECKGL_FILTER_COLOR":"\ncolor.a *= collision_fade;\n"},getUniforms:(e,t)=>{if(!e||!("dummyCollisionMap"in e))return{};let{collisionFBO:i,drawToCollisionMap:r,dummyCollisionMap:n}=e;return{collision_sort:Boolean(r),collision_texture:!r&&i?i.colorAttachments[0]:n}}},mF=class extends rf{renderCollisionMap(e,t){let i=[1,1,e.width-2,e.height-2];this.render({...t,clearColor:[0,0,0,0],scissorRect:i,target:e,pass:"collision"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}getModuleParameters(){return{drawToCollisionMap:!0,picking:{isActive:1,isAttribute:!1},lightSources:{}}}},_F={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},vF=class extends Wb{getShaders(){return{modules:[gF]}}draw({uniforms:e,context:t,moduleParameters:i}){let{collisionEnabled:r}=this.props,{collisionFBO:n,drawToCollisionMap:s}=i,o=r&&Boolean(n);e.collision_enabled=o,s&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,t){null!==this.getAttributeManager()&&(this.context.deck?._addDefaultEffect(new class{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;let{device:t}=e;this.dummyCollisionMap=t.createTexture({width:1,height:1}),this.collisionFilterPass=new mF(t,{id:"default-collision-filter"})}preRender({effects:e,layers:t,layerFilter:i,viewports:r,onViewportActive:n,views:s,isPicking:o,preRenderStats:a={}}){let{device:l}=this.context;if(o)return;let u=t.filter((({props:{visible:e,collisionEnabled:t}})=>e&&t));if(0===u.length)return void(this.channels={});let h=e?.filter((e=>e.useInPicking&&a[e.id])),c=a["mask-effect"]?.didRender,d=this._groupByCollisionGroup(l,u),f=r[0],p=!this.lastViewport||!this.lastViewport.equals(f)||c;for(let e in d){let t=this.collisionFBOs[e],r=d[e],[o,a]=l.canvasContext.getPixelSize();t.resize({width:o/2,height:a/2}),this._render(r,{effects:h,layerFilter:i,onViewportActive:n,views:s,viewport:f,viewportChanged:p})}}_render(e,{effects:t,layerFilter:i,onViewportActive:r,views:n,viewport:s,viewportChanged:o}){let{collisionGroup:a}=e,l=this.channels[a];if(!l)return;let u=o||e===l||!sg(l.layers,e.layers,1)||e.layerBounds.some(((e,t)=>!xo(e,l.layerBounds[t])))||e.allLayersLoaded!==l.allLayersLoaded||e.layers.some((e=>e.props.transitions));if(this.channels[a]=e,u){this.lastViewport=s;let o=this.collisionFBOs[a];this.collisionFilterPass.renderCollisionMap(o,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:t,layerFilter:i,viewports:s?[s]:[],onViewportActive:r,views:n,moduleParameters:{dummyCollisionMap:this.dummyCollisionMap,devicePixelRatio:o.device.canvasContext.getDevicePixelRatio()/2}})}}_groupByCollisionGroup(e,t){let i={};for(let e of t){let{collisionGroup:t}=e.props,r=i[t];r||(r={collisionGroup:t,layers:[],layerBounds:[],allLayersLoaded:!0},i[t]=r),r.layers.push(e),r.layerBounds.push(e.getBounds()),e.isLoaded||(r.allLayersLoaded=!1)}for(let t of Object.keys(i))this.collisionFBOs[t]||this.createFBO(e,t),this.channels[t]||(this.channels[t]=i[t]);for(let e of Object.keys(this.collisionFBOs))i[e]||this.destroyFBO(e);return i}getModuleParameters(e){let{collisionGroup:t}=e.props,{collisionFBOs:i,dummyCollisionMap:r}=this;return{collisionFBO:i[t],dummyCollisionMap:r}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(let e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,t){let{width:i,height:r}=e.gl.canvas,n=e.createTexture({format:"rgba8unorm",width:i,height:r,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:i,height:r,mipmaps:!1,dataFormat:6402,type:5125});this.collisionFBOs[t]=e.createFramebuffer({id:`collision-${t}`,width:i,height:r,colorAttachments:[n],depthStencilAttachment:s})}destroyFBO(e){let t=this.collisionFBOs[e];t.colorAttachments[0]?.destroy(),t.depthStencilAttachment?.destroy(),t.destroy(),delete this.collisionFBOs[e]}}),this.getAttributeManager().add({collisionPriorities:{size:1,accessor:"getCollisionPriority",shaderAttributes:{collisionPriorities:{divisor:0},instanceCollisionPriorities:{divisor:1}}}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}},yF=vF;vF.defaultProps=_F,vF.extensionName="CollisionFilterExtension";var bF={name:"mask",dependencies:[id],vs:"\nuniform vec4 mask_bounds;\nuniform bool mask_maskByInstance;\nvec2 mask_getCoords(vec4 position) {\nreturn (position.xy - mask_bounds.xy) / (mask_bounds.zw - mask_bounds.xy);\n}\n",fs:"\nuniform sampler2D mask_texture;\nuniform int mask_channel;\nuniform bool mask_enabled;\nuniform bool mask_inverted;\nbool mask_isInBounds(vec2 texCoords) {\nif (!mask_enabled) {\nreturn true;\n}\nvec4 maskColor = texture(mask_texture, texCoords);\nfloat maskValue = 1.0;\nif (mask_channel == 0) {\nmaskValue = maskColor.r;\n} else if (mask_channel == 1) {\nmaskValue = maskColor.g;\n} else if (mask_channel == 2) {\nmaskValue = maskColor.b;\n} else if (mask_channel == 3) {\nmaskValue = maskColor.a;\n}\nif (mask_inverted) {\nreturn maskValue >= 0.5;\n} else {\nreturn maskValue < 0.5;\n}\n}\n",inject:{"vs:#decl":"\nout vec2 mask_texCoords;\n","vs:#main-end":"\nvec4 mask_common_position;\nif (mask_maskByInstance) {\nmask_common_position = project_position(vec4(geometry.worldPosition, 1.0));\n} else {\nmask_common_position = geometry.position;\n}\nmask_texCoords = mask_getCoords(mask_common_position);\n","fs:#decl":"\nin vec2 mask_texCoords;\n","fs:#main-start":"\nif (mask_enabled) {\nbool mask = mask_isInBounds(mask_texCoords);\nfragColor = texture(mask_texture, mask_texCoords);\nif (!mask) discard;\n}\n"},getUniforms:e=>e&&"maskMap"in e?{mask_texture:e.maskMap}:{}},AF={blendColorOperation:"subtract",blendColorSrcFactor:"zero",blendColorDstFactor:"one",blendAlphaOperation:"subtract",blendAlphaSrcFactor:"zero",blendAlphaDstFactor:"one"},EF=class extends rf{constructor(e,t){super(e,t);let{mapSize:i=2048}=t;this.maskMap=e.createTexture({format:"rgba8unorm",width:i,height:i,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.fbo=e.createFramebuffer({id:"maskmap",width:i,height:i,colorAttachments:[this.maskMap]})}render(e){let t=2**e.channel;super.render({...e,clearColor:[255,255,255,255],colorMask:t,target:this.fbo,pass:"mask"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!0,depthTest:!1,...AF}}shouldDrawLayer(e){return e.props.operation.includes("mask")}delete(){this.fbo.delete(),this.maskMap.delete()}};function wF(e,t){let i=[1/0,1/0,-1/0,-1/0];for(let r of e){let e=r.getBounds();if(e){let n=r.projectPosition(e[0],{viewport:t,autoOffset:!1}),s=r.projectPosition(e[1],{viewport:t,autoOffset:!1});i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],s[0]),i[3]=Math.max(i[3],s[1])}}return Number.isFinite(i[0])?i:null}function xF(e){let{bounds:t,viewport:i,border:r=0}=e,{isGeospatial:n}=i;if(t[2]<=t[0]||t[3]<=t[1])return null;let s=i.unprojectPosition([(t[0]+t[2])/2,(t[1]+t[3])/2,0]),{width:o,height:a,zoom:l}=e;if(void 0===l){o-=2*r,a-=2*r;let e=Math.min(o/(t[2]-t[0]),a/(t[3]-t[1]));l=Math.min(Math.log2(e),20)}else if(!o||!a){let e=2**l;o=Math.round(Math.abs(t[2]-t[0])*e),a=Math.round(Math.abs(t[3]-t[1])*e);let i=2048-2*r;if(o>i||a>i){let e=i/Math.max(o,a);o=Math.round(o*e),a=Math.round(a*e),l+=Math.log2(e)}}return n?new Tf({id:i.id,x:r,y:r,width:o,height:a,longitude:s[0],latitude:s[1],zoom:l,orthographic:!0}):new Tb({id:i.id,x:r,y:r,width:o,height:a,target:s,zoom:l,flipY:!1})}function TF(e,t,i){if(!e)return[0,0,1,1];let r=function(e,t){let i;if(t&&2===t.length){let[r,n]=t,s=e.getBounds({z:r}),o=e.getBounds({z:n});i=[Math.min(s[0],o[0]),Math.min(s[1],o[1]),Math.max(s[2],o[2]),Math.max(s[3],o[3])]}else i=e.getBounds();let r=e.projectPosition(i.slice(0,2)),n=e.projectPosition(i.slice(2,4));return[r[0],r[1],n[0],n[1]]}(t,i),n=function(e){let t=e[2]-e[0],i=e[3]-e[1],r=(e[0]+e[2])/2,n=(e[1]+e[3])/2;return[r-t,n-i,r+t,n+i]}(r);return e[2]-e[0]<=n[2]-n[0]&&e[3]-e[1]<=n[3]-n[1]?e:[Math.max(e[0],n[0]),Math.max(e[1],n[1]),Math.min(e[2],n[2]),Math.min(e[3],n[3])]}var CF={maskId:"",maskByInstance:void 0,maskInverted:!1},SF=class extends Wb{initializeState(){this.context.deck?._addDefaultEffect(new class{constructor(){this.id="mask-effect",this.props=null,this.useInPicking=!0,this.order=0,this.channels=[],this.masks=null}setup({device:e}){this.dummyMaskMap=e.createTexture({width:1,height:1}),this.maskPass=new EF(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:r,views:n,isPicking:s}){let o=!1;if(s)return{didRender:o};let a=e.filter((e=>e.props.visible&&e.props.operation.includes("mask")));if(0===a.length)return this.masks=null,this.channels.length=0,{didRender:o};this.masks={};let l=this._sortMaskChannels(a),u=i[0],h=!this.lastViewport||!this.lastViewport.equals(u);if(void 0!==u.resolution)return wi.warn("MaskExtension is not supported in GlobeView")(),{didRender:o};for(let e in l){let i=this._renderChannel(l[e],{layerFilter:t,onViewportActive:r,views:n,viewport:u,viewportChanged:h});o||=i}return{didRender:o}}_renderChannel(e,{layerFilter:t,onViewportActive:i,views:r,viewport:n,viewportChanged:s}){let o=!1,a=this.channels[e.index];if(!a)return o;let l=e===a||e.layers.length!==a.layers.length||e.layers.some(((e,t)=>e!==a.layers[t]||e.props.transitions))||e.layerBounds.some(((e,t)=>e!==a.layerBounds[t]));if(e.bounds=a.bounds,e.maskBounds=a.maskBounds,this.channels[e.index]=e,l||s){this.lastViewport=n;let s=wF(e.layers,n);if(e.bounds=s&&TF(s,n),l||!xo(e.bounds,a.bounds)){let{maskPass:a,maskMap:l}=this,u=s&&xF({bounds:e.bounds,viewport:n,width:l.width,height:l.height,border:1});e.maskBounds=u?u.getBounds():[0,0,1,1],a.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:t,viewports:u?[u]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}}),o=!0}}return this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem},o}_sortMaskChannels(e){let t={},i=0;for(let r of e){let{id:e}=r.root,n=t[e];if(!n){if(++i>4){wi.warn("Too many mask layers. The max supported is 4")();continue}n={id:e,index:this.channels.findIndex((t=>t?.id===e)),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},t[e]=n}n.layers.push(r),n.layerBounds.push(r.getBounds())}for(let e=0;e<4;e++){let i=this.channels[e];(!i||!(i.id in t))&&(this.channels[e]=null)}for(let e in t){let i=t[e];i.index<0&&(i.index=this.channels.findIndex((e=>!e)),this.channels[i.index]=i)}return t}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}})}getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return void 0!==this.props.maskByInstance&&(e=Boolean(this.props.maskByInstance)),this.state.maskByInstance=e,{modules:[bF]}}draw({uniforms:e,context:t,moduleParameters:i}){e.mask_maskByInstance=this.state.maskByInstance;let{maskId:r,maskInverted:n}=this.props,{maskChannels:s}=i,{viewport:o}=t;if(s&&s[r]){let{index:t,bounds:i,coordinateOrigin:a}=s[r],{coordinateSystem:l}=s[r];e.mask_enabled=!0,e.mask_channel=t,e.mask_inverted=n,l===Nc.DEFAULT&&(l=o.isGeospatial?Nc.LNGLAT:Nc.CARTESIAN);let u={modelMatrix:null,fromCoordinateOrigin:a,fromCoordinateSystem:l},h=this.projectPosition([i[0],i[1],0],u),c=this.projectPosition([i[2],i[3],0],u);e.mask_bounds=[h[0],h[1],c[0],c[1]]}else r&&wi.warn(`Could not find a mask layer with id: ${r}`)(),e.mask_enabled=!1}},PF=SF;SF.defaultProps=CF,SF.extensionName="MaskExtension";var MF={NONE:0,WRITE_HEIGHT_MAP:1,USE_HEIGHT_MAP:2,USE_COVER:3,USE_COVER_ONLY:4,SKIP:5},RF=Object.keys(MF).map((e=>`const float TERRAIN_MODE_${e} = ${MF[e]}.0;`)).join("\n"),IF={name:"terrain",dependencies:[id],inject:{"vs:#decl":"\nuniform float terrain_mode;\nuniform sampler2D terrain_map;\nuniform vec4 terrain_bounds;\nout vec3 commonPos;\n"+RF,"vs:#main-start":"\nif (terrain_mode == TERRAIN_MODE_SKIP) {\ngl_Position = vec4(0.0);\nreturn;\n}\n","vs:DECKGL_FILTER_GL_POSITION":"\ncommonPos = geometry.position.xyz;\nif (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {\nvec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;\nposition = vec4(texCoords * 2.0 - 1.0, 0.0, 1.0);\ncommonPos.z += project_uCommonOrigin.z;\n}\nif (terrain_mode == TERRAIN_MODE_USE_HEIGHT_MAP) {\nvec3 anchor = geometry.worldPosition;\nanchor.z = 0.0;\nvec3 anchorCommon = project_position(anchor);\nvec2 texCoords = (anchorCommon.xy - terrain_bounds.xy) / terrain_bounds.zw;\nif (texCoords.x >= 0.0 && texCoords.y >= 0.0 && texCoords.x <= 1.0 && texCoords.y <= 1.0) {\nfloat terrainZ = texture(terrain_map, texCoords).r;\ngeometry.position.z += terrainZ;\nposition = project_common_position_to_clipspace(geometry.position);\n}\n}\n","fs:#decl":"\nuniform float terrain_mode;\nuniform sampler2D terrain_map;\nuniform vec4 terrain_bounds;\nin vec3 commonPos;\n"+RF,"fs:#main-start":"\nif (terrain_mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {\nfragColor = vec4(commonPos.z, 0.0, 0.0, 1.0);\nreturn;\n}\n","fs:DECKGL_FILTER_COLOR":"\nif ((terrain_mode == TERRAIN_MODE_USE_COVER) || (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY)) {\nvec2 texCoords = (commonPos.xy - terrain_bounds.xy) / terrain_bounds.zw;\nvec4 pixel = texture(terrain_map, texCoords);\nif (terrain_mode == TERRAIN_MODE_USE_COVER_ONLY) {\ncolor = pixel;\n} else {\ncolor = pixel + color * (1.0 - pixel.a);\n}\nreturn;\n}\n"},getUniforms:(e={},t)=>{if("dummyHeightMap"in e){let{drawToTerrainHeightMap:i,heightMap:r,heightMapBounds:n,dummyHeightMap:s,terrainCover:o,useTerrainHeightMap:a,terrainSkipRender:l}=e,{project_uCommonOrigin:u}=t,h=l?MF.SKIP:MF.NONE,c=s,d=null;if(i)h=MF.WRITE_HEIGHT_MAP,d=n;else if(a&&r)h=MF.USE_HEIGHT_MAP,c=r,d=n;else if(o){let t=e.picking?.isActive;c=(t?o.getPickingFramebuffer():o.getRenderFramebuffer())?.colorAttachments[0].texture,t&&(h=MF.SKIP),c?(h=h===MF.SKIP?MF.USE_COVER_ONLY:MF.USE_COVER,d=o.bounds):c=s}return{terrain_mode:h,terrain_map:c,terrain_bounds:d?[d[0]-u[0],d[1]-u[1],d[2]-d[0],d[3]-d[1]]:[0,0,0,0]}}return null}};function BF(e,t){return e.createFramebuffer({id:t.id,colorAttachments:[e.createTexture({id:t.id,...t.float&&{format:"rgba32float",type:5126},mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}})]})}function LF(e){for(;e;){let{tile:t}=e.props;if(t)return t;e=e.parent}return null}var OF={blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},FF=class extends rf{getRenderableLayers(e,t){let{layers:i}=t,r=[],n=this._getDrawLayerParams(e,t,!0);for(let e=0;e<i.length;e++){let t=i[e];!t.isComposite&&n[e].shouldDrawLayer&&r.push(t)}return r}renderHeightMap(e,t){let i=e.getRenderFramebuffer(),r=e.renderViewport;!i||!r||(i.resize(r),this.render({...t,target:i,pass:"terrain-height-map",layers:t.layers,viewports:[r],effects:[],clearColor:[0,0,0,0]}))}renderTerrainCover(e,t){let i=e.getRenderFramebuffer(),r=e.renderViewport;if(!i||!r)return;let n=e.filterLayers(t.layers);i.resize(r),this.render({...t,target:i,pass:`terrain-cover-${e.id}`,layers:n,effects:[],viewports:[r],clearColor:[0,0,0,0]})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!0,depthTest:!1,...e.props.operation.includes("terrain")&&OF}}},NF=class extends zp{constructor(){super(...arguments),this.drawParameters={}}getRenderableLayers(e,t){let{layers:i}=t,r=[];this.drawParameters={},this._resetColorEncoder(t.pickZ);let n=this._getDrawLayerParams(e,t);for(let e=0;e<i.length;e++){let t=i[e];!t.isComposite&&n[e].shouldDrawLayer&&(r.push(t),this.drawParameters[t.id]=n[e].layerParameters)}return r}renderTerrainCover(e,t){let i=e.getPickingFramebuffer(),r=e.renderViewport;if(!i||!r)return;let n=e.filterLayers(t.layers),s=e.targetLayer;s.props.pickable&&n.unshift(s),i.resize(r),this.render({...t,pickingFBO:i,pass:`terrain-cover-picking-${e.id}`,layers:n,effects:[],viewports:[r],cullRect:void 0,deviceRect:r,pickZ:!1})}getLayerParameters(e,t,i){let r;return this.drawParameters[e.id]?r=this.drawParameters[e.id]:(r=super.getLayerParameters(e,t,i),r.blend=!0),{...r,depthTest:!1}}},DF=class{static isSupported(e){return e.isTextureFormatRenderable("rgba32float")}constructor(e){this.renderViewport=null,this.bounds=null,this.layers=[],this.layersBounds=[],this.layersBoundsCommon=null,this.lastViewport=null,this.device=e}getRenderFramebuffer(){return this.renderViewport?(this.fbo||(this.fbo=BF(this.device,{id:"height-map",float:!0})),this.fbo):null}shouldUpdate({layers:e,viewport:t}){let i=e.length!==this.layers.length||e.some(((e,t)=>e!==this.layers[t]||e.props.transitions||e.getBounds()!==this.layersBounds[t]));i&&(this.layers=e,this.layersBounds=e.map((e=>e.getBounds())),this.layersBoundsCommon=wF(e,t));let r=!this.lastViewport||!t.equals(this.lastViewport);if(this.layersBoundsCommon){if(i||r){let e=TF(this.layersBoundsCommon,t);if(e[2]<=e[0]||e[3]<=e[1])return this.renderViewport=null,!1;this.bounds=e,this.lastViewport=t;let i=t.scale,r=(e[2]-e[0])*i,n=(e[3]-e[1])*i;return this.renderViewport=r>0||n>0?xF({bounds:[t.center[0]-1,t.center[1]-1,t.center[0]+1,t.center[1]+1],zoom:t.zoom,width:Math.min(r,2048),height:Math.min(n,2048),viewport:t}):null,!0}}else this.renderViewport=null;return!1}delete(){this.fbo&&(this.fbo.colorAttachments[0].delete(),this.fbo.delete())}},kF={terrainDrawMode:void 0},UF=class extends Wb{getShaders(){return{modules:[IF]}}initializeState(){this.context.deck?._addDefaultEffect(new class{constructor(){this.id="terrain-effect",this.props=null,this.useInPicking=!0,this.isPicking=!1,this.isDrapingEnabled=!1,this.terrainCovers=new Map}setup({device:e,deck:t}){this.dummyHeightMap=e.createTexture({width:1,height:1,data:new Uint8Array([0,0,0,0])}),this.terrainPass=new FF(e,{id:"terrain"}),this.terrainPickingPass=new NF(e,{id:"terrain-picking"}),DF.isSupported(e)?this.heightMap=new DF(e):wi.warn("Terrain offset mode is not supported by this browser")(),t._addDefaultShaderModule(IF)}preRender(e){if(e.pickZ)return void(this.isDrapingEnabled=!1);let{viewports:t}=e,i=e.pass.startsWith("picking");this.isPicking=i,this.isDrapingEnabled=!0;let r=t[0],n=(i?this.terrainPickingPass:this.terrainPass).getRenderableLayers(r,e),s=n.filter((e=>e.props.operation.includes("terrain")));if(0===s.length)return;i||n.filter((e=>"offset"===e.state.terrainDrawMode)).length>0&&this._updateHeightMap(s,r,e);let o=n.filter((e=>"drape"===e.state.terrainDrawMode));this._updateTerrainCovers(s,o,r,e)}getModuleParameters(e){let{terrainDrawMode:t}=e.state;return{heightMap:this.heightMap?.getRenderFramebuffer()?.colorAttachments[0].texture||null,heightMapBounds:this.heightMap?.bounds,dummyHeightMap:this.dummyHeightMap,terrainCover:this.isDrapingEnabled?this.terrainCovers.get(e.id):null,useTerrainHeightMap:"offset"===t,terrainSkipRender:"drape"===t||!e.props.operation.includes("draw")}}cleanup({deck:e}){this.dummyHeightMap&&(this.dummyHeightMap.delete(),this.dummyHeightMap=void 0),this.heightMap&&(this.heightMap.delete(),this.heightMap=void 0);for(let e of this.terrainCovers.values())e.delete();this.terrainCovers.clear(),e._removeDefaultShaderModule(IF)}_updateHeightMap(e,t,i){!this.heightMap||!this.heightMap.shouldUpdate({layers:e,viewport:t})||this.terrainPass.renderHeightMap(this.heightMap,{...i,layers:e,moduleParameters:{heightMapBounds:this.heightMap.bounds,dummyHeightMap:this.dummyHeightMap,devicePixelRatio:1,drawToTerrainHeightMap:!0}})}_updateTerrainCovers(e,t,i,r){let n={};for(let e of t)e.state.terrainCoverNeedsRedraw&&(n[e.id]=!0,e.state.terrainCoverNeedsRedraw=!1);for(let e of this.terrainCovers.values())e.isDirty=e.isDirty||e.shouldUpdate({layerNeedsRedraw:n});for(let n of e)this._updateTerrainCover(n,t,i,r);this.isPicking||this._pruneTerrainCovers()}_updateTerrainCover(e,t,i,r){let n=this.isPicking?this.terrainPickingPass:this.terrainPass,s=this.terrainCovers.get(e.id);s||(s=new class{constructor(e){this.isDirty=!0,this.renderViewport=null,this.bounds=null,this.layers=[],this.targetBounds=null,this.targetBoundsCommon=null,this.targetLayer=e,this.tile=LF(e)}get id(){return this.targetLayer.id}get isActive(){return Boolean(this.targetLayer.getCurrentLayer())}shouldUpdate({targetLayer:e,viewport:t,layers:i,layerNeedsRedraw:r}){e&&(this.targetLayer=e);let n=!!t&&this._updateViewport(t),s=!!i&&this._updateLayers(i);if(r)for(let e of this.layers)if(r[e]){s=!0;break}return s||n}_updateLayers(e){let t=!1;if(e=this.tile?function(e,t){return t.filter((t=>{let i=LF(t);return!i||function(e,t){return!(!e||!t)&&e[0][0]<t[1][0]&&t[0][0]<e[1][0]&&e[0][1]<t[1][1]&&t[0][1]<e[1][1]}(e.boundingBox,i.boundingBox)}))}(this.tile,e):e,e.length!==this.layers.length)t=!0;else for(let i=0;i<e.length;i++)if(e[i].id!==this.layers[i]){t=!0;break}return t&&(this.layers=e.map((e=>e.id))),t}_updateViewport(e){let t=this.targetLayer,i=!1;if(this.tile&&"boundingBox"in this.tile){if(!this.targetBounds){i=!0,this.targetBounds=this.tile.boundingBox;let t=e.projectPosition(this.targetBounds[0]),r=e.projectPosition(this.targetBounds[1]);this.targetBoundsCommon=[t[0],t[1],r[0],r[1]]}}else this.targetBounds!==t.getBounds()&&(i=!0,this.targetBounds=t.getBounds(),this.targetBoundsCommon=wF([t],e));if(!this.targetBoundsCommon)return!1;let r=Math.ceil(e.zoom+.5);if(this.tile)this.bounds=this.targetBoundsCommon;else{let t=this.renderViewport?.zoom;i=i||r!==t;let n=TF(this.targetBoundsCommon,e),s=this.bounds;i=i||!s||n.some(((e,t)=>e!==s[t])),this.bounds=n}return i&&(this.renderViewport=xF({bounds:this.bounds,zoom:r,viewport:e})),i}getRenderFramebuffer(){return this.renderViewport&&0!==this.layers.length?(this.fbo||(this.fbo=BF(this.targetLayer.context.device,{id:this.id})),this.fbo):null}getPickingFramebuffer(){return!this.renderViewport||0===this.layers.length&&!this.targetLayer.props.pickable?null:(this.pickingFbo||(this.pickingFbo=BF(this.targetLayer.context.device,{id:`${this.id}-picking`})),this.pickingFbo)}filterLayers(e){return e.filter((({id:e})=>this.layers.includes(e)))}delete(){let{fbo:e,pickingFbo:t}=this;e&&(e.colorAttachments[0].destroy(),e.destroy()),t&&(t.colorAttachments[0].destroy(),t.destroy())}}(e),this.terrainCovers.set(e.id,s));try{let o=s.shouldUpdate({targetLayer:e,viewport:i,layers:t});(this.isPicking||s.isDirty||o)&&(n.renderTerrainCover(s,{...r,layers:t,moduleParameters:{dummyHeightMap:this.dummyHeightMap,terrainSkipRender:!1,devicePixelRatio:1}}),this.isPicking||(s.isDirty=!1))}catch(t){e.raiseError(t,`Error rendering terrain cover ${s.id}`)}}_pruneTerrainCovers(){let e=[];for(let[t,i]of this.terrainCovers)i.isActive||e.push(t);for(let t of e)this.terrainCovers.delete(t)}})}updateState(e){let{props:t,oldProps:i}=e;if(this.state.terrainDrawMode&&t.terrainDrawMode===i.terrainDrawMode&&t.extruded===i.extruded)return;let{terrainDrawMode:r}=t;if(!r){let e=this.props.extruded,t=this.getAttributeManager()?.attributes;r=e||t&&"instancePositions"in t?"offset":"drape"}this.setState({terrainDrawMode:r})}onNeedsRedraw(){let e=this.state;"drape"===e.terrainDrawMode&&(e.terrainCoverNeedsRedraw=!0)}},GF=UF;function zF(e,t){let i=t?.globalFeatureId;return void 0!==i?function(e,t){let i=jF(e);for(let e of i){let i=0,r=e.featureIds.value[0];for(let n=0;n<e.featureIds.value.length;n++){let s=e.featureIds.value[n];if(s!==r){if(t===e.globalFeatureIds.value[i])return HF(e,i,n);i=n,r=s}}if(t===e.globalFeatureIds.value[i])return HF(e,i,e.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}(e,i):function(e,t){let i=jF(e);return function(e){let t=[];for(let i of e){if(0===i.featureIds.value.length)continue;let e=0,r=i.featureIds.value[0];for(let n=0;n<i.featureIds.value.length;n++){let s=i.featureIds.value[n];s!==r&&(t.push(HF(i,e,n)),e=n,r=s)}t.push(HF(i,e,i.featureIds.value.length))}return t}(i)}(e,t?.type)}function VF(e,t,i){switch(e.type){case"Point":return function(e,t,i){let{positions:r}=e,n=XF(r,t,i);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}(e,t,i);case"LineString":return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,{positions:r}=e,n=e.pathIndices.value.filter((e=>e>=t&&e<=i));if(!(n.length>2))return{type:"LineString",coordinates:XF(r,n[0],n[1])};let s=[];for(let e=0;e<n.length-1;e++){let t=XF(r,n[e],n[e+1]);s.push(t)}return{type:"MultiLineString",coordinates:s}}(e,t,i);case"Polygon":return WF(e,t,i);default:let r=e;throw new Error(`Unsupported geometry type: ${r?.type}`)}}function jF(e,t){let i=[];return e.points&&(e.points.type="Point",i.push(e.points)),e.lines&&(e.lines.type="LineString",i.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",i.push(e.polygons)),i}function HF(e,t,i){let r=VF(e,t,i),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=Object.assign({},e.properties[e.featureIds.value[t]]);for(let r in e.numericProps)i[r]=e.numericProps[r].value[t];return i}(e,t,i),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.fields&&e.fields[e.featureIds.value[t]]}(e,t,i);return{type:"Feature",geometry:r,properties:n,...s}}function WF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,{positions:r}=e,n=e.polygonIndices.value.filter((e=>e>=t&&e<=i)),s=e.primitivePolygonIndices.value.filter((e=>e>=t&&e<=i));if(!(n.length>2)){let e=[];for(let t=0;t<s.length-1;t++){let i=XF(r,s[t],s[t+1]);e.push(i)}return{type:"Polygon",coordinates:e}}let o=[];for(let t=0;t<n.length-1;t++){let i=WF(e,n[t],n[t+1]).coordinates;o.push(i)}return{type:"MultiPolygon",coordinates:o}}function XF(e,t,i){t=t||0,i=i||e.value.length/e.size;let r=[];for(let n=t;n<i;n++){let t=Array();for(let i=n*e.size;i<(n+1)*e.size;i++)t.push(Number(e.value[i]));r.push(t)}return r}UF.defaultProps=kF,UF.extensionName="TerrainExtension",h(B(),1);var qF={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:"4.1.4",extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}},KF={Point:$F,MultiPoint:function(e,t,i){return JF(e,t,i)},LineString:YF,MultiLineString:function(e,t,i){return e.map((e=>YF(e,t,i)))},Polygon:ZF,MultiPolygon:function(e,t,i){return e.map((e=>ZF(e,t,i)))}};function $F([e,t],[i,r],n){let s=wo(i[0],r[0],e),o=wo(i[1],r[1],t);return n.unprojectFlat([s,o])}function JF(e,t,i){return e.map((e=>$F(e,t,i)))}function YF(e,t,i){return JF(e,t,i)}function ZF(e,t,i){return e.map((e=>JF(e,t,i)))}var QF=["points","lines","polygons"];function eN(e,t,i,r){let n=e.featureIds.value;if(!n.length)return-1;let s=0,o=n[n.length-1]+1;if(r){let t=function(e,t){if(!e.__layers){let t={},{properties:i}=e;for(let e=0;e<i.length;e++){let{layerName:r}=i[e];r&&(t[r]?t[r][1]=e:t[r]=[e,e])}e.__layers=t}return e.__layers[t]}(e,r);if(!t)return-1;s=t[0],o=t[1]+1}let a=-1;if(t in e.numericProps){let r=e.numericProps[t].value.findIndex(((e,t)=>e===i&&n[t]>=s&&n[t]<o));return r>=0?e.globalFeatureIds.value[r]:-1}return t?a=tN(e.properties,(e=>e[t]===i),s,o):e.fields&&(a=tN(e.fields,(e=>e.id===i),s,o)),a>=0?function(e,t){if(!e.__ids){let t=[],i=e.featureIds.value,r=e.globalFeatureIds.value;for(let e=0;e<i.length;e++)t[i[e]]=r[e];e.__ids=t}return e.__ids[t]}(e,a):-1}function tN(e,t,i,r){for(let n=i;n<r;n++)if(t(e[n],n))return n;return-1}var iN={...Bw.defaultProps,data:qT,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[qF],binary:!0},rN=class extends pC{initializeState(){super.initializeState();let e=void 0===this.context.viewport.resolution&&this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return Boolean(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:i,changeFlags:r}){r.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:t,context:i,changeFlags:r}),this._setWGS84PropertyForTiles());let{highlightColor:n}=e;n!==t.highlightColor&&Array.isArray(n)&&this.setState({highlightColor:n})}async _updateTileData(){let e=this.props.data,t=null;if("string"!=typeof e||function(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}(e))e&&"object"==typeof e&&"tilejson"in e&&(t=e);else{let{onDataLoad:i,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{t=await r(e,{propName:"data",layer:this,loaders:[]})}catch(t){this.raiseError(t,"loading TileJSON"),e=null}i&&i(t,{propName:"data",layer:this})}t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){let e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:i,maxZoom:r}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>i&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(r)||t.maxzoom<r)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){let{data:t,binary:i}=this.state,{index:r,signal:n}=e,s=$T(t,e);if(!s)return Promise.reject("Invalid URL");let o=this.getLoadOptions(),{fetch:a}=this.props;return o={...o,mimeType:"application/x-protobuf",mvt:{...o?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:r},gis:i?{format:"binary"}:{}},a(s,{propName:"data",layer:this,loadOptions:o,signal:n})}renderSubLayers(e){let{x:t,y:i,z:r}=e.tile.index,n=Math.pow(2,r),s=512/n,o=-s,a=512*t/n,l=512*(1-i/n),u=(new Oh).scale([s,o,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=u,e.coordinateOrigin=[a,l,0],e.coordinateSystem=Nc.CARTESIAN,e.extensions=[...e.extensions||[],new pF]);let h=super.renderSubLayers(e);return this.state.binary&&!(h instanceof Bw)&&wi.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),h}_updateAutoHighlight(e){let{uniqueIdProperty:t}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:r}=this.state,n=e.object,s=null,o=null;n&&(s=sN(n,t),o=oN(n));let{highlightColor:a}=this.props;"function"==typeof a&&(a=a(e)),(i!==s||r!==o)&&this.setState({highlightColor:a,hoveredFeatureId:s,hoveredFeatureLayerName:o})}getPickingInfo(e){let t=super.getPickingInfo(e),i=Boolean(this.context.viewport.resolution);if(this.state.binary&&-1!==t.index){let{data:i}=e.sourceLayer.props;t.object=zF(i,{globalFeatureId:t.index})}return t.object&&!i&&(t.object=lN(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){let{hoveredFeatureId:t,hoveredFeatureLayerName:i,binary:r}=this.state,{uniqueIdProperty:n,highlightedFeatureId:s}=this.props,o=e.content,a=aN(s);if(!aN(t)&&!a)return-1;let l=a?s:t;return Array.isArray(o)?o.findIndex((e=>{let t=sN(e,n)===l,r=a||oN(e)===i;return t&&r})):o&&r?function(e,t,i,r){for(let n of QF){let s=e[n]&&eN(e[n],t,i,r);if(s>=0)return s}return-1}(o,n,l,a?"":i):-1}_pickObjects(e){let{deck:t,viewport:i}=this.context,r=i.width,n=i.height,s=i.x,o=i.y,a=[this.id];return t.pickObjects({x:s,y:o,width:r,height:n,layerIds:a,maxObjects:e})}getRenderedFeatures(e=null){let t=this._pickObjects(e),i=new Set,r=[];for(let e of t){let t=sN(e.object,this.props.uniqueIdProperty);void 0===t?r.push(e.object):i.has(t)||(i.add(t),r.push(e.object))}return r}_setWGS84PropertyForTiles(){let e="dataInWGS84";this.state.tileset.selectedTiles.forEach((t=>{t.hasOwnProperty(e)||Object.defineProperty(t,e,{get:()=>{if(!t.content)return null;if(this.state.binary&&Array.isArray(t.content)&&!t.content.length)return[];let{bbox:e}=t;if(void 0===t._contentWGS84&&function(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}(e)){let i=this.state.binary?zF(t.content):t.content;t._contentWGS84=i.map((t=>lN(t,e,this.context.viewport)))}return t._contentWGS84}})}))}},nN=rN;function sN(e,t){return e.properties&&t?e.properties[t]:"id"in e?e.id:void 0}function oN(e){return e.properties?.layerName||null}function aN(e){return null!=e&&""!==e}function lN(e,t,i){let r={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(r.geometry,"coordinates",{get:()=>function(e,t,i){let r=[i.projectFlat([t.west,t.north]),i.projectFlat([t.east,t.south])];return{...e,coordinates:KF[e.type](e.coordinates,r,i)}}(e.geometry,t,i).coordinates}),r}rN.layerName="MVTLayer",rN.defaultProps=iN;var uN="0123456789bcdefghjkmnpqrstuvwxyz",hN={};for(let e=0;e<32;e++)hN[uN.charAt(e)]=e;var cN=-90,dN=90,fN=-180,pN=180;function gN(e){let[t,i,r,n]=function(e){let t,i=!0,r=dN,n=cN,s=pN,o=fN,a=0;for(let l=0,u=e.length;l<u;l++){let u=e[l].toLowerCase();a=hN[u];for(let e=4;e>=0;e--){let l=a>>e&1;i?(t=(s+o)/2,1===l?o=t:s=t):(t=(r+n)/2,1===l?n=t:r=t),i=!i}}return[n,o,r,s]}(e);return[n,r,n,t,i,t,i,r,n,r]}var mN={getGeohash:{type:"accessor",value:e=>e.geohash}},_N=class extends vx{indexToBounds(){let{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(e,i)=>gN(t(e,i))}}},vN=_N;_N.layerName="GeohashLayer",_N.defaultProps=mN;var yN={};l(yN,{Buffer:()=>Ar,BufferTransform:()=>mp,CubeGeometry:()=>xp,Device:()=>Br,Framebuffer:()=>sn,Geometry:()=>vp,GroupNode:()=>Ep,Model:()=>fp,ModelNode:()=>wp,ScenegraphNode:()=>Ap,SphereGeometry:()=>Op,Texture:()=>Hr,TextureTransform:()=>_p});var bN={};function AN(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing??0,pitch:e.pitch??0}}l(bN,{fetchFile:()=>Je,load:()=>Zt,parse:()=>$t,registerLoaders:()=>Bt});var EN={position:"absolute",left:0,top:0,width:"100%",height:"100%"},wN=class extends Yv{constructor(e){if(typeof document>"u")throw Error("Deck can only be used in the browser");let{mapCanvas:t,deckCanvas:i}=function(e){let{container:t=document.body}=e;if("string"==typeof t&&(t=document.getElementById(t)),!t)throw Error("Deck: container not found");"static"===window.getComputedStyle(t).position&&(t.style.position="relative");let i=document.createElement("div");t.appendChild(i),Object.assign(i.style,EN);let r=document.createElement("canvas");return t.appendChild(r),Object.assign(r.style,EN),{container:t,mapCanvas:i,deckCanvas:r}}(e),r=e.viewState||e.initialViewState,n=Number.isFinite(r&&r.latitude),{map:s=globalThis.mapboxgl||globalThis.maplibregl}=e;super({canvas:i,...e}),s&&s.Map?this._map=n&&new class{constructor(e){this.map=null,this.width=0,this.height=0,this.props={...e},this._initialize(this.props)}finalize(){this.map?.remove(),this.map=null}setProps(e){let t=this.props,i={...this.props,...e};this.props=i,this.map&&this._update(t,i)&&this.redraw()}redraw(){let e=this.map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}getMap(){return this.map}_initialize(e){let{mapLib:t,container:i}=e;t.accessToken=e.mapboxApiAccessToken||"",this.map=new e.mapLib.Map({container:i,maxZoom:24,...e.mapOptions,...AN(e.viewState),style:e.mapStyle,interactive:!1,trackResize:!1}),Object.defineProperty(i,"offsetWidth",{get:()=>this.width}),Object.defineProperty(i,"clientWidth",{get:()=>this.width}),Object.defineProperty(i,"offsetHeight",{get:()=>this.height}),Object.defineProperty(i,"clientHeight",{get:()=>this.height}),this.map.resize()}_update(e,t){e.mapStyle!==t.mapStyle&&this.map.setStyle(t.mapStyle);let i=e.width!==t.width||e.height!==t.height;i&&(this.width=t.width,this.height=t.height,this.map.resize());let r=e.viewState,n=t.viewState,s=n.latitude!==r.latitude||n.longitude!==r.longitude||n.zoom!==r.zoom||n.pitch!==r.pitch||n.bearing!==r.bearing;return s&&this.map.jumpTo(AN(n)),i||s}}({...e,width:0,height:0,viewState:r,container:t,mapLib:s}):this._map=s}getMapboxMap(){return this._map&&this._map.getMap()}finalize(){this._map&&this._map.finalize(),super.finalize()}setProps(e){"mapStyle"in e&&this._map&&this._map.setProps({mapStyle:e.mapStyle}),super.setProps(e)}_drawLayers(e,t){if(this._map){let e=this.getViewports()[0];e&&this._map.setProps({width:e.width,height:e.height,viewState:e})}super._drawLayers(e,t)}};globalThis.luma=globalThis.luma||{},globalThis.loaders=globalThis.loaders||{},Object.assign(globalThis.luma,yN),Object.assign(globalThis.loaders,bN);var xN={SUM:1,MEAN:2,MIN:3,MAX:4};function TN(e,t){return e+t}function CN(e,t){return t>e?t:e}function SN(e,t){return t<e?t:e}function PN(e,t,i){let r=xN[e]||xN.SUM;switch(t=function(e,t={}){return Number.isFinite(e)?e:i=>(t.index=i.index,e(i.source,t))}(t,i),r){case xN.MIN:return e=>function(e,t){if(Number.isFinite(t))return e.length?t:null;let i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(SN,1/0):null}(e,t);case xN.SUM:return e=>function(e,t){if(Number.isFinite(t))return e.length?e.length*t:null;let i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(TN,0):null}(e,t);case xN.MEAN:return e=>function(e,t){if(Number.isFinite(t))return e.length?t:null;let i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(TN,0)/i.length:null}(e,t);case xN.MAX:return e=>function(e,t){if(Number.isFinite(t))return e.length?t:null;let i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(CN,-1/0):null}(e,t);default:return null}}function MN(e,t={}){return i=>(t.indices=i.map((e=>e.index)),e(i.map((e=>e.source)),t))}var RN={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},IN=3402823466e29,BN=[32775,32774],LN=[32776,32774],ON=[32776,32775],FN={[xN.SUM]:32774,[xN.MEAN]:32774,[xN.MIN]:BN,[xN.MAX]:LN},NN={size:1,operation:xN.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},DN="#version 300 es\n#define SHADER_NAME gpu-aggregation-to-grid-vs\nin vec3 positions;\nin vec3 positions64Low;\nin vec3 weights;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform bool projectPoints;\nuniform vec2 translation;\nuniform vec3 scaling;\nout vec3 vWeights;\nvec2 project_to_pixel(vec4 pos) {\nvec4 result;\npos.xy = pos.xy/pos.w;\nresult = pos + vec4(translation, 0., 0.);\nresult.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;\nreturn result.xy;\n}\nvoid main(void) {\nvWeights = weights;\nvec4 windowPos = vec4(positions, 1.);\nif (projectPoints) {\nwindowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));\n}\nvec2 pos = project_to_pixel(windowPos);\nvec2 pixelXY64[2];\npixelXY64[0] = vec2(pos.x, 0.);\npixelXY64[1] = vec2(pos.y, 0.);\nvec2 gridXY64[2];\ngridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\ngridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\nfloat x = floor(gridXY64[0].x);\nfloat y = floor(gridXY64[1].x);\npos = vec2(x, y);\npos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\nvec2 offset = 1.0 / gridSize;\npos = pos + offset;\ngl_Position = vec4(pos, 0.0, 1.0);\ngl_PointSize = 1.0;\n}\n",kN="#version 300 es\n#define SHADER_NAME gpu-aggregation-to-grid-fs\nprecision highp float;\nin vec3 vWeights;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vec4(vWeights, 1.0);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",UN="#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\nvoid main(void) {\nvec2 pos = vec2(-1.0, -1.0);\nvec2 offset = 1.0 / vec2(gridSize);\npos = pos + offset;\ngl_Position = vec4(pos, 0.0, 1.0);\nint yIndex = gl_InstanceID / gridSize[0];\nint xIndex = gl_InstanceID - (yIndex * gridSize[0]);\nvec2 yIndexFP64 = vec2(float(yIndex), 0.);\nvec2 xIndexFP64 = vec2(float(xIndex), 0.);\nvec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\nvec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\nvec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\nvec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\nvTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\ngl_PointSize = 1.0;\n}\n",GN="#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\nprecision highp float;\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\nvec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\nif (textureColor.a == 0.) {\ndiscard;\n}\nfragColor.rgb = textureColor.rgb;\nfragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",zN="#version 300 es\n#define SHADER_NAME gpu-aggregation-transform-mean-vs\nin vec4 aggregationValues;\nout vec4 meanValues;\nvoid main()\n{\nbool isCellValid = bool(aggregationValues.w > 0.);\nmeanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\nmeanValues.w = aggregationValues.w;\ngl_PointSize = 1.0;\n}\n",VN={minFilter:"nearest",magFilter:"nearest"};function jN(e,t){let{width:i=1,height:r=1,data:n=null,parameters:s=VN}=t;return e.createTexture({data:n,format:"rgba32float",mipmaps:!1,sampler:s,width:i,height:r})}function HN(e,t){let{id:i,width:r=1,height:n=1,texture:s}=t;return e.createFramebuffer({id:i,width:r,height:n,colorAttachments:[s]})}var WN=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],XN={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},qN=["float32-renderable-webgl","texture-blend-float-webgl"],KN=class{static getAggregationData({aggregationData:e,maxData:t,minData:i,maxMinData:r,pixelIndex:n}){let s=4*n,o={};return e&&(o.cellCount=e[s+3],o.cellWeight=e[s]),r?(o.maxCellWieght=r[0],o.minCellWeight=r[3]):(t&&(o.maxCellWieght=t[0],o.totalCount=t[3]),i&&(o.minCellWeight=i[0],o.totalCount=i[3])),o}static getCellData({countsData:e,size:t=1}){let i=e.length/4,r=new Float32Array(i*t),n=new Uint32Array(i);for(let s=0;s<i;s++){for(let i=0;i<t;i++)r[s*t+i]=e[4*s+i];n[s]=e[4*s+3]}return{cellCounts:n,cellWeights:r}}static isSupported(e){return qN.every((t=>e.features.has(t)))}constructor(e,t={}){this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},shaderOptions:{},modelDirty:!1,resources:{},results:{}},this.id=t.id||"gpu-grid-aggregator",this.device=e,this._hasGPUSupport=["float32-renderable-webgl"].every((t=>e.features.has(t))),this._hasGPUSupport&&this._setupModels()}delete(){let{gridAggregationModel:e,allAggregationModel:t,meanTransform:i}=this,{textures:r,framebuffers:n,maxMinFramebuffers:s,minFramebuffers:o,maxFramebuffers:a,meanTextures:l,resources:u}=this.state;e?.destroy(),t?.destroy(),i?.destroy(),function(e){(e=Array.isArray(e)?e:[e]).forEach((e=>{for(let t in e)e[t].delete()}))}([n,r,s,o,a,l,u])}run(e={}){this.setState({results:{}});let t=this._normalizeAggregationParams(e);return this._runAggregation(t)}getData(e){let t={},i=this.state.results;i[e].aggregationData||(i[e].aggregationData=i[e].aggregationBuffer.getData()),t.aggregationData=i[e].aggregationData;for(let r in XN){let n=XN[r];(i[e][r]||i[e][n])&&(i[e][r]=i[e][r]||i[e][n].getData(),t[r]=i[e][r])}return t}updateShaders(e={}){this.setState({shaderOptions:e,modelDirty:!0})}_normalizeAggregationParams(e){let t={...RN,...e},{weights:i}=t;return i&&(t.weights=function(e){let t={};for(let i in e)t[i]={...NN,...e[i]};return t}(i)),t}setState(e){Object.assign(this.state,e)}_getAggregateData(e){let t={},{textures:i,framebuffers:r,maxMinFramebuffers:n,minFramebuffers:s,maxFramebuffers:o,resources:a}=this.state,{weights:l}=e;for(let e in l){t[e]={};let{needMin:u,needMax:h,combineMaxMin:c}=l[e];t[e].aggregationTexture=i[e],t[e].aggregationBuffer=this.device.readPixelsToBufferWebGL(r[e],{target:l[e].aggregationBuffer,sourceType:5126}),u&&h&&c?(t[e].maxMinBuffer=this.device.readPixelsToBufferWebGL(n[e],{target:l[e].maxMinBuffer,sourceType:5126}),t[e].maxMinTexture=a[`${e}-maxMinTexture`]):(u&&(t[e].minBuffer=this.device.readPixelsToBufferWebGL(s[e],{target:l[e].minBuffer,sourceType:5126}),t[e].minTexture=a[`${e}-minTexture`]),h&&(t[e].maxBuffer=this.device.readPixelsToBufferWebGL(o[e],{target:l[e].maxBuffer,sourceType:5126}),t[e].maxTexture=a[`${e}-maxTexture`]))}return this._trackGPUResultBuffers(t,l),t}_renderAggregateData(e){let{cellSize:t,projectPoints:i,attributes:r,moduleSettings:n,numCol:s,numRow:o,weights:a,translation:l,scaling:u}=e,{maxMinFramebuffers:h,minFramebuffers:c,maxFramebuffers:d}=this.state,f=[s,o],p={blend:!0,depthTest:!1,blendFunc:[1,1]},g={cellSize:t,gridSize:f,projectPoints:i,translation:l,scaling:u};for(let e in a){let{needMin:t,needMax:i}=a[e],s=t&&i&&a[e].combineMaxMin;this._renderToWeightsTexture({id:e,parameters:p,moduleSettings:n,uniforms:g,gridSize:f,attributes:r,weights:a}),s?this._renderToMaxMinTexture({id:e,parameters:{...p,blendEquation:ON},gridSize:f,minOrMaxFb:h[e],clearParams:{clearColor:[0,0,0,IN]},combineMaxMin:s}):(t&&this._renderToMaxMinTexture({id:e,parameters:{...p,blendEquation:BN},gridSize:f,minOrMaxFb:c[e],clearParams:{clearColor:[IN,IN,IN,0]},combineMaxMin:s}),i&&this._renderToMaxMinTexture({id:e,parameters:{...p,blendEquation:LN},gridSize:f,minOrMaxFb:d[e],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:s}))}}_renderToMaxMinTexture(e){let{id:t,parameters:i,gridSize:r,minOrMaxFb:n,combineMaxMin:s,clearParams:o={}}=e,{framebuffers:a}=this.state,{allAggregationModel:l}=this;this.device.withParametersWebGL({...o,framebuffer:n,viewport:[0,0,r[0],r[1]]},(()=>{this.device.clearWebGL({color:!0}),l.setUniforms({gridSize:r,combineMaxMin:s}),l.setBindings({uSampler:a[t].texture}),l.draw()}))}_renderToWeightsTexture(e){let{id:t,parameters:i,moduleSettings:r,uniforms:n,gridSize:s,weights:o}=e,{framebuffers:a,equations:l,weightAttributes:u}=this.state,{gridAggregationModel:h}=this,{operation:c}=o[t],d=c===xN.MIN?[IN,IN,IN,0]:[0,0,0,0];if(this.device.withParametersWebGL({framebuffer:a[t],viewport:[0,0,s[0],s[1]],clearColor:d},(()=>{this.device.clearWebGL({color:!0});let e={weights:u[t]};h.draw({parameters:{...i,blendEquation:l[t]},moduleSettings:r,uniforms:n,attributes:e})})),c===xN.MEAN){let{meanTextures:e,textures:i}=this.state,r={_sourceTextures:{aggregationValues:e[t]},_targetTexture:i[t],elementCount:i[t].width*i[t].height};this.meanTransform?this.meanTransform.update(r):this.meanTransform=function(e,t){return new _p(e,{vs:zN,_targetTextureVarying:"meanValues",...t})}(this.device,r),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),a[t].attach({36064:i[t]})}}_runAggregation(e){this._updateModels(e),this._setupFramebuffers(e),this._renderAggregateData(e);let t=this._getAggregateData(e);return this.setState({results:t}),t}_setupFramebuffers(e){let{textures:t,framebuffers:i,maxMinFramebuffers:r,minFramebuffers:n,maxFramebuffers:s,meanTextures:o,equations:a}=this.state,{weights:l}=e,{numCol:u,numRow:h}=e,c={width:u,height:h};for(let e in l){let{needMin:d,needMax:f,combineMaxMin:p,operation:g}=l[e];t[e]=l[e].aggregationTexture||t[e]||jN(this.device,{id:`${e}-texture`,width:u,height:h}),t[e].resize(c);let m=t[e];g===xN.MEAN&&(o[e]=o[e]||jN(this.device,{id:`${e}-mean-texture`,width:u,height:h}),o[e].resize(c),m=o[e]),i[e]?i[e].attach({36064:m}):i[e]=HN(this.device,{id:`${e}-fb`,width:u,height:h,texture:m}),i[e].resize(c),a[e]=FN[g]||FN[xN.SUM],(d||f)&&(d&&f&&p?r[e]||(m=l[e].maxMinTexture||this._getMinMaxTexture(`${e}-maxMinTexture`),r[e]=HN(this.device,{id:`${e}-maxMinFb`,texture:m})):(d&&(n[e]||(m=l[e].minTexture||this._getMinMaxTexture(`${e}-minTexture`),n[e]=HN(this.device,{id:`${e}-minFb`,texture:m}))),f&&(s[e]||(m=l[e].maxTexture||this._getMinMaxTexture(`${e}-maxTexture`),s[e]=HN(this.device,{id:`${e}-maxFb`,texture:m})))))}}_getMinMaxTexture(e){let{resources:t}=this.state;return t[e]||(t[e]=jN(this.device,{id:"resourceName"})),t[e]}_setupModels({numCol:e=0,numRow:t=0}={}){let{shaderOptions:i}=this.state;if(this.gridAggregationModel?.destroy(),this.gridAggregationModel=function(e,t){let i=Uy({vs:DN,fs:kN,modules:[ho,rd]},t);return new fp(e,{id:"Grid-Aggregation-Model",vertexCount:1,drawMode:0,shaderAssembler:Wd(),...i})}(this.device,i),!this.allAggregationModel){let i=e*t;this.allAggregationModel=function(e,t){return new fp(e,{id:"All-Aggregation-Model",vs:UN,fs:GN,modules:[ho],vertexCount:1,topology:"point-list",isInstanced:!0,instanceCount:t,attributes:{position:[0,0]}})}(this.device,i)}}_setupWeightAttributes(e){let{weightAttributes:t}=this.state,{weights:i}=e;for(let r in i)t[r]=e.attributes[r]}_trackGPUResultBuffers(e,t){let{resources:i}=this.state;for(let r in e)if(e[r])for(let n of WN)if(e[r][n]&&t[r][n]!==e[r][n]){let t=`gpu-result-${r}-${n}`;i[t]&&i[t].delete(),i[t]=e[r][n]}}_updateModels(e){let{vertexCount:t,attributes:i,numCol:r,numRow:n}=e,{modelDirty:s}=this.state;s&&(this._setupModels(e),this.setState({modelDirty:!1})),this._setupWeightAttributes(e),this.gridAggregationModel.setVertexCount(t),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(r*n)}},$N=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function JN(e,t=!1,i=Float32Array){let r;if(Number.isFinite(e[0]))r=new i(e);else{r=new i(4*e.length);let t=0;for(let i=0;i<e.length;i++){let n=e[i];r[t++]=n[0],r[t++]=n[1],r[t++]=n[2],r[t++]=Number.isFinite(n[3])?n[3]:255}}if(t)for(let e=0;e<r.length;e++)r[e]/=255;return r}var YN=[0,0,0,0],ZN=[0,255,0,255],QN=["minColor","maxColor","colorRange","colorDomain"],eD={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0,max:5},colorDomain:null,colorRange:$N},tD=class extends hb{getShaders(){return{vs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\nin vec3 positions;\nin vec3 instancePositions;\nin vec4 instanceCounts;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\nout vec4 vColor;\nout float vSampleCount;\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\nvec4 outColor = vec4(0., 0., 0., 0.);\nif (value >= domain.x && value <= domain.y) {\nfloat domainRange = domain.y - domain.x;\nif (domainRange <= 0.) {\noutColor = colorRange[0];\n} else {\nfloat rangeCount = float(RANGE_COUNT);\nfloat rangeStep = domainRange / rangeCount;\nfloat idx = floor((value - domain.x) / rangeStep);\nidx = clamp(idx, 0., rangeCount - 1.);\nint intIdx = int(idx);\noutColor = colorRange[intIdx];\n}\n}\noutColor = outColor / 255.;\nreturn outColor;\n}\nvoid main(void) {\nvSampleCount = instanceCounts.a;\nfloat weight = instanceCounts.r;\nfloat maxWeight = texture(maxTexture, vec2(0.5)).r;\nfloat step = weight / maxWeight;\nvec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\nvec2 domain = colorDomain;\nfloat domainMaxValid = float(colorDomain.y != 0.);\ndomain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\nvec4 rangeColor = quantizeScale(domain, colorRange, weight);\nfloat rangeMinMax = float(shouldUseMinMax);\nvec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\nvColor = vec4(color.rgb, color.a * opacity);\npicking_setPickingColor(instancePickingColors);\ngl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin float vSampleCount;\nout vec4 fragColor;\nvoid main(void) {\nif (vSampleCount <= 0.0) {\ndiscard;\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Vd]}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel()})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e);let{oldProps:t,props:i,changeFlags:r}=e,n=this.getAttributeManager();i.numInstances!==t.numInstances?n.invalidateAll():t.cellSizePixels!==i.cellSizePixels&&n.invalidate("instancePositions"),this._updateUniforms(t,i,r)}draw({uniforms:e}){let{parameters:t,maxTexture:i}=this.props,r=this.props.minColor||YN,n=this.props.maxColor||ZN,s=this.props.colorDomain||[1,0],o=this.state.model;o.setUniforms(e),o.setBindings({maxTexture:i}),o.setUniforms({minColor:r,maxColor:n,colorDomain:s}),o.setParameters({depthWriteEnabled:!1,...t}),o.draw(this.context.renderPass)}calculateInstancePositions(e,{numInstances:t}){let{width:i,height:r}=this.context.viewport,{cellSizePixels:n}=this.props,s=Math.ceil(i/n),{value:o,size:a}=e;for(let e=0;e<t;e++){let t=e%s,l=Math.floor(e/s);o[e*a+0]=t*n/i*2-1,o[e*a+1]=1-l*n/r*2,o[e*a+2]=0}}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new vp({topology:"triangle-list",attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0])}})})}_shouldUseMinMax(){let{minColor:e,maxColor:t,colorDomain:i,colorRange:r}=this.props;return e||t?(wi.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!(i||r)}_updateUniforms(e,t,i){let r=this.state.model;if(QN.some((i=>e[i]!==t[i]))&&r.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),e.colorRange!==t.colorRange&&r.setUniforms({colorRange:JN(t.colorRange)}),e.cellMarginPixels!==t.cellMarginPixels||e.cellSizePixels!==t.cellSizePixels||i.viewportChanged){let{width:e,height:t}=this.context.viewport,{cellSizePixels:i,cellMarginPixels:n}=this.props,s=i>n?n:0,o=new Float32Array([(i-s)/e*2,-(i-s)/t*2,1]);r.setUniforms({cellScale:o})}}},iD=tD;function rD(e,t){let i={};for(let r in e)t.includes(r)||(i[r]=e[r]);return i}tD.layerName="ScreenGridCellLayer",tD.defaultProps=eD;var nD=class extends db{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:rD(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);let{changeFlags:t}=e;if(t.extensionsChanged){let e=this.getShaders({});e&&e.defines&&(e.defines.NON_INSTANCED_MODEL=1),this.updateShaders(e)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){let{props:i,oldProps:r,changeFlags:n}=e,{compareAll:s=!1,dimension:o}=t,{ignoreProps:a}=this.state,{props:l,accessors:u=[]}=o,{updateTriggersChanged:h}=n;if(n.dataChanged)return!0;if(h){if(h.all)return!0;for(let e of u)if(h[e])return!0}if(s)return!!n.extensionsChanged||By({oldProps:r,newProps:i,ignoreProps:a,propTypes:this.constructor._propTypes});for(let e of l)if(i[e]!==r[e])return!0;return!1}isAttributeChanged(e){let{changedAttributes:t}=this.state;return e?t&&void 0!==t[e]:!function(e){let t=!0;for(let i in e){t=!1;break}return t}(t)}_getAttributeManager(){return new Ty(this.context.device,{id:this.props.id,stats:this.context.stats})}},sD=nD;function oD(e,t,i){let r=i;return r.domain=()=>e,r.range=()=>t,r}function aD(e,t){return oD(e,t,(i=>function(e,t,i){let r=e[1]-e[0];if(r<=0)return wi.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];let n=r/t.length,s=Math.floor((i-e[0])/n),o=Math.max(Math.min(s,t.length-1),0);return t[o]}(e,t,i)))}function lD(e,t){return oD(e,t,(i=>function(e,t,i){return(i-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}(e,t,i)))}function uD(e,t){let i=e.sort(hD),r=0,n=Math.max(1,t.length),s=new Array(n-1);for(;++r<n;)s[r-1]=cD(i,r/n);let o=e=>function(e,t,i){return t[function(e,t){let i=0,r=e.length;for(;i<r;){let n=i+r>>>1;hD(e[n],t)>0?r=n:i=n+1}return i}(e,i)]}(s,t,e);return o.thresholds=()=>s,oD(e,t,o)}function hD(e,t){return e-t}function cD(e,t){let i=e.length;if(t<=0||i<2)return e[0];if(t>=1)return e[i-1];let r=(i-1)*t,n=Math.floor(r),s=e[n];return s+(e[n+1]-s)*(r-n)}function dD(e,t){let i=new Map,r=[];for(let t of e){let e=`${t}`;i.has(e)||i.set(e,r.push(t))}return oD(e,t,(e=>function(e,t,i,r){let n=`${r}`,s=t.get(n);return void 0===s&&(s=e.push(r),t.set(n,s)),i[(s-1)%i.length]}(r,i,t,e)))}function fD(e){return null!=e}function pD(e,t){return("function"==typeof t?e.map(t):e).filter(fD)}function gD(e,t){return function(e){let t=[];return e.forEach((e=>{!t.includes(e)&&fD(e)&&t.push(e)})),t}(pD(e,t))}nD.layerName="AggregationLayer";var mD=e=>e.length,_D=e=>e.points,vD=e=>e.index,yD=(e,t)=>e<t?-1:e>t?1:e>=t?0:NaN,bD={getValue:mD,getPoints:_D,getIndex:vD,filterData:null},AD=class{constructor(e=[],t=bD){this.aggregatedBins=this.getAggregatedBins(e,t),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(e,t){let{getValue:i=mD,getPoints:r=_D,getIndex:n=vD,filterData:s}=t,o="function"==typeof s,a=e.length,l=[],u=0;for(let t=0;t<a;t++){let a=e[t],h=r(a),c=n(a),d=o?h.filter(s):h;a.filteredPoints=o?d:null;let f=d.length?i(d):null;null!=f&&(l[u]={i:Number.isFinite(c)?c:t,value:f,counts:d.length},u++)}return l}_percentileToIndex(e){let t=this.sortedBins.length;if(t<2)return[0,0];let[i,r]=e.map((e=>function(e,t,i){return Math.max(t,Math.min(i,e))}(e,0,100)));return[Math.ceil(i/100*(t-1)),Math.floor(r/100*(t-1))]}getBinMap(){let e={};for(let t of this.aggregatedBins)e[t.i]=t;return e}_updateMinMaxValues(){let e=0,t=0,i=3402823466e29,r=0;for(let n of this.aggregatedBins)e=e>n.counts?e:n.counts,t=t>n.value?t:n.value,i=i<n.value?i:n.value,r+=n.counts;this.maxCount=e,this.maxValue=t,this.minValue=i,this.totalCount=r}getValueRange(e){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(((e,t)=>yD(e.value,t.value)))),!this.sortedBins.length)return[];let t=0,i=this.sortedBins.length-1;if(Array.isArray(e)){let r=this._percentileToIndex(e);t=r[0],i=r[1]}return[this.sortedBins[t].value,this.sortedBins[i].value]}getValueDomainByScale(e,[t=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(((e,t)=>yD(e.value,t.value)))),!this.sortedBins.length)return[];let r=this._percentileToIndex([t,i]);return this._getScaleDomain(e,r)}_getScaleDomain(e,[t,i]){let r=this.sortedBins;switch(e){case"quantize":case"linear":default:return[r[t].value,r[i].value];case"quantile":return function(e,t){return pD(e,t)}(r.slice(t,i+1),(e=>e.value));case"ordinal":return gD(r,(e=>e.value))}}},ED=6378e3;function wD(e){return Number.isFinite(e)?e:0}function xD(e,t){let i,r,n=e.positions.value,s=1/0,o=-1/0,a=1/0,l=-1/0;for(let e=0;e<t;e++)r=n[3*e],i=n[3*e+1],s=i<s?i:s,o=i>o?i:o,a=r<a?r:a,l=r>l?r:l;return{xMin:wD(a),xMax:wD(l),yMin:wD(s),yMax:wD(o)}}function TD(e,t){let i=e<0?-1:1,r=i<0?Math.abs(e)+t:Math.abs(e);return r=Math.floor(r/t)*t,r*i}function CD(e,t,i=!0){if(!i)return{xOffset:t,yOffset:t};let{yMin:r,yMax:n}=e;return function(e,t){let i=function(e){return e/ED*(180/Math.PI)}(e),r=function(e,t){return t/ED*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);return{yOffset:i,xOffset:r}}(t,(r+n)/2)}function SD(e,t,i,r){let n=CD(e,t,r!==Nc.CARTESIAN),s=function(e,t,i,r){let{width:n,height:s}=r,o=i===Nc.CARTESIAN?[-n/2,-s/2]:[-180,-90];wi.assert(i===Nc.CARTESIAN||i===Nc.LNGLAT||i===Nc.DEFAULT);let{xMin:a,yMin:l}=e;return[-1*(TD(a-o[0],t.xOffset)+o[0]),-1*(TD(l-o[1],t.yOffset)+o[1])]}(e,n,r,i),{xMin:o,yMin:a,xMax:l,yMax:u}=e,h=l-o+n.xOffset,c=u-a+n.yOffset;return{gridOffset:n,translation:s,width:h,height:c,numCol:Math.ceil(h/n.xOffset),numRow:Math.ceil(c/n.yOffset)}}function PD(e,t){let i=function(e,t){let{data:i=[],cellSize:r}=e,{attributes:n,viewport:s,projectPoints:o,numInstances:a}=t,l=n.positions.value,{size:u}=n.positions.getAccessor(),h=t.boundingBox||function(e,t){let i,r,n=e.value,{size:s}=e.getAccessor(),o=1/0,a=-1/0,l=1/0,u=-1/0;for(let e=0;e<t;e++)r=n[e*s],i=n[e*s+1],Number.isFinite(r)&&Number.isFinite(i)&&(o=i<o?i:o,a=i>a?i:a,l=r<l?r:l,u=r>u?r:u);return{xMin:l,xMax:u,yMin:o,yMax:a}}(n.positions,a),c=t.posOffset||[180,90],d=t.gridOffset||CD(h,r);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d,offsets:[0,0]};let{width:f,height:p}=s,g=Math.ceil(f/d.xOffset),m=Math.ceil(p/d.yOffset),_={},{iterable:v,objectInfo:y}=sy(i),b=new Array(3);for(let e of v){y.index++,b[0]=l[y.index*u],b[1]=l[y.index*u+1],b[2]=u>=3?l[y.index*u+2]:0;let[t,i]=o?s.project(b):b;if(Number.isFinite(t)&&Number.isFinite(i)){let r=Math.floor((i+c[1])/d.yOffset),n=Math.floor((t+c[0])/d.xOffset);if(!o||n>=0&&n<g&&r>=0&&r<m){let t=`${r}-${n}`;_[t]=_[t]||{count:0,points:[],lonIdx:n,latIdx:r},_[t].count+=1,_[t].points.push({source:e,index:y.index})}}}return{gridHash:_,gridOffset:d,offsets:[-1*c[0],-1*c[1]]}}(e,t),r=function({gridHash:e,gridOffset:t,offsets:i}){let r=new Array(Object.keys(e).length),n=0;for(let s in e){let o=s.split("-"),a=parseInt(o[0],10),l=parseInt(o[1],10),u=n++;r[u]={index:u,position:[i[0]+t.xOffset*l,i[1]+t.yOffset*a],...e[s]}}return r}(i);return{gridHash:i.gridHash,gridOffset:i.gridOffset,data:r}}var MD=class extends sD{initializeAggregationLayer({dimensions:e}){super.initializeAggregationLayer(e),this.setState({layerData:{},gpuGridAggregator:new KN(this.context.device,{id:`${this.id}-gpu-aggregator`}),cpuGridAggregator:PD})}updateState(e){super.updateState(e),this.updateAggregationState(e);let{aggregationDataDirty:t,aggregationWeightsDirty:i,gpuAggregation:r}=this.state;if(this.getNumInstances()<=0)return;let n=!1;(t||r&&i)&&(this._updateAggregation(e),n=!0),!r&&(t||i)&&(this._updateWeightBins(),this._uploadAggregationResults(),n=!0),this.setState({aggregationDirty:n})}finalizeState(e){let{count:t}=this.state.weights;t&&t.aggregationBuffer&&t.aggregationBuffer.delete(),this.state.gpuGridAggregator?.delete(),super.finalizeState(e)}updateShaders(e){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(e)}updateAggregationState(e){wi.assert(!1)}allocateResources(e,t){if(this.state.numRow!==e||this.state.numCol!==t){let i=t*e*4*4,{weights:r}=this.state;for(let e in r){let t=r[e];t.aggregationBuffer&&t.aggregationBuffer.delete(),t.aggregationBuffer=this.context.device.createBuffer({byteLength:i,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:e,maxMinData:t,maxData:i,minData:r}){let{count:n}=this.state.weights;n&&(n.aggregationData=e,n.maxMinData=t,n.maxData=i,n.minData=r)}_updateAggregation(e){let{cpuGridAggregator:t,gpuGridAggregator:i,gridOffset:r,posOffset:n,translation:s=[0,0],scaling:o=[0,0,0],boundingBox:a,projectPoints:l,gpuAggregation:u,numCol:h,numRow:c}=this.state,{props:d}=e,{viewport:f}=this.context,p=this.getAttributes(),g=this.getNumInstances();if(u){let{weights:e}=this.state;i.run({weights:e,cellSize:[r.xOffset,r.yOffset],numCol:h,numRow:c,translation:s,scaling:o,vertexCount:g,projectPoints:l,attributes:p,moduleSettings:this.getModuleSettings()})}else{let e=t(d,{gridOffset:r,projectPoints:l,attributes:p,viewport:f,posOffset:n,boundingBox:a});this.setState({layerData:e})}}_updateWeightBins(){let{getValue:e}=this.state,t=new AD(this.state.layerData.data||[],{getValue:e});this.setState({sortedBins:t})}_uploadAggregationResults(){let{numCol:e,numRow:t}=this.state,{data:i}=this.state.layerData,{aggregatedBins:r,minValue:n,maxValue:s,totalCount:o}=this.state.sortedBins,a=new Float32Array(e*t*4).fill(0);for(let t of r){let{lonIdx:r,latIdx:n}=i[t.i],{value:s,counts:o}=t,l=4*(r+n*e);a[l]=s,a[l+4-1]=o}let l=new Float32Array([s,0,0,n]),u=new Float32Array([s,0,0,o]),h=new Float32Array([n,0,0,o]);this.updateResults({aggregationData:a,maxMinData:l,maxData:u,minData:h})}},RD=MD;MD.layerName="GridAggregationLayer";var ID={...iD.defaultProps,getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM"},BD="positions",LD={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}},OD=class extends RD{initializeState(){super.initializeAggregationLayer({dimensions:LD,getCellSize:e=>e.cellSizePixels});let e={count:{size:1,operation:xN.SUM,needMax:!0,maxTexture:jN(this.context.device,{id:`${this.id}-max-texture`})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({[BD]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return this.state.supported&&e.somethingChanged}updateState(e){super.updateState(e)}renderLayers(){if(!this.state.supported)return[];let{maxTexture:e,numRow:t,numCol:i,weights:r}=this.state,{updateTriggers:n}=this.props,{aggregationBuffer:s}=r.count;return new(this.getSubLayerClass("cells",iD))(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:n}),{data:{attributes:{instanceCounts:s}},maxTexture:e,numInstances:t*i})}finalizeState(e){super.finalizeState(e);let{aggregationBuffer:t,maxBuffer:i,maxTexture:r}=this.state;t?.delete(),i?.delete(),r?.delete()}getPickingInfo({info:e}){let{index:t}=e;if(t>=0){let{gpuGridAggregator:i,gpuAggregation:r,weights:n}=this.state,s=r?i.getData("count"):n.count;e.object=KN.getAggregationData({pixelIndex:t,...s})}return e}updateResults({aggregationData:e,maxData:t}){let{count:i}=this.state.weights;i.aggregationData=e,i.aggregationBuffer.write(e),i.maxData=t,i.maxTexture.setImageData({data:t})}updateAggregationState(e){let t=e.props.cellSizePixels,i=e.oldProps.cellSizePixels!==t,{viewportChanged:r}=e.changeFlags,n=e.props.gpuAggregation;this.state.gpuAggregation!==e.props.gpuAggregation&&n&&!KN.isSupported(this.context.device)&&(wi.warn("GPU Grid Aggregation not supported, falling back to CPU")(),n=!1);let s=n!==this.state.gpuAggregation;this.setState({gpuAggregation:n});let o=this.isAttributeChanged(BD),{dimensions:a}=this.state,{data:l,weights:u}=a,h=o||s||r||this.isAggregationDirty(e,{compareAll:n,dimension:l}),c=this.isAggregationDirty(e,{dimension:u});this.setState({aggregationDataDirty:h,aggregationWeightsDirty:c});let{viewport:d}=this.context;if(r||i){let{width:e,height:i}=d,r=Math.ceil(e/t),n=Math.ceil(i/t);this.allocateResources(n,r),this.setState({scaling:[e/2,-i/2,1],gridOffset:{xOffset:t,yOffset:t},width:e,height:i,numCol:r,numRow:n})}c&&this._updateAccessors(e),(h||c)&&this._resetResults()}_updateAccessors(e){let{getWeight:t,aggregation:i,data:r}=e.props,{count:n}=this.state.weights;n&&(n.getWeight=t,n.operation=xN[i]),this.setState({getValue:PN(i,t,{data:r})})}_resetResults(){let{count:e}=this.state.weights;e&&(e.aggregationData=null)}},FD=OD;function ND(){}OD.layerName="ScreenGridLayer",OD.defaultProps=ID;var DD=["getBins","getDomain","getScaleFunc"],kD=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],UD=e=>e.cellSize,GD=class{constructor(e){this.state={layerData:{data:void 0},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||UD,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||kD)}static defaultDimensions(){return kD}updateState(e,t){let{oldProps:i,props:r,changeFlags:n}=e;this.updateGetValueFuncs(i,r,n);let s=this.needsReProjectPoints(i,r,n),o=!1;return n.dataChanged||s?(this.getAggregatedData(r,t),o=!0):((this.getDimensionChanges(i,r,n)||[]).forEach((e=>"function"==typeof e&&e())),o=!0),this.setState({aggregationDirty:o}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,t){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...t}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,t){let i=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,t,i){for(let r in this.dimensionUpdaters){let{value:n,weight:s,aggregation:o}=this.dimensionUpdaters[r].getBins.triggers,a=t[n.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[r].getBins,e,t,i)&&(a=a?MN(a,{data:t.data}):PN(t[o.prop],t[s.prop],{data:t.data})),a&&this.setDimensionState(r,{getValue:a})}}needsReProjectPoints(e,t,i){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach((e=>{let{key:t}=e;this.dimensionUpdaters[t]=this.getDimensionUpdaters(e),this.state.dimensions[t]={getValue:null,domain:null,sortedBins:null,scaleFunc:ND}}))}getDimensionUpdaters({key:e,accessor:t,pickingInfo:i,getBins:r,getDomain:n,getScaleFunc:s,nullValue:o}){return{key:e,accessor:t,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins.bind(this),...r},getDomain:{updater:this.getDimensionValueDomain.bind(this),...n},getScaleFunc:{updater:this.getDimensionScale.bind(this),...s},attributeAccessor:this.getSubLayerDimensionAttribute(e,o)}}needUpdateDimensionStep(e,t,i,r){return Object.values(e.triggers).some((e=>e.updateTrigger?r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged[e.updateTrigger]):t[e.prop]!==i[e.prop]))}getDimensionChanges(e,t,i){let r=[];for(let n in this.dimensionUpdaters){let s=DD.find((r=>this.needUpdateDimensionStep(this.dimensionUpdaters[n][r],e,t,i)));s&&r.push(this.dimensionUpdaters[n][s].updater.bind(this,t,this.dimensionUpdaters[n]))}return r.length?r:null}getUpdateTriggers(e){let t=e.updateTriggers||{},i={};for(let r in this.dimensionUpdaters){let{accessor:n}=this.dimensionUpdaters[r];i[n]={},DD.forEach((s=>{Object.values(this.dimensionUpdaters[r][s].triggers).forEach((({prop:r,updateTrigger:s})=>{if(s){let e=t[s];"object"!=typeof e||Array.isArray(e)?void 0!==e&&(i[n][r]=e):Object.assign(i[n],e)}else i[n][r]=e[r]}))}))}return i}getSortedBins(e){for(let t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}getDimensionSortedBins(e,t){let{key:i}=t,{getValue:r}=this.state.dimensions[i],n=new AD(this.state.layerData.data||[],{getValue:r,filterData:e._filterData});this.setDimensionState(i,{sortedBins:n}),this.getDimensionValueDomain(e,t)}getDimensionValueDomain(e,t){let{getDomain:i,key:r}=t,{triggers:{lowerPercentile:n,upperPercentile:s,scaleType:o}}=i,a=this.state.dimensions[r].sortedBins.getValueDomainByScale(e[o.prop],[e[n.prop],e[s.prop]]);this.setDimensionState(r,{valueDomain:a}),this.getDimensionScale(e,t)}getDimensionScale(e,t){let{key:i,getScaleFunc:r,getDomain:n}=t,{domain:s,range:o}=r.triggers,{scaleType:a}=n.triggers,{onSet:l}=r,u=e[o.prop],h=e[s.prop]||this.state.dimensions[i].valueDomain,c=function(e){switch(e){case"quantize":default:return aD;case"linear":return lD;case"quantile":return uD;case"ordinal":return dD}}(a&&e[a.prop])(h,u);"object"==typeof l&&"function"==typeof e[l.props]&&e[l.props](c.domain()),this.setDimensionState(i,{scaleFunc:c})}getSubLayerDimensionAttribute(e,t){return i=>{let{sortedBins:r,scaleFunc:n}=this.state.dimensions[e],s=r.binMap[i.index];if(s&&0===s.counts)return t;let o=s&&s.value,a=n.domain();return o>=a[0]&&o<=a[a.length-1]?n(o):t}}getSubLayerAccessors(e){let t={};for(let i in this.dimensionUpdaters){let{accessor:r}=this.dimensionUpdaters[i];t[r]=this.getSubLayerDimensionAttribute(e,i)}return t}getPickingInfo({info:e}){let t=null;if(e.picked&&e.index>-1){let i=this.state.layerData.data[e.index],r={};for(let e in this.dimensionUpdaters){let{pickingInfo:t}=this.dimensionUpdaters[e],{sortedBins:n}=this.state.dimensions[e],s=n.binMap[i.index]&&n.binMap[i.index].value;r[t]=s}t=Object.assign(r,i,{points:i.filteredPoints||i.points})}return e.picked=Boolean(t),e.object=t,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:ND}};function zD(){}var VD={colorDomain:null,colorRange:$N,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:zD,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:zD,gridAggregator:PD,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}},jD=class extends sD{initializeState(){let e=new GD({getAggregator:e=>e.gridAggregator,getCellSize:e=>e.cellSize});this.state={cpuAggregator:e,aggregatorState:e.state},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){super.updateState(e),this.setState({aggregatorState:this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){let{elevationScale:e,extruded:t,cellSize:i,coverage:r,material:n,transitions:s}=this.props,{cpuAggregator:o}=this.state,a=this.getSubLayerClass("grid-cell",uE),l=this._getSublayerUpdateTriggers();return new a({cellSize:i,coverage:r,material:n,elevationScale:e,extruded:t,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:l}),{data:o.state.layerData.data})}},HD=jD;jD.layerName="CPUGridLayer",jD.defaultProps=VD;var WD=Math.PI/3,XD=[0,WD,2*WD,3*WD,4*WD,5*WD];function qD(e){return e[0]}function KD(e){return e[1]}function $D(){var e,t,i,r=0,n=0,s=1,o=1,a=qD,l=KD;function u(e){var r,n={},s=[],o=e.length;for(r=0;r<o;++r)if(!isNaN(h=+a.call(null,u=e[r],r,e))&&!isNaN(c=+l.call(null,u,r,e))){var u,h,c,d=Math.round(c/=i),f=Math.round(h=h/t-(1&d)/2),p=c-d;if(3*Math.abs(p)>1){var g=h-f,m=f+(h<f?-1:1)/2,_=d+(c<d?-1:1),v=h-m,y=c-_;g*g+p*p>v*v+y*y&&(f=m+(1&d?1:-1)/2,d=_)}var b=f+"-"+d,A=n[b];A?A.push(u):(s.push(A=n[b]=[u]),A.x=(f+(1&d)/2)*t,A.y=d*i)}return s}function h(e){var t=0,i=0;return XD.map((function(r){var n=Math.sin(r)*e,s=-Math.cos(r)*e,o=n-t,a=s-i;return t=n,i=s,[o,a]}))}return u.hexagon=function(t){return"m"+h(null==t?e:+t).join("l")+"z"},u.centers=function(){for(var a=[],l=Math.round(n/i),u=Math.round(r/t),h=l*i;h<o+e;h+=i,++l)for(var c=u*t+(1&l)*t/2;c<s+t/2;c+=t)a.push([c,h]);return a},u.mesh=function(){var t=h(e).slice(0,4).join("l");return u.centers().map((function(e){return"M"+e+"m"+t})).join("")},u.x=function(e){return arguments.length?(a=e,u):a},u.y=function(e){return arguments.length?(l=e,u):l},u.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(WD),i=1.5*e,u):e},u.size=function(e){return arguments.length?(r=n=0,s=+e[0],o=+e[1],u):[s-r,o-n]},u.extent=function(e){return arguments.length?(r=+e[0][0],n=+e[0][1],s=+e[1][0],o=+e[1][1],u):[[r,n],[s,o]]},u.radius(1)}function JD(){}var YD={colorDomain:null,colorRange:$N,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:JD,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:JD,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){let{data:i,radius:r}=e,{viewport:n,attributes:s}=t,o=i.length?function(e,t){let i,{attributes:r}=t,n=r.positions.value,{size:s}=r.positions.getAccessor(),o=1/0,a=1/0,l=-1/0,u=-1/0;for(i=0;i<s*e.length;i+=s){let e=n[i],t=n[i+1];Number.isFinite(e)&&Number.isFinite(t)&&(o=Math.min(e,o),l=Math.max(e,l),a=Math.min(t,a),u=Math.max(t,u))}return[o,a,l,u].every(Number.isFinite)?[(o+l)/2,(a+u)/2]:null}(i,t):null,a=function(e,t,i){let{unitsPerMeter:r}=t.getDistanceScales(i);return e*r[0]}(r,n,o),l=[],{iterable:u,objectInfo:h}=sy(i),c=s.positions.value,{size:d}=s.positions.getAccessor();for(let e of u){h.index++;let t=h.index*d,i=[c[t],c[t+1]];Number.isFinite(i[0])&&Number.isFinite(i[1])?l.push({screenCoord:n.projectFlat(i),source:e,index:h.index}):wi.warn("HexagonLayer: invalid position")()}return{hexagons:$D().radius(a).x((e=>e.screenCoord[0])).y((e=>e.screenCoord[1]))(l).map(((e,t)=>({position:n.unprojectFlat([e.x,e.y]),points:e,index:t}))),radiusCommon:a}},getPosition:{type:"accessor",value:e=>e.position},material:!0,_filterData:{type:"function",value:null,optional:!0}},ZD=class extends sD{initializeState(){let e=new GD({getAggregator:e=>e.hexagonAggregator,getCellSize:e=>e.radius});this.state={cpuAggregator:e,aggregatorState:e.state,vertices:null},this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"}})}updateState(e){if(super.updateState(e),e.changeFlags.propsOrDataChanged){let t=this.state.cpuAggregator.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==t.layerData){let{hexagonVertices:e}=t.layerData||{};this.setState({vertices:e&&this.convertLatLngToMeterOffset(e)})}this.setState({aggregatorState:t})}}convertLatLngToMeterOffset(e){let{viewport:t}=this.context;if(Array.isArray(e)&&6===e.length){let i=e[0],r=e[3],n=[(i[0]+r[0])/2,(i[1]+r[1])/2],s=t.projectFlat(n),{metersPerUnit:o}=t.getDistanceScales(n);return e.map((e=>{let i=t.projectFlat(e);return[(i[0]-s[0])*o[0],(i[1]-s[1])*o[1]]}))}return wi.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){let{elevationScale:e,extruded:t,coverage:i,material:r,transitions:n}=this.props,{aggregatorState:s,vertices:o}=this.state,a=this.getSubLayerClass("hexagon-cell",oE),l=this._getSublayerUpdateTriggers();return new a({...o?{vertices:o,radius:1}:{radius:s.layerData.radiusCommon||1,radiusUnits:"common",angle:90},diskResolution:6,elevationScale:e,extruded:t,coverage:i,material:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:n&&{getFillColor:n.getColorValue||n.getColorWeight,getElevation:n.getElevationValue||n.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:l}),{data:s.layerData.data})}},QD=ZD;ZD.layerName="HexagonLayer",ZD.defaultProps=YD;var ek=.16666666666666666,tk={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},ik=[tk.W,tk.SW,tk.S],rk=[tk.S,tk.SE,tk.E],nk=[tk.E,tk.NE,tk.N],sk=[tk.NW,tk.W,tk.N],ok=[[-.5,ek],[-.5,-ek],[-ek,-.5],[ek,-.5]],ak=[[-ek,-.5],[ek,-.5],[.5,-ek],[.5,ek]],lk=[[.5,-ek],[.5,ek],[ek,.5],[-ek,.5]],uk=[[-.5,ek],[-.5,-ek],[ek,.5],[-ek,.5]],hk=[tk.W,tk.SW,tk.SE,tk.E],ck=[tk.S,tk.SE,tk.NE,tk.N],dk=[tk.NW,tk.W,tk.E,tk.NE],fk=[tk.NW,tk.SW,tk.S,tk.N],pk=[[-.5,ek],[-.5,-ek],[.5,-ek],[.5,ek]],gk=[[-ek,-.5],[ek,-.5],[ek,.5],[-ek,.5]],mk=[tk.NW,tk.SW,tk.SE,tk.NE],_k=[tk.NW,tk.SW,tk.SE,tk.E,tk.N],vk=[tk.W,tk.SW,tk.SE,tk.NE,tk.N],yk=[tk.NW,tk.W,tk.S,tk.SE,tk.NE],bk=[tk.NW,tk.SW,tk.S,tk.E,tk.NE],Ak=[tk.NW,tk.W,[.5,-ek],[.5,ek],tk.N],Ek=[[-ek,-.5],[ek,-.5],tk.E,tk.NE,tk.N],wk=[[-.5,ek],[-.5,-ek],tk.S,tk.SE,tk.E],xk=[tk.W,tk.SW,tk.S,[ek,.5],[-ek,.5]],Tk=[tk.NW,tk.W,[-ek,-.5],[ek,-.5],tk.N],Ck=[[-.5,ek],[-.5,-ek],tk.E,tk.NE,tk.N],Sk=[tk.S,tk.SE,tk.E,[ek,.5],[-ek,.5]],Pk=[tk.W,tk.SW,tk.S,[.5,-ek],[.5,ek]],Mk=[tk.W,tk.SW,tk.SE,tk.E,[ek,.5],[-ek,.5]],Rk=[[-.5,ek],[-.5,-ek],tk.S,tk.SE,tk.NE,tk.N],Ik=[tk.NW,tk.W,[-ek,-.5],[ek,-.5],tk.E,tk.NE],Bk=[tk.NW,tk.SW,tk.S,[.5,-ek],[.5,ek],tk.N],Lk=[tk.W,tk.SW,tk.S,tk.E,tk.NE,tk.N],Ok=[tk.NW,tk.W,tk.S,tk.SE,tk.E,tk.N],Fk=[[-.5,ek],[-.5,-ek],[-ek,-.5],[ek,-.5],tk.E,tk.NE,tk.N],Nk=[tk.W,tk.SW,tk.S,[.5,-ek],[.5,ek],[ek,.5],[-ek,.5]],Dk=[tk.NW,tk.W,[-ek,-.5],[ek,-.5],[.5,-ek],[.5,ek],tk.N],kk=[[-.5,ek],[-.5,-ek],tk.S,tk.SE,tk.E,[ek,.5],[-ek,.5]],Uk=[[-.5,ek],[-.5,-ek],[-ek,-.5],[ek,-.5],[.5,-ek],[.5,ek],[ek,.5],[-ek,.5]],Gk={0:[],1:[[tk.W,tk.S]],2:[[tk.S,tk.E]],3:[[tk.W,tk.E]],4:[[tk.N,tk.E]],5:{0:[[tk.W,tk.S],[tk.N,tk.E]],1:[[tk.W,tk.N],[tk.S,tk.E]]},6:[[tk.N,tk.S]],7:[[tk.W,tk.N]],8:[[tk.W,tk.N]],9:[[tk.N,tk.S]],10:{0:[[tk.W,tk.N],[tk.S,tk.E]],1:[[tk.W,tk.S],[tk.N,tk.E]]},11:[[tk.N,tk.E]],12:[[tk.W,tk.E]],13:[[tk.S,tk.E]],14:[[tk.W,tk.S]],15:[]};function zk(e){return parseInt(e,4)}var Vk={[zk("0000")]:[],[zk("2222")]:[],[zk("2221")]:[ik],[zk("2212")]:[rk],[zk("2122")]:[nk],[zk("1222")]:[sk],[zk("0001")]:[ik],[zk("0010")]:[rk],[zk("0100")]:[nk],[zk("1000")]:[sk],[zk("2220")]:[ok],[zk("2202")]:[ak],[zk("2022")]:[lk],[zk("0222")]:[uk],[zk("0002")]:[ok],[zk("0020")]:[ak],[zk("0200")]:[lk],[zk("2000")]:[uk],[zk("0011")]:[hk],[zk("0110")]:[ck],[zk("1100")]:[dk],[zk("1001")]:[fk],[zk("2211")]:[hk],[zk("2112")]:[ck],[zk("1122")]:[dk],[zk("1221")]:[fk],[zk("2200")]:[pk],[zk("2002")]:[gk],[zk("0022")]:[pk],[zk("0220")]:[gk],[zk("1111")]:[mk],[zk("1211")]:[_k],[zk("2111")]:[vk],[zk("1112")]:[yk],[zk("1121")]:[bk],[zk("1011")]:[_k],[zk("0111")]:[vk],[zk("1110")]:[yk],[zk("1101")]:[bk],[zk("1200")]:[Ak],[zk("0120")]:[Ek],[zk("0012")]:[wk],[zk("2001")]:[xk],[zk("1022")]:[Ak],[zk("2102")]:[Ek],[zk("2210")]:[wk],[zk("0221")]:[xk],[zk("1002")]:[Tk],[zk("2100")]:[Ck],[zk("0210")]:[Sk],[zk("0021")]:[Pk],[zk("1220")]:[Tk],[zk("0122")]:[Ck],[zk("2012")]:[Sk],[zk("2201")]:[Pk],[zk("0211")]:[Mk],[zk("2110")]:[Rk],[zk("1102")]:[Ik],[zk("1021")]:[Bk],[zk("2011")]:[Mk],[zk("0112")]:[Rk],[zk("1120")]:[Ik],[zk("1201")]:[Bk],[zk("2101")]:[Lk],[zk("0121")]:[Lk],[zk("1012")]:[Ok],[zk("1210")]:[Ok],[zk("0101")]:{0:[ik,nk],1:[Lk],2:[Lk]},[zk("1010")]:{0:[sk,rk],1:[Ok],2:[Ok]},[zk("2121")]:{0:[Lk],1:[Lk],2:[ik,nk]},[zk("1212")]:{0:[Ok],1:[Ok],2:[sk,rk]},[zk("2120")]:{0:[Fk],1:[Fk],2:[ok,nk]},[zk("2021")]:{0:[Nk],1:[Nk],2:[ik,lk]},[zk("1202")]:{0:[Dk],1:[Dk],2:[sk,ak]},[zk("0212")]:{0:[kk],1:[kk],2:[rk,uk]},[zk("0102")]:{0:[ok,nk],1:[Fk],2:[Fk]},[zk("0201")]:{0:[ik,lk],1:[Nk],2:[Nk]},[zk("1020")]:{0:[sk,ak],1:[Dk],2:[Dk]},[zk("2010")]:{0:[rk,uk],1:[kk],2:[kk]},[zk("2020")]:{0:[uk,ak],1:[Uk],2:[ok,lk]},[zk("0202")]:{0:[lk,ok],1:[Uk],2:[uk,ak]}},jk={ISO_LINES:1,ISO_BANDS:2},Hk={zIndex:0,zOffset:.005};function Wk(e,t){return Array.isArray(t)?e<t[0]?0:e<t[1]?1:2:e>=t?1:0}function Xk(e){let{cellWeights:t,x:i,y:r,width:n,height:s}=e,o=e.threshold;e.thresholdValue&&(wi.deprecated("thresholdValue","threshold")(),o=e.thresholdValue);let a=i<0,l=i>=n-1,u=r<0,h=r>=s-1,c=a||l||u||h,d={},f={};a||h?f.top=0:(d.top=t[(r+1)*n+i],f.top=Wk(d.top,o)),l||h?f.topRight=0:(d.topRight=t[(r+1)*n+i+1],f.topRight=Wk(d.topRight,o)),l||u?f.right=0:(d.right=t[r*n+i+1],f.right=Wk(d.right,o)),a||u?f.current=0:(d.current=t[r*n+i],f.current=Wk(d.current,o));let{top:p,topRight:g,right:m,current:_}=f,v=-1;Number.isFinite(o)&&(v=p<<3|g<<2|m<<1|_),Array.isArray(o)&&(v=p<<6|g<<4|m<<2|_);let y=0;return c||(y=Wk((d.top+d.topRight+d.right+d.current)/4,o)),{code:v,meanCode:y}}function qk(e){let{gridOrigin:t,cellSize:i,x:r,y:n,code:s,meanCode:o,type:a=jk.ISO_LINES}=e,l={...Hk,...e.thresholdData},u=a===jk.ISO_BANDS?Vk[s]:Gk[s];Array.isArray(u)||(u=u[o]);let h=l.zIndex*l.zOffset,c=(r+1)*i[0],d=(n+1)*i[1],f=t[0]+c,p=t[1]+d;if(a===jk.ISO_BANDS){let e=[];return u.forEach((t=>{let r=[];t.forEach((e=>{let t=f+e[0]*i[0],n=p+e[1]*i[1];r.push([t,n,h])})),e.push(r)})),e}let g=[];return u.forEach((e=>{e.forEach((e=>{let t=f+e[0]*i[0],r=p+e[1]*i[1];g.push([t,r,h])}))})),g}var Kk=[255,255,255,255],$k={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!1,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},Jk="positions",Yk={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}},Zk=class extends RD{initializeState(){super.initializeAggregationLayer({dimensions:Yk}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:xN.SUM}}}),this.getAttributeManager().add({[Jk]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(e){super.updateState(e);let t=!1,{oldProps:i,props:r}=e,{aggregationDirty:n}=this.state;(i.contours!==r.contours||i.zOffset!==r.zOffset)&&(t=!0,this._updateThresholdData(e.props)),this.getNumInstances()>0&&(n||t)&&this._generateContours()}renderLayers(){let{contourSegments:e,contourPolygons:t}=this.state.contourData,i=this.getSubLayerClass("lines",EA),r=this.getSubLayerClass("bands",kE);return[e&&e.length>0&&new i(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:e=>e.start,getTargetPosition:e=>e.end,getColor:e=>e.contour.color||Kk,getWidth:e=>e.contour.strokeWidth||1}),t&&t.length>0&&new r(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:e=>e.vertices,getFillColor:e=>e.contour.color||Kk})]}updateAggregationState(e){let{props:t,oldProps:i}=e,{cellSize:r,coordinateSystem:n}=t,{viewport:s}=this.context,o=i.cellSize!==r,a=t.gpuAggregation;this.state.gpuAggregation!==t.gpuAggregation&&a&&!KN.isSupported(this.context.device)&&(wi.warn("GPU Grid Aggregation not supported, falling back to CPU")(),a=!1);let l=a!==this.state.gpuAggregation;this.setState({gpuAggregation:a});let{dimensions:u}=this.state,h=this.isAttributeChanged(Jk),{data:c,weights:d}=u,{boundingBox:f}=this.state;if(h&&(f=xD(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:f})),h||o){let{gridOffset:e,translation:t,width:i,height:o,numCol:a,numRow:l}=SD(f,r,s,n);this.allocateResources(l,a),this.setState({gridOffset:e,boundingBox:f,translation:t,posOffset:t.slice(),gridOrigin:[-1*t[0],-1*t[1]],width:i,height:o,numCol:a,numRow:l})}let p=h||l||this.isAggregationDirty(e,{dimension:c,compareAll:a}),g=this.isAggregationDirty(e,{dimension:d});g&&this._updateAccessors(e),(p||g)&&this._resetResults(),this.setState({aggregationDataDirty:p,aggregationWeightsDirty:g})}_updateAccessors(e){let{getWeight:t,aggregation:i,data:r}=e.props,{count:n}=this.state.weights;n&&(n.getWeight=t,n.operation=xN[i]),this.setState({getValue:PN(i,t,{data:r})})}_resetResults(){let{count:e}=this.state.weights;e&&(e.aggregationData=null)}_generateContours(){let{numCol:e,numRow:t,gridOrigin:i,gridOffset:r,thresholdData:n}=this.state,{count:s}=this.state.weights,{aggregationData:o}=s;o||(o=s.aggregationBuffer.readSyncWebGL(),s.aggregationData=o);let{cellWeights:a}=KN.getCellData({countsData:o}),l=function({thresholdData:e,cellWeights:t,gridSize:i,gridOrigin:r,cellSize:n}){let s=[],o=[],a=i[0],l=i[1],u=0,h=0;for(let i of e){let{contour:e}=i,{threshold:c}=e;for(let d=-1;d<a;d++)for(let f=-1;f<l;f++){let{code:p,meanCode:g}=Xk({cellWeights:t,threshold:c,x:d,y:f,width:a,height:l}),m={type:jk.ISO_BANDS,gridOrigin:r,cellSize:n,x:d,y:f,width:a,height:l,code:p,meanCode:g,thresholdData:i};if(Array.isArray(c)){m.type=jk.ISO_BANDS;let t=qk(m);for(let i of t)o[h++]={vertices:i,contour:e}}else{m.type=jk.ISO_LINES;let t=qk(m);for(let i=0;i<t.length;i+=2)s[u++]={start:t[i],end:t[i+1],contour:e}}}}return{contourSegments:s,contourPolygons:o}}({thresholdData:n,cellWeights:a,gridSize:[e,t],gridOrigin:i,cellSize:[r.xOffset,r.yOffset]});this.setState({contourData:l})}_updateThresholdData(e){let{contours:t,zOffset:i}=e,r=t.length,n=new Array(r);for(let e=0;e<r;e++){let r=t[e];n[e]={contour:r,zIndex:r.zIndex||e,zOffset:i}}this.setState({thresholdData:n})}},Qk=Zk;Zk.layerName="ContourLayer",Zk.defaultProps=$k;var eU={colorDomain:null,colorRange:$N,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0},tU=class extends hb{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\nin vec3 positions;\nin vec3 normals;\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\nlayout(std140) uniform;\nuniform ColorData\n{\nvec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\nvec4 maxMinCount;\n} elevationData;\n#define EPSILON 0.00001\nout vec4 vColor;\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\nvec4 outColor = vec4(0., 0., 0., 0.);\nif (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\nfloat domainRange = domain.y - domain.x;\nif (domainRange <= 0.) {\noutColor = colorRange[0];\n} else {\nfloat rangeCount = float(RANGE_COUNT);\nfloat rangeStep = domainRange / rangeCount;\nfloat idx = floor((value - domain.x) / rangeStep);\nidx = clamp(idx, 0., rangeCount - 1.);\nint intIdx = int(idx);\noutColor = colorRange[intIdx];\n}\n}\nreturn outColor;\n}\nfloat linearScale(vec2 domain, vec2 range, float value) {\nif (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\nreturn ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n}\nreturn -1.;\n}\nvoid main(void) {\nvec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\nvec4 color = quantizeScale(clrDomain, colorRange, colors.r);\nfloat elevation = 0.0;\nif (extruded) {\nvec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\nelevation = linearScale(elvDomain, elevationRange, elevations.r);\nelevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n}\nfloat shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\nfloat dotRadius = cellSize / 2. * coverage * shouldRender;\nint yIndex = (gl_InstanceID / gridSize[0]);\nint xIndex = gl_InstanceID - (yIndex * gridSize[0]);\nvec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\ninstancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\nvec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\ninstancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\nvec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\nvec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);\ngeometry.worldPosition = centroidPosition;\nvec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\npicking_setPickingColor(instancePickingColors);\ngl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\nvec3 normals_commonspace = project_normal(normals);\nif (extruded) {\nvec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);\nvColor = vec4(lightColor, color.a * opacity) / 255.;\n} else {\nvColor = vec4(color.rgb, color.a * opacity) / 255.;\n}\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\nfragColor = picking_filterColor(fragColor);\n}\n",modules:[rd,Ic,Vd,ho]})}initializeState(){this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});let e=this._getModel();this._setupUniformBuffer(e),this.setState({model:e})}_getModel(){return new fp(this.context.device,{...this.getShaders(),id:this.props.id,geometry:new xp,isInstanced:!0})}draw({uniforms:e}){let{cellSize:t,offset:i,extruded:r,elevationScale:n,coverage:s,gridSize:o,gridOrigin:a,gridOffset:l,elevationRange:u,colorMaxMinBuffer:h,elevationMaxMinBuffer:c}=this.props,d=this.state.model,f=[gf(a[0]),gf(a[1])],p=[gf(l[0]),gf(l[1])],g=this.getDomainUniforms(),m=JN(this.props.colorRange);this.bindUniformBuffers(h,c),d.setUniforms(e),d.setUniforms(g),d.setUniforms({cellSize:t,offset:i,extruded:r,elevationScale:n,coverage:s,gridSize:o,gridOrigin:a,gridOriginLow:f,gridOffset:l,gridOffsetLow:p,colorRange:m,elevationRange:u}),d.draw(this.context.renderPass),this.unbindUniformBuffers(h,c)}bindUniformBuffers(e,t){e.bind({target:35345,index:0}),t.bind({target:35345,index:1})}unbindUniformBuffers(e,t){e.unbind({target:35345,index:0}),t.unbind({target:35345,index:1})}getDomainUniforms(){let{colorDomain:e,elevationDomain:t}=this.props,i={};return null!==e?(i.colorDomainValid=!0,i.colorDomain=e):i.colorDomainValid=!1,null!==t?(i.elevationDomainValid=!0,i.elevationDomain=t):i.elevationDomainValid=!1,i}_setupUniformBuffer(e){let t=e.pipeline.handle,i=this.context.gl,r=i.getUniformBlockIndex(t,"ColorData"),n=i.getUniformBlockIndex(t,"ElevationData");i.uniformBlockBinding(t,r,0),i.uniformBlockBinding(t,n,1)}},iU=tU;tU.layerName="GPUGridCellLayer",tU.defaultProps=eU;var rU={colorDomain:null,colorRange:$N,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},extruded:!1,material:!0},nU={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},sU="positions",oU=class extends RD{initializeState({device:e}){let t=KN.isSupported(e);t||wi.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeAggregationLayer({dimensions:nU}),this.setState({gpuAggregation:!1,projectPoints:!1,isSupported:t,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:e.createBuffer({byteLength:16,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:e.createBuffer({byteLength:16,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({[sU]:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(e){if(!1===this.state.isSupported)return;super.updateState(e);let{aggregationDirty:t}=this.state;t&&this.setState({gridHash:null})}getHashKeyForIndex(e){let{numRow:t,numCol:i,boundingBox:r,gridOffset:n}=this.state,s=[i,t],o=[r.xMin,r.yMin],a=[n.xOffset,n.yOffset],l=Math.floor(e/s[0]),u=e-l*s[0];return`${Math.floor((l*a[1]+o[1]+90+a[1]/2)/a[1])}-${Math.floor((u*a[0]+o[0]+180+a[0]/2)/a[0])}`}getPositionForIndex(e){let{numRow:t,numCol:i,boundingBox:r,gridOffset:n}=this.state,s=[i,t],o=[r.xMin,r.yMin],a=[n.xOffset,n.yOffset],l=Math.floor(e/s[0]);return[(e-l*s[0])*a[0]+o[0],l*a[1]+o[1]]}getPickingInfo({info:e,mode:t}){let{index:i}=e,r=null;if(i>=0){let e=this.state.gpuGridAggregator,n=this.getPositionForIndex(i),s=KN.getAggregationData({pixelIndex:i,...e.getData("color")}),o=KN.getAggregationData({pixelIndex:i,...e.getData("elevation")});if(r={colorValue:s.cellWeight,elevationValue:o.cellWeight,count:s.cellCount||o.cellCount,position:n,totalCount:s.totalCount||o.totalCount},"hover"!==t){let{props:e}=this,{gridHash:t}=this.state;if(!t){let{gridOffset:i,translation:r,boundingBox:n}=this.state,{viewport:s}=this.context;t=PD(e,{gridOffset:i,attributes:this.getAttributes(),viewport:s,translation:r,boundingBox:n}).gridHash,this.setState({gridHash:t})}let n=t[this.getHashKeyForIndex(i)];Object.assign(r,n)}}return e.picked=Boolean(r),e.object=r,e}renderLayers(){if(!this.state.isSupported)return null;let{elevationScale:e,extruded:t,cellSize:i,coverage:r,material:n,elevationRange:s,colorDomain:o,elevationDomain:a}=this.props,{weights:l,numRow:u,numCol:h,gridOrigin:c,gridOffset:d}=this.state,{color:f,elevation:p}=l,g=JN(this.props.colorRange);return new(this.getSubLayerClass("gpu-grid-cell",iU))({gridSize:[h,u],gridOrigin:c,gridOffset:[d.xOffset,d.yOffset],colorRange:g,elevationRange:s,colorDomain:o,elevationDomain:a,cellSize:i,coverage:r,material:n,elevationScale:e,extruded:t},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:f.aggregationBuffer,elevations:p.aggregationBuffer}},colorMaxMinBuffer:f.maxMinBuffer,elevationMaxMinBuffer:p.maxMinBuffer,numInstances:h*u})}finalizeState(e){let{color:t,elevation:i}=this.state.weights;[t,i].forEach((e=>{let{aggregationBuffer:t,maxMinBuffer:i}=e;i?.destroy(),t?.destroy()})),super.finalizeState(e)}updateAggregationState(e){let{props:t,oldProps:i}=e,{cellSize:r,coordinateSystem:n}=t,{viewport:s}=this.context,o=i.cellSize!==r,{dimensions:a}=this.state,l=this.isAttributeChanged(sU),u=l||this.isAttributeChanged(),{boundingBox:h}=this.state;if(l&&(h=xD(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:h})),l||o){let{gridOffset:e,translation:t,width:i,height:o,numCol:a,numRow:l}=SD(h,r,s,n);this.allocateResources(l,a),this.setState({gridOffset:e,translation:t,gridOrigin:[-1*t[0],-1*t[1]],width:i,height:o,numCol:a,numRow:l})}let c=u||this.isAggregationDirty(e,{dimension:a.data,compareAll:!0});c&&this._updateAccessors(e),this.setState({aggregationDataDirty:c})}_updateAccessors(e){let{colorAggregation:t,elevationAggregation:i}=e.props,{color:r,elevation:n}=this.state.weights;r.operation=xN[t],n.operation=xN[i]}},aU=oU;oU.layerName="GPUGridLayer",oU.defaultProps=rU;var lU={...aU.defaultProps,...HD.defaultProps,gpuAggregation:!1},uU=class extends db{initializeState(){this.state={useGPUAggregation:!1}}updateState({props:e}){this.setState({useGPUAggregation:!1})}renderLayers(){let{data:e,updateTriggers:t}=this.props,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",aU):this.getSubLayerClass("CPU",HD))(this.props,this.getSubLayerProps({id:i,updateTriggers:t}),{data:e})}canUseGPUAggregation(e){let{gpuAggregation:t,lowerPercentile:i,upperPercentile:r,getColorValue:n,getElevationValue:s,colorScaleType:o}=e;return!(!t||!KN.isSupported(this.context.device)||0!==i||100!==r||null!==n||null!==s||"quantile"===o||"ordinal"===o)}},hU=uU;uU.layerName="GridLayer",uU.defaultProps=lU;var cU=new Float32Array(12);function dU(e,t=2){let i=0;for(let r of e)for(let e=0;e<t;e++)cU[i++]=r[e]||0;return cU}var fU=class extends hb{getShaders(){return{vs:"#version 300 es\n#define SHADER_NAME heatp-map-layer-vertex-shader\nuniform sampler2D maxTexture;\nuniform float intensity;\nuniform vec2 colorDomain;\nuniform float threshold;\nuniform float aggregationMode;\nin vec3 positions;\nin vec2 texCoords;\nout vec2 vTexCoords;\nout float vIntensityMin;\nout float vIntensityMax;\nvoid main(void) {\ngl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\nvTexCoords = texCoords;\nvec4 maxTexture = texture(maxTexture, vec2(0.5));\nfloat maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\nfloat minValue = maxValue * threshold;\nif (colorDomain[1] > 0.) {\nmaxValue = colorDomain[1];\nminValue = colorDomain[0];\n}\nvIntensityMax = intensity / maxValue;\nvIntensityMin = intensity / minValue;\n}\n",fs:"#version 300 es\n#define SHADER_NAME triangle-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D weightsTexture;\nuniform sampler2D colorTexture;\nuniform float aggregationMode;\nin vec2 vTexCoords;\nin float vIntensityMin;\nin float vIntensityMax;\nout vec4 fragColor;\nvec4 getLinearColor(float value) {\nfloat factor = clamp(value * vIntensityMax, 0., 1.);\nvec4 color = texture(colorTexture, vec2(factor, 0.5));\ncolor.a *= min(value * vIntensityMin, 1.0);\nreturn color;\n}\nvoid main(void) {\nvec4 weights = texture(weightsTexture, vTexCoords);\nfloat weight = weights.r;\nif (aggregationMode > 0.5) {\nweight /= max(1.0, weights.a);\n}\nif (weight <= 0.) {\ndiscard;\n}\nvec4 linearColor = getLinearColor(weight);\nlinearColor.a *= opacity;\nfragColor = linearColor;\n}\n",modules:[rd]}}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){let{vertexCount:t,data:i,weightsTexture:r,maxTexture:n,colorTexture:s}=this.props;return new fp(e,{...this.getShaders(),id:this.props.id,bindings:{weightsTexture:r,maxTexture:n,colorTexture:s},attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-fan-webgl",vertexCount:t})}draw({uniforms:e}){let{model:t}=this.state,{intensity:i,threshold:r,aggregationMode:n,colorDomain:s}=this.props;t.setUniforms({...e,intensity:i,threshold:r,aggregationMode:n,colorDomain:s}),t.draw(this.context.renderPass)}},pU=fU;fU.layerName="TriangleLayer";var gU="#version 300 es\nin vec3 positions;\nin vec3 positions64Low;\nin float weights;\nout vec4 weightsTexture;\nuniform float radiusPixels;\nuniform float textureWidth;\nuniform vec4 commonBounds;\nuniform float weightsScale;\nvoid main()\n{\nweightsTexture = vec4(weights * weightsScale, 0., 0., 1.);\nfloat radiusTexels = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);\ngl_PointSize = radiusTexels * 2.;\nvec3 commonPosition = project_position(positions, positions64Low);\ngl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;\ngl_Position.xy = (gl_Position.xy * 2.) - (1.);\ngl_Position.w = 1.0;\n}\n",mU="#version 300 es\nin vec4 weightsTexture;\nout vec4 fragColor;\nfloat gaussianKDE(float u){\nreturn pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(0.5, 0.5));\nif (dist > 0.5) {\ndiscard;\n}\nfragColor = weightsTexture * gaussianKDE(2. * dist);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",_U={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},vU=[0,0],yU={SUM:0,MEAN:1},bU={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:$N,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},AU=["float32-renderable-webgl","texture-blend-float-webgl"],EU={data:{props:["radiusPixels"]}},wU=class extends sD{initializeState(){super.initializeAggregationLayer(EU),this.setState({colorDomain:vU}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){let{props:t,oldProps:i}=e,r=this._getChangeFlags(e);(r.dataChanged||r.viewportChanged)&&(r.boundsChanged=this._updateBounds(r.dataChanged),this._updateTextureRenderingBounds()),r.dataChanged||r.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):r.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){let{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:r,colorTexture:n,colorDomain:s}=this.state,{updateTriggers:o,intensity:a,threshold:l,aggregation:u}=this.props;return new(this.getSubLayerClass("triangle",pU))(this.getSubLayerProps({id:"triangle-layer",updateTriggers:o}),{coordinateSystem:Nc.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:r,colorTexture:n,aggregationMode:yU[u]||0,weightsTexture:e,intensity:a,threshold:l,colorDomain:s})}finalizeState(e){super.finalizeState(e);let{weightsTransform:t,weightsTexture:i,maxWeightTransform:r,maxWeightsTexture:n,triPositionBuffer:s,triTexCoordBuffer:o,colorTexture:a,updateTimer:l}=this.state;t?.destroy(),i?.destroy(),r?.destroy(),n?.destroy(),s?.destroy(),o?.destroy(),a?.destroy(),l&&clearTimeout(l)}_getAttributeManager(){return new Ty(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){let t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()?"attribute changed":this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;let{zoom:r}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==r)&&(t.viewportZoomChanged=!0),t}_createTextures(){let{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({..._U,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({..._U,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),r=AU.every((t=>e.features.has(t))),n=r?"rgba32float":"rgba8unorm",s=r?1:1/255;this.setState({textureSize:i,format:n,weightsScale:s}),r||wi.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state,{weightsTexture:i}=this.state,r=this.getAttributeManager();t?.destroy(),t=new _p(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:r.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();let{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:r}=this.state,n=this.getShaders({vs:gU,fs:mU});this._createWeightsTransform(n);let s=this.getShaders({vs:"#version 300 es\nuniform sampler2D inTexture;\nuniform float textureSize;\nout vec4 outTexture;\nvoid main()\n{\nint yIndex = gl_VertexID / int(textureSize);\nint xIndex = gl_VertexID - (yIndex * int(textureSize));\nvec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / textureSize;\noutTexture = texture(inTexture, uv);\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\ngl_PointSize = 1.0;\n}\n",fs:"#version 300 es\nin vec4 outTexture;\nout vec4 fragColor;\nvoid main() {\nfragColor = outTexture;\nfragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n"}),o=new _p(e,{id:`${this.id}-max-weights-transform`,bindings:{inTexture:i},uniforms:{textureSize:t},targetTexture:r,...s,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}});this.setState({weightsTexture:i,maxWeightsTexture:r,maxWeightTransform:o,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:gU,fs:mU,...e})}_updateMaxWeightValue(){let{maxWeightTransform:e,textureSize:t}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){let{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([t.width,t.height]),t.unproject([0,t.height])].map((e=>e.map(Math.fround))),r=function(e){let t=e.map((e=>e[0])),i=e.map((e=>e[1])),r=Math.min.apply(null,t),n=Math.max.apply(null,t);return[r,Math.min.apply(null,i),n,Math.max.apply(null,i)]}(i),n={visibleWorldBounds:r,viewportCorners:i},s=!1;if(e||!this.state.worldBounds||!function(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}(this.state.worldBounds,r)){let e=this._worldToCommonBounds(r),t=this._commonToWorldBounds(e);this.props.coordinateSystem===Nc.LNGLAT&&(t[1]=Math.max(t[1],-85.051129),t[3]=Math.min(t[3],85.051129),t[0]=Math.max(t[0],-360),t[2]=Math.min(t[2],360));let i=this._worldToCommonBounds(t);n.worldBounds=t,n.normalizedCommonBounds=i,s=!0}return this.setState(n),s}_updateTextureRenderingBounds(){let{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:r}=this.state,{viewport:n}=this.context;e.write(dU(r,3));let s=r.map((e=>function(e,t){let[i,r,n,s]=t;return[(e[0]-i)/(n-i),(e[1]-r)/(s-r)]}(n.projectPosition(e),i)));t.write(dU(s,2))}_updateColorTexture(e){let{colorRange:t}=e.props,{colorTexture:i}=this.state,r=JN(t,!1,Uint8Array);i&&i?.width===t.length?i.setSubImageData({data:r}):(i?.destroy(),i=this.context.device.createTexture({..._U,data:r,width:t.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){let{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:r,textureSize:n,weightsScale:s}=this.state,o=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let a=this._worldToCommonBounds(r,{useLayerCoordinateSystem:!0});if(t&&"SUM"===i){let{viewport:e}=this.context,i=e.distanceScales.metersPerUnit[2]*(a[2]-a[0])/n;this.state.colorDomain=t.map((e=>e*i*s))}else this.state.colorDomain=t||vU;let l=this.getAttributeManager().getAttributes(),u=this.getModuleSettings(),h=l.positions.buffer,c={radiusPixels:e,commonBounds:a,textureWidth:n,weightsScale:s},d=l.weights.buffer;o.model.setAttributes({positions:h,weights:d}),o.model.setVertexCount(this.getNumInstances()),o.model.setUniforms(c),o.model.updateModuleSettings(u),o.run({parameters:{viewport:[0,0,n,n]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state,{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){let i,r,{useLayerCoordinateSystem:n=!1}=t,[s,o,a,l]=e,{viewport:u}=this.context,{textureSize:h}=this.state,{coordinateSystem:c}=this.props,d=n&&(c===Nc.LNGLAT_OFFSETS||c===Nc.METER_OFFSETS),f=d?u.projectPosition(this.props.coordinateOrigin):[0,0],p=2*h/u.scale;return n&&!d?(i=this.projectPosition([s,o,0]),r=this.projectPosition([a,l,0])):(i=u.projectPosition([s,o,0]),r=u.projectPosition([a,l,0])),function(e,t,i){let[r,n,s,o]=e,a=s-r,l=o-n,u=a,h=l;a/l<t/i?u=t/i*l:h=i/t*a,u<t&&(u=t,h=i);let c=(s+r)/2,d=(o+n)/2;return[c-u/2,d-h/2,c+u/2,d+h/2]}([i[0]-f[0],i[1]-f[1],r[0]-f[0],r[1]-f[1]],p,p)}_commonToWorldBounds(e){let[t,i,r,n]=e,{viewport:s}=this.context,o=s.unprojectPosition([t,i]),a=s.unprojectPosition([r,n]);return o.slice(0,2).concat(a.slice(0,2))}},xU=wU;wU.layerName="HeatmapLayer",wU.defaultProps=bU;var TU=85.05113;function CU(e,t,i,r){if(i){if(i.userData._googleMap===e)return i;PU(i)}let n={click:null,rightclick:null,dblclick:null,mousemove:null,mouseout:null},s=new Yv({...r,useDevicePixels:!!r.interleaved||r.useDevicePixels,style:r.interleaved?null:{pointerEvents:"none"},parent:SU(t,r.style),views:new Og({repeat:!0}),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1});for(let t in n)n[t]=e.addListener(t,(e=>LU(s,t,e)));return s.userData._googleMap=e,s.userData._eventListeners=n,s}function SU(e,t){let i=document.createElement("div");return i.style.position="absolute",Object.assign(i.style,t),"getPanes"in e?e.getPanes()?.overlayLayer.appendChild(i):e.getMap()?.getDiv().appendChild(i),i}function PU(e){let{_eventListeners:t}=e.userData;for(let e in t)t[e]&&t[e].remove();e.finalize()}function MU(e,t){let{width:i,height:r}=RU(e),{center:n,heading:s,tilt:o,zoom:a}=t.getCameraParams(),l=r?i/r:1,u=(new Oh).perspective({fovy:25*Math.PI/180,aspect:l,near:.75,far:3e14});return{width:i,height:r,viewState:{altitude:.5*u[5],bearing:s,latitude:n.lat(),longitude:n.lng(),pitch:o,projectionMatrix:u,repeat:!0,zoom:a-1}}}function RU(e){let t=e.getDiv().firstChild;return{width:t.offsetWidth,height:t.offsetHeight}}function IU(e,t,i){let r=new google.maps.Point(t,i),n=e.fromContainerPixelToLatLng(r);return[n.lng(),n.lat()]}function BU(e,t){if(e.pixel)return e.pixel;let i=t.getViewports()[0].project([e.latLng.lng(),e.latLng.lat()]);return{x:i[0],y:i[1]}}function LU(e,t,i){if(!e.isInitialized)return;let r={type:t,offsetCenter:BU(i,e),srcEvent:i};switch(t){case"click":case"rightclick":r.type="click",r.tapCount=1,e._onPointerDown(r),e._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,e._onEvent(r);break;case"mousemove":r.type="pointermove",e._onPointerMove(r);break;case"mouseout":r.type="pointerleave",e._onPointerMove(r);break;default:return}}var OU=()=>!1,FU={depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],blendEquation:32774};function NU(){}var DU={interleaved:!0},kU=class{constructor(e){this.props={},this._map=null,this._deck=null,this._overlay=null,this.setProps({...DU,...e})}setMap(e){if(e===this._map)return;let{VECTOR:t,UNINITIALIZED:i}=google.maps.RenderingType;this._map&&(!e&&this._map.getRenderingType()===t&&this.props.interleaved&&this._overlay.requestRedraw(),this._overlay?.setMap(null),this._map=null),e&&(this._map=e,e.getRenderingType()!==i?this._createOverlay(e):e.addListener("renderingtype_changed",(()=>{this._createOverlay(e)})))}setProps(e){if(Object.assign(this.props,e),this._deck){let t=this._deck.getCanvas();if(e.style&&t?.parentElement){let i=t.parentElement.style;Object.assign(i,e.style),e.style=null}this._deck.setProps(e)}}pickObject(e){return this._deck&&this._deck.pickObject(e)}pickMultipleObjects(e){return this._deck&&this._deck.pickMultipleObjects(e)}pickObjects(e){return this._deck&&this._deck.pickObjects(e)}finalize(){this.setMap(null),this._deck&&(PU(this._deck),this._deck=null)}_createOverlay(e){let{interleaved:t}=this.props,{VECTOR:i,UNINITIALIZED:r}=google.maps.RenderingType,n=e.getRenderingType();if(n===r)return;let s=new(n===i&&google.maps.WebGLOverlayView?google.maps.WebGLOverlayView:google.maps.OverlayView);s instanceof google.maps.WebGLOverlayView?(t?(s.onAdd=NU,s.onContextRestored=this._onContextRestored.bind(this),s.onDraw=this._onDrawVectorInterleaved.bind(this)):(s.onAdd=this._onAdd.bind(this),s.onContextRestored=NU,s.onDraw=this._onDrawVectorOverlay.bind(this)),s.onContextLost=this._onContextLost.bind(this)):(s.onAdd=this._onAdd.bind(this),s.draw=this._onDrawRaster.bind(this)),s.onRemove=this._onRemove.bind(this),this._overlay=s,this._overlay.setMap(e)}_onAdd(){this._deck=CU(this._map,this._overlay,this._deck,this.props)}_onContextRestored({gl:e}){if(!this._map||!this._overlay)return;let t=CU(this._map,this._overlay,this._deck,{gl:e,_customRender:()=>{this._overlay&&this._overlay.requestRedraw()},...this.props});this._deck=t;let i=t.animationLoop;i._renderFrame=()=>{let r=e.getParameter(34964);t.device.withParametersWebGL({},(()=>{i.props.onRender(i.animationProps)})),e.bindBuffer(34962,r)}}_onContextLost(){this._deck&&(PU(this._deck),this._deck=null)}_onRemove(){this._deck?.setProps({layerFilter:OU})}_onDrawRaster(){if(!this._deck||!this._map)return;let e=this._deck,{width:t,height:i,left:r,top:n,...s}=function(e,t){let{width:i,height:r}=RU(e),n=t.getProjection(),s=e.getBounds();if(!s)return{width:i,height:r,left:0,top:0};let o=s.getNorthEast(),a=s.getSouthWest(),l=n.fromLatLngToDivPixel(o),u=n.fromLatLngToDivPixel(a),h=IU(n,i/2,r/2),c=new google.maps.LatLng(0,h[0]),d=n.fromLatLngToContainerPixel(c),f=n.fromLatLngToDivPixel(c);if(!(l&&u&&f&&d))return{width:i,height:r,left:0,top:0};let p=Math.round(f.x-d.x),g=f.y-d.y,m=IU(n,i/2,0),_=IU(n,i/2,r),v=h[1],y=h[0];if(Math.abs(v)>TU){v=v>0?TU:-TU;let e=new google.maps.LatLng(v,y);g+=n.fromLatLngToContainerPixel(e).y-r/2}g=Math.round(g);let b=180*new Ma(m).sub(_).verticalAngle()/Math.PI;b<0&&(b+=360);let A,E=e.getHeading()||0,w=e.getZoom()-1;if(0===b)A=r?(u.y-l.y)/r:1;else if(b===E){let e=new Ma([l.x,l.y]).sub([u.x,u.y]).len(),t=new Ma([i,-r]).len();A=t?e/t:1}return w+=Math.log2(A||1),{width:i,height:r,left:p,top:g,zoom:w,bearing:b,pitch:e.getTilt(),latitude:v,longitude:y}}(this._map,this._overlay),o=e.getCanvas();if(o?.parentElement){let e=o.parentElement.style;e.left=`${r}px`,e.top=`${n}px`}e.setProps({width:t,height:i,viewState:{altitude:1e4,...s}}),e.redraw()}_onDrawVectorInterleaved({gl:e,transformer:t}){if(!this._deck||!this._map)return;let i=this._deck;if(i.setProps({...MU(this._map,t),width:null,height:null}),i.isInitialized){let t=i.device,r=t.getParametersWebGL(36006);i.setProps({_framebuffer:r}),t.getCanvasContext().resize(),i.needsRedraw({clearRedrawFlags:!0}),t.setParametersWebGL({viewport:[0,0,e.canvas.width,e.canvas.height],scissor:[0,0,e.canvas.width,e.canvas.height],stencilFunc:[519,0,255,519,0,255]}),t.withParametersWebGL(FU,(()=>{i._drawLayers("google-vector",{clearCanvas:!1})}))}}_onDrawVectorOverlay({transformer:e}){if(!this._deck||!this._map)return;let t=this._deck;t.setProps({...MU(this._map,e)}),t.redraw()}},UU=512,GU=Math.PI/180;function zU({map:e,gl:t,deck:i}){if(e.__deck)return e.__deck;let r,n=i?.props._customRender,s=i?.props.onLoad,o=HU({...i?.props,_customRender:()=>{e.triggerRepaint(),n?.("")}});return(!i||i.props.gl===t)&&(Object.assign(o,{gl:t,width:null,height:null,touchAction:"unset",viewState:WU(e)}),i?.isInitialized?VU(i,e):o.onLoad=()=>{s?.(),VU(r,e)}),i?(r=i,i.setProps(o),i.userData.isExternal=!0):(r=new Yv(o),e.on("remove",(()=>{jU(e)}))),r.userData.mapboxLayers=new Set,e.__deck=r,e.on("render",(()=>{r.isInitialized&&function(e,t){let{mapboxLayers:i,isExternal:r}=e.userData;if(r){let r=Array.from(i,(e=>e.id)),n=tg(e.props.layers,Boolean).some((e=>e&&!r.includes(e.id))),s=e.getViewports(),o=s.findIndex((e=>"mapbox"===e.id)),a=s.length>1||o<0;(n||a)&&(o>=0&&(s=s.slice(),s[o]=XU(e,t,!1)),e._drawLayers("mapbox-repaint",{viewports:s,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&("mapbox"!==t.viewport.id||!r.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}(r,e)})),r}function VU(e,t){let i=()=>{e.isInitialized?function(e,t){e.setProps({viewState:WU(t)}),e.needsRedraw({clearRedrawFlags:!0})}(e,t):t.off("move",i)};t.on("move",i)}function jU(e){e.__deck?.finalize(),e.__deck=null}function HU(e){return{...e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...e.parameters},views:e.views||[new Og({id:"mapbox"})]}}function WU(e){let{lng:t,lat:i}=e.getCenter(),r={longitude:(t+540)%360-180,latitude:i,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&function(e,t){if(e.getFreeCameraOptions){let{position:i}=e.getFreeCameraOptions();if(!i||void 0===i.z)return;let r=e.transform.height,{longitude:n,latitude:s,pitch:o}=t,a=i.x*UU,l=(1-i.y)*UU,u=i.z*UU,h=bd([n,s]),c=a-h[0],d=l-h[1],f=Math.sqrt(c*c+d*d),p=o*GU,g=1.5*r,m=p<.001?g*Math.cos(p)/u:g*Math.sin(p)/f;t.zoom=Math.log2(m);let _=u-g*Math.cos(p)/m;t.position=[0,0,_/wd(s)]}else"number"==typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}(e,r),r}function XU(e,t,i=!0){return new Tf({id:"mapbox",x:0,y:0,width:e.width,height:e.height,...WU(t),nearZMultiplier:i?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function qU(e){if(e.userData.isExternal)return;let t=[];e.userData.mapboxLayers.forEach((e=>{let i=new(0,e.props.type)(e.props);t.push(i)})),e.setProps({layers:t})}var KU=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=zU({map:e,gl:t,deck:this.props.deck}),function(e,t){e.userData.mapboxLayers.add(t),qU(e)}(this.deck,this)}onRemove(){this.deck&&function(e,t){e.userData.mapboxLayers.delete(t),qU(e)}(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&function(e,t){qU(e)}(this.deck)}render(){!function(e,t,i){let{currentViewport:r}=e.userData,n=!1;r||(r=XU(e,t,!0),e.userData.currentViewport=r,n=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:e})=>i.id===e.id||e.props.operation.includes("terrain"),clearStack:n,clearCanvas:!1})}(this.deck,this.map,this)}},$U="__UNDEFINED__";function JU(e,t,i,r){if(!(e&&t&&e.style&&e.style._loaded))return;let n=tg(r,Boolean);if(i!==r){let t=tg(i,Boolean),r=new Set(t.map((e=>e.id)));for(let e of n)r.delete(e.id);for(let t of r)e.getLayer(t)&&e.removeLayer(t)}for(let i of n){let r=e.getLayer(i.id);r?r.implementation.setProps(i.props):e.addLayer(new KU({id:i.id,deck:t}),i.props.beforeId)}let s=e.style._order,o={};for(let e of n){let{beforeId:t}=e.props;(!t||!s.includes(t))&&(t=$U),o[t]=o[t]||[],o[t].push(e.id)}for(let t in o){let i=o[t],r=t===$U?s.length:s.indexOf(t),n=t===$U?void 0:t;for(let t=i.length-1;t>=0;t--){let o=i[t],a=s.indexOf(o);a!==r-1&&(e.moveLayer(o,n),a>r&&r++),r--,n=o}}}var YU,ZU,QU,eG,tG,iG,rG,nG=class{constructor(e){this._handleStyleChange=()=>{JU(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:e,clientHeight:t}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${t}px`})}},this._updateViewState=()=>{let e=this._deck;e&&(e.setProps({viewState:WU(this._map)}),e.isInitialized&&e.redraw())},this._handleMouseEvent=e=>{let t=this._deck;if(!t||!t.isInitialized)return;let i={type:e.type,offsetCenter:e.point,srcEvent:e},r=this._lastMouseDownPoint;switch(!e.point&&r&&(i.deltaX=e.originalEvent.clientX-r.clientX,i.deltaY=e.originalEvent.clientY-r.clientY,i.offsetCenter={x:r.x+i.deltaX,y:r.y+i.deltaY}),i.type){case"mousedown":t._onPointerDown(i),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":i.type="panstart",t._onEvent(i);break;case"drag":i.type="panmove",t._onEvent(i);break;case"dragend":i.type="panend",t._onEvent(i);break;case"click":i.tapCount=1,t._onEvent(i);break;case"dblclick":i.type="click",i.tapCount=2,t._onEvent(i);break;case"mousemove":i.type="pointermove",t._onPointerMove(i);break;case"mouseout":i.type="pointerleave",t._onPointerMove(i);break;default:return}};let{interleaved:t=!1,...i}=e;this._interleaved=t,this._props=i}setProps(e){this._interleaved&&e.layers&&JU(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?HU(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Yv({...this._props,parent:t,viewState:WU(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){let t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&wi.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=zU({map:e,gl:t,deck:new Yv({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),JU(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),JU(e,this._deck,this._props.layers,[]),jU(e)}getDefaultPosition(){return"top-left"}pickObject(e){return gg(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return gg(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return gg(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}},sG={},oG=[],aG=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,lG=Array.isArray;function uG(e,t){for(var i in t)e[i]=t[i];return e}function hG(e){var t=e.parentNode;t&&t.removeChild(e)}function cG(e,t,i,r,n){var s={type:e,props:t,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:n??++QU,__i:-1,__u:0};return null==n&&null!=ZU.vnode&&ZU.vnode(s),s}function dG(e){return e.children}function fG(e,t){this.props=e,this.context=t}function pG(e,t){if(null==t)return e.__?pG(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?pG(e):null}function gG(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return gG(e)}}function mG(e){(!e.__d&&(e.__d=!0)&&eG.push(e)&&!_G.__r++||tG!==ZU.debounceRendering)&&((tG=ZU.debounceRendering)||iG)(_G)}function _G(){var e,t,i,r,n,s,o,a,l;for(eG.sort(rG);e=eG.shift();)e.__d&&(t=eG.length,r=void 0,s=(n=(i=e).__v).__e,a=[],l=[],(o=i.__P)&&((r=uG({},n)).__v=n.__v+1,ZU.vnode&&ZU.vnode(r),TG(o,r,n,i.__n,void 0!==o.ownerSVGElement,32&n.__u?[s]:null,a,s??pG(n),!!(32&n.__u),l),r.__v=n.__v,r.__.__k[r.__i]=r,CG(a,r,l),r.__e!=s&&gG(r)),eG.length>t&&eG.sort(rG));_G.__r=0}function vG(e,t,i,r,n,s,o,a,l,u,h){var c,d,f,p,g,m=r&&r.__k||oG,_=t.length;for(i.__d=l,function(e,t,i){var r,n,s,o,a,l=t.length,u=i.length,h=u,c=0;for(e.__k=[],r=0;r<l;r++)o=r+c,null!=(n=e.__k[r]=null==(n=t[r])||"boolean"==typeof n||"function"==typeof n?null:"string"==typeof n||"number"==typeof n||"bigint"==typeof n||n.constructor==String?cG(null,n,null,null,null):lG(n)?cG(dG,{children:n},null,null,null):void 0===n.constructor&&n.__b>0?cG(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n)?(n.__=e,n.__b=e.__b+1,a=bG(n,i,o,h),n.__i=a,s=null,-1!==a&&(h--,(s=i[a])&&(s.__u|=131072)),null==s||null===s.__v?(-1==a&&c--,"function"!=typeof n.type&&(n.__u|=65536)):a!==o&&(a===o+1?c++:a>o?h>l-o?c+=a-o:c--:a<o?a==o-1&&(c=a-o):c=0,a!==r+c&&(n.__u|=65536))):(s=i[o])&&null==s.key&&s.__e&&!(131072&s.__u)&&(s.__e==e.__d&&(e.__d=pG(s)),PG(s,s,!1),i[o]=null,h--);if(h)for(r=0;r<u;r++)null!=(s=i[r])&&!(131072&s.__u)&&(s.__e==e.__d&&(e.__d=pG(s)),PG(s,s))}(i,t,m),l=i.__d,c=0;c<_;c++)null!=(f=i.__k[c])&&"boolean"!=typeof f&&"function"!=typeof f&&(d=-1===f.__i?sG:m[f.__i]||sG,f.__i=c,TG(e,f,d,n,s,o,a,l,u,h),p=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&SG(d.ref,null,f),h.push(f.ref,f.__c||p,f)),null==g&&null!=p&&(g=p),65536&f.__u||d.__k===f.__k?(p||d.__e!=l||(l=pG(d)),l=yG(f,l,e)):"function"==typeof f.type&&void 0!==f.__d?l=f.__d:p&&(l=p.nextSibling),f.__d=void 0,f.__u&=-196609);i.__d=l,i.__e=g}function yG(e,t,i){var r,n;if("function"==typeof e.type){for(r=e.__k,n=0;r&&n<r.length;n++)r[n]&&(r[n].__=e,t=yG(r[n],t,i));return t}e.__e!=t&&(i.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8===t.nodeType);return t}function bG(e,t,i,r){var n=e.key,s=e.type,o=i-1,a=i+1,l=t[i];if(null===l||l&&n==l.key&&s===l.type&&!(131072&l.__u))return i;if(r>(null==l||131072&l.__u?0:1))for(;o>=0||a<t.length;){if(o>=0){if((l=t[o])&&!(131072&l.__u)&&n==l.key&&s===l.type)return o;o--}if(a<t.length){if((l=t[a])&&!(131072&l.__u)&&n==l.key&&s===l.type)return a;a++}}return-1}function AG(e,t,i){"-"===t[0]?e.setProperty(t,i??""):e[t]=null==i?"":"number"!=typeof i||aG.test(t)?i:i+"px"}function EG(e,t,i,r,n){var s;e:if("style"===t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)i&&t in i||AG(e.style,t,"");if(i)for(t in i)r&&i[t]===r[t]||AG(e.style,t,i[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=i,i?r?i.u=r.u:(i.u=Date.now(),e.addEventListener(t,s?xG:wG,s)):e.removeEventListener(t,s?xG:wG,s);else{if(n)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==t&&"height"!==t&&"href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&"rowSpan"!==t&&"colSpan"!==t&&"role"!==t&&t in e)try{e[t]=i??"";break e}catch{}"function"==typeof i||(null==i||!1===i&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,i))}}function wG(e){if(this.l){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(ZU.event?ZU.event(e):e)}}function xG(e){if(this.l)return this.l[e.type+!0](ZU.event?ZU.event(e):e)}function TG(e,t,i,r,n,s,o,a,l,u){var h,c,d,f,p,g,m,_,v,y,b,A,E,w,x,T=t.type;if(void 0!==t.constructor)return null;128&i.__u&&(l=!!(32&i.__u),s=[a=t.__e=i.__e]),(h=ZU.__b)&&h(t);e:if("function"==typeof T)try{if(_=t.props,v=(h=T.contextType)&&r[h.__c],y=h?v?v.props.value:h.__:r,i.__c?m=(c=t.__c=i.__c).__=c.__E:("prototype"in T&&T.prototype.render?t.__c=c=new T(_,y):(t.__c=c=new fG(_,y),c.constructor=T,c.render=MG),v&&v.sub(c),c.props=_,c.state||(c.state={}),c.context=y,c.__n=r,d=c.__d=!0,c.__h=[],c._sb=[]),null==c.__s&&(c.__s=c.state),null!=T.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=uG({},c.__s)),uG(c.__s,T.getDerivedStateFromProps(_,c.__s))),f=c.props,p=c.state,c.__v=t,d)null==T.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(null==T.getDerivedStateFromProps&&_!==f&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(_,y),!c.__e&&(null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(_,c.__s,y)||t.__v===i.__v)){for(t.__v!==i.__v&&(c.props=_,c.state=c.__s,c.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.forEach((function(e){e&&(e.__=t)})),b=0;b<c._sb.length;b++)c.__h.push(c._sb[b]);c._sb=[],c.__h.length&&o.push(c);break e}null!=c.componentWillUpdate&&c.componentWillUpdate(_,c.__s,y),null!=c.componentDidUpdate&&c.__h.push((function(){c.componentDidUpdate(f,p,g)}))}if(c.context=y,c.props=_,c.__P=e,c.__e=!1,A=ZU.__r,E=0,"prototype"in T&&T.prototype.render){for(c.state=c.__s,c.__d=!1,A&&A(t),h=c.render(c.props,c.state,c.context),w=0;w<c._sb.length;w++)c.__h.push(c._sb[w]);c._sb=[]}else do{c.__d=!1,A&&A(t),h=c.render(c.props,c.state,c.context),c.state=c.__s}while(c.__d&&++E<25);c.state=c.__s,null!=c.getChildContext&&(r=uG(uG({},r),c.getChildContext())),d||null==c.getSnapshotBeforeUpdate||(g=c.getSnapshotBeforeUpdate(f,p)),vG(e,lG(x=null!=h&&h.type===dG&&null==h.key?h.props.children:h)?x:[x],t,i,r,n,s,o,a,l,u),c.base=t.__e,t.__u&=-161,c.__h.length&&o.push(c),m&&(c.__E=c.__=null)}catch(e){t.__v=null,l||null!=s?(t.__e=a,t.__u|=l?160:32,s[s.indexOf(a)]=null):(t.__e=i.__e,t.__k=i.__k),ZU.__e(e,t,i)}else null==s&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=function(e,t,i,r,n,s,o,a,l){var u,h,c,d,f,p,g,m=i.props,_=t.props,v=t.type;if("svg"===v&&(n=!0),null!=s)for(u=0;u<s.length;u++)if((f=s[u])&&"setAttribute"in f==!!v&&(v?f.localName===v:3===f.nodeType)){e=f,s[u]=null;break}if(null==e){if(null===v)return document.createTextNode(_);e=n?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,_.is&&_),s=null,a=!1}if(null===v)m===_||a&&e.data===_||(e.data=_);else{if(s=s&&YU.call(e.childNodes),m=i.props||sG,!a&&null!=s)for(m={},u=0;u<e.attributes.length;u++)m[(f=e.attributes[u]).name]=f.value;for(u in m)f=m[u],"children"==u||("dangerouslySetInnerHTML"==u?c=f:"key"===u||u in _||EG(e,u,null,f,n));for(u in _)f=_[u],"children"==u?d=f:"dangerouslySetInnerHTML"==u?h=f:"value"==u?p=f:"checked"==u?g=f:"key"===u||a&&"function"!=typeof f||m[u]===f||EG(e,u,f,m[u],n);if(h)a||c&&(h.__html===c.__html||h.__html===e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(c&&(e.innerHTML=""),vG(e,lG(d)?d:[d],t,i,r,n&&"foreignObject"!==v,s,o,s?s[0]:i.__k&&pG(i,0),a,l),null!=s)for(u=s.length;u--;)null!=s[u]&&hG(s[u]);a||(u="value",void 0!==p&&(p!==e[u]||"progress"===v&&!p||"option"===v&&p!==m[u])&&EG(e,u,p,m[u],!1),u="checked",void 0!==g&&g!==e[u]&&EG(e,u,g,m[u],!1))}return e}(i.__e,t,i,r,n,s,o,l,u);(h=ZU.diffed)&&h(t)}function CG(e,t,i){t.__d=void 0;for(var r=0;r<i.length;r++)SG(i[r],i[++r],i[++r]);ZU.__c&&ZU.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){ZU.__e(e,t.__v)}}))}function SG(e,t,i){try{"function"==typeof e?e(t):e.current=t}catch(e){ZU.__e(e,i)}}function PG(e,t,i){var r,n;if(ZU.unmount&&ZU.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||SG(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){ZU.__e(e,t)}r.base=r.__P=null,e.__c=void 0}if(r=e.__k)for(n=0;n<r.length;n++)r[n]&&PG(r[n],t,i||"function"!=typeof e.type);i||null==e.__e||hG(e.__e),e.__=e.__e=e.__d=void 0}function MG(e,t,i){return this.constructor(e,i)}function RG(e,t,i){var r,n,s,o;ZU.__&&ZU.__(e,t),n=(r="function"==typeof i)?null:i&&i.__k||t.__k,s=[],o=[],TG(t,e=(!r&&i||t).__k=function(e,t,i){var r,n,s,o={};for(s in t)"key"==s?r=t[s]:"ref"==s?n=t[s]:o[s]=t[s];if(arguments.length>2&&(o.children=arguments.length>3?YU.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===o[s]&&(o[s]=e.defaultProps[s]);return cG(e,o,r,n,null)}(dG,null,[e]),n||sG,sG,void 0!==t.ownerSVGElement,!r&&i?[i]:n?null:t.firstChild?YU.call(t.childNodes):null,s,!r&&i?i:n?n.__e:t.firstChild,r,o),CG(s,e,o)}YU=oG.slice,ZU={__e:function(e,t,i,r){for(var n,s,o;t=t.__;)if((n=t.__c)&&!n.__)try{if((s=n.constructor)&&null!=s.getDerivedStateFromError&&(n.setState(s.getDerivedStateFromError(e)),o=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e,r||{}),o=n.__d),o)return n.__E=n}catch(t){e=t}throw e}},QU=0,fG.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=uG({},this.state),"function"==typeof e&&(e=e(uG({},i),this.props)),e&&uG(i,e),null!=e&&this.__v&&(t&&this._sb.push(t),mG(this))},fG.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),mG(this))},fG.prototype.render=dG,eG=[],iG="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,rG=function(e,t){return e.__v.__b-t.__v.__b},_G.__r=0;var IG=0;function BG(e,t,i,r,n,s){var o,a,l={};for(a in t)"ref"==a?o=t[a]:l[a]=t[a];var u={type:e,props:l,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--IG,__i:-1,__u:0,__source:n,__self:s};if("function"==typeof e&&(o=e.defaultProps))for(a in o)void 0===l[a]&&(l[a]=o[a]);return ZU.vnode&&ZU.vnode(u),u}var LG=e=>{let{className:t,label:i,onClick:r}=e;return BG("div",{className:"deck-widget-button",children:BG("button",{className:`deck-widget-icon-button ${t}`,type:"button",onClick:r,title:i,children:BG("div",{className:"deck-widget-icon"})})})},OG=e=>{let{children:t,orientation:i}=e;return BG("div",{className:`deck-widget-button-group ${i}`,children:t})},FG=e=>{let{className:t,label:i,onClick:r}=e;return BG("button",{className:`deck-widget-icon-button ${t}`,type:"button",onClick:r,title:i,children:BG("div",{className:"deck-widget-icon"})})},NG=class{constructor(e){this.id="fullscreen",this.placement="top-left",this.fullscreen=!1,this.id=e.id||"fullscreen",this.placement=e.placement||"top-left",e.enterLabel=e.enterLabel||"Enter Fullscreen",e.exitLabel=e.exitLabel||"Exit Fullscreen",e.style=e.style||{},this.props=e}onAdd({deck:e}){let{style:t,className:i}=this.props,r=document.createElement("div");return r.classList.add("deck-widget","deck-widget-fullscreen"),i&&r.classList.add(i),t&&Object.entries(t).map((([e,t])=>r.style.setProperty(e,t))),this.deck=e,this.element=r,this.update(),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),r}onRemove(){this.deck=void 0,this.element=void 0,document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}update(){let{enterLabel:e,exitLabel:t}=this.props,i=this.element;i&&RG(BG(LG,{onClick:this.handleClick.bind(this),label:this.fullscreen?t:e,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"}),i)}setProps(e){let t=this.props,i=this.element;i&&(t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),sg(t.style,e.style,1)||(t.style&&Object.entries(t.style).map((([e])=>i.style.removeProperty(e))),e.style&&Object.entries(e.style).map((([e,t])=>i.style.setProperty(e,t))))),Object.assign(this.props,e)}getContainer(){return this.props.container||this.deck?.getCanvas()?.parentElement}onFullscreenChange(){this.fullscreen!==(document.fullscreenElement===this.getContainer())&&(this.fullscreen=!this.fullscreen),this.update()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.update()}async requestFullscreen(){let e=this.getContainer();e?.requestFullscreen?await e.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){this.getContainer()?.classList.toggle("deck-pseudo-fullscreen")}},DG=class{constructor(e){this.id="compass",this.placement="top-left",this.viewId=null,this.id=e.id||"compass",this.viewId=e.viewId||null,this.placement=e.placement||"top-left",e.transitionDuration=e.transitionDuration||200,e.label=e.label||"Compass",e.style=e.style||{},this.props=e}setProps(e){Object.assign(this.props,e)}onViewportChange(e){this.viewport=e,this.update()}onAdd({deck:e}){let{style:t,className:i}=this.props,r=document.createElement("div");return r.classList.add("deck-widget","deck-widget-compass"),i&&r.classList.add(i),t&&Object.entries(t).map((([e,t])=>r.style.setProperty(e,t))),this.deck=e,this.element=r,this.update(),r}getRotation(){return this.viewport instanceof Tf?[-this.viewport.bearing,this.viewport.pitch]:this.viewport instanceof vb?[0,Math.max(-80,Math.min(80,this.viewport.latitude))]:[0,0]}update(){let[e,t]=this.getRotation(),i=this.element;i&&RG(BG("div",{className:"deck-widget-button",style:{perspective:100},children:BG("button",{type:"button",onClick:()=>this.handleCompassReset(),label:this.props.label,style:{transform:`rotateX(${t}deg)`},children:BG("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:BG("g",{transform:`rotate(${e},13,13)`,children:[BG("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, #F05C44)"}),BG("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, #C2C2CC)"})]})})})}),i)}onRemove(){this.deck=void 0,this.element=void 0}handleCompassReset(){let e=this.viewId||"default-view";if(this.viewport instanceof Tf){let t={...this.viewport,bearing:0,...0===this.getRotation()[0]?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new Kb};this.deck._onViewStateChange({viewId:e,viewState:t,interactionState:{}})}}},kG=class{constructor(e){this.id="zoom",this.placement="top-left",this.orientation="vertical",this.viewId=null,this.id=e.id||"zoom",this.viewId=e.viewId||null,this.placement=e.placement||"top-left",this.orientation=e.orientation||"vertical",e.transitionDuration=e.transitionDuration||200,e.zoomInLabel=e.zoomInLabel||"Zoom In",e.zoomOutLabel=e.zoomOutLabel||"Zoom Out",e.style=e.style||{},this.props=e}onAdd({deck:e}){let{style:t,className:i}=this.props,r=document.createElement("div");return r.classList.add("deck-widget","deck-widget-zoom"),i&&r.classList.add(i),t&&Object.entries(t).map((([e,t])=>r.style.setProperty(e,t))),RG(BG(OG,{orientation:this.orientation,children:[BG(FG,{onClick:()=>this.handleZoomIn(),label:this.props.zoomInLabel,className:"deck-widget-zoom-in"}),BG(FG,{onClick:()=>this.handleZoomOut(),label:this.props.zoomOutLabel,className:"deck-widget-zoom-out"})]}),r),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(e){Object.assign(this.props,e)}onViewportChange(e){this.viewport=e}handleZoom(e){let t=this.viewId||"default-view",i={...this.viewport,zoom:e,transitionDuration:this.props.transitionDuration,transitionInterpolator:new Kb};this.deck._onViewStateChange({viewId:t,viewState:i,interactionState:{}})}handleZoomIn(){this.viewport&&this.handleZoom(this.viewport.zoom+1)}handleZoomOut(){this.viewport&&this.handleZoom(this.viewport.zoom-1)}},UG={"--button-background":"#fff","--button-stroke":"rgba(255, 255, 255, 0.3)","--button-inner-stroke":"unset","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25)","--button-backdrop-filter":"unset","--button-icon-idle":"rgba(97, 97, 102, 1)","--button-icon-hover":"rgba(24, 24, 26, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},GG={"--button-background":"rgba(18, 18, 20, 1)","--button-stroke":"rgba(18, 18, 20, 0.30)","--button-inner-stroke":"unset","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25)","--button-backdrop-filter":"unset","--button-icon-idle":"rgba(158, 157, 168, 1)","--button-icon-hover":"rgba(215, 214, 229, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},zG={"--button-background":"rgba(255, 255, 255, 0.6)","--button-stroke":"rgba(255, 255, 255, 0.3)","--button-inner-stroke":"1px solid rgba(255, 255, 255, 0.6)","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25), 0px 0px 8px 0px rgba(0, 0, 0, 0.1) inset","--button-backdrop-filter":"blur(4px)","--button-icon-idle":"rgba(97, 97, 102, 1)","--button-icon-hover":"rgba(24, 24, 26, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},VG={"--button-background":"rgba(18, 18, 20, 0.75)","--button-stroke":"rgba(18, 18, 20, 0.30)","--button-inner-stroke":"1px solid rgba(18, 18, 20, 0.75)","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25), 0px 0px 8px 0px rgba(0, 0, 0, 0.1) inset","--button-backdrop-filter":"blur(4px)","--button-icon-idle":"rgba(158, 157, 168, 1)","--button-icon-hover":"rgba(215, 214, 229, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},jG=h(R(),1);return CC._checkH3Lib=()=>{let e='include the <script src="https://unpkg.com/h3-js@^4.0.0"><\/script> tag before the deck.gl script tag. https://deck.gl/docs/api-reference/geo-layers/h3-hexagon-layer';if(!jG)throw new Error(`To use H3 functionality, ${e}`);if(jG.polyfill&&!jG.polygonToCells)throw new Error(`Incompatible h3-js version. ${e}`)},(e=>u(t({},"__esModule",{value:!0}),e))(L)})();return e};var M=P.exports=S();export{M as default};
