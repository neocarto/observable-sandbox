/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/webr@0.4.2/dist/webr.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function t(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}var n=t,i=r;function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===t||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}"function"==typeof e.setTimeout&&(n=setTimeout),"function"==typeof e.clearTimeout&&(i=clearTimeout);var a,o=[],l=!1,h=-1;function u(){l&&a&&(l=!1,a.length?o=a.concat(o):h=-1,o.length&&c())}function c(){if(!l){var e=s(u);l=!0;for(var t=o.length;t;){for(a=o,o=[];++h<t;)a&&a[h].run();h=-1,t=o.length}a=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}d.prototype.run=function(){this.fun.apply(null,this.array)};function p(){}var f=p,y=p,w=p,m=p,g=p,b=p,v=p;var E=e.performance||{},T=E.now||E.mozNow||E.msNow||E.oNow||E.webkitNow||function(){return(new Date).getTime()};var R=new Date;var _,S={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new d(e,t)),1!==o.length||l||s(c)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:f,addListener:y,once:w,off:m,removeListener:g,removeAllListeners:b,emit:v,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*T.call(E),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-R)/1e3}},A=Object.create,x=Object.defineProperty,U=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyNames,k=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty,D=(_=function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')},typeof require<"u"?require:typeof Proxy<"u"?new Proxy(_,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):_),M=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),I=(e,t,r)=>(r=null!=e?A(k(e)):{},((e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of j(t))!O.call(e,i)&&i!==r&&x(e,i,{get:()=>t[i],enumerable:!(n=U(t,i))||n.enumerable});return e})(!t&&e&&e.__esModule?r:x(r,"default",{value:e,enumerable:!0}),e)),P=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},C=(e,t,r)=>(P(e,t,"read from private field"),r?r.call(e):t.get(e)),L=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},B=(e,t,r,n)=>(P(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),W=(e,t,r)=>(P(e,t,"access private method"),r),N=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getUint64=e.getInt64=e.setInt64=e.setUint64=e.UINT32_MAX=void 0,e.UINT32_MAX=4294967295,e.setUint64=function(e,t,r){let n=r/4294967296,i=r;e.setUint32(t,n),e.setUint32(t+4,i)},e.setInt64=function(e,t,r){let n=Math.floor(r/4294967296),i=r;e.setUint32(t,n),e.setUint32(t+4,i)},e.getInt64=function(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)},e.getUint64=function(e,t){return 4294967296*e.getUint32(t)+e.getUint32(t+4)}})),F=M((e=>{var t,r,n;Object.defineProperty(e,"__esModule",{value:!0}),e.utf8DecodeTD=e.TEXT_DECODER_THRESHOLD=e.utf8DecodeJs=e.utf8EncodeTE=e.TEXT_ENCODER_THRESHOLD=e.utf8EncodeJs=e.utf8Count=void 0;var i=N(),s=(typeof S>"u"||"never"!==(null===(t=null==S?void 0:S.env)||void 0===t?void 0:t.TEXT_ENCODING))&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";e.utf8Count=function(e){let t=e.length,r=0,n=0;for(;n<t;){let i=e.charCodeAt(n++);if(4294967168&i)if(4294965248&i){if(i>=55296&&i<=56319&&n<t){let t=e.charCodeAt(n);56320==(64512&t)&&(++n,i=((1023&i)<<10)+(1023&t)+65536)}r+=4294901760&i?4:3}else r+=2;else r++}return r},e.utf8EncodeJs=function(e,t,r){let n=e.length,i=r,s=0;for(;s<n;){let r=e.charCodeAt(s++);if(4294967168&r){if(4294965248&r){if(r>=55296&&r<=56319&&s<n){let t=e.charCodeAt(s);56320==(64512&t)&&(++s,r=((1023&r)<<10)+(1023&t)+65536)}4294901760&r?(t[i++]=r>>18&7|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128):(t[i++]=r>>12&15|224,t[i++]=r>>6&63|128)}else t[i++]=r>>6&31|192;t[i++]=63&r|128}else t[i++]=r}};var a=s?new TextEncoder:void 0;e.TEXT_ENCODER_THRESHOLD=s?typeof S<"u"&&"force"!==(null===(r=null==S?void 0:S.env)||void 0===r?void 0:r.TEXT_ENCODING)?200:0:i.UINT32_MAX,e.utf8EncodeTE=null!=a&&a.encodeInto?function(e,t,r){a.encodeInto(e,t.subarray(r))}:function(e,t,r){t.set(a.encode(e),r)};e.utf8DecodeJs=function(e,t,r){let n=t,i=n+r,s=[],a="";for(;n<i;){let t=e[n++];if(128&t)if(192==(224&t)){let r=63&e[n++];s.push((31&t)<<6|r)}else if(224==(240&t)){let r=63&e[n++],i=63&e[n++];s.push((31&t)<<12|r<<6|i)}else if(240==(248&t)){let r=(7&t)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++];r>65535&&(r-=65536,s.push(r>>>10&1023|55296),r=56320|1023&r),s.push(r)}else s.push(t);else s.push(t);s.length>=4096&&(a+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(a+=String.fromCharCode(...s)),a};var o=s?new TextDecoder:null;e.TEXT_DECODER_THRESHOLD=s?typeof S<"u"&&"force"!==(null===(n=null==S?void 0:S.env)||void 0===n?void 0:n.TEXT_DECODER)?200:0:i.UINT32_MAX,e.utf8DecodeTD=function(e,t,r){let n=e.subarray(t,t+r);return o.decode(n)}})),q=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtData=void 0;e.ExtData=class{constructor(e,t){this.type=e,this.data=t}}})),V=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DecodeError=void 0;var t=class extends Error{constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};e.DecodeError=t})),z=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.timestampExtension=e.decodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimestampExtension=e.encodeDateToTimeSpec=e.encodeTimeSpecToTimestamp=e.EXT_TIMESTAMP=void 0;var t=V(),r=N();e.EXT_TIMESTAMP=-1;var n=4294967295,i=17179869183;function s({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=i){if(0===t&&e<=n){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}{let r=e/4294967296,n=4294967295&e,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,t<<2|3&r),s.setUint32(4,n),i}}{let n=new Uint8Array(12),i=new DataView(n.buffer);return i.setUint32(0,t),(0,r.setInt64)(i,4,e),n}}function a(e){let t=e.getTime(),r=Math.floor(t/1e3),n=1e6*(t-1e3*r),i=Math.floor(n/1e9);return{sec:r+i,nsec:n-1e9*i}}function o(e){if(e instanceof Date){return s(a(e))}return null}function l(e){let n=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:n.getUint32(0),nsec:0};case 8:{let e=n.getUint32(0);return{sec:4294967296*(3&e)+n.getUint32(4),nsec:e>>>2}}case 12:return{sec:(0,r.getInt64)(n,4),nsec:n.getUint32(0)};default:throw new t.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function h(e){let t=l(e);return new Date(1e3*t.sec+t.nsec/1e6)}e.encodeTimeSpecToTimestamp=s,e.encodeDateToTimeSpec=a,e.encodeTimestampExtension=o,e.decodeTimestampToTimeSpec=l,e.decodeTimestampExtension=h,e.timestampExtension={type:e.EXT_TIMESTAMP,encode:o,decode:h}})),$=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionCodec=void 0;var t=q(),r=z(),n=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(r.timestampExtension)}register({type:e,encode:t,decode:r}){if(e>=0)this.encoders[e]=t,this.decoders[e]=r;else{let n=1+e;this.builtInEncoders[n]=t,this.builtInDecoders[n]=r}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){let i=this.builtInEncoders[n];if(null!=i){let s=i(e,r);if(null!=s){let e=-1-n;return new t.ExtData(e,s)}}}for(let n=0;n<this.encoders.length;n++){let i=this.encoders[n];if(null!=i){let s=i(e,r);if(null!=s){let e=n;return new t.ExtData(e,s)}}}return e instanceof t.ExtData?e:null}decode(e,r,n){let i=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return i?i(e,r,n):new t.ExtData(r,e)}};e.ExtensionCodec=n,n.defaultCodec=new n})),J=M((e=>{function t(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.createDataView=e.ensureUint8Array=void 0,e.ensureUint8Array=t,e.createDataView=function(e){if(e instanceof ArrayBuffer)return new DataView(e);let r=t(e);return new DataView(r.buffer,r.byteOffset,r.byteLength)}})),H=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Encoder=e.DEFAULT_INITIAL_BUFFER_SIZE=e.DEFAULT_MAX_DEPTH=void 0;var t=F(),r=$(),n=N(),i=J();e.DEFAULT_MAX_DEPTH=100,e.DEFAULT_INITIAL_BUFFER_SIZE=2048;e.Encoder=class{constructor(t=r.ExtensionCodec.defaultCodec,n=void 0,i=e.DEFAULT_MAX_DEPTH,s=e.DEFAULT_INITIAL_BUFFER_SIZE,a=!1,o=!1,l=!1,h=!1){this.extensionCodec=t,this.context=n,this.maxDepth=i,this.initialBufferSize=s,this.sortKeys=a,this.forceFloat32=o,this.ignoreUndefined=l,this.forceIntegerToFloat=h,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}encode(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){let t=new ArrayBuffer(e),r=new Uint8Array(t),n=new DataView(t);r.set(this.bytes),this.view=n,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error(`Too long string: ${e} bytes in UTF-8`);this.writeU8(219),this.writeU32(e)}}encodeString(e){if(e.length>t.TEXT_ENCODER_THRESHOLD){let r=(0,t.utf8Count)(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),(0,t.utf8EncodeTE)(e,this.bytes,this.pos),this.pos+=r}else{let r=(0,t.utf8Count)(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),(0,t.utf8EncodeJs)(e,this.bytes,this.pos),this.pos+=r}}encodeObject(e,t){let r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`);this.encodeMap(e,t)}}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large binary: ${t}`);this.writeU8(198),this.writeU32(t)}let r=(0,i.ensureUint8Array)(e);this.writeU8a(r)}encodeArray(e,t){let r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error(`Too large array: ${r}`);this.writeU8(221),this.writeU32(r)}for(let r of e)this.doEncode(r,t+1)}countWithoutUndefined(e,t){let r=0;for(let n of t)void 0!==e[n]&&r++;return r}encodeMap(e,t){let r=Object.keys(e);this.sortKeys&&r.sort();let n=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else{if(!(n<4294967296))throw new Error(`Too large map object: ${n}`);this.writeU8(223),this.writeU32(n)}for(let n of r){let r=e[n];this.ignoreUndefined&&void 0===r||(this.encodeString(n),this.doEncode(r,t+1))}}encodeExtension(e){let t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large extension object: ${t}`);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),(0,n.setUint64)(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),(0,n.setInt64)(this.view,this.pos,e),this.pos+=8}}})),X=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var t=H(),r={};e.encode=function(e,n=r){return new t.Encoder(n.extensionCodec,n.context,n.maxDepth,n.initialBufferSize,n.sortKeys,n.forceFloat32,n.ignoreUndefined,n.forceIntegerToFloat).encodeSharedRef(e)}})),K=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.prettyByte=void 0,e.prettyByte=function(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}})),G=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CachedKeyDecoder=void 0;var t=F();e.CachedKeyDecoder=class{constructor(e=16,t=16){this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(let e=0;e<this.maxKeyLength;e++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,r){let n=this.caches[r-1];e:for(let i of n){let n=i.bytes;for(let i=0;i<r;i++)if(n[i]!==e[t+i])continue e;return i.str}return null}store(e,t){let r=this.caches[e.length-1],n={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=n:r.push(n)}decode(e,r,n){let i=this.find(e,r,n);if(null!=i)return this.hit++,i;this.miss++;let s=(0,t.utf8DecodeJs)(e,r,n),a=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(a,s),s}}})),Q=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.DataViewIndexOutOfBoundsError=void 0;var t=K(),r=$(),n=N(),i=F(),s=J(),a=G(),o=V(),l=e=>{let t=typeof e;return"string"===t||"number"===t},h=new DataView(new ArrayBuffer(0)),u=new Uint8Array(h.buffer);e.DataViewIndexOutOfBoundsError=(()=>{try{h.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")})();var c=new e.DataViewIndexOutOfBoundsError("Insufficient data"),d=new a.CachedKeyDecoder;e.Decoder=class{constructor(e=r.ExtensionCodec.defaultCodec,t=void 0,i=n.UINT32_MAX,s=n.UINT32_MAX,a=n.UINT32_MAX,o=n.UINT32_MAX,l=n.UINT32_MAX,c=d){this.extensionCodec=e,this.context=t,this.maxStrLength=i,this.maxBinLength=s,this.maxArrayLength=a,this.maxMapLength=o,this.maxExtLength=l,this.keyDecoder=c,this.totalPos=0,this.pos=0,this.view=h,this.bytes=u,this.headByte=-1,this.stack=[]}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.length=0}setBuffer(e){this.bytes=(0,s.ensureUint8Array)(e),this.view=(0,s.createDataView)(this.bytes),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){let t=this.bytes.subarray(this.pos),r=(0,s.ensureUint8Array)(e),n=new Uint8Array(t.length+r.length);n.set(t),n.set(r,t.length),this.setBuffer(n)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:r}=this;return new RangeError(`Extra ${t.byteLength-r} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}*decodeMulti(e){for(this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}async decodeAsync(r){let n,i=!1;for await(let t of r){if(i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(t);try{n=this.doDecodeSync(),i=!0}catch(t){if(!(t instanceof e.DataViewIndexOutOfBoundsError))throw t}this.totalPos+=this.pos}if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}let{headByte:s,pos:a,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${(0,t.prettyByte)(s)} at ${o} (${a} in the current buffer)`)}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(t,r){let n=r,i=-1;for await(let s of t){if(r&&0===i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--i;);}catch(t){if(!(t instanceof e.DataViewIndexOutOfBoundsError))throw t}this.totalPos+=this.pos}}doDecodeSync(){e:for(;;){let e,r=this.readHeadByte();if(r>=224)e=r-256;else if(r<192)if(r<128)e=r;else if(r<144){let t=r-128;if(0!==t){this.pushMapState(t),this.complete();continue e}e={}}else if(r<160){let t=r-144;if(0!==t){this.pushArrayState(t),this.complete();continue e}e=[]}else{let t=r-160;e=this.decodeUtf8String(t,0)}else if(192===r)e=null;else if(194===r)e=!1;else if(195===r)e=!0;else if(202===r)e=this.readF32();else if(203===r)e=this.readF64();else if(204===r)e=this.readU8();else if(205===r)e=this.readU16();else if(206===r)e=this.readU32();else if(207===r)e=this.readU64();else if(208===r)e=this.readI8();else if(209===r)e=this.readI16();else if(210===r)e=this.readI32();else if(211===r)e=this.readI64();else if(217===r){let t=this.lookU8();e=this.decodeUtf8String(t,1)}else if(218===r){let t=this.lookU16();e=this.decodeUtf8String(t,2)}else if(219===r){let t=this.lookU32();e=this.decodeUtf8String(t,4)}else if(220===r){let t=this.readU16();if(0!==t){this.pushArrayState(t),this.complete();continue e}e=[]}else if(221===r){let t=this.readU32();if(0!==t){this.pushArrayState(t),this.complete();continue e}e=[]}else if(222===r){let t=this.readU16();if(0!==t){this.pushMapState(t),this.complete();continue e}e={}}else if(223===r){let t=this.readU32();if(0!==t){this.pushMapState(t),this.complete();continue e}e={}}else if(196===r){let t=this.lookU8();e=this.decodeBinary(t,1)}else if(197===r){let t=this.lookU16();e=this.decodeBinary(t,2)}else if(198===r){let t=this.lookU32();e=this.decodeBinary(t,4)}else if(212===r)e=this.decodeExtension(1,0);else if(213===r)e=this.decodeExtension(2,0);else if(214===r)e=this.decodeExtension(4,0);else if(215===r)e=this.decodeExtension(8,0);else if(216===r)e=this.decodeExtension(16,0);else if(199===r){let t=this.lookU8();e=this.decodeExtension(t,1)}else if(200===r){let t=this.lookU16();e=this.decodeExtension(t,2)}else{if(201!==r)throw new o.DecodeError(`Unrecognized type byte: ${(0,t.prettyByte)(r)}`);{let t=this.lookU32();e=this.decodeExtension(t,4)}}this.complete();let n=this.stack;for(;n.length>0;){let t=n[n.length-1];if(0===t.type){if(t.array[t.position]=e,t.position++,t.position!==t.size)continue e;n.pop(),e=t.array}else{if(1===t.type){if(!l(e))throw new o.DecodeError("The type of key must be string or number but "+typeof e);if("__proto__"===e)throw new o.DecodeError("The key __proto__ is not allowed");t.key=e,t.type=2;continue e}if(t.map[t.key]=e,t.readCount++,t.readCount!==t.size){t.key=null,t.type=1;continue e}n.pop(),e=t.map}}return e}}readHeadByte(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new o.DecodeError(`Unrecognized array type byte: ${(0,t.prettyByte)(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new o.DecodeError(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})}pushArrayState(e){if(e>this.maxArrayLength)throw new o.DecodeError(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:0,size:e,array:new Array(e),position:0})}decodeUtf8String(e,t){var r;if(e>this.maxStrLength)throw new o.DecodeError(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw c;let n,s=this.pos+t;return n=this.stateIsMapKey()&&null!==(r=this.keyDecoder)&&void 0!==r&&r.canBeCached(e)?this.keyDecoder.decode(this.bytes,s,e):e>i.TEXT_DECODER_THRESHOLD?(0,i.utf8DecodeTD)(this.bytes,s,e):(0,i.utf8DecodeJs)(this.bytes,s,e),this.pos+=t+e,n}stateIsMapKey(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type}decodeBinary(e,t){if(e>this.maxBinLength)throw new o.DecodeError(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw c;let r=this.pos+t,n=this.bytes.subarray(r,r+e);return this.pos+=t+e,n}decodeExtension(e,t){if(e>this.maxExtLength)throw new o.DecodeError(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let r=this.view.getInt8(this.pos+t),n=this.decodeBinary(e,t+1);return this.extensionCodec.decode(n,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=(0,n.getUint64)(this.view,this.pos);return this.pos+=8,e}readI64(){let e=(0,n.getInt64)(this.view,this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}}})),Y=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeMulti=e.decode=e.defaultDecodeOptions=void 0;var t=Q();e.defaultDecodeOptions={},e.decode=function(r,n=e.defaultDecodeOptions){return new t.Decoder(n.extensionCodec,n.context,n.maxStrLength,n.maxBinLength,n.maxArrayLength,n.maxMapLength,n.maxExtLength).decode(r)},e.decodeMulti=function(r,n=e.defaultDecodeOptions){return new t.Decoder(n.extensionCodec,n.context,n.maxStrLength,n.maxBinLength,n.maxArrayLength,n.maxMapLength,n.maxExtLength).decodeMulti(r)}})),Z=M((e=>{function t(e){return null!=e[Symbol.asyncIterator]}function r(e){if(null==e)throw new Error("Assertion Failure: value must not be null nor undefined")}async function*n(e){let t=e.getReader();try{for(;;){let{done:e,value:n}=await t.read();if(e)return;r(n),yield n}}finally{t.releaseLock()}}Object.defineProperty(e,"__esModule",{value:!0}),e.ensureAsyncIterable=e.asyncIterableFromStream=e.isAsyncIterable=void 0,e.isAsyncIterable=t,e.asyncIterableFromStream=n,e.ensureAsyncIterable=function(e){return t(e)?e:n(e)}})),ee=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=void 0;var t=Q(),r=Z(),n=Y();function i(e,i=n.defaultDecodeOptions){let s=(0,r.ensureAsyncIterable)(e);return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decodeStream(s)}e.decodeAsync=async function(e,i=n.defaultDecodeOptions){let s=(0,r.ensureAsyncIterable)(e);return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decodeAsync(s)},e.decodeArrayStream=function(e,i=n.defaultDecodeOptions){let s=(0,r.ensureAsyncIterable)(e);return new t.Decoder(i.extensionCodec,i.context,i.maxStrLength,i.maxBinLength,i.maxArrayLength,i.maxMapLength,i.maxExtLength).decodeArrayStream(s)},e.decodeMultiStream=i,e.decodeStream=function(e,t=n.defaultDecodeOptions){return i(e,t)}})),te=M((e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decodeTimestampExtension=e.encodeTimestampExtension=e.decodeTimestampToTimeSpec=e.encodeTimeSpecToTimestamp=e.encodeDateToTimeSpec=e.EXT_TIMESTAMP=e.ExtData=e.ExtensionCodec=e.Encoder=e.DataViewIndexOutOfBoundsError=e.DecodeError=e.Decoder=e.decodeStream=e.decodeMultiStream=e.decodeArrayStream=e.decodeAsync=e.decodeMulti=e.decode=e.encode=void 0;var t=X();Object.defineProperty(e,"encode",{enumerable:!0,get:function(){return t.encode}});var r=Y();Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return r.decode}}),Object.defineProperty(e,"decodeMulti",{enumerable:!0,get:function(){return r.decodeMulti}});var n=ee();Object.defineProperty(e,"decodeAsync",{enumerable:!0,get:function(){return n.decodeAsync}}),Object.defineProperty(e,"decodeArrayStream",{enumerable:!0,get:function(){return n.decodeArrayStream}}),Object.defineProperty(e,"decodeMultiStream",{enumerable:!0,get:function(){return n.decodeMultiStream}}),Object.defineProperty(e,"decodeStream",{enumerable:!0,get:function(){return n.decodeStream}});var i=Q();Object.defineProperty(e,"Decoder",{enumerable:!0,get:function(){return i.Decoder}}),Object.defineProperty(e,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return i.DataViewIndexOutOfBoundsError}});var s=V();Object.defineProperty(e,"DecodeError",{enumerable:!0,get:function(){return s.DecodeError}});var a=H();Object.defineProperty(e,"Encoder",{enumerable:!0,get:function(){return a.Encoder}});var o=$();Object.defineProperty(e,"ExtensionCodec",{enumerable:!0,get:function(){return o.ExtensionCodec}});var l=q();Object.defineProperty(e,"ExtData",{enumerable:!0,get:function(){return l.ExtData}});var h=z();Object.defineProperty(e,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return h.EXT_TIMESTAMP}}),Object.defineProperty(e,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return h.encodeDateToTimeSpec}}),Object.defineProperty(e,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return h.encodeTimeSpecToTimestamp}}),Object.defineProperty(e,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return h.decodeTimestampToTimeSpec}}),Object.defineProperty(e,"encodeTimestampExtension",{enumerable:!0,get:function(){return h.encodeTimestampExtension}}),Object.defineProperty(e,"decodeTimestampExtension",{enumerable:!0,get:function(){return h.decodeTimestampExtension}})})),re=class extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}},ne=class extends re{},ie=class extends re{},se=class extends re{},ae=typeof S<"u"&&S.release&&"node"===S.release.name;if(globalThis.document);else if(globalThis.importScripts);else if(!ae)throw new re("Cannot determine runtime environment");var oe={};var le={null:0,symbol:1,pairlist:2,closure:3,environment:4,promise:5,call:6,special:7,builtin:8,string:9,logical:10,integer:13,double:14,complex:15,character:16,dots:17,any:18,list:19,expression:20,bytecode:21,pointer:22,weakref:23,raw:24,s4:25,new:30,free:31,function:99};function he(e){return!!e&&"object"==typeof e&&Object.keys(le).includes(e.type)}function ue(e){return!!e&&"object"==typeof e&&"re"in e&&"im"in e}function ce(e){return oe._Rf_protect(Te(e)),e}function de(e,t){return oe._Rf_protect(Te(e)),++t.n,e}function pe(e){oe._Rf_unprotect(e)}function fe(e,t,r){oe._Rf_defineVar(Te(t),Te(r),Te(e))}function ye(e,t){let r={},n={n:0};try{let i=new We(t);de(i,n),r.code=oe.allocateUTF8(e);let s=oe._R_ParseEvalString(r.code,i.ptr);return je.wrap(s)}finally{(function(e){Object.keys(e).forEach((t=>oe._free(e[t])))})(r),pe(n.n)}}function we(e,t){return oe.getWasmTableEntry(oe.GOT.ffi_safe_eval.value)(Te(e),Te(t))}var me=new WeakMap;function ge(e){return"string"==typeof e&&e.length===be}var be=63;function ve(){let e=Array.from({length:4},Ee).join("-");if(e.length!==be)throw new Error("comlink internal error: UUID has the wrong length");return e}function Ee(){let e=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16),t=15-e.length;return t>0&&(e=Array.from({length:t},(()=>0)).join("")+e),e}function Te(e){return ot(e)?e.ptr:e}function Re(e,t){if(oe._TYPEOF(e.ptr)!==le[t])throw new Error(`Unexpected object type "${e.type()}" when expecting type "${t}"`)}function _e(e){if(he(e))return new(at(e.type))(e);if(e&&"object"==typeof e&&"type"in e&&"null"===e.type)return new Oe;if(null===e)return new qe({type:"logical",names:null,values:[null]});if("boolean"==typeof e)return new qe(e);if("number"==typeof e)return new Xe(e);if("string"==typeof e)return new et(e);if(ue(e))return new Qe(e);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return new it(e);if(Array.isArray(e))return function(e){let t={n:0};if(e.every((e=>e&&"object"==typeof e&&!ot(e)&&!ue(e)))){let t=e,r=t.every((e=>0===Object.keys(e).filter((e=>!Object.keys(t[0]).includes(e))).length&&0===Object.keys(t[0]).filter((t=>!Object.keys(e).includes(t))).length)),n=t.every((e=>Object.values(e).every((e=>ht(e)||lt(e)))));if(r&&n)return Ce.fromD3(t)}if(e.every((e=>"boolean"==typeof e||null===e)))return new qe(e);if(e.every((e=>"number"==typeof e||null===e)))return new Xe(e);if(e.every((e=>"string"==typeof e||null===e)))return new et(e);try{let r=new Ie([new De("c"),...e]);return de(r,t),r.eval()}finally{pe(t.n)}}(e);if("object"==typeof e)return Ce.fromObject(e);throw new Error("Robj construction for this JS object is not yet supported")}var Se,Ae,xe=class{constructor(e){this.ptr=e}type(){let e=oe._TYPEOF(this.ptr);return Object.keys(le).find((t=>le[t]===e))}},Ue=class extends xe{constructor(e){if(!(e instanceof xe))return _e(e);super(e.ptr),L(this,Se)}static wrap(e){let t=oe._TYPEOF(e);return new(at(Object.keys(le)[Object.values(le).indexOf(t)]))(new xe(e))}get[Symbol.toStringTag](){return`RObject:${this.type()}`}static getPersistentObject(e){return rt[e]}getPropertyValue(e){return this[e]}inspect(){ye(".Internal(inspect(x))",{x:this})}isNull(){return oe._TYPEOF(this.ptr)===le.null}isNa(){try{let e=ye("is.na(x)",{x:this});return ce(e),e.toBoolean()}finally{pe(1)}}isUnbound(){return this.ptr===rt.unboundValue.ptr}attrs(){return Me.wrap(oe._ATTRIB(this.ptr))}class(){let e={n:0},t=new Ie([new De("class"),this]);de(t,e);try{return t.eval()}finally{pe(e.n)}}setNames(e){let t;if(null===e)t=rt.null;else{if(!Array.isArray(e)||!e.every((e=>"string"==typeof e||null===e)))throw new Error("Argument to setNames must be null or an Array of strings or null");t=new et(e)}return oe._Rf_setAttrib(this.ptr,rt.namesSymbol.ptr,t.ptr),this}names(){let e=et.wrap(oe._Rf_getAttrib(this.ptr,rt.namesSymbol.ptr));return e.isNull()?null:e.toArray()}includes(e){let t=this.names();return t&&t.includes(e)}toJs(e={depth:0},t=1){throw new Error("This R object cannot be converted to JS")}subset(e){return W(this,Se,Ae).call(this,e,rt.bracketSymbol.ptr)}get(e){return W(this,Se,Ae).call(this,e,rt.bracket2Symbol.ptr)}getDollar(e){return W(this,Se,Ae).call(this,e,rt.dollarSymbol.ptr)}pluck(...e){let t=function(e){let t=oe._malloc(4);return oe._R_ProtectWithIndex(Te(e),t),{loc:oe.getValue(t,"i32"),ptr:t}}(rt.null);try{let r=(e,r)=>function(e,t){return oe._R_Reprotect(Te(e),t.loc),e}(e.get(r),t),n=e.reduce(r,this);return n.isNull()?void 0:n}finally{!function(e){oe._Rf_unprotect(1),oe._free(e.ptr)}(t)}}set(e,t){let r={n:0};try{let n=new Ue(e);de(n,r);let i=new Ue(t);de(i,r);let s=new De("[[<-"),a=oe._Rf_lang4(s.ptr,this.ptr,n.ptr,i.ptr);return de(a,r),Ue.wrap(we(a,rt.baseEnv))}finally{pe(r.n)}}static getMethods(e){let t=new Set,r=e;do{Object.getOwnPropertyNames(r).map((e=>t.add(e)))}while(r=Object.getPrototypeOf(r));return[...t.keys()].filter((t=>"function"==typeof e[t]))}},je=Ue;Se=new WeakSet,Ae=function(e,t){let r={n:0};try{let n=new Ue(e);de(n,r);let i=oe._Rf_lang3(t,this.ptr,n.ptr);return de(i,r),Ue.wrap(we(i,rt.baseEnv))}finally{pe(r.n)}};var ke,Oe=class extends je{constructor(){return super(new xe(oe.getValue(oe._R_NilValue,"*"))),this}toJs(){return{type:"null"}}},De=class extends je{constructor(e){if(e instanceof xe)return Re(e,"symbol"),void super(e);let t=oe.allocateUTF8(e);try{super(new xe(oe._Rf_install(t)))}finally{oe._free(t)}}toJs(){let e=this.toObject();return{type:"symbol",printname:e.printname,symvalue:e.symvalue,internal:e.internal}}toObject(){return{printname:this.printname().isUnbound()?null:this.printname().toString(),symvalue:this.symvalue().isUnbound()?null:this.symvalue().ptr,internal:this.internal().isNull()?null:this.internal().ptr}}toString(){return this.printname().toString()}printname(){return Be.wrap(oe._PRINTNAME(this.ptr))}symvalue(){return je.wrap(oe._SYMVALUE(this.ptr))}internal(){return je.wrap(oe._INTERNAL(this.ptr))}},Me=class extends je{constructor(e){if(e instanceof xe)return Re(e,"pairlist"),super(e),this;let t={n:0};try{let{names:r,values:n}=st(e),i=Me.wrap(oe._Rf_allocList(n.length));de(i,t);for(let[e,t]=[0,i];!t.isNull();[e,t]=[e+1,t.cdr()])t.setcar(new je(n[e]));i.setNames(r),super(i)}finally{pe(t.n)}}get length(){return this.toArray().length}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=-1}={}){let n=this.entries({depth:r}),i=n.map((([e])=>e));if(!e&&new Set(i).size!==i.length)throw new Error("Duplicate key when converting pairlist without allowDuplicateKey enabled");if(!t&&i.some((e=>!e)))throw new Error("Empty or null key when converting pairlist without allowEmptyKey enabled");return Object.fromEntries(n.filter(((e,t)=>n.findIndex((t=>t[0]===e[0]))===t)))}entries(e={depth:1}){let t=this.toJs(e);return t.values.map(((e,r)=>[t.names?t.names[r]:null,e]))}toJs(e={depth:0},t=1){let r=[],n=!1,i=[];for(let s=this;!s.isNull();s=s.cdr()){let a=s.tag();a.isNull()?r.push(""):(n=!0,r.push(a.toString())),e.depth&&t>=e.depth?i.push(s.car()):i.push(s.car().toJs(e,t+1))}return{type:"pairlist",names:n?r:null,values:i}}includes(e){return e in this.toObject()}setcar(e){oe._SETCAR(this.ptr,e.ptr)}car(){return je.wrap(oe._CAR(this.ptr))}cdr(){return je.wrap(oe._CDR(this.ptr))}tag(){return je.wrap(oe._TAG(this.ptr))}},Ie=class extends je{constructor(e){if(e instanceof xe)return Re(e,"call"),super(e),this;let t={n:0};try{let{values:r}=st(e),n=r.map((e=>de(new je(e),t))),i=Ie.wrap(oe._Rf_allocVector(le.call,r.length));de(i,t);for(let[e,t]=[0,i];!t.isNull();[e,t]=[e+1,t.cdr()])t.setcar(n[e]);super(i)}finally{pe(t.n)}}setcar(e){oe._SETCAR(this.ptr,e.ptr)}car(){return je.wrap(oe._CAR(this.ptr))}cdr(){return je.wrap(oe._CDR(this.ptr))}eval(){return oe.webr.evalR(this,{env:rt.baseEnv})}capture(e={}){return oe.webr.captureR(this,e)}deparse(){let e={n:0};try{let t=oe._Rf_lang2(new De("deparse1").ptr,oe._Rf_lang2(new De("quote").ptr,this.ptr));de(t,e);let r=et.wrap(we(t,rt.baseEnv));return de(r,e),r.toString()}finally{pe(e.n)}}},Pe=class extends je{constructor(e,t=null){if(e instanceof xe){if(Re(e,"list"),super(e),t){if(t.length!==this.length)throw new Error("Can't construct named `RList`. Supplied `names` must be the same length as the list.");this.setNames(t)}return this}let r={n:0};try{let n=st(e),i=oe._Rf_allocVector(le.list,n.values.length);de(i,r),n.values.forEach(((e,t)=>{oe._SET_VECTOR_ELT(i,t,new je(e).ptr)}));let s=t||n.names;if(s&&s.length!==n.values.length)throw new Error("Can't construct named `RList`. Supplied `names` must be the same length as the list.");je.wrap(i).setNames(s),super(new xe(i))}finally{pe(r.n)}}get length(){return oe._LENGTH(this.ptr)}isDataFrame(){let e=Me.wrap(oe._ATTRIB(this.ptr)).get("class");return!e.isNull()&&e.toArray().includes("data.frame")}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:r=-1}={}){let n=this.entries({depth:r}),i=n.map((([e])=>e));if(!e&&new Set(i).size!==i.length)throw new Error("Duplicate key when converting list without allowDuplicateKey enabled");if(!t&&i.some((e=>!e)))throw new Error("Empty or null key when converting list without allowEmptyKey enabled");return Object.fromEntries(n.filter(((e,t)=>n.findIndex((t=>t[0]===e[0]))===t)))}toD3(){if(!this.isDataFrame())throw new Error("Can't convert R list object to D3 format. Object must be of class 'data.frame'.");return this.entries().reduce(((e,t)=>(t[1].forEach(((r,n)=>e[n]=Object.assign(e[n]||{},{[t[0]]:r}))),e)),[])}entries(e={depth:-1}){let t=this.toJs(e);return this.isDataFrame()&&e.depth<0&&(t.values=t.values.map((e=>e.toArray()))),t.values.map(((e,r)=>[t.names?t.names[r]:null,e]))}toJs(e={depth:0},t=1){return{type:"list",names:this.names(),values:[...Array(this.length).keys()].map((r=>e.depth&&t>=e.depth?this.get(r+1):this.get(r+1).toJs(e,t+1)))}}},Ce=class extends Pe{constructor(e){if(e instanceof xe){if(super(e),!this.isDataFrame())throw new Error("Can't construct `RDataFrame`. Supplied R object is not a `data.frame`.");return this}return Ce.fromObject(e)}static fromObject(e){let{names:t,values:r}=st(e),n={n:0};try{let e=!!t&&t.length>0&&t.every((e=>e)),i=r.length>0&&r.every((e=>Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer));if(e&&i){let e=r,i=e.every((t=>t.length===e[0].length)),s=e.every((e=>ht(e[0])||lt(e[0])));if(i&&s){let r=new Pe({type:"list",names:t,values:e.map((e=>_e(e)))});de(r,n);let i=new Ie([new De("as.data.frame"),r]);return de(i,n),new Ce(i.eval())}}}finally{pe(n.n)}throw new Error("Can't construct `data.frame`. Source object is not eligible.")}static fromD3(e){return this.fromObject(Object.fromEntries(Object.keys(e[0]).map((t=>[t,e.map((e=>e[t]))]))))}},Le=class extends je{exec(...e){let t={n:0};try{let r=new Ie([this,...e]);return de(r,t),r.eval()}finally{pe(t.n)}}capture(e={},...t){let r={n:0};try{let n=new Ie([this,...t]);return de(n,r),n.capture(e)}finally{pe(r.n)}}},Be=class extends je{constructor(e){if(e instanceof xe)return Re(e,"string"),void super(e);let t=oe.allocateUTF8(e);try{super(new xe(oe._Rf_mkChar(t)))}finally{oe._free(t)}}toString(){return oe.UTF8ToString(oe._R_CHAR(this.ptr))}toJs(){return{type:"string",value:this.toString()}}},We=class extends je{constructor(e={}){if(e instanceof xe)return Re(e,"environment"),super(e),this;let t=0;try{let{names:r,values:n}=st(e),i=ce(oe._R_NewEnv(rt.globalEnv.ptr,0,0));++t,n.forEach(((e,t)=>{let n=r?r[t]:null;if(!n)throw new Error("Can't create object in new environment with empty symbol name");let s=new De(n),a=ce(new je(e));try{fe(i,s,a)}finally{pe(1)}})),super(new xe(i))}finally{pe(t)}}ls(e=!1,t=!0){return et.wrap(oe._R_lsInternal3(this.ptr,Number(e),Number(t))).toArray()}bind(e,t){let r=new De(e),n=ce(new je(t));try{fe(this,r,n)}finally{pe(1)}}names(){return this.ls(!0,!0)}frame(){return je.wrap(oe._FRAME(this.ptr))}subset(e){if("number"==typeof e)throw new Error("Object of type environment is not subsettable");return this.getDollar(e)}toObject({depth:e=-1}={}){let t=this.names();return Object.fromEntries([...Array(t.length).keys()].map((r=>{let n=this.getDollar(t[r]);return[t[r],e<0?n:n.toJs({depth:e})]})))}toJs(e={depth:0},t=1){let r=this.names(),n=[...Array(r.length).keys()].map((n=>e.depth&&t>=e.depth?this.getDollar(r[n]):this.getDollar(r[n]).toJs(e,t+1)));return{type:"environment",names:r,values:n}}},Ne=class extends je{constructor(e,t,r){if(e instanceof xe)return Re(e,t),super(e),this;let n={n:0};try{let{names:i,values:s}=st(e),a=oe._Rf_allocVector(le[t],s.length);de(a,n),s.forEach(r(a)),je.wrap(a).setNames(i),super(new xe(a))}finally{pe(n.n)}}get length(){return oe._LENGTH(this.ptr)}get(e){return super.get(e)}subset(e){return super.subset(e)}getDollar(){throw new Error("$ operator is invalid for atomic vectors")}detectMissing(){let e={n:0};try{let t=oe._Rf_lang2(new De("is.na").ptr,this.ptr);de(t,e);let r=qe.wrap(we(t,rt.baseEnv));de(r,e);let n=r.toTypedArray();return Array.from(n).map((e=>!!e))}finally{pe(e.n)}}toArray(){let e=this.toTypedArray();return this.detectMissing().map(((t,r)=>t?null:e[r]))}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1}={}){let r=this.entries(),n=r.map((([e])=>e));if(!e&&new Set(n).size!==n.length)throw new Error("Duplicate key when converting atomic vector without allowDuplicateKey enabled");if(!t&&n.some((e=>!e)))throw new Error("Empty or null key when converting atomic vector without allowEmptyKey enabled");return Object.fromEntries(r.filter(((e,t)=>r.findIndex((t=>t[0]===e[0]))===t)))}entries(){let e=this.toArray(),t=this.names();return e.map(((e,r)=>[t?t[r]:null,e]))}toJs(){return{type:this.type(),names:this.names(),values:this.toArray()}}},Fe=class extends Ne{constructor(e){super(e,"logical",C(Fe,ke))}getBoolean(e){return this.get(e).toArray()[0]}toBoolean(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getBoolean(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS boolean");return e}toTypedArray(){return new Int32Array(oe.HEAP32.subarray(oe._LOGICAL(this.ptr)/4,oe._LOGICAL(this.ptr)/4+this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map(((t,r)=>t?null:!!e[r]))}},qe=Fe;ke=new WeakMap,L(qe,ke,(e=>{let t=oe._LOGICAL(e),r=oe.getValue(oe._R_NaInt,"i32");return(e,n)=>{oe.setValue(t+4*n,null===e?r:!!e,"i32")}}));var Ve,ze=class extends Ne{constructor(e){super(e,"integer",C(ze,Ve))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Int32Array(oe.HEAP32.subarray(oe._INTEGER(this.ptr)/4,oe._INTEGER(this.ptr)/4+this.length))}},$e=ze;Ve=new WeakMap,L($e,Ve,(e=>{let t=oe._INTEGER(e),r=oe.getValue(oe._R_NaInt,"i32");return(e,n)=>{oe.setValue(t+4*n,null===e?r:Math.round(Number(e)),"i32")}}));var Je,He=class extends Ne{constructor(e){super(e,"double",C(He,Je))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Float64Array(oe.HEAPF64.subarray(oe._REAL(this.ptr)/8,oe._REAL(this.ptr)/8+this.length))}},Xe=He;Je=new WeakMap,L(Xe,Je,(e=>{let t=oe._REAL(e),r=oe.getValue(oe._R_NaReal,"double");return(e,n)=>{oe.setValue(t+8*n,null===e?r:e,"double")}}));var Ke,Ge=class extends Ne{constructor(e){super(e,"complex",C(Ge,Ke))}getComplex(e){return this.get(e).toArray()[0]}toComplex(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getComplex(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS object");return e}toTypedArray(){return new Float64Array(oe.HEAPF64.subarray(oe._COMPLEX(this.ptr)/8,oe._COMPLEX(this.ptr)/8+2*this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map(((t,r)=>t?null:{re:e[2*r],im:e[2*r+1]}))}},Qe=Ge;Ke=new WeakMap,L(Qe,Ke,(e=>{let t=oe._COMPLEX(e),r=oe.getValue(oe._R_NaReal,"double");return(e,n)=>{oe.setValue(t+2*n*8,null===e?r:e.re,"double"),oe.setValue(t+8*(2*n+1),null===e?r:e.im,"double")}}));var Ye,Ze=class extends Ne{constructor(e){super(e,"character",C(Ze,Ye))}getString(e){return this.get(e).toArray()[0]}toString(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getString(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS string");return e}toTypedArray(){return new Uint32Array(oe.HEAPU32.subarray(oe._STRING_PTR(this.ptr)/4,oe._STRING_PTR(this.ptr)/4+this.length))}toArray(){return this.detectMissing().map(((e,t)=>e?null:oe.UTF8ToString(oe._R_CHAR(oe._STRING_ELT(this.ptr,t)))))}},et=Ze;Ye=new WeakMap,L(et,Ye,(e=>(t,r)=>{null===t?oe._SET_STRING_ELT(e,r,rt.naString.ptr):oe._SET_STRING_ELT(e,r,new Be(t).ptr)}));var tt,rt,nt=class extends Ne{constructor(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e)),super(e,"raw",C(nt,tt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(1!==this.length)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(null===e)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Uint8Array(oe.HEAPU8.subarray(oe._RAW(this.ptr),oe._RAW(this.ptr)+this.length))}},it=nt;function st(e){return he(e)?e:Array.isArray(e)||ArrayBuffer.isView(e)?{names:null,values:e}:e&&"object"==typeof e&&!ue(e)?{names:Object.keys(e),values:Object.values(e)}:{names:null,values:[e]}}function at(e){let t={object:je,null:Oe,symbol:De,pairlist:Me,closure:Le,environment:We,call:Ie,special:Le,builtin:Le,string:Be,logical:qe,integer:$e,double:Xe,complex:Qe,character:et,list:Pe,raw:it,function:Le,dataframe:Ce};return e in t?t[e]:je}function ot(e){return e instanceof je}function lt(e){return ot(e)&&["logical","integer","double","complex","character"].includes(e.type())||ot(e)&&e.isNa()}function ht(e){return null===e||"number"==typeof e||"boolean"==typeof e||"string"==typeof e||ue(e)}function ut(){let e={resolve:()=>{},reject:()=>{},promise:Promise.resolve()},t=new Promise(((t,r)=>{e.resolve=t,e.reject=r}));return e.promise=t,e}function ct(e){return new Promise((t=>setTimeout(t,e)))}function dt(e,t,r,...n){return null==e||function(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}(e)?e:e instanceof ArrayBuffer?new Uint8Array(e):t(e)?r(e,...n):Array.isArray(e)||ArrayBuffer.isView(e)?e.map((e=>dt(e,t,r,...n))):e instanceof xe?e:"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,i])=>[e,dt(i,t,r,...n)]))):e}function pt(e,t){let r=new XMLHttpRequest;r.open("get",e,!0),r.onload=()=>{let e=new Worker(URL.createObjectURL(new Blob([r.responseText])));t(e)},r.send()}function ft(e){if(ae)return!1;let t=new URL(location.href),r=new URL(e,location.origin);return!(t.host===r.host&&t.port===r.port&&t.protocol===r.protocol)}tt=new WeakMap,L(it,tt,(e=>{let t=oe._RAW(e);return(e,r)=>{oe.setValue(t+r,Number(e),"i8")}}));var yt=I(te()),wt=new TextEncoder;async function mt(e,t,r){try{let{taskId:n,sizeBuffer:i,dataBuffer:s,signalBuffer:a}=t,o=(0,yt.encode)(r),l=o.length<=s.length;if(Atomics.store(i,0,o.length),Atomics.store(i,1,+l),!l){let[t,r]=function(e){let t=ve();return[t,new Promise((r=>{ae?e.once("message",(e=>{!e.id||e.id!==t||r(e)})):e.addEventListener("message",(function n(i){!i.data||!i.data.id||i.data.id!==t||(e.removeEventListener("message",n),r(i.data))})),e.start&&e.start()}))]}(e);s.set(wt.encode(t)),await gt(a,n),s=(await r).dataBuffer}s.set(o),Atomics.store(i,1,1),await gt(a,n)}catch(e){console.warn(e)}}async function gt(e,t){let r=(t>>1)%32,n=1;for(;0!==Atomics.compareExchange(e,r+1,0,t);)await ct(n),n<32&&(n*=2);Atomics.or(e,0,1<<r),Atomics.notify(e,0)}var bt,vt,Et,Tt,Rt=class{constructor(){L(this,Et),L(this,bt,void 0),L(this,vt,void 0),B(this,vt,[]),B(this,bt,[])}reset(){B(this,vt,[]),B(this,bt,[])}put(e){C(this,vt).length||W(this,Et,Tt).call(this),C(this,vt).shift()(e)}async get(){return C(this,bt).length||W(this,Et,Tt).call(this),C(this,bt).shift()}isEmpty(){return!C(this,bt).length}isBlocked(){return!!C(this,vt).length}get length(){return C(this,bt).length-C(this,vt).length}};function _t(e,t,r){return St({type:"response",data:{uuid:e,resp:t}},r)}function St(e,t){return t&&function(e,t){me.set(e,t)}(e,t),e}function At(e){return function(e){return!!e&&"object"==typeof e&&"payloadType"in e&&"obj"in e}(e)&&"ptr"===e.payloadType}bt=new WeakMap,vt=new WeakMap,Et=new WeakSet,Tt=function(){C(this,bt).push(new Promise((e=>{C(this,vt).push(e)})))};var xt,Ut,jt=class{constructor(){this.inputQueue=new Rt,this.outputQueue=new Rt,this.systemQueue=new Rt,L(this,xt,new Map),L(this,Ut,!1)}async read(){return await this.outputQueue.get()}async flush(){let e=[];for(;!this.outputQueue.isEmpty();)e.push(await this.read());return e}async readSystem(){return await this.systemQueue.get()}write(e){if(C(this,Ut))throw new ie("The webR communication channel has been closed.");this.inputQueue.put(e)}async request(e,t){let r=function(e,t){return St({type:"request",data:{uuid:ve(),msg:e}},t)}(e,t),{resolve:n,reject:i,promise:s}=ut();return C(this,xt).set(r.data.uuid,{resolve:n,reject:i}),this.write(r),s}putClosedMessage(){B(this,Ut,!0),this.outputQueue.put({type:"closed"})}resolveResponse(e){let t=e.data.uuid,r=C(this,xt).get(t);if(r){let n=e.data.resp;C(this,xt).delete(t),"err"===n.payloadType?r.reject(function(e){let t=new ne(e.obj.message);return"Error"!==e.obj.name&&(t.name=e.obj.name),t.stack=e.obj.stack,t}(n)):r.resolve(n)}else console.warn("Can't find request.")}};xt=new WeakMap,Ut=new WeakMap,I(te()),new TextDecoder("utf-8"),ae&&(globalThis.Worker=D("worker_threads").Worker);var kt,Ot,Dt,Mt,It=class extends jt{constructor(e){super(),L(this,Ot),L(this,kt,void 0),this.close=()=>{},L(this,Mt,(async(e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return B(this,kt,new Int32Array(t.data)),void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"sync-request":{let r=t,n=r.data.msg,i=r.data.reqData;switch(n.type){case"read":{let t=await this.inputQueue.get();await mt(e,i,t);break}default:throw new ie(`Unsupported request type '${n.type}'.`)}return}case"request":throw new ie("Can't send messages of type 'request' from a worker. Please Use 'sync-request' instead.")}})),({resolve:this.resolve,reject:this.reject,promise:this.initialised}=ut());let t=t=>{W(this,Ot,Dt).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()};let r={type:"init",data:{config:e,channelType:Qt.SharedArrayBuffer}};t.postMessage(r)};if(ft(e.baseUrl))pt(`${e.baseUrl}webr-worker.js`,(e=>t(e)));else{let r=new Worker(`${e.baseUrl}webr-worker.js`);t(r)}}interrupt(){if(!C(this,kt))throw new ie("Failed attempt to interrupt before initialising interruptBuffer");this.inputQueue.reset(),C(this,kt)[0]=1}};kt=new WeakMap,Ot=new WeakSet,Dt=function(e){ae?(e.on("message",(t=>{C(this,Mt).call(this,e,t)})),e.on("error",(e=>{console.error(e),this.reject(new ne("An error occurred initialising the webR SharedBufferChannel worker."))}))):(e.onmessage=t=>C(this,Mt).call(this,e,t.data),e.onerror=e=>{console.error(e),this.reject(new ne("An error occurred initialising the webR SharedBufferChannel worker."))})},Mt=new WeakMap,I(te()),ae&&(globalThis.Worker=D("worker_threads").Worker);var Pt,Ct,Lt,Bt,Wt,Nt,Ft,qt,Vt,zt,$t=class extends jt{constructor(e){super(),L(this,Bt),L(this,Nt),L(this,qt),this.close=()=>{},L(this,Pt,new Map),L(this,Ct,void 0),L(this,Lt,!1),L(this,zt,((e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"sync-request":{let e=t.data;return void C(this,Pt).set(e.data.uuid,e.data.msg)}case"request":throw new ie("Can't send messages of type 'request' from a worker.Use service worker fetch request instead.")}})),({resolve:this.resolve,reject:this.reject,promise:this.initialised}=ut()),console.warn("The ServiceWorker communication channel is deprecated and will be removed in a future version of webR. Consider using the PostMessage channel instead. If blocking input is required (for example, `browser()`) the SharedArrayBuffer channel should be used. See https://docs.r-wasm.org/webr/latest/serving.html for further information.");let t=t=>{W(this,qt,Vt).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()},W(this,Bt,Wt).call(this,`${e.serviceWorkerUrl}webr-serviceworker.js`).then((r=>{let n={type:"init",data:{config:e,channelType:Qt.ServiceWorker,clientId:r,location:window.location.href}};t.postMessage(n)}))};if(ft(e.serviceWorkerUrl))pt(`${e.serviceWorkerUrl}webr-worker.js`,(e=>t(e)));else{let r=new Worker(`${e.serviceWorkerUrl}webr-worker.js`);t(r)}}activeRegistration(){var e;if(null==(e=C(this,Ct))||!e.active)throw new ie("Attempted to obtain a non-existent active registration.");return C(this,Ct).active}interrupt(){B(this,Lt,!0)}};Pt=new WeakMap,Ct=new WeakMap,Lt=new WeakMap,Bt=new WeakSet,Wt=async function(e){B(this,Ct,await navigator.serviceWorker.register(e)),await navigator.serviceWorker.ready,window.addEventListener("beforeunload",(()=>{var e;null==(e=C(this,Ct))||e.unregister()}));let t=await new Promise((e=>{navigator.serviceWorker.addEventListener("message",(function t(r){"registration-successful"===r.data.type&&(navigator.serviceWorker.removeEventListener("message",t),e(r.data.clientId))})),this.activeRegistration().postMessage({type:"register-client-main"})}));return navigator.serviceWorker.addEventListener("message",(e=>{W(this,Nt,Ft).call(this,e)})),t},Nt=new WeakSet,Ft=async function(e){if("request"!==e.data.type);else{let t=e.data.data,r=C(this,Pt).get(t);if(!r)throw new ie("Request not found during service worker XHR request");switch(C(this,Pt).delete(t),r.type){case"read":{let e=await this.inputQueue.get();this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:_t(t,e)});break}case"interrupt":{let e=C(this,Lt);this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:t,response:_t(t,e)}),this.inputQueue.reset(),B(this,Lt,!1);break}default:throw new ie(`Unsupported request type '${r.type}'.`)}}},qt=new WeakSet,Vt=function(e){ae?(e.on("message",(t=>{C(this,zt).call(this,e,t)})),e.on("error",(e=>{console.error(e),this.reject(new ne("An error occurred initialising the webR ServiceWorkerChannel worker."))}))):(e.onmessage=t=>C(this,zt).call(this,e,t.data),e.onerror=e=>{console.error(e),this.reject(new ne("An error occurred initialising the webR ServiceWorkerChannel worker."))})},zt=new WeakMap,ae&&(globalThis.Worker=D("worker_threads").Worker);var Jt,Ht,Xt,Kt,Gt=class extends jt{constructor(e){super(),L(this,Ht),this.close=()=>{},L(this,Jt,void 0),L(this,Kt,(async(e,t)=>{if(t&&t.type)switch(t.type){case"resolve":return void this.resolve();case"response":return void this.resolveResponse(t);case"system":return void this.systemQueue.put(t.data);default:return void this.outputQueue.put(t);case"request":{let e=t,r=e.data.msg;switch(r.type){case"read":{let t=await this.inputQueue.get();if(C(this,Jt)){let r=_t(e.data.uuid,t);C(this,Jt).postMessage(r)}break}default:throw new ie(`Unsupported request type '${r.type}'.`)}return}case"sync-request":throw new ie("Can't send messages of type 'sync-request' in PostMessage mode. Use 'request' instead.")}})),({resolve:this.resolve,reject:this.reject,promise:this.initialised}=ut());let t=t=>{B(this,Jt,t),W(this,Ht,Xt).call(this,t),this.close=()=>{t.terminate(),this.putClosedMessage()};let r={type:"init",data:{config:e,channelType:Qt.PostMessage}};t.postMessage(r)};if(ft(e.baseUrl))pt(`${e.baseUrl}webr-worker.js`,(e=>t(e)));else{let r=new Worker(`${e.baseUrl}webr-worker.js`);t(r)}}interrupt(){console.error("Interrupting R execution is not available when using the PostMessage channel")}};Jt=new WeakMap,Ht=new WeakSet,Xt=function(e){ae?(e.on("message",(t=>{C(this,Kt).call(this,e,t)})),e.on("error",(e=>{console.error(e),this.reject(new ne("An error occurred initialising the webR PostMessageChannel worker."))}))):(e.onmessage=t=>C(this,Kt).call(this,e,t.data),e.onerror=e=>{console.error(e),this.reject(new ne("An error occurred initialising the webR PostMessageChannel worker."))})},Kt=new WeakMap;var Qt={Automatic:0,SharedArrayBuffer:1,ServiceWorker:2,PostMessage:3};var Yt=ae?"/app/.cache/npm/webr@0.4.2/dist/":"https://webr.r-wasm.org/v0.4.2/",Zt="0.4.2";function er(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"payloadType"in e&&At(e._payload)}function tr(e){return er(e)&&"null"===e._payload.obj.type}function rr(e){return er(e)&&"symbol"===e._payload.obj.type}function nr(e){return er(e)&&"pairlist"===e._payload.obj.type}function ir(e){return er(e)&&"environment"===e._payload.obj.type}function sr(e){return er(e)&&"logical"===e._payload.obj.type}function ar(e){return er(e)&&"integer"===e._payload.obj.type}function or(e){return er(e)&&"double"===e._payload.obj.type}function lr(e){return er(e)&&"complex"===e._payload.obj.type}function hr(e){return er(e)&&"character"===e._payload.obj.type}function ur(e){return er(e)&&"list"===e._payload.obj.type}function cr(e){return er(e)&&"raw"===e._payload.obj.type}function dr(e){return er(e)&&"call"===e._payload.obj.type}function pr(e){var t;return!(!er(e)||null==(t=e._payload.obj.methods)||!t.includes("exec"))}function fr(){}function yr(e,t,r){return async(...n)=>{let i=n.map((e=>er(e)?e._payload:{obj:dt(e,er,(e=>e._payload)),payloadType:"raw"})),s={type:"callRObjectMethod",data:{payload:r,prop:t,args:i}},a=await e.request(s);switch(a.payloadType){case"ptr":return wr(e,a);case"raw":return dt(a,At,((e,t)=>wr(t,e)),e).obj}}}function wr(e,t){var r;let n=new Proxy(null!=(r=t.obj.methods)&&r.includes("exec")?Object.assign(fr,{...t}):t,{get:(r,i)=>{var s;return"_payload"===i?t:i===Symbol.asyncIterator?function(e,t){return async function*(){let r={type:"callRObjectMethod",data:{payload:t._payload,prop:"getPropertyValue",args:[{payloadType:"raw",obj:"length"}],shelter:void 0}},n=await e.request(r);if("number"!=typeof n.obj)throw new re("Cannot iterate over object, unexpected type for length property.");for(let e=1;e<=n.obj;e++)yield t.get(e)}}(e,n):null!=(s=t.obj.methods)&&s.includes(i.toString())?yr(e,i.toString(),t):void 0},apply:async(r,n,i)=>{let s=await wr(e,t).exec(...i);return pr(s)?s:s.toJs()}});return n}function mr(e,t,r){return new Proxy(je,{construct:(n,i)=>async function(e,t,r,...n){let i={type:"newRObject",data:{objType:t,args:dt(n,er,(e=>e._payload)),shelter:r}},s=await e.request(i);switch(s.payloadType){case"raw":throw new se("Unexpected raw payload type returned from newRObject");case"ptr":return wr(e,s)}}(e,r,t,...i),get:(t,r)=>yr(e,r.toString())})}var gr,br,vr,Er,Tr,Rr,_r,Sr,Ar,xr,Ur,jr,kr=class{constructor(e={},t={REnv:{R_HOME:"/usr/lib/R",FONTCONFIG_PATH:"/etc/fonts",R_ENABLE_JIT:"0"}}){L(this,Ur),L(this,gr,void 0),L(this,br,void 0),L(this,vr,void 0),L(this,Er,void 0),L(this,Tr,void 0),L(this,Rr,(e=>{console.log(e)})),L(this,_r,(e=>{console.error(e)})),L(this,Sr,(e=>{let t=prompt(e);t&&this.stdin(`${t}\n`)})),L(this,Ar,(e=>{if(ae)throw new Error("Plotting with HTML canvas is not yet supported under Node");this.canvas.getContext("2d").drawImage(e,0,0)})),L(this,xr,(()=>{if(ae)throw new Error("Plotting with HTML canvas is not yet supported under Node");this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)})),this.webR=new Cr(t),ae||(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width","1008"),this.canvas.setAttribute("height","1008")),B(this,gr,e.stdout||C(this,Rr)),B(this,br,e.stderr||C(this,_r)),B(this,vr,e.prompt||C(this,Sr)),B(this,Er,e.canvasImage||C(this,Ar)),B(this,Tr,e.canvasNewPage||C(this,xr)),this.webR.evalRVoid("options(device=webr::canvas)")}stdin(e){this.webR.writeConsole(e)}interrupt(){this.webR.interrupt()}run(){W(this,Ur,jr).call(this)}};gr=new WeakMap,br=new WeakMap,vr=new WeakMap,Er=new WeakMap,Tr=new WeakMap,Rr=new WeakMap,_r=new WeakMap,Sr=new WeakMap,Ar=new WeakMap,xr=new WeakMap,Ur=new WeakSet,jr=async function(){for(;;){let e=await this.webR.read();switch(e.type){case"stdout":C(this,gr).call(this,e.data);break;case"stderr":C(this,br).call(this,e.data);break;case"prompt":C(this,vr).call(this,e.data);break;case"canvas":"canvasImage"===e.data.event?C(this,Er).call(this,e.data.image):"canvasNewPage"===e.data.event&&C(this,Tr).call(this);break;case"closed":return;default:console.warn(`Unhandled output type for webR Console: ${e.type}.`)}}};var Or,Dr,Mr,Ir,Pr={RArgs:[],REnv:{FONTCONFIG_PATH:"/etc/fonts",R_HOME:"/usr/lib/R",R_ENABLE_JIT:"0",WEBR:"1",WEBR_VERSION:Zt},baseUrl:Yt,serviceWorkerUrl:"",repoUrl:"https://repo.r-wasm.org",homedir:"/home/web_user",interactive:!0,channelType:Qt.Automatic,createLazyFilesystem:!0},Cr=class{constructor(e={}){L(this,Mr),L(this,Or,void 0),L(this,Dr,void 0),this.version=Zt,this.FS={lookupPath:async e=>{let t={type:"lookupPath",data:{path:e}};return(await C(this,Or).request(t)).obj},mkdir:async e=>{let t={type:"mkdir",data:{path:e}};return(await C(this,Or).request(t)).obj},mount:async(e,t,r)=>{let n=[];"blobs"in t&&t.blobs&&(n=[...n,...t.blobs.map((e=>e.data instanceof Blob?e.data.arrayBuffer().then((t=>{e.data=new Uint8Array(t)})):Promise.resolve()))]),"packages"in t&&t.packages&&(n=[...n,...t.packages.map((e=>e.blob instanceof Blob?e.blob.arrayBuffer().then((t=>{e.blob=new Uint8Array(t)})):Promise.resolve()))]),await Promise.all(n);let i={type:"mount",data:{type:e,options:t,mountpoint:r}};await C(this,Or).request(i)},syncfs:async e=>{let t={type:"syncfs",data:{populate:e}};await C(this,Or).request(t)},readFile:async(e,t)=>{let r={type:"readFile",data:{path:e,flags:t}};return(await C(this,Or).request(r)).obj},rmdir:async e=>{let t={type:"rmdir",data:{path:e}};await C(this,Or).request(t)},writeFile:async(e,t,r)=>{let n={type:"writeFile",data:{path:e,data:t,flags:r}};await C(this,Or).request(n)},unlink:async e=>{let t={type:"unlink",data:{path:e}};await C(this,Or).request(t)},unmount:async e=>{let t={type:"unmount",data:{path:e}};await C(this,Or).request(t)}};let t={...Pr,...e,REnv:{...Pr.REnv,...e.REnv}};B(this,Or,function(e){switch(e.channelType){case Qt.SharedArrayBuffer:return new It(e);case Qt.ServiceWorker:return new $t(e);case Qt.PostMessage:return new Gt(e);case Qt.Automatic:default:return typeof SharedArrayBuffer<"u"?new It(e):new Gt(e)}}(t)),this.objs={},this.Shelter=function(e){return new Proxy(Nr,{construct:async()=>{let t=new Nr(e);return await t.init(),t}})}(C(this,Or)),B(this,Dr,C(this,Or).initialised.then((async()=>{this.globalShelter=await new this.Shelter,this.RObject=this.globalShelter.RObject,this.RLogical=this.globalShelter.RLogical,this.RInteger=this.globalShelter.RInteger,this.RDouble=this.globalShelter.RDouble,this.RComplex=this.globalShelter.RComplex,this.RCharacter=this.globalShelter.RCharacter,this.RRaw=this.globalShelter.RRaw,this.RList=this.globalShelter.RList,this.RDataFrame=this.globalShelter.RDataFrame,this.RPairlist=this.globalShelter.RPairlist,this.REnvironment=this.globalShelter.REnvironment,this.RSymbol=this.globalShelter.RSymbol,this.RString=this.globalShelter.RString,this.RCall=this.globalShelter.RCall,this.objs={baseEnv:await this.RObject.getPersistentObject("baseEnv"),globalEnv:await this.RObject.getPersistentObject("globalEnv"),null:await this.RObject.getPersistentObject("null"),true:await this.RObject.getPersistentObject("true"),false:await this.RObject.getPersistentObject("false"),na:await this.RObject.getPersistentObject("na")},W(this,Mr,Ir).call(this)})))}async init(){return C(this,Dr)}close(){C(this,Or).close()}async read(){return await C(this,Or).read()}async flush(){return await C(this,Or).flush()}write(e){C(this,Or).write(e)}writeConsole(e){this.write({type:"stdin",data:e+"\n"})}interrupt(){C(this,Or).interrupt()}async installPackages(e,t){let r={type:"installPackages",data:{name:e,options:Object.assign({quiet:!1,mount:!0},t)}};await C(this,Or).request(r)}async destroy(e){await this.globalShelter.destroy(e)}async evalR(e,t){return this.globalShelter.evalR(e,t)}async evalRVoid(e,t){return this.evalRRaw(e,"void",t)}async evalRBoolean(e,t){return this.evalRRaw(e,"boolean",t)}async evalRNumber(e,t){return this.evalRRaw(e,"number",t)}async evalRString(e,t){return this.evalRRaw(e,"string",t)}async evalRRaw(e,t,r={}){let n={type:"evalRRaw",data:{code:e,options:dt(r,er,(e=>e._payload)),outputType:t}},i=await C(this,Or).request(n);switch(i.payloadType){case"raw":return i.obj;case"ptr":throw new se("Unexpected ptr payload type returned from evalRVoid")}}async invokeWasmFunction(e,...t){let r={type:"invokeWasmFunction",data:{ptr:e,args:t}};return(await C(this,Or).request(r)).obj}};Or=new WeakMap,Dr=new WeakMap,Mr=new WeakSet,Ir=async function(){for(;;){let e=await C(this,Or).readSystem();switch(e.type){case"setTimeoutWasm":setTimeout(((e,t)=>{this.invokeWasmFunction(e,...t)}),e.data.delay,e.data.ptr,e.data.args);break;case"console.log":console.log(e.data);break;case"console.warn":console.warn(e.data);break;case"console.error":console.error(e.data);break;case"close":C(this,Or).close();break;default:throw new re("Unknown system message type `"+e.type+"`")}}};var Lr,Br,Wr,Nr=class{constructor(e){L(this,Lr,""),L(this,Br,void 0),L(this,Wr,!1),B(this,Br,e)}async init(){if(C(this,Wr))return;let e=await C(this,Br).request({type:"newShelter"});B(this,Lr,e.obj),this.RObject=mr(C(this,Br),C(this,Lr),"object"),this.RLogical=mr(C(this,Br),C(this,Lr),"logical"),this.RInteger=mr(C(this,Br),C(this,Lr),"integer"),this.RDouble=mr(C(this,Br),C(this,Lr),"double"),this.RComplex=mr(C(this,Br),C(this,Lr),"complex"),this.RCharacter=mr(C(this,Br),C(this,Lr),"character"),this.RRaw=mr(C(this,Br),C(this,Lr),"raw"),this.RList=mr(C(this,Br),C(this,Lr),"list"),this.RDataFrame=mr(C(this,Br),C(this,Lr),"dataframe"),this.RPairlist=mr(C(this,Br),C(this,Lr),"pairlist"),this.REnvironment=mr(C(this,Br),C(this,Lr),"environment"),this.RSymbol=mr(C(this,Br),C(this,Lr),"symbol"),this.RString=mr(C(this,Br),C(this,Lr),"string"),this.RCall=mr(C(this,Br),C(this,Lr),"call"),B(this,Wr,!0)}async purge(){let e={type:"shelterPurge",data:C(this,Lr)};await C(this,Br).request(e)}async destroy(e){let t={type:"shelterDestroy",data:{id:C(this,Lr),obj:e._payload}};await C(this,Br).request(t)}async size(){let e={type:"shelterSize",data:C(this,Lr)};return(await C(this,Br).request(e)).obj}async evalR(e,t={}){let r={type:"evalR",data:{code:e,options:dt(t,er,(e=>e._payload)),shelter:C(this,Lr)}},n=await C(this,Br).request(r);if("raw"===n.payloadType)throw new se("Unexpected payload type returned from evalR");return wr(C(this,Br),n)}async captureR(e,t={}){let r={type:"captureR",data:{code:e,options:dt(t,er,(e=>e._payload)),shelter:C(this,Lr)}},n=await C(this,Br).request(r);switch(n.payloadType){case"ptr":throw new se("Unexpected payload type returned from evalR");case"raw":{let e=n.obj,t=wr(C(this,Br),e.result),r=e.output,i=e.images;for(let e=0;e<r.length;++e)"stdout"!==r[e].type&&"stderr"!==r[e].type&&(r[e].data=wr(C(this,Br),r[e].data));return{result:t,output:r,images:i}}}}};Lr=new WeakMap,Br=new WeakMap,Wr=new WeakMap;export{Qt as ChannelType,kr as Console,Nr as Shelter,Cr as WebR,ie as WebRChannelError,re as WebRError,se as WebRPayloadError,ne as WebRWorkerError,dr as isRCall,hr as isRCharacter,lr as isRComplex,or as isRDouble,ir as isREnvironment,pr as isRFunction,ar as isRInteger,ur as isRList,sr as isRLogical,tr as isRNull,er as isRObject,nr as isRPairlist,cr as isRRaw,rr as isRSymbol,ge as isShelterID};export default null;
