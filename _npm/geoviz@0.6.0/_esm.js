/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/geoviz@0.6.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{geoEquirectangularRaw,geoBounds,geoArea,geoCentroid,geoIdentity,geoPath,geoMercator,geoNaturalEarth1,geoGraticule,geoEquirectangular,geoProjection}from"../d3-geo@3.1.1/_esm.js";import{create as create$1,select,pointers}from"../d3-selection@3.0.0/_esm.js";import{descending,max,extent as extent$1,min,ascending,sum,cumsum,range,mean,mode}from"../d3-array/_esm.js";import{scaleSqrt,scaleLinear,scaleThreshold,scaleOrdinal}from"../d3-scale@4.0.2/_esm.js";import{forceX,forceY,forceCollide,forceSimulation}from"../d3-force@3.0.0/_esm.js";import{arc}from"../d3-shape@3.2.0/_esm.js";import{tile as tile$1}from"../d3-tile@1.0.0/_esm.js";import*as geoScaleBar from"../d3-geo-scale-bar@1.2.5/_esm.js";import{zoom,zoomTransform,zoomIdentity}from"../d3-zoom@3.0.0/_esm.js";import{interpolate,interpolateRgbBasis}from"../d3-interpolate@3.0.1/_esm.js";import{transition}from"../d3-transition@3.0.1/_esm.js";import versor from"../versor@0.2.0/_esm.js";import{formatLocale}from"../d3-format@3.1.0/_esm.js";import*as discr from"../statsbreaks@1.0.6/_esm.js";import{getColors,getPalettes}from"../dicopal@0.6.4/_esm.js";import{geoProject}from"../d3-geo-projection@4.0.0/_esm.js";import{Delaunay}from"../d3-delaunay@6.0.4/_esm.js";import booleanPointInPolygon from"../@turf/boolean-point-in-polygon@6.5.0/_esm.js";const d3$G=Object.assign({},{geoEquirectangularRaw:geoEquirectangularRaw,geoBounds:geoBounds});function bbox(e){let t;t=Array.isArray(e)?e:d3$G.geoBounds(e);let a=t[0][0],r=t[0][1],i=t[1][0],o=t[1][1];const s={type:"FeatureCollection",features:[{type:"Feature",properties:{id:1},geometry:{type:"Polygon",coordinates:-90===r?[[[a,o],[i,o]]]:[[[a,r],[a,o],[i+=360*(i<a),o],[i,r],[a,r]]]}}]};return inverseResampleJSON(d3$G.geoEquirectangularRaw,.02)(s)}const inverseResampleJSON=(e,t)=>{const a=Math.PI/180,r=Math.tan(a*t/2)**2,i=function(t,a,o,s,l,n,c){if(n--){var d=planar_midpoint(t,o),p=e.invert(...d),g=cartesian(p),h=stereo_length2(g,a),u=stereo_length2(g,s);stereo_area2(g,a,s)*(1+.25*l)*(1+.25*l)/(r*l)+(h-u)/l*2*((h-u)/l)>1&h+u>r|h+u>.25&&(i(t,a,d,g,h,n,c),c.push(p),i(d,g,o,s,u,n,c))}},o=t=>{let a=[],r=t[0],o=e.invert(...r),s=cartesian(o);a.push(o);for(var l=1,n=t.length;l<n;l++){let o=t[l],n=e.invert(...o),c=cartesian(n);i(r,s,o,c,stereo_length2(s,c),16,a),a.push(n),r=o,s=c}return a};let s,l=t=>e.invert(...t),n=e=>t=>t.forEach(((a,r)=>t[r]=e(a))),c={Point:e=>e.coordinates=l(e.coordinates),MultiPoint:e=>n(l)(e.coordinates),LineString:e=>e.coordinates=o(e.coordinates),Polygon:e=>n(o)(e.coordinates),MultiLineString:e=>n(o)(e.coordinates),MultiPolygon:e=>e.coordinates.forEach(n(o)),Feature:e=>s(e.geometry),GeometryCollection:e=>e.geometries.forEach(s),FeatureCollection:e=>e.features.forEach(s)};return s=e=>(c[e.type](e),e),function(e){return e=JSON.parse(JSON.stringify(e)),s(e)}},stereo_area2=([e,t,a],[r,i,o],[s,l,n])=>{var c=e*((i-t)*(n-a)-(l-t)*(o-a))+t*((o-a)*(s-e)-(n-a)*(r-e))+a*((r-e)*(l-t)-(s-e)*(i-t)),d=(e+s)*(e+r)+(t+l)*(t+i)+(a+n)*(a+o);return(c*c+!(d*d))/(d*d)},planar_midpoint=([e,t],[a,r])=>[.5*(e+a),.5*(t+r)],radians=Math.PI/180,cartesian=([e,t])=>[Math.cos(radians*t)*Math.cos(radians*e),Math.cos(radians*t)*Math.sin(radians*e),Math.sin(radians*t)],stereo_length2=([e,t,a],[r,i,o])=>{var s=e*(i-t)-(r-e)*t,l=t*(o-a)-(i-t)*a,n=a*(r-e)-(o-a)*e,c=e*(r+e)+t*(i+t)+a*(o+a);return(s*s+l*l+n*n+!(c*c))/(c*c)};function whatisit(e){return isFeatureCollection(e)?"FeatureCollection":isFeatures(e)?"features":isFeature(e)?"feature":isGeometries(e)?"geometries":isGeometry(e)?"geometry":isArrayOfObjects(e)?"table":isBbox(e)?"bbox":void 0}function isFeatureCollection(e){return"object"==typeof e&&!Array.isArray(e)&&"FeatureCollection"==e.type}function isFeatures(e){return!(!Array.isArray(e)||"Feature"!=e[0]?.type||!e[0].hasOwnProperty("geometry"))}function isFeature(e){return!(Array.isArray(e)||"object"!=typeof e||"Feature"!=e?.type||!e.hasOwnProperty("geometry"))}function isBbox(e){return!!(Array.isArray(e)&&2==e.length&&Array.isArray(e[0])&&Array.isArray(e[1])&&Array.isArray(e[0])&&2==e[0]?.length&&2==e[1]?.length)}function isGeometries(e){return!!(Array.isArray(e)&&e[0].hasOwnProperty("type")&&e[0].hasOwnProperty("coordinates"))}function isGeometry(e){return!Array.isArray(e)&&"object"==typeof e&&e.hasOwnProperty("coordinates"),!(!e.hasOwnProperty("type")||!Array.isArray(e?.coordinates))}function isArrayOfObjects(e){return!(isBbox(e)||!Array.isArray(e)||"object"!=typeof e[0]||0===Object.keys(e[0]).length)}function extent(e,t){if((null==e||""==e)&&"none"!==t)return{type:"Sphere"};if((null==e||""==e)&&"none"==t)return bbox([[0,0],[0,0]]);if("bbox"==whatisit(e))return bbox(e);if("FeatureCollection"==whatisit(e))return e;if(Array.isArray(e)&&1==[...new Set(e.map((e=>whatisit(e))))].length&&"FeatureCollection"==whatisit(e[0])){let t=[];return e.forEach((e=>t.push(e.features))),{type:"FeatureCollection",features:t.flat()}}}const d3$F=Object.assign({},{create:create$1,descending:descending});function unique$1(){let e="";const t="abcdefghijklmnopqrstuvwxyz";for(let a=0;a<15;a++)e+=t.charAt(Math.floor(26*Math.random()));return e}function propertiesentries(e){let t=[];return e.features.map((e=>e.properties)).forEach((e=>t.push(Object.keys(e)))),[...new Set(t.flat())]}function detectinput(e,t=[]){return"function"==typeof e?"function":"string"==typeof e&&t.includes(e)?"field":"value"}function check(e,t){return"function"==typeof e?e:"string"==typeof e&&t.includes(e)?t=>t.properties[e]:e}function getsize$1(e){const t=e.clone(!0),a=d3$F.create("svg");a.node().appendChild(t.node()),document.body.appendChild(a.node());const{x:r,y:i,width:o,height:s}=t.node().getBBox();return document.body.removeChild(a.node()),{x:r,y:i,width:o,height:s}}function camelcasetodash$1(e,t=""){return e.split(/(?=[A-Z])/).map((e=>e.toLowerCase())).join("-").replace(t+"_","")}function northangle(e,t){const a=t.invert(e),r=t([a[0],a[1]+3]),i=t([a[0],a[1]-3]),o=r[0]-i[0],s=i[1]-r[1];let l=Math.atan(o/s)*(180/Math.PI);const n=t([0,90]);return e[1]<n[1]&&(l+=180),l}function implantation(e){let t=Array.from(new Set(e.features.filter((e=>null!==e.geometry)).map((e=>e.geometry.type)))),a=[];return-1===t.indexOf("Polygon")&&-1===t.indexOf("MultiPolygon")||a.push(3),-1===t.indexOf("LineString")&&-1===t.indexOf("MultiLineString")||a.push(2),-1===t.indexOf("Point")&&-1===t.indexOf("MultiPoint")||a.push(1),1==a.length?a[0]:-1}function columns(e){let t=[];return e.forEach((e=>t.push(Object.keys(e)))),[...new Set(t.flat())]}function order(e,t,{fields:a,descending:r=!0}={}){switch(a=a||columns(e.map((e=>e.properties))),detectinput(t,a)){case"value":return e;case"function":return e.sort(t);case"field":return r?e.sort(((e,a)=>d3$F.descending(Math.abs(+e.properties[t]),Math.abs(+a.properties[t])))):e.sort(((e,a)=>d3$F.descending(Math.abs(+a.properties[t]),Math.abs(+e.properties[t]))))}}function isNumber$1(e){return null!==e&&""!==e&&"boolean"!=typeof e&&isFinite(e)}function getDOMids(e){let t=e.selectAll("g"),a=t._groups[0].length,r=[];for(let e=0;e<a;e++)r.push(t.selectAll("id")._parents[e].id);return r.filter((e=>""!==e))}function random$1(){const e=["#B2DF8A","#33A02C","#FB9A99","#E31A1C","#FDBF6F","#FF7F00","#CAB2D6","#6A3D9A","#FFFF99","#B15928","#32A251","#ACD98D","#FF7F0F","#FFB977","#B85A0D","#FFD94A","#39737C","#86B4A9","#82853B","#CCC94D"];return e[Math.floor(Math.random()*e.length)]}const d3$E=Object.assign({},{scaleSqrt:scaleSqrt,max:max,extent:extent$1});function radius(e,{fixmax:t,k:a=50}={}){const r=null!=t?t:d3$E.max(e.map((e=>Math.abs(+e))));return{data:d3$E.extent(e.filter((e=>isNumber$1(e))).map((e=>Math.abs(Number(e))))),k:a,fixmax:t,r:d3$E.scaleSqrt([0,r],[0,a])}}const d3$D=Object.assign({},{forceX:forceX,forceY:forceY,forceCollide:forceCollide,forceSimulation:forceSimulation,max:max,scaleSqrt:scaleSqrt});function dodge(e,{projection:t=(e=>e),iteration:a=200,r:r=10,k:i=50,fixmax:o=null,gap:s=0}={}){let l,n=JSON.parse(JSON.stringify(e)).features.filter((e=>e.geometry)).filter((e=>null!=e.geometry.coordinates)),c=JSON.parse(JSON.stringify(n)),d=propertiesentries(e);if("field"==detectinput(r,d)){const e=null!=o?o:d3$D.max(c,(e=>Math.abs(+e.properties[r])));let a=d3$D.scaleSqrt([0,e],[0,i]);l=d3$D.forceSimulation(c).force("x",d3$D.forceX((e=>t(e.geometry.coordinates)[0]))).force("y",d3$D.forceY((e=>t(e.geometry.coordinates)[1]))).force("collide",d3$D.forceCollide((e=>a(Math.abs(e.properties[r]))+s)))}"function"==detectinput(r,d)&&(l=d3$D.forceSimulation(c).force("x",d3$D.forceX((e=>t(e.geometry.coordinates)[0]))).force("y",d3$D.forceY((e=>t(e.geometry.coordinates)[1]))).force("collide",d3$D.forceCollide(r))),"value"==detectinput(r,d)&&(l=d3$D.forceSimulation(c).force("x",d3$D.forceX((e=>t(e.geometry.coordinates)[0]))).force("y",d3$D.forceY((e=>t(e.geometry.coordinates)[1]))).force("collide",d3$D.forceCollide(r+s)));for(let e=0;e<a;e++)l.tick();return n.map(((e,t)=>e.geometry.coordinates=[c[t].x,c[t].y])),{type:"FeatureCollection",crs:null,features:n}}const d3$C=Object.assign({},{geoArea:geoArea,geoCentroid:geoCentroid,geoIdentity:geoIdentity,geoPath:geoPath});function centroid(e,{largest:t=!0,latlong:a=!0}={}){let r=d3$C.geoPath(d3$C.geoIdentity()),i=JSON.parse(JSON.stringify(e));const o=function(e){var t={},i=0;return e.geometry.coordinates.forEach((function(e){var o={type:"Polygon",coordinates:e},s=a?d3$C.geoArea(o):r.area(o);s>i&&(i=s,t=o)})),t};let s=i.features.filter((e=>null!=e.geometry)).map((e=>(e.geometry.coordinates=a?d3$C.geoCentroid(1==t?"Polygon"==e.geometry.type?e:o(e):e):r.centroid(1==t?"Polygon"==e.geometry.type?e:o(e):e),e.geometry.type="Point",e)));return i.features=s,i}const d3$B=Object.assign({},{select:select,pointers:pointers});function tooltip(layer,data,container,tip,tip_style={},fields,view){let dataview;if("string"==typeof tip)fields.sort(((e,t)=>t.length-e.length)),fields.forEach((e=>{tip=tip.replace(`$${e}`,`\${d.properties.${e}}`)})),tip=eval("d => `"+tip+"`");else if("function"==typeof tip){const arrstr=tip.toString().split("=>");arrstr[1].includes("`${")||(tip=eval(arrstr[0]+" => `${"+tip.toString().split("=>")[1]+"}`"))}else if(!0===tip){let x={...data},keys=[];x.features.map((e=>e.properties)).forEach((e=>{keys.push(Object.keys(e))})),keys=Array.from(new Set(keys.flat()));let str=[];keys.forEach((e=>str.push(`${e}: \${d.properties.${e}}`))),tip=eval("(d) => `"+str.join("\n")+"`")}let style={fontSize:13,fill:"#4d4545",background:"#fcf7e6",stroke:"#4a4d4b",strokeWidth:1,fontFamily:container.fontFamily,fontWeight:"normal",fontStyle:"normal",textDecoration:"none",hoverOpacity:.5,hoverFill:void 0,hoverStroke:void 0},formerOpacity=layer.attr("fill-opacity"),context=container.node();Object.keys(tip_style).forEach((e=>{style[e]=tip_style[e]}));const geoviztooltip=container.select("#geoviztooltip");let path,text;geoviztooltip.attr("pointer-events","none"),container.select("#geoviztooltip").selectAll("*").empty()?(path=geoviztooltip.append("g").attr("id","geotooltippath").attr("fill",style.background).attr("stroke",style.stroke).attr("stroke-width",style.strokeWidth).selectAll("path").data([null]).join("path"),text=geoviztooltip.append("g").attr("id","geotooltiptext").attr("font-size",`${style.fontSize}px`).attr("fill",style.fill).attr("font-family",style.fontFamily).attr("font-weight",style.fontWeight).attr("font-style",style.fontStyle).attr("text-decoration",style.textDecoration)):(path=geoviztooltip.select("#geotooltippath").attr("fill",style.background).attr("stroke",style.stroke).attr("stroke-width",style.strokeWidth).selectAll("path").data([null]).join("path"),text=geoviztooltip.select("#geotooltiptext")),layer.selectAll("*").on("touchmove mousemove",(function(event,d){view&&(dataview=d.properties,container.dispatch("input")),geoviztooltip.style("visibility","visible");const xy=d3$B.pointers(event,context)[0];d3$B.select(this).attr("fill-opacity",.5),text.selectAll("text").data(eval(tip.toString().split("=>")[1]).split("\n")).join("text").attr("dy",((e,t)=>t*style.fontSize)).text((e=>e)),path.attr("transform",`translate(${xy})`);const{x:x,y:y,width:w,height:h}=text.node().getBBox(),x_margin=.33*container.width,y_margin=.25*container.height;xy[0]<x_margin&&xy[1]<y_margin?(text.attr("transform",`translate(${xy[0]+10},${xy[1]+15-y})`),path.attr("d",`M0,0v${+h+5+20}h${w+20}v${-h-20}h${-w-15}z`)):xy[0]>container.width-x_margin&&xy[1]<y_margin?(text.attr("transform",`translate(${xy[0]-w-10},${xy[1]+15-y})`),path.attr("d",`M0,0v${+h+5+20}h${-w-20}v${-h-20}h${+w+15}z`)):xy[0]<x_margin&&xy[1]>container.height-y_margin?(text.attr("transform",`translate(${xy[0]+10},${xy[1]-15-y-h})`),path.attr("d",`M0,0v${-h-5-20}h${w+20}v${h+20}h${-w-15}z`)):xy[0]>container.width-x_margin&&xy[1]>container.height-y_margin?(text.attr("transform",`translate(${xy[0]-w-10},${xy[1]-15-y-h})`),path.attr("d",`M0,0v${-h-5-20}h${-w-20}v${h+20}h${w+15}z`)):xy[1]>container.height-y_margin?(text.attr("transform",`translate(${xy[0]-w/2},${xy[1]-15-y-h})`),path.attr("d",`M${-w/2-10},-5H-5l5,5l5,-5H${w/2+10}v${-h-20}h-${w+20}z`)):xy[0]<x_margin?(text.attr("transform",`translate(${xy[0]+15},${xy[1]-y-h/2})`),path.attr("d",`M0,0l5,5v${h/2+5}h${w+20}v${-h-20}h${-w-20}v${h/2+5}z`)):xy[0]>container.width-x_margin?(text.attr("transform",`translate(${xy[0]-w-15},${xy[1]-y-h/2})`),path.attr("d",`M0,0l-5,5v${h/2+5}h${-w-20}v${-h-20}h${w+20}v${h/2+5}z`)):(text.attr("transform",`translate(${xy[0]-w/2},${xy[1]-y+15})`),path.attr("d",`M${-w/2-10},5H-5l5,-5l5,5H${w/2+10}v${h+20}h-${w+20}z`))})).on("touchend mouseleave",(function(e,t){d3$B.select(this).attr("fill-opacity",formerOpacity),geoviztooltip.style("visibility","hidden"),view&&(dataview={},container.dispatch("input"))})),view&&Object.defineProperty(container.node(),"value",{get:()=>dataview})}const d3$A=Object.assign({},{select:select,pointers:pointers});function viewof(e,t){let a,r=e.attr("fill-opacity");e.selectAll("*").on("touchmove mousemove",(function(e,r){d3$A.select(this).attr("fill-opacity",.5),a=r.properties,t.dispatch("input")})).on("touchend mouseleave",(function(e,i){d3$A.select(this).attr("fill-opacity",r),a={},t.dispatch("input")})),Object.defineProperty(t.node(),"value",{get:()=>a})}const d3$z=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity});function circle(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"circle",id:unique$1(),data:void 0,r:10,k:50,pos:[0,0],sort:void 0,dodge:!1,dodgegap:0,iteration:200,descending:!0,fixmax:null,fill:random$1(),stroke:"white",tip:void 0,tipstyle:void 0},...a?e:t},i={domain:r.data||r.datum};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e,s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),r.data||(r.coords=void 0!==r.coords?r.coords:"svg"),r.data&&(o.data=!0,r.coords=void 0!==r.coords?r.coords:"geo",r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","coords","data","r","k","sort","dodge","dodgegap","iteration","descending","fixmax","tip","tipstyle","pos"].includes(e)));let n="svg"==r.coords?d3$z.geoIdentity():o.projection,c=d3$z.geoPath(n);if(r.data){r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data;let e=propertiesentries(r.data);const t=l.filter((t=>"value"==detectinput(r[t],e)));t.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));const a=l.filter((e=>!t.includes(e)));a.forEach((t=>{r[t]=check(r[t],e)}));let i,n="svg"==r.coords?d3$z.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection;if(r.dodge){i=JSON.parse(JSON.stringify(r.data));let e={features:i.features.filter((e=>!isNaN(d3$z.geoPath(n).centroid(e.geometry)[0]))).filter((e=>!isNaN(d3$z.geoPath(n).centroid(e.geometry)[1])))};i=dodge(e,{projection:n,gap:r.dodgegap,r:r.r,k:r.k,fixmax:r.fixmax,iteration:r.iteration}),n=d3$z.geoIdentity()}else i=r.data;let d=propertiesentries(r.data),p=attr2radius$2(r.r,{columns:d,geojson:r.data,fixmax:r.fixmax,k:r.k});i=i.features.filter((e=>e.geometry)).filter((e=>null!=e.geometry.coordinates)),"field"==detectinput(r.r,d)&&(i=i.filter((e=>null!=e.properties[r.r]))),i=order(i,r.sort||r.r,{fields:d,descending:r.descending}),c=d3$z.geoPath(n),s.selectAll("circle").data(i).join((e=>{let t=e.append("circle").attr("cx",(e=>c.centroid(e.geometry)[0])).attr("cy",(e=>c.centroid(e.geometry)[1])).attr("r",(e=>p(e,r.r))).attr("visibility",(e=>isNaN(c.centroid(e.geometry)[0])?"hidden":"visible"));return a.forEach((e=>{t.attr(camelcasetodash$1(e),r[e])})),t})),r.tip&&tooltip(s,r.data,o,r.tip,r.tipstyle,e,r.view),!r.tip&&r.view&&viewof(s,o)}else{l.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));let e=c.centroid({type:"Point",coordinates:r.pos});s.append("circle").attr("cx",e[0]).attr("cy",e[1]).attr("r",r.r).attr("visibility",isNaN(e[0])?"hidden":"visible")}if(a){const e=getsize$1(s);return o.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(o)}return`#${r.id}`}function attr2radius$2(e,{columns:t,geojson:a,fixmax:r,k:i}={}){switch(detectinput(e,t)){case"function":return e;case"field":let t=radius(a.features.map((t=>t.properties[e])),{fixmax:r,k:i});return(e,a)=>t.r(e.properties[a]);case"value":return t=>e}}const d3$y=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity,arc:arc});function square$1(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"square",id:unique$1(),data:void 0,side:20,k:100,pos:[0,0],dx:0,dy:0,angle:0,sort:void 0,descending:!0,fixmax:null,fill:random$1(),stroke:"white",tip:void 0,tipstyle:void 0},...a?e:t},i={domain:r.data||r.datum};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e,s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),r.data||(r.coords=void 0!==r.coords?r.coords:"svg"),r.data&&(r.coords=void 0!==r.coords?r.coords:"geo",r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","coords","data","side","k","dx","dy","transform","angle","sort","descending","fixmax","tip","tipstyle","pos"].includes(e)));if(r.data){let e="svg"==r.coords?d3$y.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection,t=d3$y.geoPath(e);r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data;let a=propertiesentries(r.data);const i=l.filter((e=>"value"==detectinput(r[e],a)));i.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));const n=l.filter((e=>!i.includes(e)));n.forEach((e=>{r[e]=check(r[e],a)})),"svg"==r.coords?d3$y.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection;let c=r.data,d=propertiesentries(c),p=attr2radius$1(r.side,{columns:d,geojson:r.data,fixmax:r.fixmax,k:r.k});c=c.features.filter((e=>e.geometry)).filter((e=>null!=e.geometry.coordinates)),"field"==detectinput(r.side,d)&&(c=c.filter((e=>null!=e.properties[r.side]))),c=order(c,r.sort||r.side,{fields:d,descending:r.descending}),s.selectAll("path").data(c).join((e=>{let a=e.append("rect").attr("transform",(e=>`rotate(${r.angle} ${t.centroid(e.geometry)[0]+r.dx} ${t.centroid(e.geometry)[1]+r.dy})\n              translate(${r.dx} ${r.dy})`)).attr("x",(e=>t.centroid(e.geometry)[0]+r.dx-p(e,r.side))).attr("y",(e=>t.centroid(e.geometry)[1]+r.dy-p(e,r.side))).attr("width",(e=>2*p(e,r.side))).attr("height",(e=>2*p(e,r.side))).attr("visibility",(e=>isNaN(t.centroid(e.geometry)[0])?"hidden":"visible"));return n.forEach((e=>{a.attr(camelcasetodash$1(e),r[e])})),a})),r.tip&&tooltip(s,r.data,o,r.tip,r.tipstyle,a,r.view),!r.tip&&r.view&&viewof(s,o)}else{let e="svg"==r.coords?d3$y.geoIdentity():o.projection,t=d3$y.geoPath(e);l.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));let a=t.centroid({type:"Point",coordinates:r.pos});s.append("rect").attr("transform",`rotate(${r.angle} ${a[0]+r.dx} ${a[1]+r.dy})\n          translate(${r.dx} ${r.dy})`).attr("x",a[0]-r.side/2).attr("y",a[1]-r.side/2).attr("width",r.side).attr("height",r.side).attr("visibility",isNaN(a[0])?"hidden":"visible")}if(a){const e=getsize$1(s);return o.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(o)}return`#${r.id}`}function attr2radius$1(e,{columns:t,geojson:a,fixmax:r,k:i}={}){switch(detectinput(e,t)){case"function":return e;case"field":let t=radius(a.features.map((t=>t.properties[e])),{fixmax:r,k:i});return(e,a)=>t.r(e.properties[a]);case"value":return t=>e}}const d3$x=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity,arc:arc});function halfcircle(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"halfcircle",id:unique$1(),data:void 0,r:20,k:50,pos:[0,0],dx:0,dy:0,cornerRadius:2,innerRadius:0,angle:0,sort:void 0,descending:!0,fixmax:null,fill:random$1(),stroke:"white",tip:void 0,tipstyle:void 0},...a?e:t},i={domain:r.data||r.datum};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e,s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),r.data||(r.coords=void 0!==r.coords?r.coords:"svg"),r.data&&(r.coords=void 0!==r.coords?r.coords:"geo",r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","coords","data","r","k","dx","dy","cornerRadius","innerRadius","transform","angle","sort","descending","fixmax","tip","tipstyle","pos"].includes(e)));if(r.data){let e="svg"==r.coords?d3$x.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection,t=d3$x.geoPath(e);r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data;let a=propertiesentries(r.data);const i=l.filter((e=>"value"==detectinput(r[e],a)));i.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));const n=l.filter((e=>!i.includes(e)));n.forEach((e=>{r[e]=check(r[e],a)})),"svg"==r.coords?d3$x.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection;let c=r.data,d=propertiesentries(c),p=attr2radius(r.r,{columns:d,geojson:r.data,fixmax:r.fixmax,k:r.k});c=c.features.filter((e=>e.geometry)).filter((e=>null!=e.geometry.coordinates)),"field"==detectinput(r.r,d)&&(c=c.filter((e=>null!=e.properties[r.r]))),c=order(c,r.sort||r.r,{fields:d,descending:r.descending}),s.selectAll("path").data(c).join((e=>{let a=e.append("path").attr("transform",(e=>`rotate(${r.angle} ${t.centroid(e.geometry)[0]+r.dx} ${t.centroid(e.geometry)[1]+r.dy}) translate(${t.centroid(e.geometry)[0]+r.dx} ${t.centroid(e.geometry)[1]+r.dy})`)).attr("d",(e=>d3$x.arc().outerRadius(p(e,r.r)).innerRadius(r.innerRadius).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(r.cornerRadius)())).attr("visibility",(e=>isNaN(t.centroid(e.geometry)[0])?"hidden":"visible"));return n.forEach((e=>{a.attr(camelcasetodash$1(e),r[e])})),a})),r.tip&&tooltip(s,r.data,o,r.tip,r.tipstyle,a,r.view),!r.tip&&r.view&&viewof(s,o)}else{let e="svg"==r.coords?d3$x.geoIdentity():o.projection,t=d3$x.geoPath(e);l.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));let a=t.centroid({type:"Point",coordinates:r.pos});s.append("path").attr("transform",`rotate(${r.angle} ${a[0]+r.dx} ${a[1]+r.dy}) translate(${a[0]+r.dx} ${a[1]+r.dy})`).attr("d",d3$x.arc().outerRadius(r.r).innerRadius(r.innerRadius).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(r.cornerRadius)()).attr("visibility",isNaN(a[0])?"hidden":"visible")}if(a){const e=getsize$1(s);return o.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(o)}return`#${r.id}`}function attr2radius(e,{columns:t,geojson:a,fixmax:r,k:i}={}){switch(detectinput(e,t)){case"function":return e;case"field":let t=radius(a.features.map((t=>t.properties[e])),{fixmax:r,k:i});return(e,a)=>t.r(e.properties[a]);case"value":return t=>e}}const d3$w=Object.assign({},{scaleLinear:scaleLinear,max:max,extent:extent$1});function height(e,{fixmax:t,k:a=50}={}){const r=null!=t?t:d3$w.max(e.map((e=>Math.abs(+e))));return{data:d3$w.extent(e.filter((e=>isNumber$1(e))).map((e=>Math.abs(Number(e))))),k:a,fixmax:t,h:d3$w.scaleLinear().domain([0,r]).range([0,a]).unknown(0)}}const d3$v=Object.assign({},{scaleSqrt:scaleSqrt,max:max,descending:descending,geoPath:geoPath,geoIdentity:geoIdentity});function spike(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"spike",id:unique$1(),data:void 0,pos:[0,0],k:50,width:30,height:100,pos:[0,0],straight:0,sort:void 0,descending:!0,fixmax:null,fill:"#F13C47",stroke:"#F13C47",fillOpacity:.5,strokeWidth:.5,tip:void 0,tipstyle:void 0},...a?e:t},i={domain:r.data||r.datum};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e,s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),r.data||(r.coords=void 0!==r.coords?r.coords:"svg"),r.data&&(o.data=!0,r.coords=void 0!==r.coords?r.coords:"geo",r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","coords","data","height","width","k","sort","descending","fixmax","tip","tipstyle","pos"].includes(e)));if(r.data){let e="svg"==r.coords?d3$v.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection,t=d3$v.geoPath(e);r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords&&trueg}):r.data;let a=propertiesentries(r.data);const i=l.filter((e=>"value"==detectinput(r[e],a)));i.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));const n=l.filter((e=>!i.includes(e)));n.forEach((e=>{r[e]=check(r[e],a)}));let c=r.data,d=propertiesentries(c);let p;switch(detectinput(r.height,d)){case"value":p=e=>`m ${t.centroid(e.geometry)[0]-r.width/2},${t.centroid(e.geometry)[1]} Q ${t.centroid(e.geometry)[0]},${t.centroid(e.geometry)[1]-r.height*r.straight},${t.centroid(e.geometry)[0]} ${t.centroid(e.geometry)[1]-r.height}\n         Q ${t.centroid(e.geometry)[0]}, ${t.centroid(e.geometry)[1]-r.height*r.straight} ${t.centroid(e.geometry)[0]+r.width/2},${t.centroid(e.geometry)[1]}`;break;case"field":const e=height(c.features.map((e=>e.properties[r.height])),{fixmax:r.fixmax,k:r.k}).h;p=a=>`m ${t.centroid(a.geometry)[0]-r.width/2},${t.centroid(a.geometry)[1]} Q ${t.centroid(a.geometry)[0]},${t.centroid(a.geometry)[1]-e(a.properties[r.height])*r.straight},${t.centroid(a.geometry)[0]} ${t.centroid(a.geometry)[1]-e(a.properties[r.height])}\n         Q ${t.centroid(a.geometry)[0]}, ${t.centroid(a.geometry)[1]-e(a.properties[r.height])*r.straight} ${t.centroid(a.geometry)[0]+r.width/2},${t.centroid(a.geometry)[1]}`}c=c.features.filter((e=>e.geometry)).filter((e=>null!=e.geometry.coordinates)),"field"==detectinput(r.height,d)&&(c=c.filter((e=>null!=e.properties[r.height]))),c=order(c,r.sort||r.height,{fields:d,descending:r.descending}),s.selectAll("path").data(c).join((e=>{let a=e.append("path").attr("d",p).attr("visibility",(e=>isNaN(t.centroid(e.geometry)[0])?"hidden":"visible"));return n.forEach((e=>{a.attr(camelcasetodash$1(e),r[e])})),a})),r.tip&&tooltip(s,r.data,o,r.tip,r.tipstyle,a,r.view),!r.tip&&r.view&&viewof(s,o)}else{let e="svg"==r.coords?d3$v.geoIdentity():o.projection,t=d3$v.geoPath(e);l.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));let a=t.centroid({type:"Point",coordinates:r.pos});s.append("path").attr("d",`m ${a[0]-r.width/2},${a[1]} Q ${a[0]},${a[1]-r.height*r.straight},${a[0]} ${a[1]-r.height}\n     Q ${a[0]}, ${a[1]-r.height*r.straight} ${a[0]+r.width/2},${a[1]}`).attr("visibility",isNaN(a[0])?"hidden":"visible")}if(a){const e=getsize$1(s);return o.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(o)}return`#${r.id}`}const d3$u=Object.assign({},{geoPath:geoPath,geoIdentity:geoIdentity,geoCentroid:geoCentroid});function text(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"text",id:unique$1(),strokeWidth:1,text:"text",sort:void 0,descending:!0,paintOrder:"stroke",strokeLinejoin:"round",fontSize:12,lineSpacing:0,dx:0,dy:0,pos:[0,0]},...a?e:t},i={domain:r.data||r.datum};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;r.fontFamily=r.fontFamily||o.fontFamily,r.data||(r.coords=void 0!==r.coords?r.coords:"svg","svg"!==r.coords?(r.dominantBaseline=r.dominantBaseline?r.dominantBaseline:"middle",r.textAnchor=r.textAnchor?r.textAnchor:"middle"):(r.dominantBaseline=r.dominantBaseline?r.dominantBaseline:"hanging",r.textAnchor=r.textAnchor?r.textAnchor:"start")),r.data&&(o.data=!0,r.coords=void 0!==r.coords?r.coords:"geo",r.textAnchor=r.textAnchor?r.textAnchor:"middle",r.dominantBaseline=r.dominantBaseline?r.dominantBaseline:"middle",r.data=3==implantation(r.data)?centroid(r.data,{latlong:"none"!=o.initproj&&"svg"!=r.coords}):r.data);let s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","datum","data","coords","sort","descending"].includes(e)));if(!r.data){let e="svg"==r.coords?d3$u.geoIdentity():o.projection,t=d3$u.geoPath(e);l.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));let a=t.centroid({type:"Point",coordinates:r.pos});if(a[0]=a[0]+r.dx,a[1]=a[1]+r.dy,1==r.text.split("\n").length)s.append("text").attr("x",a[0]).attr("y",a[1]).text(r.text).attr("visibility",isNaN(a[0])?"hidden":"visible");else{let e=0;switch(r.dominantBaseline){case"hanging":default:e=0;break;case"middle":case"central":e=(r.text.split("\n").length-1)*r.fontSize,e/=2;break;case"auto":case"text-top":e=(r.text.split("\n").length-1)*r.fontSize}s.selectAll("text").data(r.text.split("\n")).join("text").attr("x",a[0]).attr("y",((t,i)=>a[1]+i*(r.fontSize+r.lineSpacing)-e)).text((e=>e)).attr("visibility",isNaN(a[0])?"hidden":"visible")}}if(r.data){let e="svg"==r.coords?d3$u.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection,t=d3$u.geoPath(e),a=propertiesentries(r.data);const i=l.filter((e=>"value"==detectinput(r[e],a)));i.forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));const n=l.filter((e=>!i.includes(e)));n.forEach((e=>{r[e]=check(r[e],a)}));let c=r.data.features.filter((e=>e.geometry)).filter((e=>null!=e.geometry.coordinates));c=order(c,r.sort,{fields:a,descending:r.descending}),s.selectAll("text").data(c).join((e=>{let a=e.append("text").attr("x",(e=>t.centroid(e.geometry)[0])).attr("y",(e=>t.centroid(e.geometry)[1])).text(r.text).attr("visibility",(e=>isNaN(t.centroid(e.geometry)[0])?"hidden":"visible"));return n.forEach((e=>{a.attr(camelcasetodash$1(e),r[e])})),a}))}if(a){const e=getsize$1(s);return o.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(o)}return`#${r.id}`}function tile(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"tile",id:unique$1(),tileSize:512,zoomDelta:1,increasetilesize:1,opacity:1,clipPath:void 0,url:(e,t,a)=>`https://tile.openstreetmap.org/${a}/${e}/${t}.png`},...a?e:t};r.url=geturl(r.url);let i={zoomable:!0,projection:geoMercator()};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;"none"==o.initproj&&o.warning&&o.warning_message.push('You must use projection: "mercator" in the svg container to display tile marks');let s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);let l=tile$1().size([o.width,o.height]).scale(2*o.projection.scale()*Math.PI).translate(o.projection([0,0])).tileSize(r.tileSize).zoomDelta(r.zoomDelta);return s.selectAll("image").data(l()).join("image").attr("xlink:href",(e=>r.url(...e))).attr("x",(([e])=>(e+l().translate[0])*l().scale)).attr("y",(([,e])=>(e+l().translate[1])*l().scale)).attr("width",l().scale+r.increasetilesize+"px").attr("height",l().scale+r.increasetilesize+"px").attr("opacity",r.opacity).attr("clip-path",r.clipPath),a?render(o):`#${r.id}`}function geturl(e){let t=(e,t,a)=>`https://tile.openstreetmap.org/${a}/${e}/${t}.png`;switch(typeof e){case"function":t=e;break;case"string":t=providers.find((t=>t.name==e))?.url||((e,t,a)=>`https://tile.openstreetmap.org/${a}/${e}/${t}.png`)}return t}const providers=[{name:"openstreetmap",provider:"OpenStreetMap contributors",url:(e,t,a)=>`https://tile.openstreetmap.org/${a}/${e}/${t}.png`},{name:"opentopomap",provider:"OpenStreetMap contributors",url:(e,t,a)=>`https://tile.opentopomap.org/${a}/${e}/${t}.png`},{name:"worldterrain",provider:"USGS, Esri, TANA, DeLorme, and NPS",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/${a}/${t}/${e}.png`},{name:"worldimagery",provider:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/${a}/${t}/${e}.png`},{name:"worldStreet",provider:"Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/${a}/${t}/${e}.png`},{name:"worldphysical",provider:"Esri, US National Park Service",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/${a}/${t}/${e}`},{name:"shadedrelief",provider:"ESRI",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/${a}/${t}/${e}.png`},{name:"stamenterrain",provider:"stadiamaps",url:(e,t,a)=>`https://tiles.stadiamaps.com/tiles/stamen_terrain/${a}/${e}/${t}${devicePixelRatio>1?"@2x":""}.png`},{name:"cartodbvoyager",provider:"CartoDB",url:(e,t,a)=>`https://${"abc"[Math.abs(e+t)%3]}.basemaps.cartocdn.com/rastertiles/voyager/${a}/${e}/${t}${devicePixelRatio>1?"@2x":""}.png`},{name:"stamentoner",provider:"stadiamaps",url:(e,t,a)=>`https://tiles.stadiamaps.com/tiles/stamen_toner/${a}/${e}/${t}${devicePixelRatio>1?"@2x":""}.png`},{name:"stamentonerbackground",provider:"stadiamaps",url:(e,t,a)=>`https://tiles.stadiamaps.com/tiles/stamen_toner_background/${a}/${e}/${t}${devicePixelRatio>1?"@2x":""}.png`},{name:"stamentonerlite",provider:"stadiamaps",url:(e,t,a)=>`https://tiles.stadiamaps.com/tiles/stamen_toner_lite/${a}/${e}/${t}${devicePixelRatio>1?"@2x":""}.png`},{name:"stamenwatercolor",provider:"stadiamaps",url:(e,t,a)=>`https://tiles.stadiamaps.com/tiles/stamen_watercolor/${a}/${e}/${t}.jpg`},{name:"hillshade",provider:"ESRI",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/Elevation/World_Hillshade/MapServer/tile/${a}/${t}/${e}.png`},{name:"worldocean",provider:"ESRI",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/Ocean/World_Ocean_Base/MapServer/tile/${a}/${t}/${e}`},{name:"natgeo",provider:"ESRI",url:(e,t,a)=>`https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/${a}/${t}/${e}`},{name:"worldterrain",provider:"ESRI",url:(e,t,a)=>`  https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/${a}/${t}/${e}`}],d3$t=Object.assign({geoNaturalEarth1:geoNaturalEarth1},geoScaleBar);function scalebar(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"scalebar",id:unique$1(),translate:null,units:"km",label:void 0,tickPadding:5,tickSize:.2,distance:void 0,tickFormat:e=>e,tickValues:void 0,labelAnchor:"start"},...a?e:t},i={projection:d3$t.geoNaturalEarth1()};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;r.pos=r.pos||[10,o.height-20],"none"==o.initproj&&o.warning&&(o.warning_message.push("Scalebar mark"),o.warning_message.push("The scale bar is not relevant without defining a projection function function in the SVG container"));let s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);Object.entries(r).map((e=>e[0])).forEach((e=>{s.attr(camelcasetodash$1(e),r[e])}));let l=new Map([["ft",d3$t.geoScaleFeet],["km",d3$t.geoScaleKilometers],["m",d3$t.geoScaleMeters],["mi",d3$t.geoScaleMiles]]).get(r.units);const n=r.pos[0]/o.width,c=r.pos[1]/o.height,d=d3$t.geoScaleBar().projection(o.projection).size([o.width,o.height]).left(n).top(c).distance(r.distance).label(void 0!==r.label?r.label:l.units).units(l).tickPadding(r.tickPadding).tickSize(r.tickSize).tickFormat(r.tickFormat).tickValues(r.tickValues).labelAnchor(r.labelAnchor);return s.call(d),r.translate&&s.attr("transform",`translate(${r.pos[0]+r.translate[0]},${r.pos[1]+r.translate[1]})`),a?render(o):`#${r.id}`}const d3$s=Object.assign({},{geoNaturalEarth1:geoNaturalEarth1});function north(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"north",id:unique$1(),rotate:null,scale:1,fill:"black",fillOpacity:1},...a?e:t},i={projection:d3$s.geoNaturalEarth1()};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;r.pos=r.pos||[o.width-30,30],"none"==o.initproj&&o.warning&&(o.warning_message.push("North mark"),o.warning_message.push("The North arrow is not relevant without defining a projection function in the SVG container"));let s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(s.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]=r}else o.zoomablelayers.push(r);const l=null===r.rotate?northangle(r.pos,o.projection):r.rotate;return Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","pos","rotate","scale"].includes(e))).forEach((e=>{s.attr(camelcasetodash$1(e),r[e])})),s.append("path").attr("d","M 0.044958496 -17.812349 C -0.26996119 -17.812349 -0.55343697 -17.592424 -0.67127686 -17.257345 L -8.3333415 4.589384 C -8.4444814 4.9067336 -8.3867007 5.2688235 -8.1855469 5.5205933 C -8.036827 5.7055621 -7.8301427 5.8063639 -7.6176229 5.8063639 C -7.541523 5.8063639 -7.4648555 5.7942066 -7.3902466 5.7676066 C -2.7097153 4.1075403 2.3000786 4.1096862 7.5003174 5.7743245 C 7.7838471 5.8647245 8.0866488 5.7625043 8.2826986 5.5112915 C 8.4787474 5.2601218 8.5328574 4.9026136 8.4232585 4.589384 L 0.76119385 -17.257345 C 0.64335397 -17.592424 0.35987718 -17.812349 0.044958496 -17.812349 z M 0.050126139 -14.540715 L 6.4238973 3.6313029 C 6.4089973 3.6273029 6.393912 3.6251008 6.378422 3.6204508 C 0.64157284 -2.0936385 0.097483092 -4.360355 0.050126139 -14.540715 z M -3.3693034 -12.968201 C -9.1352526 -11.453015 -13.401249 -6.1970669 -13.401249 0.03824056 C -13.401249 4.5709812 -11.148377 8.6866709 -7.540625 11.145056 A 8.3801446 8.3801446 0 0 1 -7.0967244 10.275342 C -10.385638 7.9859154 -12.4349 4.2025426 -12.4349 0.03824056 C -12.4349 -5.659418 -8.5956532 -10.47465 -3.3693034 -11.964128 L -3.3693034 -12.968201 z M 3.5574056 -12.940812 L 3.5574056 -11.936739 C 8.7345144 -10.415833 12.526367 -5.6244081 12.526367 0.03824056 C 12.526367 4.1909026 10.478884 7.9752639 7.19646 10.26759 A 8.3801446 8.3801446 0 0 1 7.6558634 11.126453 C 11.247977 8.6637544 13.492716 4.5522912 13.492716 0.03824056 C 13.492716 -6.161767 9.2740539 -11.392436 3.5574056 -12.940812 z M -3.6158 7.7333781 C -3.7267299 7.7341681 -3.8385828 7.7529054 -3.9475627 7.7897054 C -4.3841612 7.9364343 -4.6793009 8.3455548 -4.6793009 8.8072144 L -4.6793009 18.45262 C -4.6793009 19.045959 -4.1988131 19.526457 -3.6054647 19.526457 C -3.0121153 19.526457 -2.5321452 19.045959 -2.5321452 18.45262 L -2.5321452 12.003918 L 2.8411702 19.10116 C 3.04802 19.374569 3.3674991 19.526973 3.6974487 19.526973 C 3.8112586 19.526973 3.9261433 19.508463 4.0385132 19.471163 C 4.4758327 19.324443 4.7702515 18.914787 4.7702515 18.453137 L 4.7702515 8.8072144 C 4.7702515 8.2138749 4.2890446 7.7338949 3.6964152 7.7338949 C 3.1037968 7.7338949 2.6230957 8.2138749 2.6230957 8.8072144 L 2.6230957 15.25695 L -2.7502197 8.1597087 C -2.9590285 7.8833089 -3.2829703 7.7303491 -3.6158 7.7333781 z ").attr("transform",`translate(${r.pos[0]},${r.pos[1]}) rotate(${l}) scale(${r.scale})`),a?render(o):`#${r.id}`}function zoompanel(e){const t=[25,70],a=t[1]/3;let r=`translate(${e.width-30},5)`;Array.isArray(e.control)&&(r=`translate(${e.control[0]},${e.control[1]})`);const i=e.append("g").attr("transform",r).attr("id",e.controlid);i.append("rect").attr("x",0).attr("y",0).attr("ry",4).attr("height",t[1]).attr("width",t[0]).attr("fill","white").attr("stroke","#6a6a6a").attr("stroke-width",.5).attr("stroke-opacity",.3).attr("fill-opacity",.8),i.append("line").attr("x1",5).attr("y1",a).attr("x2",t[0]-5).attr("y2",a).attr("stroke","#6a6a6a").attr("stroke-opacity",.3).attr("stroke-width",1).attr("stroke-dasharray",2),i.append("line").attr("x1",5).attr("y1",2*a).attr("x2",t[0]-5).attr("y2",2*a).attr("stroke","#6a6a6a").attr("stroke-opacity",.3).attr("stroke-width",1).attr("stroke-dasharray",2);const o=i.append("g").attr("id","plus").attr("fill-opacity",.3).attr("transform",`translate(${t[0]/2},${a/2})`).append("path").attr("d","m 5.3946396,1.8575e-4 c 0,-0.5977207 -0.6415104,-1.07903965 -1.4384715,-1.07903965 H 1.078854 v -2.876943 c 0,-0.7969611 -0.4813189,-1.4388425 -1.0790396,-1.4388425 -0.5977206,0 -1.078668,0.6418815 -1.078668,1.4388425 v 2.876943 h -2.8773145 c -0.7969611,0 -1.4384715,0.48131895 -1.4384715,1.07903965 0,0.5977206 0.6415104,1.07866755 1.4384715,1.07866755 h 2.8773145 v 2.8773148 c 0,0.7969609 0.4809474,1.4384713 1.078668,1.4384713 0.5977207,0 1.0790396,-0.6415104 1.0790396,-1.4384713 V 1.0788533 h 2.8773141 c 0.7969611,0 1.4384715,-0.48094695 1.4384715,-1.07866755 z"),s=i.append("g").attr("id","minus").attr("fill-opacity",.3).attr("transform",`translate(${t[0]/2},${1.5*a})`).append("path").attr("d","m -3.9574147,-1.0788543 h 7.9148294 c 0.767531,0 1.385435,0.48116901 1.385435,1.0788543 0,0.59768529 -0.617904,1.0788543 -1.385435,1.0788543 h -7.9148294 c -0.767531,0 -1.385435,-0.48116901 -1.385435,-1.0788543 0,-0.59768529 0.617904,-1.0788543 1.385435,-1.0788543 z"),l=i.append("g").attr("id","reset").attr("fill-opacity",.3).attr("transform",`translate(${t[0]/2},${2.5*a})`).append("path").attr("d","M -1.2940927,5.0777775 C -2.1684164,4.8314706 -3.2986963,4.0441048 -3.8430923,3.3020874 -4.6193793,2.2440057 -5.0578621,0.46159635 -4.6437431,0.04747726 c 0.4578187,-0.45781851 1.1277698,-0.19372689 1.1277698,0.44454944 0,0.8074783 0.4120423,1.7461873 1.0437767,2.3779217 C -0.24540433,5.0967408 3.4868355,3.5629027 3.4982525,0.41627457 3.5037957,-1.1038637 2.4692459,-2.4802179 1.0001263,-2.9073051 0.19813045,-3.1404538 -0.76260136,-3.0858393 -1.3593238,-2.7731864 l -0.3688394,0.1932514 0.5293829,0.085502 c 0.2911585,0.047005 0.61875041,0.1329827 0.72797943,0.191032 0.29382183,0.1561282 0.3156994,0.71991 0.0377042,0.9714962 -0.21116559,0.1911111 -0.41243343,0.201125 -1.69434973,0.084313 -1.962603,-0.1788514 -1.9446809,-0.1582157 -1.7693199,-2.0361648 0.1718494,-1.8401839 0.5119549,-2.3182208 1.1765397,-1.6536359 0.2143098,0.2143099 0.249689,0.3691038 0.1815992,0.7948485 l -0.084551,0.5287012 0.7756978,-0.3551263 c 1.47661618,-0.6760186 3.3900398,-0.4384785 4.7528368,0.590034 2.9090907,2.1955084 2.3838296,6.6728784 -0.9625575,8.204904 -0.890169,0.4075321 -2.29594186,0.5169037 -3.2368994,0.2518292 z");i.append("g").attr("id","buttonplus").append("rect").attr("x",0).attr("y",0).attr("height",t[1]/3).attr("width",t[0]).attr("opacity",0).style("cursor","pointer").on("mouseover",(e=>{o.attr("fill-opacity",.8)})).on("mouseout",(e=>{o.attr("fill-opacity",.3)})),i.append("g").attr("id","buttonminus").append("rect").attr("x",0).attr("y",a).attr("height",t[1]/3).attr("width",t[0]).attr("opacity",0).style("cursor","pointer").on("mouseover",(e=>{s.attr("fill-opacity",.8)})).on("mouseout",(e=>{s.attr("fill-opacity",.3)})),i.append("g").attr("id","buttonreset").append("rect").attr("x",0).attr("y",2*a).attr("height",t[1]/3).attr("width",t[0]).attr("opacity",0).style("cursor","pointer").on("mouseover",(e=>{l.attr("fill-opacity",.8)})).on("mouseout",(e=>{l.attr("fill-opacity",.3)}))}const d3$r=Object.assign({},{transition:transition,interpolate:interpolate,zoom:zoom,geoPath:geoPath,geoIdentity:geoIdentity,zoomTransform:zoomTransform,select:select});function zoomandpan(e){let t=d3$r.geoIdentity();const a=d3$r.geoPath(e.projection),r=d3$r.geoPath(t);function i(a){const r=Array.isArray(e.zoomable)?e.zoomable:[1,8],i=[e.width/2,e.height/2],o=d3$r.zoomTransform(e.node());if(o.k<=r[1]&&o.k>=r[0]){const l={...o};l.k=o.k*(1+.2*a),l.k=l.k<r[0]?r[0]:l.k,l.k=l.k>r[1]?r[1]:l.k;const n=[(i[0]-o.x)/o.k,(i[1]-o.y)/o.k];l.x+=i[0]-(n[0]*l.k+l.x),l.y+=i[1]-(n[1]*l.k+l.y),o.k=l.k,o.x=l.x,o.y=l.y,e.projection.scale(o.k*e.baseScale).translate([e.baseTranslate[0]*o.k+o.x,e.baseTranslate[1]*o.k+o.y]),t.scale(o.k).translate([o.x,o.y]),e.zoom={k:o.k,x:o.x,y:o.y},s(o)}}function o(){d3$r.zoomTransform(this).k=1,d3$r.zoomTransform(this).x=0,d3$r.zoomTransform(this).y=0,e.projection.scale(e.baseScale).translate(e.baseTranslate),t.scale(1).translate([0,0]),s({k:1,x:0,y:0})}function s(t){e.zoomablelayers.forEach((i=>{switch(i.mark){case"circle":i.zoom={k:t.k,x:t.x,y:t.y},circle(e,i);break;case"square":i.zoom={k:t.k,x:t.x,y:t.y},square$1(e,i);break;case"halfcircle":i.zoom={k:t.k,x:t.x,y:t.y},halfcircle(e,i);break;case"spike":i.zoom={k:t.k,x:t.x,y:t.y},spike(e,i);break;case"path":e.selectAll(`#${i.id} > path`).attr("d","svg"==i.coords?r:a);break;case"clippath":case"graticule":e.selectAll(`#${i.id} > path`).attr("d",a);break;case"text":i.zoom={k:t.k,x:t.x,y:t.y},text(e,i);break;case"outline":e.selectAll(`#${i.id} > path`).attr("d",a({type:"Sphere"}));break;case"tile":tile(e,i);break;case"scalebar":scalebar(e,i);break;case"north":north(e,i)}}))}e.control?(e.selectAll(`#${e.controlid}`).empty()&&zoompanel(e),e.select("#buttonplus").on("click",o).on("click",(e=>{i(1)})).on("dblclick",(e=>{e.stopPropagation()})),e.select("#buttonminus").on("click",o).on("click",(e=>{i(-1)})).on("dblclick",(e=>{e.stopPropagation()})),e.select("#buttonreset").on("click",o).on("dblclick",(e=>{e.stopPropagation()}))):e.on("click",o),e.call(d3$r.zoom().extent([[0,0],[e.width,e.height]]).scaleExtent(Array.isArray(e.zoomable)?e.zoomable:[1,8]).on("start",(()=>{e.select("#geoviztooltip").style("visibility","hidden")})).on("zoom",(function({transform:a}){e.projection.scale(a.k*e.baseScale).translate([e.baseTranslate[0]*a.k+a.x,e.baseTranslate[1]*a.k+a.y]),t.scale(a.k).translate([a.x,a.y]),e.zoom={k:a.k,x:a.x,y:a.y},s(a)})))}const d3$q=Object.assign({},geoScaleBar,{zoom:zoom,zoomIdentity:zoomIdentity,pointers:pointers,geoPath:geoPath,geoIdentity:geoIdentity,select:select,scaleLinear:scaleLinear,max:max});function zoomversor(e){function t(){e.zoomablelayers.forEach((t=>{const a=d3$q.geoPath(e.projection);switch(t.mark){case"circle":circle(e,t);break;case"square":square$1(e,t);break;case"halfcircle":halfcircle(e,t);break;case"spike":spike(e,t);break;case"path":case"clippath":case"graticule":e.selectAll(`#${t.id} > path`).attr("d",a);break;case"text":text(e,t);break;case"outline":e.selectAll(`#${t.id} > path`).attr("d",a({type:"Sphere"}));break;case"tile":tile(e,t);break;case"scalebar":scalebar(e,t);break;case"north":north(e,t)}}))}e.call(versorzoom(e.projection).on("zoom.render end.render",t)).call(t).node()}function versorzoom(e,{scale:t=(void 0===e._scale?e._scale=e.scale():e._scale),scaleExtent:a=[.8,8]}={}){let r,i,o,s,l;const n=d3$q.zoom().scaleExtent(a.map((e=>e*t))).on("start",d).on("zoom",(function(t){e.scale(t.transform.k);const a=c(t,this),l=versor.cartesian(e.rotate(o).invert(a)),n=versor.delta(r,l);let p=versor.multiply(i,n);if(a[2]){const e=(a[2]-s)/2,t=-Math.sin(e),r=Math.sign(Math.cos(e));p=versor.multiply([Math.sqrt(1-t*t),0,0,r*t],p)}e.rotate(versor.rotation(p)),n[0]<.7&&d.call(this,t)}));function c(e,t){const a=d3$q.pointers(e,t);return a.length!==l&&(l=a.length,l>1&&(s=Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0])),d.call(t,e)),l>1?[d3$q.mean(a,(e=>e[0])),d3$q.mean(a,(e=>e[1])),Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0])]:a[0]}function d(t){r=versor.cartesian(e.invert(c(t,this))),i=versor(o=e.rotate())}return Object.assign((t=>t.property("__zoom",d3$q.zoomIdentity.scale(e.scale())).call(n)),{on(e,...t){return t.length?(n.on(e,...t),this):n.on(e)}})}const d3$p=Object.assign({},{select:select,pointers:pointers});function render(e,{order:t=[]}={}){if(t.length>0&&(t=t.flat(),getDOMids(e).toString()!==t&&t.forEach((t=>{e.select(`${t}`).raise()}))),e.data&&"none"==e.initproj&&!e.domain&&e.warning&&e.warning_message.push("You must specify a projection and/or the domain in the SVG container"),"versor"==e.zoomable&&"none"==e.initproj&&e.warning&&e.warning_message.push("You must specify a projection tu use versor zooming"),e.warning&&e.warning_message.length>0){let t={fontSize:13,fill:"#594A2F",background:"#FDD66C",stroke:"#FDD66C",strokeWidth:1},a=e.append("g").attr("id","warningtooltip").attr("pointer-events","none").style("visibility","hidden").attr("transform","translate(30,10)");const r=e.warning_message.length*t.fontSize,i=e.width-80;a.append("g").attr("fill",t.background).attr("stroke",t.stroke).attr("stroke-width",t.strokeWidth).append("path").attr("d",`M0,0v${+r+5+20}h${i+20}v${-r-20}h${-i-15}z`).attr("transform","translate(-10,20)"),a.append("g").attr("font-size",`${t.fontSize}px`).attr("fill",t.fill).attr("font-family",t.fontFamily).attr("text-anchor","middle").attr("font-weight","bold").attr("transform",`translate(${(e.width-70)/2},45)`).selectAll("text").data(e.warning_message).join("text").attr("dy",((e,a)=>a*t.fontSize)).text((e=>e)),e.append("g").attr("font-size","15px").append("text").attr("x",10).attr("y",20).text("⚠️").on("touchmove mousemove",(function(e,t){d3$p.select(this).style("cursor","pointer"),a.style("visibility","visible")})).on("touchend mouseleave",(function(){a.style("visibility","hidden"),d3$p.select(this).style("cursor","default")}))}return e.zoomable&&("versor"==e.zoomable?zoomversor(e):zoomandpan(e)),e.versor,e.selectAll("#geoviztooltip").raise(),e.selectAll(`#${e.controlid}`).raise(),e.node()}const d3$o=Object.assign({},{geoPath:geoPath,geoNaturalEarth1:geoNaturalEarth1});function outline(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"outline",id:unique$1(),fill:"#B5DFFD",stroke:"none",strokeWidth:1},...a?e:t},i={projection:d3$o.geoNaturalEarth1()};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;if("none"==o.initproj&&o.warning&&(o.warning_message.push("Outline mark"),o.warning_message.push("You must define a projection function in the SVG container")),"none"!=o.initproj){let e=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(e.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]={mark:r.mark,id:r.id}}else o.zoomablelayers.push({mark:r.mark,id:r.id});Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id"].includes(e))).forEach((t=>{e.attr(camelcasetodash$1(t),r[t])}));let t=d3$o.geoPath(o.projection);return e.append("path").attr("d",t({type:"Sphere"})),a?render(o):`#${r.id}`}}const d3$n=Object.assign({},{geoPath:geoPath,geoGraticule:geoGraticule,geoNaturalEarth1:geoNaturalEarth1});function graticule(e,t){console.log(arguments.length);let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"graticule",id:unique$1(),step:10,fill:"none",stroke:"#9ad5e6",strokeWidth:.8,strokeLinecap:"square",strokeLinejoin:"round",strokeDasharray:2},...a?e:t},i={projection:d3$n.geoNaturalEarth1()};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;if("none"==o.initproj&&o.warning&&o.warning_message.push("You must define a projection function in the SVG container"),"none"!=o.initproj){let e=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(e.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]={mark:r.mark,id:r.id}}else o.zoomablelayers.push({mark:r.mark,id:r.id});Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","step"].includes(e))).forEach((t=>{e.attr(camelcasetodash$1(t),r[t])}));let t=d3$n.geoPath(o.projection);return e.append("path").datum(d3$n.geoGraticule().step(Array.isArray(r.step)?r.step:[r.step,r.step])).attr("d",t),a?render(o):`#${r.id}`}}const d3$m=Object.assign({},{geoPath:geoPath,geoIdentity:geoIdentity});function path(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;console.log(a),e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"path",id:unique$1(),coords:"geo",clip:!0,strokeWidth:1},...a?e:t},i={domain:r.data||r.datum};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;(r.data||r.datum)&&(o.data=!0);const s=random$1();r.data&&(2==implantation(r.data)?(r.fill=r.fill?r.fill:"none",r.stroke=r.stroke?r.stroke:s):(r.fill=r.fill?r.fill:s,r.stroke=r.stroke?r.stroke:"white")),r.datum&&(2==implantation(r.datum)?(r.fill=r.fill?r.fill:"none",r.stroke=r.stroke?r.stroke:s):(r.fill=r.fill?r.fill:s,r.stroke=r.stroke?r.stroke:"none"));let l=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);if(l.selectAll("*").remove(),o.zoomable&&!o.parent)if(o.zoomablelayers.map((e=>e.id)).includes(r.id)){let e=o.zoomablelayers.indexOf(o.zoomablelayers.find((e=>e.id==r.id)));o.zoomablelayers[e]={mark:r.mark,id:r.id,coords:r.coords}}else o.zoomablelayers.push({mark:r.mark,id:r.id,coords:r.coords});let n="svg"==r.coords?d3$m.geoIdentity().scale(o.zoom.k).translate([o.zoom.x,o.zoom.y]):o.projection,c=d3$m.geoPath(n);const d=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id","datum","data","coords","tip","tipstyle"].includes(e)));let p=propertiesentries(r.data||r.datum);const g=d.filter((e=>"value"==detectinput(r[e],p)));g.forEach((e=>{l.attr(camelcasetodash$1(e),r[e])}));const h=d.filter((e=>!g.includes(e)));if(h.forEach((e=>{r[e]=check(r[e],p)})),1==r.clip&&"svg"!=r.coords&&"none"!==o.initproj){const e=unique$1();o.zoomable&&!o.parent&&o.zoomablelayers.push({mark:"outline",id:e}),o.append("clipPath").attr("id",e).append("path").attr("d",c({type:"Sphere"})),l.attr("clip-path",`url(#${e})`)}if(r.datum&&l.append("path").datum(r.datum).attr("d",c),r.data&&(l.selectAll("path").data(r.data.features.filter((e=>null!==e.geometry))).join((e=>{let t=e.append("path").attr("d",c);return h.forEach((e=>{t.attr(camelcasetodash$1(e),r[e])})),t})),r.tip&&tooltip(l,r.data,o,r.tip,r.tipstyle,p,r.view),!r.tip&&r.view&&viewof(l,o)),o=Object.assign(o,{viewbox:getsize$1(l)}),a){const e=getsize$1(l);return o.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(o)}return`#${r.id}`}function header(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"header",id:unique$1(),text:"Map title",fill:"#9e9696",background_fill:"white",background_stroke:"white",background_strokeWidth:1,dominantBaseline:"central",textAnchor:"middle",lineSpacing:0,margin:8,fontSize:26,dx:0,dy:0},...a?e:t},i={};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;r.fontFamily=r.fontFamily||o.fontFamily;let s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);s.selectAll("*").remove();const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id"].includes(e))),n=s.append("text").attr("font-family",r.fontFamily).attr("font-size",r.fontSize).text(r.text.toString()),c=getsize$1(s).height,d=r.text.split("\n").length,p=c*d+(d-1)*r.lineSpacing+2*r.margin;n.remove(),o.height_header=Math.max(o.height_header,p);const g=s.append("rect").attr("x",0).attr("y",-p).attr("width",o.width).attr("height",p);l.filter((e=>e.includes("background_"))).forEach((e=>{g.attr(camelcasetodash$1(e.replace("background_","")),r[e])}));let h=o.width/2;switch(r.textAnchor){case"start":h=r.margin;break;case"end":h=o.width-r.margin}const u=s.selectAll("text").data(r.text.split("\n")).join("text").attr("x",h).attr("y",((e,t)=>t*(c+r.lineSpacing)-p+c/2+r.margin)).attr("dy",r.dy).text((e=>e));return l.filter((e=>!e.includes("background_"))).forEach((e=>{u.attr(camelcasetodash$1(e),r[e])})),o.attr("width",o.width).attr("height",o.height+o.height_header+o.height_footer).attr("viewBox",[0,-o.height_header,o.width,o.height+o.height_header+o.height_footer]),a?(o.attr("width",o.width).attr("height",p).attr("viewBox",[0,-p,o.width,p]),render(o)):`#${r.id}`}function footer(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r={...{mark:"footer",id:unique$1(),text:"Author, source...",fill:"#9e9696",background_fill:"white",background_stroke:"white",background_strokeWidth:1,dominantBaseline:"central",textAnchor:"middle",lineSpacing:0,margin:2,fontSize:10,dx:0,dy:0},...a?e:t},i={};Object.keys(r).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(i,{["svg_"==e.slice(0,4)?e.slice(4):e]:r[e]}),delete r[e]}));let o=a?create(i):e;r.fontFamily=r.fontFamily||o.fontFamily;let s=o.selectAll(`#${r.id}`).empty()?o.append("g").attr("id",r.id):o.select(`#${r.id}`);s.selectAll("*").remove();const l=Object.entries(r).map((e=>e[0])).filter((e=>!["mark","id"].includes(e))),n=s.append("text").attr("font-family",r.fontFamily).attr("font-size",r.fontSize).text(r.text.toString()),c=getsize$1(n).height,d=r.text.split("\n").length,p=c*d+(d-1)*r.lineSpacing+2*r.margin;n.remove(),o.height_footer=Math.max(o.height_footer,p);const g=s.append("rect").attr("x",0).attr("y",o.height).attr("width",o.width).attr("height",p);l.filter((e=>e.includes("background_"))).forEach((e=>{g.attr(camelcasetodash$1(e.replace("background_","")),r[e])}));let h=o.width/2;switch(r.textAnchor){case"start":h=r.margin;break;case"end":h=o.width-r.margin}const u=s.selectAll("text").data(r.text.split("\n")).join("text").attr("x",h).attr("y",((e,t)=>o.height+r.margin+t*(c+r.lineSpacing)+c/2)).attr("dy",r.dy).text((e=>e));return l.filter((e=>!e.includes("background_"))).forEach((e=>{u.attr(camelcasetodash$1(e),r[e])})),o.attr("width",o.width).attr("height",o.height+o.height_header+o.height_footer).attr("viewBox",[0,-o.height_header,o.width,o.height+o.height_header+o.height_footer]),a?(o.attr("width",o.width).attr("height",p).attr("viewBox",[0,o.height,o.width,p]),render(o)):`#${r.id}`}const d3$l=Object.assign({},{geoPath:geoPath});function clipPath(e,{id:t=unique$1(),datum:a={type:"Sphere"},permanent:r=!1}={}){let i=e.append("g");if(e.zoomable&&!e.parent&&0==r)if(e.zoomablelayers.map((e=>e.id)).includes(t)){let a=e.zoomablelayers.indexOf(e.zoomablelayers.find((e=>e.id==t)));e.zoomablelayers[a]={mark:"clippath",id:t}}else e.zoomablelayers.push({mark:"clippath",id:t});return i.append("clipPath").attr("id",t).append("path").datum(a).attr("d",d3$l.geoPath(e.projection)),`url(#${t})`}function blur(e,{id:t=unique$1(),stdDeviation:a=1.5}={}){let r=e.select("#defs");return r.select(`#${t}`).remove(),r.append("defs").append("filter").attr("id",t).append("feGaussianBlur").attr("stdDeviation",a),`url(#${t})`}function shadow(e,{id:t=unique$1(),stdDeviation:a=1.5,dx:r=4,dy:i=4,fill:o="black",fillOpacity:s=.5,opacity:l}={}){let n=e.select("#defs");return n.select(`#${t}`).remove(),n.append("defs").append("filter").attr("id",t).append("feDropShadow").attr("dx",r).attr("dy",i).attr("stdDeviation",a).attr("flood-color",o).attr("flood-opacity",l||s).append("feGaussianBlur"),`url(#${t})`}function radialGradient(e,{id:t=unique$1(),color1:a="#63b0af",color2:r="#428c8b",offset1:i=50,offset2:o=100,fx:s=50,fy:l=50}={}){let n=e.select("#defs");n.select(`#${t}`).remove();let c=n.append("radialGradient").attr("id",t).attr("fx",`${s}%`).attr("fy",`${l}%`);return c.append("stop").attr("offset",`${i}%`).attr("stop-color",a),c.append("stop").attr("offset",`${o}%`).attr("stop-color",r),`url(#${t})`}function camelcasetodash(e,t=""){return e.split(/(?=[A-Z])/).map((e=>e.toLowerCase())).join("-").replace(t+"_","")}function isNumber(e){return null!==e&&""!==e&&"boolean"!=typeof e&&isFinite(e)}function roundarray(e,t){return[floor(e[0],t),e.slice(1,-1).map((e=>round(e,t))),ceil(e[e.length-1],t)].flat()}function round(e,t){const a=Math.pow(10,t),r=e*a*(1+Number.EPSILON);return Math.round(r)/a}function floor(e,t){const a=Math.pow(10,t),r=e*a*(1+Math.sign(e)*Number.EPSILON);return Math.floor(r)/a}function ceil(e,t){const a=Math.pow(10,t),r=e*a*(1-Math.sign(e)*Number.EPSILON);return Math.ceil(r)/a}const d3$k=Object.assign({},{min:min,max:max,scaleSqrt:scaleSqrt,ascending:ascending});function datatoradius(e,{nb:t=4,k:a=50,round:r=2,fixmax:i=null,factor:o=1}={}){let s=e.filter((e=>isNumber(e))).map((e=>Math.abs(e))).sort(d3$k.ascending);const l=null!=i?i:d3$k.max(s);let n=d3$k.scaleSqrt([0,l],[0,a]),c=[];if(s.length!=t&&null!=t){let e=n(d3$k.min(s)),a=n(d3$k.max(s)),r=a-e;if(t>2)for(let a=1;a<=t-2;a++)c.push(e+a*r/(t-1));c=[e,c,a].flat()}else c=s.map((e=>n(e)));let d=c.map((e=>n.invert(e)));return d[0]=d3$k.min(s),d[d.length-1]=d3$k.max(s),d=roundarray(d.map((e=>e*o)),r),d.map(((e,t)=>[e,c[t]]))}const d3$j=Object.assign({},{create:create$1});function getsize(e){const t=e.clone(!0),a=d3$j.create("svg");a.node().appendChild(t.node()),document.body.appendChild(a.node());const{x:r,y:i,width:o,height:s}=t.node().getBBox();return document.body.removeChild(a.node()),{x:r,y:i,width:o,height:s}}function mergeoptions(e,t){return Object.keys(e).forEach((a=>{void 0!==t[a]&&(e[a]=t[a])})),Object.keys(t).forEach((a=>{e[a]=t[a]})),e}function unique(){let e="";const t="abcdefghijklmnopqrstuvwxyz";for(let a=0;a<15;a++)e+=t.charAt(Math.floor(26*Math.random()));return e}function manageoptions(e,t,a){return{...{mark:"legend",id:unique(),pos:[0,0],gap:2,title:"Legend",title_fill:"#363636",title_fontSize:16,title_fontWeight:"bold",title_fontFamily:a,subtitle_fill:"#363636",subtitle_fontSize:12,subtitle_fontFamily:a,note_fill:"#363636",note_fontSize:10,note_fontStyle:"italic",note_fontFamily:a,values_fill:"#363636",values_fontSize:10,values_fontFamily:a,values_round:2,values_decimal:".",values_thousands:" ",values_dx:5,values_dy:0,values_dominantBaseline:"central",top_values_fill:"#363636",top_values_fontSize:10,top_values_fontFamily:a,top_values_round:2,top_values_decimal:".",top_values_thousands:" ",top_values_dx:5,top_values_dy:0,top_values_dominantBaseline:"central",top_title_fill:"#363636",top_title_fontSize:12,top_title_fontFamily:a,top_title_textAnchor:"middle",top_title_dominantBaseline:"hanging",bottom_title_fill:"#363636",bottom_title_fontSize:12,bottom_title_fontFamily:a,bottom_title_textAnchor:"middle",bottom_title_dominantBaseline:"hanging",bottom_values_fill:"#363636",bottom_values_fontSize:10,bottom_values_fontFamily:a,bottom_values_round:2,bottom_values_decimal:".",bottom_values_thousands:" ",bottom_values_dx:5,bottom_values_dy:0,bottom_values_dominantBaseline:"central",label_fill:"#363636",label_fontSize:10,label_dx:5,label_dominantBaseline:"central",label_fontFamily:a,rect_width:25,rect_height:17,rect_dx:0,rect_dy:0,rect_stroke:"#303030",rect_strokeWidth:.1,rect_spacing:0,spike_width:10,spike_dx:0,spike_dy:0,spike_spacing:3,spike_fill:"none",spike_stroke:"black",line_fill:"none",line_stroke:"#363636",line_strokeDasharray:2,line_strokeWidth:.7,line_length:10,circle_dx:0,circle_dy:0,circle_fill:"none",circle_stroke:"#363636",circle_spacing:5,square_dx:0,square_dy:0,square_fill:"none",square_stroke:"#363636",square_spacing:5,top_circle_dx:0,top_circle_dy:0,top_circle_fill:"none",top_circle_stroke:"#363636",top_circle_spacing:5,bottom_circle_dx:0,bottom_circle_dy:0,bottom_circle_fill:"none",bottom_circle_stroke:"#363636",bottom_circle_spacing:5,missing:!0,missing_fill:"white",missing_text:"no data",frame:!1,frame_fill:"white",frame_fillOpacity:.5,frame_margin:15,frame_stroke:"black"},...e,...t}}function addTitle(e,t){if(t.title){const a=Object.assign(subsetobj(t,{prefix:"title_"}),subsetobj(t,{prefix:"text_"}));a.text=t.title,a.pos=t.pos,addText(e,a)}}function addSubtitle(e,t){if(t.subtitle){const a=getsize(e),r=Object.assign(subsetobj(t,{prefix:"subtitle_"}),subsetobj(t,{prefix:"text_"}));r.text=t.subtitle,r.pos=[t.pos[0],0==a.height?t.pos[1]:a.y+a.height+t.gap],addText(e,r)}}function addNote(e,t){if(t.note){const a=getsize(e),r=Object.assign(subsetobj(t,{prefix:"note_"}),subsetobj(t,{prefix:"text_"}));r.text=t.note,r.dy=void 0!==r.dy?r.dy:5,r.pos=[t.pos[0],0==a.height?t.pos[1]:a.y+a.height+t.gap],addText(e,r)}}function addFrame(e,t){if(t.frame){const a=subsetobj(t,{prefix:"frame_"}),r=getsize(e),i=e.append("rect").attr("x",r.x-a.margin).attr("y",r.y-a.margin).attr("width",r.width+2*a.margin).attr("height",r.height+2*a.margin).lower();Object.entries(a).forEach((e=>i.attr(camelcasetodash(e[0]),e[1])))}}function addText(e,t){t=mergeoptions({dx:0,dy:0,dominantBaseline:"hanging",textAnchor:"start",lineSpacing:0,fontSize:10},t);let a=e.append("g");Object.entries(t).forEach((e=>a.attr(camelcasetodash(e[0]),e[1])));let r={...t.pos};if(r[0]=r[0]+t.dx,r[1]=r[1]+t.dy,1==t.text.split("\n").length)a.append("text").attr("x",r[0]).attr("y",r[1]).text(t.text);else{let e=0;switch(t.dominantBaseline){case"hanging":default:e=0;break;case"middle":case"central":e=(t.text.split("\n").length-1)*t.fontSize,e/=2;break;case"auto":case"text-top":e=(t.text.split("\n").length-1)*t.fontSize}a.selectAll("text").data(t.text.split("\n")).join("text").attr("x",r[0]).attr("y",((a,i)=>r[1]+i*(t.fontSize+t.lineSpacing)-e)).text((e=>e))}}function subsetobj(e,{prefix:t,exclude:a=null}={}){let r={};return Object.entries(e).map((e=>e[0])).filter((e=>e.includes(t))).filter((e=>!e.includes(a))).forEach((a=>Object.assign(r,{[a.replace(t,"")]:e[a]}))),r}const d3$i=Object.assign({},{formatLocale:formatLocale});function circles_nested(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,values_dx:2,values_dominantBaseline:"middle"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoradius(i.data,{nb:i.nb,factor:i.values_factor,round:i.values_round,fixmax:i.fixmax,k:i.k}),l=s[s.length-1][1],n=o.append("g"),c=getsize(o),d=n.selectAll("circle").data(s.reverse()).join("circle").attr("r",(e=>e[1])).attr("transform",(e=>`translate(${i.pos[0]+l+i.circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+c.height+2*l-e[1]})`)),p=subsetobj(i,{prefix:"circle_",exclude:["dx","dy"]});Object.entries(p).forEach((e=>d.attr(camelcasetodash(e[0]),e[1])));let g=n.selectAll("line").data(s).join("line").attr("x1",i.pos[0]+l+i.circle_dx).attr("x2",i.pos[0]+l+l+i.line_length+i.circle_dx).attr("y1",(e=>i.pos[1]+i.circle_dy+i.gap+c.height+2*l-2*e[1])).attr("y2",(e=>i.pos[1]+i.circle_dy+i.gap+c.height+2*l-2*e[1])),h=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(h).forEach((e=>g.attr(camelcasetodash(e[0]),e[1])));let u=d3$i.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),m=n.selectAll("text").data(s).join("text").attr("x",i.pos[0]+l+l+i.line_length+i.circle_dx+i.values_dx).attr("y",(e=>i.pos[1]+i.circle_dy+i.gap+c.height+2*l-2*e[1])).text((e=>u.format(",")(e[0]))),f=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(f).forEach((e=>m.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$h=Object.assign({},{formatLocale:formatLocale,sum:sum,cumsum:cumsum});function circles(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e,i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,values_dx:2,values_dominantBaseline:"middle"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoradius(i.data,{nb:i.nb,factor:i.values_factor,round:i.values_round,fixmax:i.fixmax,k:i.k}).slice().reverse(),l=s[0][1],n=d3$h.cumsum(s.map((e=>2*e[1]))),c=o.append("g"),d=getsize(o),p=c.selectAll("circle").data(s).join("circle").attr("r",(e=>e[1])).attr("transform",((e,t)=>`translate(${i.pos[0]+l+i.circle_dx}, ${i.pos[1]+d.height+i.circle_dy+i.gap-e[1]+n[t]+t*i.circle_spacing} )`)),g=subsetobj(i,{prefix:"circle_",exclude:["dx","dy"]});Object.entries(g).forEach((e=>p.attr(camelcasetodash(e[0]),e[1])));let h=c.selectAll("line").data(s).join("line").attr("x1",(e=>i.pos[0]+l+e[1]+i.circle_dx)).attr("x2",i.pos[0]+2*l+i.line_length+i.circle_dx).attr("y1",((e,t)=>i.pos[1]+d.height+i.circle_dy+i.gap-e[1]+n[t]+t*i.circle_spacing)).attr("y2",((e,t)=>i.pos[1]+d.height+i.circle_dy+i.gap-e[1]+n[t]+t*i.circle_spacing)),u=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(u).forEach((e=>h.attr(camelcasetodash(e[0]),e[1])));let m=d3$h.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),f=c.selectAll("text").data(s).join("text").attr("x",i.pos[0]+2*l+i.line_length+i.values_dx+i.circle_dx).attr("y",((e,t)=>i.pos[1]+d.height+i.circle_dy+i.gap-e[1]+n[t]+t*i.circle_spacing)).text((e=>m.format(",")(e[0]))),y=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(y).forEach((e=>f.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$g=Object.assign({},{formatLocale:formatLocale,sum:sum,cumsum:cumsum});function squares(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e,i=manageoptions({data:[1,1e3],k:100,fixmax:null,nb:4,values_dx:2,values_dominantBaseline:"middle"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoradius(i.data,{nb:i.nb,factor:i.values_factor,round:i.values_round,fixmax:i.fixmax,k:i.k}).slice().reverse(),l=s[0][1],n=d3$g.cumsum(s.map((e=>e[1]))),c=o.append("g"),d=getsize(o),p=c.selectAll("rect").data(s).join("rect").attr("x",0).attr("x",0).attr("height",(e=>e[1])).attr("width",(e=>e[1])).attr("transform",((e,t)=>`translate(${i.pos[0]+l/2-e[1]/2+i.square_dx}, ${i.pos[1]+d.height+i.square_dy+i.gap-e[1]+n[t]+t*i.square_spacing} )`)),g=subsetobj(i,{prefix:"square_",exclude:["dx","dy"]});Object.entries(g).forEach((e=>p.attr(camelcasetodash(e[0]),e[1])));let h=c.selectAll("line").data(s).join("line").attr("x1",(e=>i.pos[0]+l/2+e[1]/2+i.square_dx)).attr("x2",i.pos[0]+l+i.line_length+i.square_dx).attr("y1",((e,t)=>i.pos[1]+d.height+i.square_dy+i.gap-e[1]/2+n[t]+t*i.square_spacing)).attr("y2",((e,t)=>i.pos[1]+d.height+i.square_dy+i.gap-e[1]/2+n[t]+t*i.square_spacing)),u=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(u).forEach((e=>h.attr(camelcasetodash(e[0]),e[1])));let m=d3$g.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),f=c.selectAll("text").data(s).join("text").attr("x",i.pos[0]+l+i.line_length+i.square_dx+i.values_dx).attr("y",((e,t)=>i.pos[1]+d.height+i.square_dy+i.gap-e[1]/2+n[t]+t*i.square_spacing)).text((e=>m.format(",")(e[0]))),y=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(y).forEach((e=>f.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$f=Object.assign({},{formatLocale:formatLocale});function squares_nested(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,values_dx:2,values_dominantBaseline:"middle"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoradius(i.data,{nb:i.nb,factor:i.values_factor,round:i.values_round,fixmax:i.fixmax,k:i.k}),l=s[s.length-1][1],n=o.append("g"),c=getsize(o),d=n.selectAll("rect").data(s.reverse()).join("rect").attr("x",0).attr("x",0).attr("height",(e=>2*e[1])).attr("width",(e=>2*e[1])).attr("transform",(e=>`translate(${i.pos[0]+i.square_dx+2*l-2*e[1]}, ${i.pos[1]+i.square_dy+i.gap+c.height+2*l-2*e[1]})`)),p=subsetobj(i,{prefix:"square_",exclude:["dx","dy"]});Object.entries(p).forEach((e=>d.attr(camelcasetodash(e[0]),e[1])));let g=n.selectAll("line").data(s).join("line").attr("x1",i.pos[0]+2*l+i.square_dx).attr("x2",i.pos[0]+2*l+i.line_length+i.square_dx).attr("y1",(e=>i.pos[1]+i.square_dy+i.gap+c.height+2*l-2*e[1])).attr("y2",(e=>i.pos[1]+i.square_dy+i.gap+c.height+2*l-2*e[1])),h=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(h).forEach((e=>g.attr(camelcasetodash(e[0]),e[1])));let u=d3$f.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),m=n.selectAll("text").data(s).join("text").attr("x",i.pos[0]+l+l+i.line_length+i.square_dx+i.values_dx).attr("y",(e=>i.pos[1]+i.square_dy+i.gap+c.height+2*l-2*e[1])).text((e=>u.format(",")(e[0]))),f=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(f).forEach((e=>m.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$e=Object.assign({},{formatLocale:formatLocale,arc:arc});function circles_half(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({data:[30,1e3],k:50,fixmax:null,nb:4,circle_cornerRadius:5,values_dx:2,values_dominantBaseline:"middle"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoradius(i.data,{nb:i.nb,factor:i.values_factor,round:i.values_round,fixmax:i.fixmax,k:i.k}),l=s[s.length-1][1],n=o.append("g"),c=getsize(o),d=n.selectAll("path").data(s.reverse()).join("path").attr("d",(e=>d3$e.arc().outerRadius(e[1]).innerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(i.circle_cornerRadius)())).attr("transform",(e=>`translate(${i.pos[0]+l+i.circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+c.height+l+i.values_fontSize/2})`)),p=subsetobj(i,{prefix:"circle_",exclude:["dx","dy"]});Object.entries(p).forEach((e=>d.attr(camelcasetodash(e[0]),e[1])));let g=n.selectAll("line").data(s).join("line").attr("x1",i.pos[0]+l+i.circle_dx).attr("x2",i.pos[0]+l+l+i.line_length+i.circle_dx).attr("y1",(e=>i.pos[1]+i.circle_dy+i.gap+c.height+l-e[1]+i.values_fontSize/2)).attr("y2",(e=>i.pos[1]+i.circle_dy+i.gap+c.height+l-e[1]+i.values_fontSize/2)),h=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(h).forEach((e=>g.attr(camelcasetodash(e[0]),e[1])));let u=d3$e.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),m=n.selectAll("text").data(s).join("text").attr("x",i.pos[0]+l+l+i.line_length+i.circle_dx+i.values_dx).attr("y",(e=>i.pos[1]+i.circle_dy+i.gap+c.height+l-e[1]+i.values_fontSize/2)).text((e=>u.format(",")(e[0]))),f=subsetobj(i,{prefix:"values_",exclude:["dx","dy"]});if(Object.entries(f).forEach((e=>m.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$d=Object.assign({},{min:min,max:max,ascending:ascending,scaleLinear:scaleLinear});function datatoheight(e,{nb:t=4,k:a=50,round:r=2,fixmax:i=null,factor:o=1}={}){let s=e.filter((e=>isNumber(e))).map((e=>Math.abs(e))).sort(d3$d.ascending);const l=null!=i?i:d3$d.max(s);let n=d3$d.scaleLinear().domain([0,l]).range([0,a]),c=[];if(s.length!=t&&null!=t){let e=n(d3$d.min(s)),a=n(d3$d.max(s)),r=a-e;if(t>2)for(let a=1;a<=t-2;a++)c.push(e+a*r/(t-1));c=[e,c,a].flat()}else c=s.map((e=>n(e)));let d=c.map((e=>n.invert(e)));return d[0]=d3$d.min(s),d[d.length-1]=d3$d.max(s),d=roundarray(d.map((e=>e*o)),r),d.map(((e,t)=>[e,c[t]]))}const d3$c=Object.assign({},{formatLocale:formatLocale,sum:sum,cumsum:cumsum});function spikes(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({data:[1,1e3],k:50,fixmax:null,nb:4,spike_width:30,spike_straight:0,values_dx:0,values_dy:0,values_dominantBaseline:"middle"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoheight(i.data,{nb:i.nb,round:i.values_round,factor:i.values_factor,fixmax:i.fixmax,k:i.k}).slice().reverse(),l=s[0][1],n=o.append("g"),c=getsize(o),d=n.selectAll("path").data(s).join("path").attr("d",(e=>`m ${0-i.spike_width/2},0 Q 0,${0-e[1]*i.spike_straight},0 ${0-e[1]}\n   Q 0, ${0-e[1]*i.spike_straight} ${0+i.spike_width/2},0`)).attr("transform",((e,t)=>`translate(${i.spike_width/2+i.pos[0]+i.spike_dx+ +i.spike_width*t+t*i.spike_spacing},${i.pos[1]+c.height+i.spike_dy+l+i.gap})`)),p=subsetobj(i,{prefix:"spike_",exclude:["dx","dy"]});Object.entries(p).forEach((e=>d.attr(camelcasetodash(e[0]),e[1]))),c=getsize(o);let g=d3$c.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),h=n.selectAll("text").data(s).join("text").text((e=>g.format(",")(e[0]))).attr("transform",((e,t)=>`translate (${i.pos[0]+i.spike_dx+i.spike_width/2+i.spike_width*t+t*i.spike_spacing} ${i.pos[1]+c.height+i.spike_dy}) rotate(90)`)),u=subsetobj(i,{prefix:"values_"});if(Object.entries(u).forEach((e=>h.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$b=Object.assign({},{formatLocale:formatLocale,arc:arc});function mushrooms(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({top_data:[30,1e3],top_k:50,top_title:"top_title",top_fixmax:null,top_nb:4,top_circle_cornerRadius:5,top_values_dx:2,top_values_dominantBaseline:"middle",top_values_textAnchor:"start",bottom_data:[30,1e3],bottom_k:50,bottom_title:"bottom_title",bottom_fixmax:null,bottom_nb:4,bottom_circle_cornerRadius:5,bottom_values_dx:2,bottom_values_dominantBaseline:"middle",bottom_values_textAnchor:"start"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=datatoradius(i.top_data,{nb:i.top_nb,factor:i.top_values_factor,round:i.top_values_round,fixmax:i.top_fixmax,k:i.top_k}),l=datatoradius(i.bottom_data,{nb:i.bottom_nb,factor:i.bottom_values_factor,round:i.bottom_values_round,fixmax:i.bottom_fixmax,k:i.bottom_k}),n=s[s.length-1][1],c=l[l.length-1][1],d=Math.max(n,c),p=o.append("g"),g=getsize(o),h=p.selectAll("path").data(s.reverse()).join("path").attr("d",(e=>d3$b.arc().outerRadius(e[1]).innerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2).cornerRadius(i.top_circle_cornerRadius)())).attr("transform",(e=>`translate(${i.pos[0]+d+i.top_circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+i.top_values_fontSize/2+g.height+n})`)),u=subsetobj(i,{prefix:"top_circle_",exclude:["dx","dy"]});Object.entries(u).forEach((e=>h.attr(camelcasetodash(e[0]),e[1])));let m=p.selectAll("line").data(s).join("line").attr("x1",i.pos[0]+d+i.top_circle_dx).attr("x2",i.pos[0]+d+d+i.line_length+i.top_circle_dx).attr("y1",(e=>i.pos[1]+i.top_circle_dy+i.gap+g.height+n-e[1]+i.top_values_fontSize/2)).attr("y2",(e=>i.pos[1]+i.top_circle_dy+i.gap+g.height+n-e[1]+i.top_values_fontSize/2)),f=subsetobj(i,{prefix:"line_",exclude:["dx","dy"]});Object.entries(f).forEach((e=>m.attr(camelcasetodash(e[0]),e[1])));let y=d3$b.formatLocale({decimal:i.top_values_decimal,thousands:i.top_values_thousands,grouping:[3]}),_=p.selectAll("text").data(s).join("text").attr("x",i.pos[0]+d+d+i.line_length+i.top_circle_dx+i.top_values_dx).attr("y",(e=>i.pos[1]+i.top_circle_dy+i.gap+g.height+n-e[1]+i.top_values_fontSize/2)).text((e=>y.format(",")(e[0]))),x=subsetobj(i,{prefix:"top_values_",exclude:["dx","dy"]});Object.entries(x).forEach((e=>_.attr(camelcasetodash(e[0]),e[1]))),g=getsize(o);let b=p.append("text").attr("x",i.pos[0]+d).attr("y",i.pos[1]+g.height+i.gap).text(i.top_title),v=subsetobj(i,{prefix:"top_title_",exclude:["dx","dy"]});Object.entries(v).forEach((e=>b.attr(camelcasetodash(e[0]),e[1]))),g=getsize(o);let $=p.append("text").attr("x",i.pos[0]+d).attr("y",i.pos[1]+g.height+i.gap).text(i.bottom_title),k=subsetobj(i,{prefix:"bottom_title_",exclude:["dx","dy"]});Object.entries(k).forEach((e=>$.attr(camelcasetodash(e[0]),e[1])));const j=o.append("g");g=getsize(o);let w=j.selectAll("path").data(l.reverse()).join("path").attr("d",(e=>d3$b.arc().outerRadius(e[1]).innerRadius(0).startAngle(.5*Math.PI).endAngle(1.5*Math.PI).cornerRadius(i.bottom_circle_cornerRadius)())).attr("transform",(e=>`translate(${i.pos[0]+d+i.bottom_circle_dx}, ${i.pos[1]+i.circle_dy+i.gap+g.height})`)),z=subsetobj(i,{prefix:"bottom_circle_",exclude:["dx","dy"]});Object.entries(z).forEach((e=>w.attr(camelcasetodash(e[0]),e[1])));let O=j.selectAll("line").data(l).join("line").attr("x1",i.pos[0]+d+i.bottom_circle_dx).attr("x2",i.pos[0]+d+d+i.line_length+i.bottom_circle_dx).attr("y1",(e=>i.pos[1]+i.bottom_circle_dy+i.gap+g.height+e[1])).attr("y2",(e=>i.pos[1]+i.bottom_circle_dy+i.gap+g.height+e[1]));Object.entries(f).forEach((e=>O.attr(camelcasetodash(e[0]),e[1])));let A=d3$b.formatLocale({decimal:i.bottom_values_decimal,thousands:i.bottom_values_thousands,grouping:[3]}),S=j.selectAll("text").data(l).join("text").attr("x",i.pos[0]+d+d+i.line_length+i.bottom_circle_dx+i.bottom_values_dx).attr("y",(e=>i.pos[1]+i.bottom_circle_dy+i.gap+g.height+e[1])).text((e=>A.format(",")(e[0]))),E=subsetobj(i,{prefix:"bottom_values_",exclude:["dx","dy"]});if(Object.entries(E).forEach((e=>S.attr(camelcasetodash(e[0]),e[1]))),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$a=Object.assign({},{formatLocale:formatLocale});function choro_vertical(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({breaks:[1,2,3,4,5],colors:["#fee5d9","#fcae91","#fb6a4a","#cb181d"]},a?e:t,r.fontFamily);i.breaks=i.breaks.map((e=>e*(i.values_factor||1)));let o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=d3$a.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),l=o.append("g"),n=getsize(o);const c=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));Object.entries(c).forEach((e=>l.attr(camelcasetodash(e[0]),e[1]))),l.selectAll("text").data(i.reverse?roundarray(i.breaks,i.values_round):roundarray(i.breaks.slice().reverse(),i.values_round)).join("text").attr("x",i.pos[0]+i.rect_width+i.values_dx).attr("y",((e,t)=>i.pos[1]+i.values_fontSize/2+n.height+i.gap+i.values_dy+t*(i.rect_height+i.rect_spacing))).text((e=>s.format(",")(e)));let d=o.append("g"),p=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(p).forEach((e=>d.attr(camelcasetodash(e[0]),e[1])));let g=i.pos[1]+n.height+i.gap+i.rect_dy,h=i.pos[0]+i.rect_dx;if(d.selectAll("rect").data(i.reverse?i.colors:i.colors.slice().reverse()).join("rect").attr("x",h).attr("y",((e,t)=>g+i.rect_spacing/2+i.values_fontSize/2+t*(i.rect_height+i.rect_spacing))).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill",(e=>e)),i.missing){let e=o.append("g"),t=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=t.y+t.height+i.gap+a.dy+Math.max(i.gap,i.rect_spacing);let r=e.append("rect");Object.entries(a).forEach((e=>r.attr(camelcasetodash(e[0]),e[1]))),c.text=i.missing_text,c.pos=[i.pos[0]+i.rect_width,t.y+t.height+i.gap+a.dy+a.height/2+Math.max(i.gap,i.rect_spacing)],addText(e,c)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$9=Object.assign({},{formatLocale:formatLocale});function choro_horizontal(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({title:"Legend",breaks:[1,2,3,4,5],colors:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],values_textAnchor:"middle",values_dx:0,values_dy:5,rect_width:50,rect_height:14},a?e:t,r.fontFamily);i.breaks=i.breaks.map((e=>e*(i.values_factor||1)));let o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i);let s=d3$9.formatLocale({decimal:i.values_decimal,thousands:i.values_thousands,grouping:[3]}),l=o.append("g"),n=getsize(o);const c=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));Object.entries(c).forEach((e=>l.attr(camelcasetodash(e[0]),e[1])));let d=o.append("g"),p=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(p).forEach((e=>d.attr(camelcasetodash(e[0]),e[1])));let g=i.pos[1]+n.height+i.gap+i.rect_dy,h=i.pos[0]+i.rect_dx;if(d.selectAll("rect").data(i.reverse?i.colors.slice().reverse():i.colors).join("rect").attr("x",((e,t)=>h+t*(i.rect_spacing+i.rect_width))).attr("y",g).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill","red").attr("fill",(e=>e)),n=getsize(o),l.selectAll("text").data(i.reverse?roundarray(i.breaks.slice().reverse(),i.values_round):roundarray(i.breaks,i.values_round)).join("text").attr("x",((e,t)=>i.pos[0]+t*(i.rect_width+i.rect_spacing)+i.values_dx)).attr("y",i.pos[1]+n.height+i.gap+i.values_dy).text((e=>s.format(",")(e))),i.missing){let e=o.append("g"),t=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=t.y+t.height+i.gap+a.dy+i.gap;let r=e.append("rect");Object.entries(a).forEach((e=>r.attr(camelcasetodash(e[0]),e[1]))),c.text=i.missing_text,c.dx=5,c.dy=0,c.textAnchor="start",c.pos=[i.pos[0]+i.rect_width,t.y+t.height+i.gap+a.dy+a.height/2+i.gap],addText(e,c)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}function typo_vertical(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({types:["A","B","C","D"],colors:["#e41a1c","#377eb8","#4daf4a","#984ea3"],alphabetical:!0,rect_spacing:3},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i),i.alphabetical){let e=i.types.map(((e,t)=>[e,i.colors[t]])).sort();i.types=e.map((e=>e[0])),i.colors=e.map((e=>e[1]))}let s=getsize(o),l=o.append("g"),n=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(n).forEach((e=>l.attr(camelcasetodash(e[0]),e[1])));let c=i.pos[1]+s.height+i.gap+i.rect_dy,d=i.pos[0]+i.rect_dx;l.selectAll("rect").data(i.colors).join("rect").attr("x",d).attr("y",((e,t)=>c+i.rect_spacing/2+t*(i.rect_height+i.rect_spacing))).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill",(e=>e));let p=o.append("g");const g=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));if(Object.entries(g).forEach((e=>p.attr(camelcasetodash(e[0]),e[1]))),p.selectAll("text").data(i.types).join("text").attr("x",d+i.rect_width+i.values_dx).attr("y",((e,t)=>c+i.rect_spacing/2+t*(i.rect_height+i.rect_spacing)+i.rect_height/2)).text((e=>e)),i.missing){let e=o.append("g"),t=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=t.y+t.height+i.gap+a.dy+Math.max(i.gap,i.rect_spacing);let r=e.append("rect");Object.entries(a).forEach((e=>r.attr(camelcasetodash(e[0]),e[1]))),g.text=i.missing_text,g.pos=[i.pos[0]+i.rect_width,t.y+t.height+i.gap+a.dy+a.height/2+Math.max(i.gap,i.rect_spacing)],addText(e,g)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}function typo_horizontal(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({types:["A","B","C","D"],colors:["#e41a1c","#377eb8","#4daf4a","#984ea3"],alphabetical:!0,values_dx:0,values_dy:5,values_textAnchor:"middle",rect_spacing:3,rect_width:50,rect_height:14},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);if(o.selectAll("*").remove(),addTitle(o,i),addSubtitle(o,i),i.alphabetical){let e=i.types.map(((e,t)=>[e,i.colors[t]])).sort();i.types=e.map((e=>e[0])),i.colors=e.map((e=>e[1]))}let s=getsize(o),l=o.append("g"),n=subsetobj(i,{prefix:"rect_",exclude:["fill","width","height","spacing"]});Object.entries(n).forEach((e=>l.attr(camelcasetodash(e[0]),e[1])));let c=i.pos[1]+s.height+i.gap+i.rect_dy,d=i.pos[0]+i.rect_dx;l.selectAll("rect").data(i.colors).join("rect").attr("x",((e,t)=>d+t*(i.rect_spacing+i.rect_width))).attr("y",c).attr("width",i.rect_width).attr("height",i.rect_height).attr("fill","red").attr("fill",(e=>e));let p=o.append("g");const g=Object.assign(subsetobj(i,{prefix:"values_"}),subsetobj(i,{prefix:"text_"}));if(Object.entries(g).forEach((e=>p.attr(camelcasetodash(e[0]),e[1]))),s=getsize(o),p.selectAll("text").data(i.types).join("text").attr("x",((e,t)=>d+t*(i.rect_spacing+i.rect_width)+i.rect_width/2)).attr("y",i.pos[1]+s.height+i.gap+i.values_dy).text((e=>e)),i.missing){let e=o.append("g"),t=getsize(o),a=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});a.fill=i.missing_fill,a.x=i.pos[0]+a.dx,a.y=t.y+t.height+i.gap+a.dy+Math.max(i.gap,i.rect_spacing);let r=e.append("rect");Object.entries(a).forEach((e=>r.attr(camelcasetodash(e[0]),e[1]))),g.text=i.missing_text,g.dx=5,g.dy=0,g.textAnchor="start",g.pos=[i.pos[0]+i.rect_width,t.y+t.height+i.gap+a.dy+a.height/2+Math.max(i.gap,i.rect_spacing)],addText(e,g)}if(addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}function box(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups;e=a&&null==e?{}:e,t=null==t?{}:t;let r=a?create():e;let i=manageoptions({title:void 0,label:"label",rect_fill:"#5d6266"},a?e:t,r.fontFamily),o=r.selectAll(`#${i.id}`).empty()?r.append("g").attr("id",i.id):r.select(`#${i.id}`);o.selectAll("*").remove(),i=subsetobj(i,{prefix:"",exclude:["id","mark"]}),addTitle(o,i),addSubtitle(o,i);let s=getsize(o),l=subsetobj(i,{prefix:"rect_",exclude:["dx","dy"]});l.x=i.pos[0]+l.dx,l.y=0==s.height?i.pos[1]+l.dy:s.y+s.height+i.gap+l.dy;let n=o.append("rect");Object.entries(l).forEach((e=>n.attr(camelcasetodash(e[0]),e[1]))),s=getsize(o);const c=Object.assign(subsetobj(i,{prefix:"label_"}),subsetobj(i,{prefix:"text_"}));if(c.text=i.label,c.pos=[i.pos[0]+l.width,i.pos[1]+s.height-l.height/2],addText(o,c),addNote(o,i),i.frame&&addFrame(o,i),a){const e=getsize(o);return r.attr("width",e.width).attr("height",e.height).attr("viewBox",[e.x,e.y,e.width,e.height]),render(r)}return`#${i.id}`}const d3$8=Object.assign({},{scaleThreshold:scaleThreshold,min:min,interpolateRgbBasis:interpolateRgbBasis,range:range});function choro(e,{method:t="quantile",breaks:a=null,colors:r="Algae",reverse:i=!1,nb:o=6,k:s=1,middle:l,precision:n=2,missing_fill:c="white"}={}){let d=e.filter((e=>isNumber(e)));const p=a||discr.breaks(d,{method:t,nb:o,k:s,middle:l,precision:n});let g=palette(r,p.length-1);i&&(g=[...g].reverse());const h=e.length-d.length;return{breaks:p,colors:g,missing:0!=h,missing_fill:c,nodata:h,colorize:function(e){return d3$8.scaleThreshold(p.slice(1,-1),g).unknown(c)(parseFloat(e))}}}function palette(e,t){let a;if("string"==typeof e&&(a=getColors(e,t),null==a)){const a=getPalettes({name:e}).map((e=>e.number)),r=d3$8.min(a.map((e=>Math.abs(e-t)))),i=a.findIndex((e=>Math.abs(e-t)==r)),o=getColors(e,a[i]);return d3$8.range(t).map((e=>d3$8.interpolateRgbBasis(o)(e/t)))}return"object"==typeof e&&(a=e.length!=t?d3$8.range(t).map((a=>d3$8.interpolateRgbBasis(e)(a/t))):e),a}function plot_choro(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups,r=a?e:t,i={legend:!0,id:unique$1(),missing:"white",leg_type:"vertical",leg_pos:[10,10]};i={...i,...r},i.leg_title=i.leg_title?i.leg_title:i.var;let o={domain:i.data||i.datum};Object.keys(i).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(o,{["svg_"==e.slice(0,4)?e.slice(4):e]:i[e]}),delete i[e]}));let s=a?create(o):e,l="poly";const n=implantation(i.data);if(2==n&&(i.fill=i.fill?i.fill:"none",i.stroke=i.stroke?i.stroke:"#CCC"),2!=n&&(i.fill=i.fill?i.fill:"#CCC",i.stroke=i.stroke?i.stroke:"white"),void 0!==i.var)2==n&&(l="line");else{const e=columns(i.data.features.map((e=>e.properties)));e.includes(i.stroke)&&(i.var=i.stroke,l="line"),e.includes(i.fill)&&(i.var=i.fill,l="poly")}i.missing_fill=i.missing;let c=choro(i.data.features.map((e=>e.properties[i.var])),Object.fromEntries(Object.entries(i).filter((([e])=>["method","breaks","colors","nb","k","reverse","middle","precision","missing_fill"].includes(e)))));0==c.nodata&&!0!==i.missing&&(i.missing=!1);let d={};Object.keys(i).filter((e=>"leg_"!=e.slice(0,4))).forEach((e=>Object.assign(d,{[e]:i[e]}))),path(s,{...d,stroke:e=>"line"==l?c.colorize(e.properties[i.var]):i.stroke,fill:e=>"poly"==l?c.colorize(e.properties[i.var]):i.fill});let p=`#${i.id}`;if(i.legend){let e={};Object.keys(i).filter((e=>"leg_"==e.slice(0,4)||["k","fixmax","missing","id"].includes(e))).forEach((t=>Object.assign(e,{["leg_"==t.slice(0,4)?t.slice(4):t]:i[t]}))),e.id="leg_"+e.id,("vertical"==i.leg_type?choro_vertical:choro_horizontal)(s,{...e,missing:!1!==i.missing,missing_fill:i.missing,pos:i.leg_pos,breaks:c.breaks,colors:c.colors}),p=[`#${i.id}`,`#${e.id}`]}return a?render(s):p}const d3$7=Object.assign({},{scaleOrdinal:scaleOrdinal});function typo(e,{colors:t="Set3",missing_fill:a="white"}={}){let r=Array.from(new Set(e)).filter((e=>""!==e&&null!=e&&null!=e)),i=e.length-e.filter((e=>""!==e&&null!=e&&null!=e)).length,o=Array.isArray(t)?t:getColors(t,r.length);return{types:r,colors:o,missing:0!=i,missing_fill:a,nodata:i,colorize:d3$7.scaleOrdinal().domain(r).range(o).unknown(a)}}function plot_typo(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups,r=a?e:t,i={legend:!0,id:unique$1(),missing:"white",leg_type:"vertical",leg_pos:[10,10]};i={...i,...r},i.leg_title=i.leg_title?i.leg_title:i.var;let o={domain:i.data||i.datum};Object.keys(i).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(o,{["svg_"==e.slice(0,4)?e.slice(4):e]:i[e]}),delete i[e]}));let s=a?create(o):e,l="poly";const n=implantation(i.data);if(2==n&&(i.fill=i.fill?i.fill:"none",i.stroke=i.stroke?i.stroke:"#CCC"),2!=n&&(i.fill=i.fill?i.fill:"#CCC",i.stroke=i.stroke?i.stroke:"white"),void 0!==i.var)2==n&&(l="line");else{const e=columns(i.data.features.map((e=>e.properties)));e.includes(i.stroke)&&(i.var=i.stroke,l="line"),e.includes(i.fill)&&(i.var=i.fill,l="poly")}i.missing_fill=i.missing;let c=typo(i.order||i.data.features.map((e=>e.properties[i.var])),Object.fromEntries(Object.entries(i).filter((([e])=>["colors","missing","missing_fill"].includes(e)))));0==c.nodata&&!0!==i.missing&&(i.missing=!1);let d={};Object.keys(i).filter((e=>"leg_"!=e.slice(0,4))).forEach((e=>Object.assign(d,{[e]:i[e]}))),path(s,{...d,stroke:e=>"line"==l?c.colorize(e.properties[i.var]):i.stroke,fill:e=>"poly"==l?c.colorize(e.properties[i.var]):i.fill});let p=`#${i.id}`;if(i.legend){let e={};Object.keys(i).filter((e=>"leg_"==e.slice(0,4)||["alphabetical","missing"].includes(e))).forEach((t=>Object.assign(e,{["leg_"==t.slice(0,4)?t.slice(4):t]:i[t]}))),e.id="leg_"+e.id,("vertical"==i.leg_type?typo_vertical:typo_horizontal)(s,{...e,missing:!1!==i.missing,missing_fill:i.missing,alphabetical:i.alphabetical,pos:i.leg_pos,types:c.types,colors:c.colors}),p=[`#${i.id}`,`#${e.id}`]}return a?render(s):p}function plot_prop(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups,r=a?e:t,i={legend:!0,symbol:"circle",straight:0,width:30,id:unique$1(),missing:"white",k:50,fixmax:null,leg_type:"nested",leg_pos:[10,10]};i.k="square"==i.symbol?100:50,i={...i,...r};let o=`#${i.id}`;i.leg_title=i.leg_title?i.leg_title:i.var;let s={domain:i.data||i.datum};Object.keys(i).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(s,{["svg_"==e.slice(0,4)?e.slice(4):e]:i[e]}),delete i[e]}));let l=a?create(s):e;3==implantation(i.data)&&a&&l.path({datum:i.data,fill:"#CCC",fillOpacity:.5}),"square"==i.symbol&&(i.side=i.var),"spike"==i.symbol&&(i.height=i.var),"circle"==i.symbol&&(i.r=i.var),"halfcircle"==i.symbol&&(i.r=i.var);let n={};switch(Object.keys(i).filter((e=>"leg_"!=e.slice(0,4))).forEach((e=>Object.assign(n,{[e]:i[e]}))),i.symbol){case"circle":l.circle(n);break;case"square":l.square(n);break;case"spike":l.spike(n);break;case"halfcircle":l.halfcircle(n)}if(i.legend){let e={};switch(Object.keys(i).filter((e=>"leg_"==e.slice(0,4)||["k","fixmax","id"].includes(e))).forEach((t=>Object.assign(e,{["leg_"==t.slice(0,4)?t.slice(4):t]:i[t]}))),e.id="leg_"+e.id,e.data=i.data.features.map((e=>+e.properties[i.var])),e.spike_width=e.spike_width?e.spike_width:i.width,e.spike_straight=e.spike_straight?e.spike_straight:i.straight,i.symbol){case"circle":"nested"==i.leg_type?l.legend.circles_nested(e):l.legend.circles(e);break;case"square":"nested"==i.leg_type?l.legend.squares_nested(e):l.legend.squares(e);break;case"spike":l.legend.spikes(e);break;case"halfcircle":l.legend.circles_half(e)}o=[`#${i.id}`,`#${e.id}`]}return a?render(l):o}function plot_propchoro(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups,r=a?e:t,i={legend:!0,symbol:"circle",straight:0,width:30,id:unique$1(),missing:"white",fillOpacity:1,stroke:"white",k:50,fixmax:null,leg1_type:"nested",leg1_pos:[10,10],leg2_pos:void 0,leg2_type:"vertical"};i={...i,...r};let o=`#${i.id}`,s={domain:i.data||i.datum};Object.keys(i).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(s,{["svg_"==e.slice(0,4)?e.slice(4):e]:i[e]}),delete i[e]}));let l=a?create(s):e;i.var&&!i.var1&!i.var2&&(i.var1=i.var,i.var2=i.var),i.data.features.filter((e=>null!=e.properties.var1)),i.leg1_title=i.leg1_title?i.leg1_title:i.var1||i.var,i.leg2_title=i.leg2_title?i.leg2_title:i.var2||i.var,3==implantation(i.data)&&a&&l.path({datum:i.data,fill:"#CCC",fillOpacity:.5}),"square"==i.symbol&&(i.side=i.var1),"spike"==i.symbol&&(i.height=i.var1),"circle"==i.symbol&&(i.r=i.var1),"halfcircle"==i.symbol&&(i.r=i.var1),i.missing_fill=i.missing;let n=choro(i.data.features.map((e=>e.properties[i.var2])),Object.fromEntries(Object.entries(i).filter((([e])=>["method","breaks","colors","nb","k","reverse","middle","precision","missing_fill"].includes(e)))));i.fill=e=>n.colorize(e.properties[i.var2]);let c={};switch(Object.keys(i).filter((e=>"leg"!=e.slice(0,3))).forEach((e=>Object.assign(c,{[e]:i[e]}))),i.symbol){case"circle":l.circle(c);break;case"square":l.square(c);break;case"spike":l.spike(c);break;case"halfcircle":l.halfcircle(c)}if(i.legend){let e={};switch(Object.keys(i).filter((e=>"leg1_"==e.slice(0,5)||["k","fixmax","id"].includes(e))).forEach((t=>Object.assign(e,{["leg1_"==t.slice(0,5)?t.slice(5):t]:i[t]}))),e.id="leg_"+e.id,e.data=i.data.features.map((e=>+e.properties[i.var1])),e.spike_width=e.spike_width?e.spike_width:i.width,e.spike_straight=e.spike_straight?e.spike_straight:i.straight,console.log(i),i.symbol){case"circle":"nested"==i.leg1_type?l.legend.circles_nested(e):l.legend.circles(e);break;case"square":"nested"==i.leg1_type?l.legend.squares_nested(e):l.legend.squares(e);break;case"spike":l.legend.spikes(e);break;case"halfcircle":l.legend.circles_half(e)}if(null==i.leg2_pos){const t=getsize(l.selectAll(`#${e.id}`));console.log(t),i.leg2_pos=[i.leg1_pos[0],i.leg1_pos[1]+t.height+5]}let t={};Object.keys(i).filter((e=>"leg2_"==e.slice(0,5)||["missing"].includes(e))).forEach((e=>Object.assign(t,{["leg2_"==e.slice(0,5)?e.slice(5):e]:i[e]})));let a="vertical"==i.leg2_type?choro_vertical:choro_horizontal;t.id="leg_"+t.id+"_choro",a(l,{...t,missing:!1!==i.missing,missing_fill:i.missing,pos:i.leg2_pos,breaks:n.breaks,colors:n.colors}),o=[`#${i.id}`,`#${e.id}`,`#${t.id}`],console.log(o)}return a?render(l):o}function plot_proptypo(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups,r=a?e:t,i={legend:!0,symbol:"circle",straight:0,width:30,id:unique$1(),missing:"white",fillOpacity:1,stroke:"white",k:50,fixmax:null,leg1_type:"nested",leg1_pos:[10,10],leg2_pos:void 0,leg2_type:"vertical"};i={...i,...r};let o=`#${i.id}`,s={domain:i.data||i.datum};Object.keys(i).filter((e=>"svg_"==e.slice(0,4))).forEach((e=>{Object.assign(s,{["svg_"==e.slice(0,4)?e.slice(4):e]:i[e]}),delete i[e]}));let l=a?create(s):e;i.var&&!i.var1&!i.var2&&(i.var1=i.var,i.var2=i.var),i.data.features.filter((e=>null!=e.properties.var1)),i.leg1_title=i.leg1_title?i.leg1_title:i.var1||i.var,i.leg2_title=i.leg2_title?i.leg2_title:i.var2||i.var,3==implantation(i.data)&&a&&l.path({datum:i.data,fill:"#CCC",fillOpacity:.5}),"square"==i.symbol&&(i.side=i.var1),"spike"==i.symbol&&(i.height=i.var1),"circle"==i.symbol&&(i.r=i.var1),"halfcircle"==i.symbol&&(i.r=i.var1),i.missing_fill=i.missing;let n=typo(i.order||i.data.features.map((e=>e.properties[i.var2])),Object.fromEntries(Object.entries(i).filter((([e])=>["colors","missing","missing_fill"].includes(e)))));i.fill=e=>n.colorize(e.properties[i.var2]),0==n.nodata&&!0!==i.missing&&(i.missing=!1);let c={};switch(Object.keys(i).filter((e=>"leg"!=e.slice(0,3))).forEach((e=>Object.assign(c,{[e]:i[e]}))),i.symbol){case"circle":l.circle(c);break;case"square":l.square(c);break;case"spike":l.spike(c);break;case"halfcircle":l.halfcircle(c)}if(i.legend){let e={};switch(Object.keys(i).filter((e=>"leg1_"==e.slice(0,5)||["k","fixmax","id"].includes(e))).forEach((t=>Object.assign(e,{["leg1_"==t.slice(0,5)?t.slice(5):t]:i[t]}))),e.id="leg_"+e.id,e.data=i.data.features.map((e=>+e.properties[i.var1])),e.spike_width=e.spike_width?e.spike_width:i.width,e.spike_straight=e.spike_straight?e.spike_straight:i.straight,i.symbol){case"circle":"nested"==i.leg1_type?l.legend.circles_nested(e):l.legend.circles(e);break;case"square":"nested"==i.leg1_type?l.legend.squares_nested(e):l.legend.squares(e);break;case"spike":l.legend.spikes(e);break;case"halfcircle":l.legend.circles_half(e)}if(null==i.leg2_pos){const t=getsize(l.selectAll(`#${e.id}`));console.log(t),i.leg2_pos=[i.leg1_pos[0],i.leg1_pos[1]+t.height+5]}let t={};Object.keys(i).filter((e=>"leg2_"==e.slice(0,5)||["missing"].includes(e))).forEach((e=>Object.assign(t,{["leg2_"==e.slice(0,5)?e.slice(5):e]:i[e]})));let a="vertical"==i.leg2_type?typo_vertical:typo_horizontal;t.id="leg_"+t.id+"_choro",a(l,{...t,missing:!1!==i.missing,missing_fill:i.missing,alphabetical:i.alphabetical,types:n.types,colors:n.colors}),o=[`#${i.id}`,`#${e.id}`,`#${t.id}`],console.log(o)}return a?render(l):o}function plot(e,t){let a=(arguments.length<=1||null==arguments[1])&&!arguments[0]?._groups?e:t;switch(a.type){case"graticule":return graticule(e,t);case"outline":return outline(e,t);case"path":case"base":case"simple":return path(e,t);case"text":case"label":return text(e,t);case"circle":return circle(e,t);case"square":return square$1(e,t);case"halfcircle":return halfcircle(e,t);case"spike":return spike(e,t);case"tile":return tile(e,t);case"header":return header(e,t);case"footer":return footer(e,t);case"scalebar":return scalebar(e,t);case"north":return north(e,t);case"leg_box":case"legbox":return box(e,t);case"leg_choro_horizontal":case"legchorohorizontal":return choro_horizontal(e,t);case"leg_choro_vertical":case"legchorovertical":case"leg_choro":case"legchoro":return newcontainer?choro_vertical(a):choro_vertical(e,t);case"leg_typo_horizontal":case"legtypohorizontal":return typo_horizontal(e,t);case"leg_typo_vertical":case"legtypovertical":case"leg_typo":case"legtypo":return newcontainer?typo_vertical(a):typo_vertical(e,t);case"leg_spikes":case"leg_spike":case"legspike":case"legspikes":return spikes(e,t);case"leg_circles":case"leg_circle":case"legcircle":case"legcircles":return circles(e,t);case"leg_circles_nested":case"leg_circle_nested":case"legcirclenested":case"legcirclesnested":return circles_nested(e,t);case"leg_mushrooms":case"leg_mushroom":case"legmushrooms":case"legmushroom":return mushrooms(e,t);case"blur":case"effect_blur":return blur(e,t);case"clipPath":case"effect_clipPath":return clipPath(e,t);case"radialGradient":case"effect_radialGradient":return radialGradient(e,t);case"shadow":case"effect_shadow":return shadow(e,t);case"choro":case"choropleth":return plot_choro(e,t);case"typo":case"typology":return plot_typo(e,t);case"prop":return plot_prop(e,t);case"propchoro":return plot_propchoro(e,t);case"proptypo":return plot_proptypo(e,t)}}const d3$6=Object.assign({},{create2:create$1,geoPath:geoPath,geoBounds:geoBounds,geoEquirectangular:geoEquirectangular,geoMercator:geoMercator,geoIdentity:geoIdentity});function create({height:e=null,projection:t="none",domain:a,pos:r=[0,0],background:i="none",width:o=1e3,margin:s=[0,0,0,0],parent:l=null,fontFamily:n="Arial",zoomable:c=!1,control:d=!0,warning:p=!0,warning_message:g=[]}={}){const h=t;switch(t){case"mercator":t=d3$6.geoMercator();break;case"none":t=d3$6.geoIdentity().reflectY(!0)}let u,m;if(null!==e)m={width:o,height:e,fontFamily:n};else{let r=extent(a,h);s=Array.isArray(s)?s:Array(4).fill(s);const[[i,u],[f,y]]=d3$6.geoPath(t.fitWidth(o-s[1]-s[3],r)).bounds(r);e=Math.ceil(y-u)+s[0]+s[2];let _=t.translate();t.translate([_[0]+s[3],_[1]+s[0]]),t.clipExtent([[0,0],[o,e]]),m={initproj:h,domain:a,projection:t,baseScale:t.scale(),baseTranslate:t.translate(),margin:s,width:o,height:e,viewbox:[],height_header:0,height_footer:0,fontFamily:n,zoomable:c,control:d,controlid:"control_"+unique$1(),zoomablelayers:[],zoom:{k:1,x:0,y:0},bbox:d3$6.geoBounds(r),inset:!!l,warning:p,warning_message:g,data:!1}}if(null==l){let t=d3$6.create2("svg").attr("width",o).attr("height",e).attr("viewBox",[0,0,o,e]).style("background-color",i);t.append("defs").attr("id","defs"),t.append("g").attr("id","geoviztooltip"),u=Object.assign(t,m)}else{let t=l.append("g").attr("transform",`translate(${r[0]},${r[1]})`);t.append("defs").attr("id","defs"),t.append("rect").attr("x",0).attr("y",0).attr("width",o).attr("height",e).attr("fill",i),t.append("g").attr("id","geoviztooltip"),u=Object.assign(t,m)}let f={};[{id:"outline",func:outline},{id:"path",func:path},{id:"graticule",func:graticule},{id:"circle",func:circle},{id:"square",func:square$1},{id:"halfcircle",func:halfcircle},{id:"spike",func:spike},{id:"text",func:text},{id:"tile",func:tile},{id:"header",func:header},{id:"footer",func:footer},{id:"scalebar",func:scalebar},{id:"north",func:north},{id:"plot",func:plot}].forEach((e=>f[e.id]=function(){return e.func(u,arguments[0])}));let y={};[{id:"circles_nested",func:circles_nested},{id:"circles",func:circles},{id:"squares",func:squares},{id:"squares_nested",func:squares_nested},{id:"circles_half",func:circles_half},{id:"spikes",func:spikes},{id:"mushrooms",func:mushrooms},{id:"choro_vertical",func:choro_vertical},{id:"choro_horizontal",func:choro_horizontal},{id:"typo_vertical",func:typo_vertical},{id:"typo_horizontal",func:typo_horizontal},{id:"box",func:box}].forEach((e=>y[e.id]=function(){return e.func(u,arguments[0])}));let _={};return[{id:"blur",func:blur},{id:"shadow",func:shadow},{id:"radialGradient",func:radialGradient},{id:"clipPath",func:clipPath},,].forEach((e=>_[e.id]=function(){return e.func(u,arguments[0])})),Object.assign(u,{...f,legend:y,effect:_,render:function(){return render(u,arguments[0])}})}const d3$5=Object.assign({},{scaleLinear:scaleLinear,min:min,max:max,mean:mean,mode:mode});function ridge(e,{x:t="x",y:a="y",z:r="z",k:i=100,fixmax:o=null,projection:s=(e=>e)}={}){let l=getres(e,t);return toLineString(split(e,l,{x:t,y:a,z:r,fixmax:o}),l,{z:r,k:i,projection:s})}function toLineString(e,t,{x:a="x",y:r="y",z:i="z",k:o=100,fixmax:s=null,projection:l=(e=>e)}={}){const n=null!=s?s:d3$5.max(e.map((e=>e[0][i]))),c=d3$5.scaleLinear().domain([0,n]).range([0,o]);let d=[];return e.forEach(((e,o)=>{let s=e.map((e=>e[i])),n=d3$5.min(s),p=d3$5.max(s),g=d3$5.mean(s),h=e[0][a]-t<-180?-180:e[0][a]-t,u=e[e.length-1][a]+t>180?180:e[e.length-1][a]+t;e.unshift({[a]:h,[r]:e[0][r],[i]:0}),e.push({[a]:u,[r]:e[0][r],[i]:0}),d.push({type:"Feature",properties:{min:n,max:p,mean:g},geometry:{type:"LineString",coordinates:e.map((e=>[l([e[a],e[r]])[0],l([e[a],e[r]])[1]-c(e[i])]))}})})),{type:"FeatureCollection",features:d}}function split(e,t,{x:a="x",y:r="y",z:i="z"}={}){const o=Array.from(new Set(e.map((e=>e[r]))));let s=[];return o.forEach((i=>{let o=e.filter((e=>e[r]==i)),l=[],n=[];for(let e=0;e<o.length-1;e++)n.push(o[e]),(o[e+1][a]-o[e][a]>t+.1*t||e==o.length-2)&&(l.push(n),n=[]);return s.push(l)})),s.flat()}function getres(e,t){let a=[];for(let r=0;r<e.length-1;r++)a.push(e[r+1][t]-e[r][t]);return d3$5.mode(a)}const d3$4=Object.assign({},{geoArea:geoArea});function dissolve(e,t={areashare:"_share"}){e=JSON.parse(JSON.stringify(e));let a=[];e.features.forEach((e=>{a.push(sp(e,t.areashare))}));const r=Object.keys(e).filter((e=>"features"!=e)),i={};return r.forEach((t=>{i[t]=e[t]})),i.features=a.flat(),i}function sp(e,t){let a=[];e.geometry.type.includes("Multi")?e.geometry.coordinates.forEach((t=>{a.push({type:"Feature",properties:e.properties,geometry:{type:e.geometry.type.replace("Multi",""),coordinates:t}})})):a.push({...e});const r=d3$4.geoArea(e);return a.forEach((e=>e.properties={...e.properties,[t]:d3$4.geoArea(e)/r})),JSON.parse(JSON.stringify(a))}const d3$3=Object.assign({},{geoProject:geoProject});function project(e,{projection:t=null}={}){return null==t?e:d3$3.geoProject(e,t)}function unproject(e,t={}){let a=JSON.parse(JSON.stringify(e));return a.features.forEach((e=>e.geometry.coordinates=unprojectCoords(e.geometry.coordinates,t.projection))),a}function unprojectCoords(e,t){return"object"!=typeof e[0]?t.invert(e):e.map((function(e){return unprojectCoords(e,t)}))}const d3$2=Object.assign({},{sum:sum});function replicate(e,{field:t,targetvalue:a}={}){let r=JSON.parse(JSON.stringify(e));a=a||d3$2.sum(r.features.map((e=>parseFloat(e.properties[t]))))/2e3;let i=[];for(let e=0;e<=r.features.length-1;e++){let o=Math.round(+r.features[e].properties[t]/a);for(let t=1;t<=o;t++)i.push({...r.features[e]})}return r.features=i,r}function rewind(e,t={}){e=JSON.parse(JSON.stringify(e));let a=!1!==t.outer,r=!0===(!1!==t.mutate)?e:JSON.parse(JSON.stringify(x));for(let e=0;e<r.features.length;e++)if("Polygon"===r.features[e].geometry.type)rewindRings(r.features[e].geometry.coordinates,a);else if("MultiPolygon"===r.features[e].geometry.type)for(let t=0;t<r.features[e].geometry.coordinates.length;t++)rewindRings(r.features[e].geometry.coordinates[t],a);return r}function rewindRings(e,t){if(0!==e.length){rewindRing(e[0],t);for(let a=1;a<e.length;a++)rewindRing(e[a],!t)}}function rewindRing(e,t){let a=0,r=0;for(let t=0,i=e.length,o=i-1;t<i;o=t++){const i=(e[t][0]-e[o][0])*(e[o][1]+e[t][1]),s=a+i;r+=Math.abs(a)>=Math.abs(i)?a-s+i:i-s+a,a=s}a+r>=0!=!!t&&e.reverse()}function coords2geo(e,t={}){let a=t.lat||t.latitude,r=t.lon||t.lng||t.longitude,i=t.coords||t.coordinates;!t.sep&&!t.separator||(t.sep||t.separator);let o=!!t.reverse;if(a&&r){let t=o?r:a,i=o?a:r;return{type:"FeatureCollection",features:e.map((e=>({type:"Feature",properties:e,geometry:{type:"Point",coordinates:[+e[i],+e[t]]}})))}}return i?{type:"FeatureCollection",features:e.map((e=>({type:"Feature",properties:e,geometry:{type:"Point",coordinates:o?getcoords(e[i]):getcoords(e[i]).reverse()}})))}:i}function txt2coords(e,t=","){let a=(e=e.replace(/[ ]+/g,"")).split(t).map((e=>e.replace(",","."))).map((e=>e.replace(/[^\d.-]/g,""))).map((e=>+e));return 2!=a.length&&(a=[void 0,void 0]),a}function wkt2coords(e){let t=e.match(/\(([^)]+)\)/g);return null===t?[void 0,void 0]:t[0].replace(/\s\s+/g," ").replace("(","").replace(")","").trimStart().trimEnd().split(" ").map((e=>e.replace(",","."))).map((e=>+e))}function getcoords(e){return e?e.toLowerCase().includes("point")?wkt2coords(e):txt2coords(e):null}function featurecollection(e,t={}){let a=JSON.parse(JSON.stringify(e));if("table"==whatisit(a)&&1==checkTable(t))return coords2geo(a,t);if("table"==whatisit(a)&&1==checkGeoTable(t))return geotabletogeojson(a,t);switch(whatisit(a)){case"FeatureCollection":default:return a;case"features":return{type:"FeatureCollection",features:a};case"feature":return{type:"FeatureCollection",features:[a]};case"geometries":return{type:"FeatureCollection",features:a.map((e=>({type:"Feature",properties:{},geometry:e})))};case"geometry":return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:a}]};case"bbox":return bbox(a)}}function checkTable(e){return!!(e.lat&&e.lon||e.latitude&&e.longitude||e.coords||e.coordinates)}function checkGeoTable(e){return!(!e.geom&&!e.geometry)}function geotabletogeojson(e,{geometry:t="geometry"}={}){let a=JSON.parse(JSON.stringify(e)),r=a.map((e=>e[t]));return a.forEach((e=>delete e[t])),{type:"FeatureCollection",features:a.map(((e,t)=>({type:"Feature",properties:e,geometry:r[t]})))}}function merge({geom:e,geom_id:t,data:a,data_id:r,id:i}={}){i&&(t=i,r=i);let o=addUnderscore(a,(e=JSON.parse(JSON.stringify(e))).features.map((e=>e.properties)),r);a=o[0],r=o[1];let s=new Map(a.map((e=>[e[r],e]))),l=[];e.features.forEach((e=>{let a={};Object.keys(e).forEach((r=>{"properties"==r?Object.assign(a,{properties:Object.assign({...e.properties},{...s.get(e.properties[t])})}):Object.assign(a,{[r]:e[r]})})),l.push(a)}));let n={};Object.keys(e).forEach((t=>{n=Object.assign(n,{[t]:"features"==t?l:e[t]})}));let c=e.features.map((e=>e.properties[t])),d=a.map((e=>e[r])),p=c.length-new Set(c).size,g=d.length-new Set(d).size,h=c.filter((e=>d.includes(e))).filter((e=>d.includes(e))),u=c.filter((e=>!d.includes(e))),m=d.filter((e=>!c.includes(e)));return{featureCollection:n,diagnostic:{duplicate_data:g,duplicate_geom:p,geom:c,data:d,matched:h,unmatched_geom:u,unmatched_data:m}}}function addUnderscore(e,t,a){let r=columns(e),i=columns(t),o=[...r];for(;0!==o.filter((e=>i.includes(e))).length;)o.filter((e=>i.includes(e))).forEach((e=>{o[o.indexOf(e)]="_"+e}));let s=new Map(r.map(((e,t)=>[e,o[t]]))),l=[];return e.forEach((e=>{let t={};Object.keys(e).forEach((a=>{t[s.get(a)]=e[a]})),l.push(t)})),[l,s.get(a)]}function geotable(e,{geometry:t="geometry"}={}){return JSON.parse(JSON.stringify(e)).features.map((e=>Object.assign(e.properties,{[t]:e.geometry})))}const d3$1=Object.assign({},{geoProjection:geoProjection});function proj4d3(e,t){const a=180/Math.PI,r=1/a,i=e(t),o=function(e,t){return i.forward([e*a,t*a])};o.invert=function(e,t){return i.inverse([e,t]).map((function(e){return e*r}))};const s=d3$1.geoProjection(o).scale(1);return s.raw=i,s}function addfonts(e){return e.map((e=>{const t=new FontFace(e.fontFamily,`url(${e.url})`,{style:e.style,weight:e.weight,stretch:e.stretch});return t.load(),document.fonts.add(t),e}))}const d3=Object.assign({},{range:range,max:max,Delaunay:Delaunay,geoProject:geoProject});function dotstogrid(e,t={data:data,type:type,step:step,var:void 0}){let a;switch(t.type=t.type?t.type:"hex",t.step=t.step?t.step:50,t.type){case"hex":case"hexbin":default:a=hexbin(t.step,e.width,e.height);break;case"square":a=square(t.step,e.width,e.height);break;case"triangle":a=triangle(t.step,e.width,e.height);break;case"random":a=random(t.step,e.width,e.height)}if(void 0!==t.data){const r=d3.geoProject(t.data,e.projection).features.filter((e=>null!=e.geometry?.coordinates));let i=0,o=0,s=[];return a.forEach((e=>{if(r.forEach((a=>{booleanPointInPolygon(a,e)&&(i+=1,o+=a.properties[t.var])})),i>0){let a=t.var?{id:e.properties.index,count:i,sum:o}:{id:e.properties.index,count:i};s.push({type:"Feature",geometry:e.geometry,properties:a})}i=0})),{type:"FeatureCollection",features:s}}return{type:"FeatureCollection",features:a}}function square(e,t,a){let r=d3.range(0+e/2,a,e).reverse(),i=d3.range(0+e/2,t,e).map(((e,t)=>r.map((t=>[e,t])))).flat(),o=e/2;return i.map(((e,t)=>({type:"Feature",geometry:{type:"Polygon",coordinates:[[[e[0]-o,e[1]+o],[e[0]+o,e[1]+o],[e[0]+o,e[1]-o],[e[0]-o,e[1]-o],[e[0]-o,e[1]+o]]]},properties:{index:t}})))}function hexbin(e,t,a){let r=e,i=r/Math.sqrt(3),o=2*i*(3/4),s=d3.range(0,a+i,o).reverse();s.length%2&&s.unshift(d3.max(s)+o);let l=d3.range(0,t+i,r).map(((e,t)=>s.map((t=>[e,t])))).flat();return l=l.map(((e,t)=>t%2==1?[e[0]+r/2,e[1]]:e)),l.map(((e,t)=>{let a=[];for(let t=0;t<6;t++){let r=Math.PI/180*(60*t-30);a.push([e[0]+i*Math.cos(r),e[1]+i*Math.sin(r)])}return{type:"Feature",geometry:{type:"Polygon",coordinates:[[a[0],a[1],a[2],a[3],a[4],a[5],a[0]]]},properties:{index:t}}}))}function triangle(e,t,a){let r=(e,t)=>{let a=Math.sqrt(3)/2*t,r=[e[0]+t/2,e[1]];return[r,[e[0],e[1]-a],[e[0]-t/2,e[1]],r]},i=(e,t)=>{let a=Math.sqrt(3)/2*t,r=[e[0]+t/2,e[1]];return[r,[e[0],e[1]+a],[e[0]-t/2,e[1]],r]},o=e/Math.sqrt(3),s=Math.sqrt(3)/2*e,l=d3.range(0,a+o,s).reverse();l.length%2&&l.unshift(d3.max(l)+s);let n=d3.range(0,t+o,e).map(((e,t)=>l.map((t=>[e,t])))).flat();n=n.map(((t,a)=>a%2==1?[t[0]+e/2,t[1]]:t));let c=n.length;return n=n.concat(n),n.map(((t,a)=>({type:"Feature",geometry:{type:"Polygon",coordinates:a<c?[r(t,e)]:[i(t,e)]},properties:{index:a}})))}function random(e,t,a){let r=[],i=Math.round(t/e*(a/e));for(let e=0;e<i;e++)r.push([Math.random()*t,Math.random()*a]);let o=d3.Delaunay.from(r,(e=>e[0]),(e=>e[1])).voronoi([0,0,t,a]);return r.map(((e,t)=>({type:"Feature",geometry:{type:"Polygon",coordinates:[o.cellPolygon(t)]},properties:{index:t}})))}let container={create:create,render:render},tool={addfonts:addfonts,rewind:rewind,featurecollection:featurecollection,merge:merge,geotable:geotable,proj4d3:proj4d3,dissolve:dissolve,centroid:centroid,project:project,unproject:unproject,dodge:dodge,replicate:replicate,ridge:ridge,choro:choro,typo:typo,random:random$1,radius:radius,dotstogrid:dotstogrid},legend={circles:circles,squares:squares,squares_nested:squares_nested,circles_nested:circles_nested,circles_half:circles_half,choro_vertical:choro_vertical,choro_horizontal:choro_horizontal,typo_vertical:typo_vertical,typo_horizontal:typo_horizontal,box:box,spikes:spikes,mushrooms:mushrooms},effect={blur:blur,shadow:shadow,radialGradient:radialGradient,clipPath:clipPath};export{circle,container,create,effect,footer,graticule,halfcircle,header,legend,north,outline,path,plot,render,scalebar,spike,square$1 as square,text,tile,tool};export default null;
