import{dispatch as et}from"../d3-dispatch@3.0.1/index.be49ca5f.js";import{dragDisable as ot,dragEnable as it}from"../d3-drag@3.0.0/index.8e5f73cc.js";import{interpolateZoom as rt}from"../d3-interpolate@3.0.1/index.7ed7c7fe.js";import{select as D,pointer as T}from"../d3-selection@3.0.0/index.13204b25.js";import{interrupt as O}from"../d3-transition@3.0.1/index.d140d658.js";var K=e=>()=>e;function ut(e,{sourceEvent:m,target:f,transform:_,dispatch:k}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:m,enumerable:!0,configurable:!0},target:{value:f,enumerable:!0,configurable:!0},transform:{value:_,enumerable:!0,configurable:!0},_:{value:k}})}function z(e,m,f){this.k=e,this.x=m,this.y=f}z.prototype={constructor:z,scale:function(e){return e===1?this:new z(this.k*e,this.x,this.y)},translate:function(e,m){return e===0&m===0?this:new z(this.k,this.x+this.k*e,this.y+this.k*m)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var S=new z(1,0,0);R.prototype=z.prototype;function R(e){for(;!e.__zoom;)if(!(e=e.parentNode))return S;return e.__zoom}function W(e){e.stopImmediatePropagation()}function B(e){e.preventDefault(),e.stopImmediatePropagation()}function st(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function at(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function U(){return this.__zoom||S}function ht(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function ct(){return navigator.maxTouchPoints||"ontouchstart"in this}function mt(e,m,f){var _=e.invertX(m[0][0])-f[0][0],k=e.invertX(m[1][0])-f[1][0],v=e.invertY(m[0][1])-f[0][1],l=e.invertY(m[1][1])-f[1][1];return e.translate(k>_?(_+k)/2:Math.min(0,_)||Math.max(0,k),l>v?(v+l)/2:Math.min(0,v)||Math.max(0,l))}function lt(){var e=st,m=at,f=mt,_=ht,k=ct,v=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],P=250,q=rt,E=et("start","zoom","end"),M,G,Y,A=500,C=150,I=0,j=10;function u(t){t.property("__zoom",U).on("wheel.zoom",F,{passive:!1}).on("mousedown.zoom",J).on("dblclick.zoom",Z).filter(k).on("touchstart.zoom",$).on("touchmove.zoom",tt).on("touchend.zoom touchcancel.zoom",nt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.transform=function(t,o,n,i){var r=t.selection?t.selection():t;r.property("__zoom",U),t!==r?L(t,o,n,i):r.interrupt().each(function(){x(this,arguments).event(i).start().zoom(null,typeof o=="function"?o.apply(this,arguments):o).end()})},u.scaleBy=function(t,o,n,i){u.scaleTo(t,function(){var r=this.__zoom.k,s=typeof o=="function"?o.apply(this,arguments):o;return r*s},n,i)},u.scaleTo=function(t,o,n,i){u.transform(t,function(){var r=m.apply(this,arguments),s=this.__zoom,a=n==null?H(r):typeof n=="function"?n.apply(this,arguments):n,h=s.invert(a),c=typeof o=="function"?o.apply(this,arguments):o;return f(X(V(s,c),a,h),r,l)},n,i)},u.translateBy=function(t,o,n,i){u.transform(t,function(){return f(this.__zoom.translate(typeof o=="function"?o.apply(this,arguments):o,typeof n=="function"?n.apply(this,arguments):n),m.apply(this,arguments),l)},null,i)},u.translateTo=function(t,o,n,i,r){u.transform(t,function(){var s=m.apply(this,arguments),a=this.__zoom,h=i==null?H(s):typeof i=="function"?i.apply(this,arguments):i;return f(S.translate(h[0],h[1]).scale(a.k).translate(typeof o=="function"?-o.apply(this,arguments):-o,typeof n=="function"?-n.apply(this,arguments):-n),s,l)},i,r)};function V(t,o){return o=Math.max(v[0],Math.min(v[1],o)),o===t.k?t:new z(o,t.x,t.y)}function X(t,o,n){var i=o[0]-n[0]*t.k,r=o[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new z(t.k,i,r)}function H(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function L(t,o,n,i){t.on("start.zoom",function(){x(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(i).end()}).tween("zoom",function(){var r=this,s=arguments,a=x(r,s).event(i),h=m.apply(r,s),c=n==null?H(h):typeof n=="function"?n.apply(r,s):n,d=Math.max(h[1][0]-h[0][0],h[1][1]-h[0][1]),p=r.__zoom,g=typeof o=="function"?o.apply(r,s):o,w=q(p.invert(c).concat(d/p.k),g.invert(c).concat(d/g.k));return function(y){if(y===1)y=g;else{var b=w(y),N=d/b[2];y=new z(N,c[0]-b[0]*N,c[1]-b[1]*N)}a.zoom(null,y)}})}function x(t,o,n){return!n&&t.__zooming||new Q(t,o)}function Q(t,o){this.that=t,this.args=o,this.active=0,this.sourceEvent=null,this.extent=m.apply(t,o),this.taps=0}Q.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,o){return this.mouse&&t!=="mouse"&&(this.mouse[1]=o.invert(this.mouse[0])),this.touch0&&t!=="touch"&&(this.touch0[1]=o.invert(this.touch0[0])),this.touch1&&t!=="touch"&&(this.touch1[1]=o.invert(this.touch1[0])),this.that.__zoom=o,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var o=D(this.that).datum();E.call(t,this.that,new ut(t,{sourceEvent:this.sourceEvent,target:u,type:t,transform:this.that.__zoom,dispatch:E}),o)}};function F(t,...o){if(!e.apply(this,arguments))return;var n=x(this,o).event(t),i=this.__zoom,r=Math.max(v[0],Math.min(v[1],i.k*Math.pow(2,_.apply(this,arguments)))),s=T(t);if(n.wheel)(n.mouse[0][0]!==s[0]||n.mouse[0][1]!==s[1])&&(n.mouse[1]=i.invert(n.mouse[0]=s)),clearTimeout(n.wheel);else{if(i.k===r)return;n.mouse=[s,i.invert(s)],O(this),n.start()}B(t),n.wheel=setTimeout(a,C),n.zoom("mouse",f(X(V(i,r),n.mouse[0],n.mouse[1]),n.extent,l));function a(){n.wheel=null,n.end()}}function J(t,...o){if(Y||!e.apply(this,arguments))return;var n=t.currentTarget,i=x(this,o,!0).event(t),r=D(t.view).on("mousemove.zoom",c,!0).on("mouseup.zoom",d,!0),s=T(t,n),a=t.clientX,h=t.clientY;ot(t.view),W(t),i.mouse=[s,this.__zoom.invert(s)],O(this),i.start();function c(p){if(B(p),!i.moved){var g=p.clientX-a,w=p.clientY-h;i.moved=g*g+w*w>I}i.event(p).zoom("mouse",f(X(i.that.__zoom,i.mouse[0]=T(p,n),i.mouse[1]),i.extent,l))}function d(p){r.on("mousemove.zoom mouseup.zoom",null),it(p.view,i.moved),B(p),i.event(p).end()}}function Z(t,...o){if(e.apply(this,arguments)){var n=this.__zoom,i=T(t.changedTouches?t.changedTouches[0]:t,this),r=n.invert(i),s=n.k*(t.shiftKey?.5:2),a=f(X(V(n,s),i,r),m.apply(this,o),l);B(t),P>0?D(this).transition().duration(P).call(L,a,i,t):D(this).call(u.transform,a,i,t)}}function $(t,...o){if(e.apply(this,arguments)){var n=t.touches,i=n.length,r=x(this,o,t.changedTouches.length===i).event(t),s,a,h,c;for(W(t),a=0;a<i;++a)h=n[a],c=T(h,this),c=[c,this.__zoom.invert(c),h.identifier],r.touch0?!r.touch1&&r.touch0[2]!==c[2]&&(r.touch1=c,r.taps=0):(r.touch0=c,s=!0,r.taps=1+!!M);M&&(M=clearTimeout(M)),s&&(r.taps<2&&(G=c[0],M=setTimeout(function(){M=null},A)),O(this),r.start())}}function tt(t,...o){if(this.__zooming){var n=x(this,o).event(t),i=t.changedTouches,r=i.length,s,a,h,c;for(B(t),s=0;s<r;++s)a=i[s],h=T(a,this),n.touch0&&n.touch0[2]===a.identifier?n.touch0[0]=h:n.touch1&&n.touch1[2]===a.identifier&&(n.touch1[0]=h);if(a=n.that.__zoom,n.touch1){var d=n.touch0[0],p=n.touch0[1],g=n.touch1[0],w=n.touch1[1],y=(y=g[0]-d[0])*y+(y=g[1]-d[1])*y,b=(b=w[0]-p[0])*b+(b=w[1]-p[1])*b;a=V(a,Math.sqrt(y/b)),h=[(d[0]+g[0])/2,(d[1]+g[1])/2],c=[(p[0]+w[0])/2,(p[1]+w[1])/2]}else if(n.touch0)h=n.touch0[0],c=n.touch0[1];else return;n.zoom("touch",f(X(a,h,c),n.extent,l))}}function nt(t,...o){if(this.__zooming){var n=x(this,o).event(t),i=t.changedTouches,r=i.length,s,a;for(W(t),Y&&clearTimeout(Y),Y=setTimeout(function(){Y=null},A),s=0;s<r;++s)a=i[s],n.touch0&&n.touch0[2]===a.identifier?delete n.touch0:n.touch1&&n.touch1[2]===a.identifier&&delete n.touch1;if(n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0)n.touch0[1]=this.__zoom.invert(n.touch0[0]);else if(n.end(),n.taps===2&&(a=T(a,this),Math.hypot(G[0]-a[0],G[1]-a[1])<j)){var h=D(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return u.wheelDelta=function(t){return arguments.length?(_=typeof t=="function"?t:K(+t),u):_},u.filter=function(t){return arguments.length?(e=typeof t=="function"?t:K(!!t),u):e},u.touchable=function(t){return arguments.length?(k=typeof t=="function"?t:K(!!t),u):k},u.extent=function(t){return arguments.length?(m=typeof t=="function"?t:K([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),u):m},u.scaleExtent=function(t){return arguments.length?(v[0]=+t[0],v[1]=+t[1],u):[v[0],v[1]]},u.translateExtent=function(t){return arguments.length?(l[0][0]=+t[0][0],l[1][0]=+t[1][0],l[0][1]=+t[0][1],l[1][1]=+t[1][1],u):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},u.constrain=function(t){return arguments.length?(f=t,u):f},u.duration=function(t){return arguments.length?(P=+t,u):P},u.interpolate=function(t){return arguments.length?(q=t,u):q},u.on=function(){var t=E.on.apply(E,arguments);return t===E?u:t},u.clickDistance=function(t){return arguments.length?(I=(t=+t)*t,u):Math.sqrt(I)},u.tapDistance=function(t){return arguments.length?(j=+t,u):j},u}export{z as ZoomTransform,lt as zoom,S as zoomIdentity,R as zoomTransform};
