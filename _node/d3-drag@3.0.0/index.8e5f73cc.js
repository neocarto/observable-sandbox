import{dispatch as W}from"../d3-dispatch@3.0.1/index.be49ca5f.js";import{select as E,pointer as Y}from"../d3-selection@3.0.0/index.13204b25.js";const Z={passive:!1},y={capture:!0,passive:!1};function M(n){n.stopImmediatePropagation()}function p(n){n.preventDefault(),n.stopImmediatePropagation()}function q(n){var o=n.document.documentElement,i=E(n).on("dragstart.drag",p,y);"onselectstart"in o?i.on("selectstart.drag",p,y):(o.__noselect=o.style.MozUserSelect,o.style.MozUserSelect="none")}function A(n,o){var i=n.document.documentElement,s=E(n).on("dragstart.drag",null);o&&(s.on("click.drag",p,y),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in i?s.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var k=n=>()=>n;function P(n,{sourceEvent:o,subject:i,target:s,identifier:f,active:m,x:h,y:x,dx:w,dy:v,dispatch:g}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:o,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:f,enumerable:!0,configurable:!0},active:{value:m,enumerable:!0,configurable:!0},x:{value:h,enumerable:!0,configurable:!0},y:{value:x,enumerable:!0,configurable:!0},dx:{value:w,enumerable:!0,configurable:!0},dy:{value:v,enumerable:!0,configurable:!0},_:{value:g}})}P.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function J(n){return!n.ctrlKey&&!n.button}function L(){return this.parentNode}function Q(n,o){return o??{x:n.x,y:n.y}}function R(){return navigator.maxTouchPoints||"ontouchstart"in this}function C(){var n=J,o=L,i=Q,s=R,f={},m=W("start","drag","end"),h=0,x,w,v,g,j=0;function u(e){e.on("mousedown.drag",B).filter(s).on("touchstart.drag",H).on("touchmove.drag",K,Z).on("touchend.drag touchcancel.drag",N).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function B(e,t){if(!(g||!n.call(this,e,t))){var r=S(this,o.call(this,e,t),e,t,"mouse");r&&(E(e.view).on("mousemove.drag",F,y).on("mouseup.drag",G,y),q(e.view),M(e),v=!1,x=e.clientX,w=e.clientY,r("start",e))}}function F(e){if(p(e),!v){var t=e.clientX-x,r=e.clientY-w;v=t*t+r*r>j}f.mouse("drag",e)}function G(e){E(e.view).on("mousemove.drag mouseup.drag",null),A(e.view,v),p(e),f.mouse("end",e)}function H(e,t){if(n.call(this,e,t)){var r=e.changedTouches,a=o.call(this,e,t),c=r.length,d,b;for(d=0;d<c;++d)(b=S(this,a,e,t,r[d].identifier,r[d]))&&(M(e),b("start",e,r[d]))}}function K(e){var t=e.changedTouches,r=t.length,a,c;for(a=0;a<r;++a)(c=f[t[a].identifier])&&(p(e),c("drag",e,t[a]))}function N(e){var t=e.changedTouches,r=t.length,a,c;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),a=0;a<r;++a)(c=f[t[a].identifier])&&(M(e),c("end",e,t[a]))}function S(e,t,r,a,c,d){var b=m.copy(),l=Y(d||r,t),U,D,_;if((_=i.call(e,new P("beforestart",{sourceEvent:r,target:u,identifier:c,active:h,x:l[0],y:l[1],dx:0,dy:0,dispatch:b}),a))!=null)return U=_.x-l[0]||0,D=_.y-l[1]||0,function O(T,I,V){var X=l,z;switch(T){case"start":f[c]=O,z=h++;break;case"end":delete f[c],--h;case"drag":l=Y(V||I,t),z=h;break}b.call(T,e,new P(T,{sourceEvent:I,subject:_,target:u,identifier:c,active:z,x:l[0]+U,y:l[1]+D,dx:l[0]-X[0],dy:l[1]-X[1],dispatch:b}),a)}}return u.filter=function(e){return arguments.length?(n=typeof e=="function"?e:k(!!e),u):n},u.container=function(e){return arguments.length?(o=typeof e=="function"?e:k(e),u):o},u.subject=function(e){return arguments.length?(i=typeof e=="function"?e:k(e),u):i},u.touchable=function(e){return arguments.length?(s=typeof e=="function"?e:k(!!e),u):s},u.on=function(){var e=m.on.apply(m,arguments);return e===m?u:e},u.clickDistance=function(e){return arguments.length?(j=(e=+e)*e,u):Math.sqrt(j)},u}export{C as drag,q as dragDisable,A as dragEnable};
